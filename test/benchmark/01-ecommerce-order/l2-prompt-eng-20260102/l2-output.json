{
  "aggregates": [
    {
      "id": "AGG-CUSTOMER-001",
      "name": "Customer",
      "purpose": "Manages customer registration, authentication, and profile data with order placement capability",
      "invariants": [
        {
          "id": "INV-CUST-001",
          "rule": "Customer must have a valid email address",
          "enforcement": "Email value object validates format on creation; constructor rejects invalid emails"
        },
        {
          "id": "INV-CUST-002",
          "rule": "Email addresses must be unique across all customer accounts",
          "enforcement": "Repository checks uniqueness before persisting; database unique constraint as backup"
        },
        {
          "id": "INV-CUST-003",
          "rule": "Customer must be registered with verified email to place orders",
          "enforcement": "placeOrder method checks registrationStatus is REGISTERED and emailVerified is true"
        },
        {
          "id": "INV-CUST-004",
          "rule": "Password must meet minimum security requirements",
          "enforcement": "Password value object validates on creation"
        }
      ],
      "root": {
        "entity": "Customer",
        "identity": "CustomerId (UUID)",
        "attributes": [
          {
            "name": "customerId",
            "type": "CustomerId",
            "mutable": false
          },
          {
            "name": "email",
            "type": "Email",
            "mutable": true
          },
          {
            "name": "password",
            "type": "HashedPassword",
            "mutable": true
          },
          {
            "name": "registrationStatus",
            "type": "RegistrationStatus",
            "mutable": true
          },
          {
            "name": "emailVerified",
            "type": "boolean",
            "mutable": true
          },
          {
            "name": "cartId",
            "type": "CartId",
            "mutable": false
          }
        ]
      },
      "entities": [],
      "valueObjects": [
        "CustomerId",
        "Email",
        "HashedPassword",
        "RegistrationStatus"
      ],
      "behaviors": [
        {
          "name": "register",
          "command": "RegisterCustomer",
          "preconditions": [
            "Email not already registered",
            "Password meets requirements"
          ],
          "postconditions": [
            "Customer created with REGISTERED status",
            "Cart created for customer"
          ],
          "emits": "CustomerRegistered"
        },
        {
          "name": "verifyEmail",
          "command": "VerifyCustomerEmail",
          "preconditions": [
            "Valid verification token"
          ],
          "postconditions": [
            "emailVerified set to true"
          ],
          "emits": "EmailVerified"
        },
        {
          "name": "changeEmail",
          "command": "ChangeCustomerEmail",
          "preconditions": [
            "New email not already registered",
            "Email format valid"
          ],
          "postconditions": [
            "Email updated",
            "emailVerified reset to false"
          ],
          "emits": "CustomerEmailChanged"
        },
        {
          "name": "changePassword",
          "command": "ChangeCustomerPassword",
          "preconditions": [
            "Password meets requirements"
          ],
          "postconditions": [
            "Password updated"
          ],
          "emits": "CustomerPasswordChanged"
        }
      ],
      "events": [
        {
          "name": "CustomerRegistered",
          "payload": [
            "customerId",
            "email",
            "registeredAt"
          ]
        },
        {
          "name": "EmailVerified",
          "payload": [
            "customerId",
            "verifiedAt"
          ]
        },
        {
          "name": "CustomerEmailChanged",
          "payload": [
            "customerId",
            "oldEmail",
            "newEmail"
          ]
        },
        {
          "name": "CustomerPasswordChanged",
          "payload": [
            "customerId",
            "changedAt"
          ]
        }
      ],
      "repository": {
        "name": "CustomerRepository",
        "methods": [
          {
            "name": "findById",
            "params": "CustomerId",
            "returns": "Customer?"
          },
          {
            "name": "findByEmail",
            "params": "Email",
            "returns": "Customer?"
          },
          {
            "name": "existsByEmail",
            "params": "Email",
            "returns": "boolean"
          },
          {
            "name": "save",
            "params": "Customer",
            "returns": "void"
          }
        ],
        "loadStrategy": "Eager load all attributes; no child entities",
        "concurrency": "Optimistic locking with version field"
      },
      "externalReferences": [
        {
          "aggregate": "Cart",
          "via": "cartId",
          "type": "reference"
        },
        {
          "aggregate": "Order",
          "via": "N/A (orders reference customer)",
          "type": "reference"
        }
      ]
    },
    {
      "id": "AGG-CART-001",
      "name": "Cart",
      "purpose": "Manages shopping cart items with real-time pricing and stock validation before checkout",
      "invariants": [
        {
          "id": "INV-CART-001",
          "rule": "Total price equals sum of all item subtotals",
          "enforcement": "Total recalculated on every item add/update/remove operation"
        },
        {
          "id": "INV-CART-002",
          "rule": "Each product can appear only once in cart",
          "enforcement": "addItem checks for existing product and updates quantity instead of adding duplicate"
        },
        {
          "id": "INV-CART-003",
          "rule": "Cart item quantity must be at least 1",
          "enforcement": "CartItem constructor and updateQuantity validate quantity \u003e= 1"
        },
        {
          "id": "INV-CART-004",
          "rule": "Cart items reflect current product prices",
          "enforcement": "Cart recalculates totals by fetching current prices on cart view"
        },
        {
          "id": "INV-CART-005",
          "rule": "Cart item quantity cannot exceed available stock",
          "enforcement": "Application service validates stock before cart operations"
        }
      ],
      "root": {
        "entity": "Cart",
        "identity": "CartId (UUID)",
        "attributes": [
          {
            "name": "cartId",
            "type": "CartId",
            "mutable": false
          },
          {
            "name": "customerId",
            "type": "CustomerId",
            "mutable": false
          },
          {
            "name": "lastActivityAt",
            "type": "DateTime",
            "mutable": true
          }
        ]
      },
      "entities": [
        {
          "name": "CartItem",
          "identity": "CartItemId (UUID)",
          "purpose": "Represents a product and quantity within the shopping cart",
          "attributes": [
            {
              "name": "cartItemId",
              "type": "CartItemId",
              "mutable": false
            },
            {
              "name": "productId",
              "type": "ProductId",
              "mutable": false
            },
            {
              "name": "variantId",
              "type": "VariantId?",
              "mutable": false
            },
            {
              "name": "quantity",
              "type": "integer",
              "mutable": false
            }
          ]
        }
      ],
      "valueObjects": [
        "CartId",
        "CartItemId",
        "ProductId",
        "VariantId",
        "Money",
        "Quantity"
      ],
      "behaviors": [
        {
          "name": "addItem",
          "command": "AddItemToCart",
          "preconditions": [
            "Product exists and is active",
            "Stock available",
            "Quantity \u003e 0",
            "If product has variants, variant must be specified"
          ],
          "postconditions": [
            "CartItem added or quantity updated",
            "lastActivityAt updated"
          ],
          "emits": "ItemAddedToCart"
        },
        {
          "name": "updateQuantity",
          "command": "UpdateCartItemQuantity",
          "preconditions": [
            "Item exists in cart",
            "Quantity \u003e= 1",
            "Stock available for new quantity"
          ],
          "postconditions": [
            "Quantity updated",
            "lastActivityAt updated"
          ],
          "emits": "CartQuantityUpdated"
        },
        {
          "name": "removeItem",
          "command": "RemoveItemFromCart",
          "preconditions": [
            "Item exists in cart"
          ],
          "postconditions": [
            "Item removed",
            "lastActivityAt updated"
          ],
          "emits": "ItemRemovedFromCart"
        },
        {
          "name": "clear",
          "command": "ClearCart",
          "preconditions": [],
          "postconditions": [
            "All items removed",
            "lastActivityAt updated"
          ],
          "emits": "CartCleared"
        }
      ],
      "events": [
        {
          "name": "ItemAddedToCart",
          "payload": [
            "cartId",
            "productId",
            "variantId",
            "quantity"
          ]
        },
        {
          "name": "CartQuantityUpdated",
          "payload": [
            "cartId",
            "cartItemId",
            "oldQuantity",
            "newQuantity"
          ]
        },
        {
          "name": "ItemRemovedFromCart",
          "payload": [
            "cartId",
            "productId"
          ]
        },
        {
          "name": "CartCleared",
          "payload": [
            "cartId",
            "clearedAt"
          ]
        }
      ],
      "repository": {
        "name": "CartRepository",
        "methods": [
          {
            "name": "findById",
            "params": "CartId",
            "returns": "Cart?"
          },
          {
            "name": "findByCustomerId",
            "params": "CustomerId",
            "returns": "Cart?"
          },
          {
            "name": "save",
            "params": "Cart",
            "returns": "void"
          },
          {
            "name": "deleteExpired",
            "params": "DateTime cutoff",
            "returns": "int"
          }
        ],
        "loadStrategy": "Eager load Cart with all CartItems",
        "concurrency": "Optimistic locking with version field"
      },
      "externalReferences": [
        {
          "aggregate": "Customer",
          "via": "customerId",
          "type": "reference"
        },
        {
          "aggregate": "Product",
          "via": "productId in CartItem",
          "type": "reference"
        },
        {
          "aggregate": "Inventory",
          "via": "N/A (checked via service)",
          "type": "reference"
        }
      ]
    },
    {
      "id": "AGG-ORDER-001",
      "name": "Order",
      "purpose": "Represents a completed purchase transaction with immutable line items and state machine for fulfillment",
      "invariants": [
        {
          "id": "INV-ORD-001",
          "rule": "Order must have at least one line item",
          "enforcement": "Constructor validates lineItems list is not empty"
        },
        {
          "id": "INV-ORD-002",
          "rule": "Total amount equals subtotal plus shipping cost",
          "enforcement": "Calculated field; recalculated on creation only (immutable after)"
        },
        {
          "id": "INV-ORD-003",
          "rule": "Shipping is free when subtotal exceeds $50",
          "enforcement": "Shipping calculation applies zero cost when subtotal \u003e= 50"
        },
        {
          "id": "INV-ORD-004",
          "rule": "Order items are immutable after creation",
          "enforcement": "No setter methods for lineItems or shippingAddress after construction"
        },
        {
          "id": "INV-ORD-005",
          "rule": "Status transitions must follow valid state machine",
          "enforcement": "updateStatus method validates transition against allowed transitions map"
        },
        {
          "id": "INV-ORD-006",
          "rule": "Can only cancel before shipped status",
          "enforcement": "cancel method checks current status is PENDING or CONFIRMED"
        },
        {
          "id": "INV-ORD-007",
          "rule": "Order line items capture prices at order time",
          "enforcement": "OrderLineItem created with price snapshot; no price setters"
        }
      ],
      "root": {
        "entity": "Order",
        "identity": "OrderId (UUID)",
        "attributes": [
          {
            "name": "orderId",
            "type": "OrderId",
            "mutable": false
          },
          {
            "name": "customerId",
            "type": "CustomerId",
            "mutable": false
          },
          {
            "name": "status",
            "type": "OrderStatus",
            "mutable": true
          },
          {
            "name": "shippingAddress",
            "type": "ShippingAddress",
            "mutable": false
          },
          {
            "name": "paymentMethod",
            "type": "PaymentMethod",
            "mutable": false
          },
          {
            "name": "subtotal",
            "type": "Money",
            "mutable": false
          },
          {
            "name": "shippingCost",
            "type": "Money",
            "mutable": false
          },
          {
            "name": "totalAmount",
            "type": "Money",
            "mutable": false
          },
          {
            "name": "createdAt",
            "type": "DateTime",
            "mutable": false
          },
          {
            "name": "trackingNumber",
            "type": "string?",
            "mutable": true
          },
          {
            "name": "cancellationReason",
            "type": "string?",
            "mutable": true
          }
        ]
      },
      "entities": [
        {
          "name": "OrderLineItem",
          "identity": "LineItemId (UUID)",
          "purpose": "Immutable snapshot of a product at time of order with quantity and pricing",
          "attributes": [
            {
              "name": "lineItemId",
              "type": "LineItemId",
              "mutable": false
            },
            {
              "name": "productId",
              "type": "ProductId",
              "mutable": false
            },
            {
              "name": "productName",
              "type": "string",
              "mutable": false
            },
            {
              "name": "unitPrice",
              "type": "Money",
              "mutable": false
            },
            {
              "name": "quantity",
              "type": "integer",
              "mutable": false
            },
            {
              "name": "subtotal",
              "type": "Money",
              "mutable": false
            }
          ]
        }
      ],
      "valueObjects": [
        "OrderId",
        "LineItemId",
        "OrderStatus",
        "Money",
        "ShippingAddress",
        "PaymentMethod",
        "CustomerId",
        "ProductId"
      ],
      "behaviors": [
        {
          "name": "create",
          "command": "PlaceOrder",
          "preconditions": [
            "Customer is registered with verified email",
            "At least one line item",
            "All items in stock",
            "Payment authorized",
            "Valid shipping address"
          ],
          "postconditions": [
            "Order created with PENDING status",
            "Price snapshots captured",
            "Shipping cost calculated",
            "Inventory reserved"
          ],
          "emits": "OrderPlaced"
        },
        {
          "name": "confirm",
          "command": "ConfirmOrder",
          "preconditions": [
            "Status is PENDING"
          ],
          "postconditions": [
            "Status changes to CONFIRMED"
          ],
          "emits": "OrderConfirmed"
        },
        {
          "name": "ship",
          "command": "ShipOrder",
          "preconditions": [
            "Status is CONFIRMED",
            "Tracking number provided"
          ],
          "postconditions": [
            "Status changes to SHIPPED",
            "Tracking number recorded"
          ],
          "emits": "OrderShipped"
        },
        {
          "name": "deliver",
          "command": "DeliverOrder",
          "preconditions": [
            "Status is SHIPPED"
          ],
          "postconditions": [
            "Status changes to DELIVERED"
          ],
          "emits": "OrderDelivered"
        },
        {
          "name": "cancel",
          "command": "CancelOrder",
          "preconditions": [
            "Status is PENDING or CONFIRMED"
          ],
          "postconditions": [
            "Status changes to CANCELLED",
            "Cancellation reason recorded"
          ],
          "emits": "OrderCancelled"
        }
      ],
      "events": [
        {
          "name": "OrderPlaced",
          "payload": [
            "orderId",
            "customerId",
            "lineItems",
            "totalAmount",
            "createdAt"
          ]
        },
        {
          "name": "OrderConfirmed",
          "payload": [
            "orderId",
            "confirmedAt"
          ]
        },
        {
          "name": "OrderShipped",
          "payload": [
            "orderId",
            "trackingNumber",
            "shippedAt"
          ]
        },
        {
          "name": "OrderDelivered",
          "payload": [
            "orderId",
            "deliveredAt"
          ]
        },
        {
          "name": "OrderCancelled",
          "payload": [
            "orderId",
            "reason",
            "cancelledAt"
          ]
        }
      ],
      "repository": {
        "name": "OrderRepository",
        "methods": [
          {
            "name": "findById",
            "params": "OrderId",
            "returns": "Order?"
          },
          {
            "name": "findByCustomerId",
            "params": "CustomerId",
            "returns": "List\u003cOrder\u003e"
          },
          {
            "name": "findByStatus",
            "params": "OrderStatus",
            "returns": "List\u003cOrder\u003e"
          },
          {
            "name": "save",
            "params": "Order",
            "returns": "void"
          }
        ],
        "loadStrategy": "Eager load Order with all OrderLineItems",
        "concurrency": "Optimistic locking with version field"
      },
      "externalReferences": [
        {
          "aggregate": "Customer",
          "via": "customerId",
          "type": "reference"
        },
        {
          "aggregate": "Product",
          "via": "productId in OrderLineItem",
          "type": "snapshot"
        },
        {
          "aggregate": "Inventory",
          "via": "N/A (handled via domain events)",
          "type": "reference"
        }
      ]
    },
    {
      "id": "AGG-PRODUCT-001",
      "name": "Product",
      "purpose": "Represents a sellable item in the catalog with variants, pricing, and category association",
      "invariants": [
        {
          "id": "INV-PROD-001",
          "rule": "Price must be greater than zero",
          "enforcement": "Money value object validates minimum of 0.01"
        },
        {
          "id": "INV-PROD-002",
          "rule": "Product name must be between 2 and 200 characters",
          "enforcement": "Constructor and update method validate name length"
        },
        {
          "id": "INV-PROD-003",
          "rule": "Product description must not exceed 5000 characters",
          "enforcement": "Constructor and update method validate description length"
        },
        {
          "id": "INV-PROD-004",
          "rule": "Product must belong to a category",
          "enforcement": "Constructor requires categoryId; cannot be null"
        },
        {
          "id": "INV-PROD-005",
          "rule": "Inactive products cannot be added to carts",
          "enforcement": "Application service checks isActive before cart operations"
        },
        {
          "id": "INV-PROD-006",
          "rule": "Products can have up to 10 images with exactly one primary",
          "enforcement": "addImage validates count; setPrimaryImage ensures exactly one primary"
        },
        {
          "id": "INV-PROD-007",
          "rule": "Variant SKU must be unique",
          "enforcement": "Repository validates SKU uniqueness before save"
        },
        {
          "id": "INV-PROD-008",
          "rule": "Variant must have at least one attribute",
          "enforcement": "ProductVariant constructor validates size or color is provided"
        }
      ],
      "root": {
        "entity": "Product",
        "identity": "ProductId (UUID)",
        "attributes": [
          {
            "name": "productId",
            "type": "ProductId",
            "mutable": false
          },
          {
            "name": "name",
            "type": "string",
            "mutable": true
          },
          {
            "name": "description",
            "type": "string?",
            "mutable": true
          },
          {
            "name": "price",
            "type": "Money",
            "mutable": true
          },
          {
            "name": "categoryId",
            "type": "CategoryId",
            "mutable": true
          },
          {
            "name": "isActive",
            "type": "boolean",
            "mutable": true
          },
          {
            "name": "deletedAt",
            "type": "DateTime?",
            "mutable": true
          }
        ]
      },
      "entities": [
        {
          "name": "ProductVariant",
          "identity": "VariantId (UUID)",
          "purpose": "Represents a specific variation of a product (size, color)",
          "attributes": [
            {
              "name": "variantId",
              "type": "VariantId",
              "mutable": false
            },
            {
              "name": "sku",
              "type": "string",
              "mutable": false
            },
            {
              "name": "size",
              "type": "string?",
              "mutable": false
            },
            {
              "name": "color",
              "type": "string?",
              "mutable": false
            },
            {
              "name": "priceAdjustment",
              "type": "Money?",
              "mutable": false
            }
          ]
        },
        {
          "name": "ProductImage",
          "identity": "ImageId (UUID)",
          "purpose": "Product image with primary flag",
          "attributes": [
            {
              "name": "imageId",
              "type": "ImageId",
              "mutable": false
            },
            {
              "name": "url",
              "type": "string",
              "mutable": false
            },
            {
              "name": "isPrimary",
              "type": "boolean",
              "mutable": false
            }
          ]
        }
      ],
      "valueObjects": [
        "ProductId",
        "VariantId",
        "ImageId",
        "CategoryId",
        "Money",
        "SKU"
      ],
      "behaviors": [
        {
          "name": "create",
          "command": "CreateProduct",
          "preconditions": [
            "Price \u003e 0",
            "Name 2-200 chars",
            "Category exists"
          ],
          "postconditions": [
            "Product created as active"
          ],
          "emits": "ProductCreated"
        },
        {
          "name": "update",
          "command": "UpdateProduct",
          "preconditions": [
            "If price provided, price \u003e 0",
            "If name provided, 2-200 chars"
          ],
          "postconditions": [
            "Product attributes updated"
          ],
          "emits": "ProductUpdated"
        },
        {
          "name": "deactivate",
          "command": "DeactivateProduct",
          "preconditions": [
            "Product is active"
          ],
          "postconditions": [
            "isActive set to false"
          ],
          "emits": "ProductDeactivated"
        },
        {
          "name": "softDelete",
          "command": "DeleteProduct",
          "preconditions": [],
          "postconditions": [
            "deletedAt set to current timestamp"
          ],
          "emits": "ProductDeleted"
        },
        {
          "name": "addVariant",
          "command": "AddProductVariant",
          "preconditions": [
            "SKU is unique",
            "Size or color specified"
          ],
          "postconditions": [
            "Variant added to product"
          ],
          "emits": "VariantAdded"
        },
        {
          "name": "addImage",
          "command": "AddProductImage",
          "preconditions": [
            "Image count \u003c 10"
          ],
          "postconditions": [
            "Image added; if first image, set as primary"
          ],
          "emits": "ImageAdded"
        },
        {
          "name": "setPrimaryImage",
          "command": "SetPrimaryProductImage",
          "preconditions": [
            "Image exists"
          ],
          "postconditions": [
            "Selected image is primary; others are not"
          ],
          "emits": "PrimaryImageChanged"
        }
      ],
      "events": [
        {
          "name": "ProductCreated",
          "payload": [
            "productId",
            "name",
            "price",
            "categoryId"
          ]
        },
        {
          "name": "ProductUpdated",
          "payload": [
            "productId",
            "changedFields"
          ]
        },
        {
          "name": "ProductDeactivated",
          "payload": [
            "productId",
            "deactivatedAt"
          ]
        },
        {
          "name": "ProductDeleted",
          "payload": [
            "productId",
            "deletedAt"
          ]
        },
        {
          "name": "VariantAdded",
          "payload": [
            "productId",
            "variantId",
            "sku"
          ]
        },
        {
          "name": "ImageAdded",
          "payload": [
            "productId",
            "imageId",
            "url"
          ]
        },
        {
          "name": "PrimaryImageChanged",
          "payload": [
            "productId",
            "imageId"
          ]
        }
      ],
      "repository": {
        "name": "ProductRepository",
        "methods": [
          {
            "name": "findById",
            "params": "ProductId",
            "returns": "Product?"
          },
          {
            "name": "findByCategory",
            "params": "CategoryId",
            "returns": "List\u003cProduct\u003e"
          },
          {
            "name": "findActive",
            "params": "PaginationParams",
            "returns": "Page\u003cProduct\u003e"
          },
          {
            "name": "existsBySku",
            "params": "string",
            "returns": "boolean"
          },
          {
            "name": "save",
            "params": "Product",
            "returns": "void"
          }
        ],
        "loadStrategy": "Eager load Product with variants and images",
        "concurrency": "Optimistic locking with version field"
      },
      "externalReferences": [
        {
          "aggregate": "Category",
          "via": "categoryId",
          "type": "reference"
        },
        {
          "aggregate": "Inventory",
          "via": "N/A (inventory references product)",
          "type": "reference"
        }
      ]
    },
    {
      "id": "AGG-CATEGORY-001",
      "name": "Category",
      "purpose": "Organizes products into browsable hierarchical groupings",
      "invariants": [
        {
          "id": "INV-CAT-001",
          "rule": "Category name must be unique",
          "enforcement": "Repository validates uniqueness before save"
        },
        {
          "id": "INV-CAT-002",
          "rule": "Category cannot be its own parent",
          "enforcement": "setParent method validates parentCategoryId != categoryId"
        },
        {
          "id": "INV-CAT-003",
          "rule": "Category hierarchy limited to 3 levels",
          "enforcement": "setParent validates resulting depth \u003c= 3"
        }
      ],
      "root": {
        "entity": "Category",
        "identity": "CategoryId (UUID)",
        "attributes": [
          {
            "name": "categoryId",
            "type": "CategoryId",
            "mutable": false
          },
          {
            "name": "name",
            "type": "string",
            "mutable": true
          },
          {
            "name": "description",
            "type": "string?",
            "mutable": true
          },
          {
            "name": "parentCategoryId",
            "type": "CategoryId?",
            "mutable": true
          },
          {
            "name": "depth",
            "type": "integer",
            "mutable": true
          }
        ]
      },
      "entities": [],
      "valueObjects": [
        "CategoryId"
      ],
      "behaviors": [
        {
          "name": "create",
          "command": "CreateCategory",
          "preconditions": [
            "Name is unique",
            "If parent provided, resulting depth \u003c= 3"
          ],
          "postconditions": [
            "Category created",
            "Depth calculated from parent"
          ],
          "emits": "CategoryCreated"
        },
        {
          "name": "update",
          "command": "UpdateCategory",
          "preconditions": [
            "If name changed, new name is unique"
          ],
          "postconditions": [
            "Category attributes updated"
          ],
          "emits": "CategoryUpdated"
        },
        {
          "name": "setParent",
          "command": "SetCategoryParent",
          "preconditions": [
            "Not setting self as parent",
            "Resulting depth \u003c= 3"
          ],
          "postconditions": [
            "parentCategoryId updated",
            "Depth recalculated"
          ],
          "emits": "CategoryParentChanged"
        }
      ],
      "events": [
        {
          "name": "CategoryCreated",
          "payload": [
            "categoryId",
            "name",
            "parentCategoryId"
          ]
        },
        {
          "name": "CategoryUpdated",
          "payload": [
            "categoryId",
            "changedFields"
          ]
        },
        {
          "name": "CategoryParentChanged",
          "payload": [
            "categoryId",
            "oldParentId",
            "newParentId"
          ]
        }
      ],
      "repository": {
        "name": "CategoryRepository",
        "methods": [
          {
            "name": "findById",
            "params": "CategoryId",
            "returns": "Category?"
          },
          {
            "name": "findByName",
            "params": "string",
            "returns": "Category?"
          },
          {
            "name": "findRoots",
            "params": "void",
            "returns": "List\u003cCategory\u003e"
          },
          {
            "name": "findChildren",
            "params": "CategoryId",
            "returns": "List\u003cCategory\u003e"
          },
          {
            "name": "existsByName",
            "params": "string",
            "returns": "boolean"
          },
          {
            "name": "save",
            "params": "Category",
            "returns": "void"
          }
        ],
        "loadStrategy": "Load category without children; load children on demand",
        "concurrency": "Optimistic locking with version field"
      },
      "externalReferences": [
        {
          "aggregate": "Category",
          "via": "parentCategoryId",
          "type": "reference"
        }
      ]
    },
    {
      "id": "AGG-INVENTORY-001",
      "name": "Inventory",
      "purpose": "Tracks stock levels for products and manages availability with reservation support",
      "invariants": [
        {
          "id": "INV-INV-001",
          "rule": "Available quantity cannot be negative",
          "enforcement": "All operations validate resulting availableQuantity \u003e= 0"
        },
        {
          "id": "INV-INV-002",
          "rule": "Reserved quantity cannot exceed quantity on hand",
          "enforcement": "reserve method validates reservedQuantity + requested \u003c= quantityOnHand"
        },
        {
          "id": "INV-INV-003",
          "rule": "Each product has exactly one inventory record",
          "enforcement": "Repository enforces unique constraint on productId"
        },
        {
          "id": "INV-INV-004",
          "rule": "No backorders allowed",
          "enforcement": "isInStock method used to validate before order placement"
        }
      ],
      "root": {
        "entity": "Inventory",
        "identity": "InventoryId (UUID)",
        "attributes": [
          {
            "name": "inventoryId",
            "type": "InventoryId",
            "mutable": false
          },
          {
            "name": "productId",
            "type": "ProductId",
            "mutable": false
          },
          {
            "name": "quantityOnHand",
            "type": "integer",
            "mutable": true
          },
          {
            "name": "reservedQuantity",
            "type": "integer",
            "mutable": true
          }
        ]
      },
      "entities": [],
      "valueObjects": [
        "InventoryId",
        "ProductId",
        "Quantity"
      ],
      "behaviors": [
        {
          "name": "reserve",
          "command": "ReserveInventory",
          "preconditions": [
            "Available quantity \u003e= requested quantity"
          ],
          "postconditions": [
            "Reserved quantity increased by requested amount"
          ],
          "emits": "InventoryReserved"
        },
        {
          "name": "release",
          "command": "ReleaseInventory",
          "preconditions": [
            "Reserved quantity \u003e= requested quantity"
          ],
          "postconditions": [
            "Reserved quantity decreased by requested amount"
          ],
          "emits": "InventoryReleased"
        },
        {
          "name": "deduct",
          "command": "DeductInventory",
          "preconditions": [
            "Reserved quantity \u003e= requested quantity"
          ],
          "postconditions": [
            "Quantity on hand decreased",
            "Reserved quantity decreased"
          ],
          "emits": "InventoryDeducted"
        },
        {
          "name": "restock",
          "command": "RestockInventory",
          "preconditions": [
            "Quantity \u003e 0"
          ],
          "postconditions": [
            "Quantity on hand increased"
          ],
          "emits": "InventoryRestocked"
        },
        {
          "name": "restore",
          "command": "RestoreInventory",
          "preconditions": [
            "Quantity \u003e 0"
          ],
          "postconditions": [
            "Quantity on hand increased (for cancelled orders)"
          ],
          "emits": "InventoryRestored"
        }
      ],
      "events": [
        {
          "name": "InventoryReserved",
          "payload": [
            "inventoryId",
            "productId",
            "quantity",
            "newAvailable"
          ]
        },
        {
          "name": "InventoryReleased",
          "payload": [
            "inventoryId",
            "productId",
            "quantity",
            "newAvailable"
          ]
        },
        {
          "name": "InventoryDeducted",
          "payload": [
            "inventoryId",
            "productId",
            "quantity",
            "newOnHand"
          ]
        },
        {
          "name": "InventoryRestocked",
          "payload": [
            "inventoryId",
            "productId",
            "quantity",
            "newOnHand"
          ]
        },
        {
          "name": "InventoryRestored",
          "payload": [
            "inventoryId",
            "productId",
            "quantity",
            "reason"
          ]
        },
        {
          "name": "OutOfStock",
          "payload": [
            "inventoryId",
            "productId"
          ]
        }
      ],
      "repository": {
        "name": "InventoryRepository",
        "methods": [
          {
            "name": "findById",
            "params": "InventoryId",
            "returns": "Inventory?"
          },
          {
            "name": "findByProductId",
            "params": "ProductId",
            "returns": "Inventory?"
          },
          {
            "name": "findLowStock",
            "params": "int threshold",
            "returns": "List\u003cInventory\u003e"
          },
          {
            "name": "save",
            "params": "Inventory",
            "returns": "void"
          }
        ],
        "loadStrategy": "Simple load; no child entities",
        "concurrency": "Pessimistic locking for reserve/release/deduct to prevent overselling"
      },
      "externalReferences": [
        {
          "aggregate": "Product",
          "via": "productId",
          "type": "reference"
        }
      ]
    }
  ],
  "enums": [
    {
      "name": "registration_status_enum",
      "values": [
        "REGISTERED",
        "UNREGISTERED"
      ]
    },
    {
      "name": "order_status_enum",
      "values": [
        "PENDING",
        "CONFIRMED",
        "SHIPPED",
        "DELIVERED",
        "CANCELLED"
      ]
    },
    {
      "name": "payment_type_enum",
      "values": [
        "CREDIT_CARD",
        "PAYPAL"
      ]
    }
  ],
  "interface_contracts": [
    {
      "id": "IC-PRODUCT-001",
      "serviceName": "Product Service",
      "purpose": "Manages product catalog, categories, and product variants for the e-commerce platform",
      "baseUrl": "/api/v1/products",
      "operations": [
        {
          "id": "OP-PRODUCT-001",
          "name": "listProducts",
          "method": "GET",
          "path": "/",
          "description": "Browse products with filtering, sorting, and pagination",
          "inputSchema": {
            "categoryId": {
              "type": "CategoryId (UUID)"
            },
            "inStock": {
              "type": "boolean"
            },
            "maxPrice": {
              "type": "Money"
            },
            "minPrice": {
              "type": "Money"
            },
            "page": {
              "type": "integer"
            },
            "pageSize": {
              "type": "integer"
            },
            "sortBy": {
              "type": "enum(name, price_asc, price_desc, newest)"
            }
          },
          "outputSchema": {
            "hasMore": {
              "type": "boolean"
            },
            "page": {
              "type": "integer"
            },
            "pageSize": {
              "type": "integer"
            },
            "products": {
              "type": "Product[]"
            },
            "totalCount": {
              "type": "integer"
            }
          },
          "errors": [
            {
              "code": "INVALID_PRICE_RANGE",
              "httpStatus": 400,
              "message": "Minimum price cannot exceed maximum price"
            }
          ],
          "preconditions": [],
          "postconditions": [
            "Products matching filters are returned sorted and paginated"
          ],
          "relatedACs": [
            "AC-PROD-001",
            "AC-PROD-002"
          ],
          "relatedBRs": []
        },
        {
          "id": "OP-PRODUCT-002",
          "name": "getProduct",
          "method": "GET",
          "path": "/{productId}",
          "description": "Get detailed product information including variants",
          "inputSchema": {
            "productId": {
              "type": "ProductId (UUID)",
              "required": true
            }
          },
          "outputSchema": {
            "availableQuantity": {
              "type": "integer"
            },
            "categoryId": {
              "type": "CategoryId"
            },
            "description": {
              "type": "string"
            },
            "images": {
              "type": "ProductImage[]"
            },
            "inStock": {
              "type": "boolean"
            },
            "isActive": {
              "type": "boolean"
            },
            "name": {
              "type": "string"
            },
            "price": {
              "type": "Money"
            },
            "productId": {
              "type": "ProductId (UUID)"
            },
            "variants": {
              "type": "ProductVariant[]"
            }
          },
          "errors": [
            {
              "code": "PRODUCT_NOT_FOUND",
              "httpStatus": 404,
              "message": "Product with specified ID does not exist"
            }
          ],
          "preconditions": [
            "Product must exist and be active for customer view"
          ],
          "postconditions": [
            "Product details with variant stock status returned"
          ],
          "relatedACs": [
            "AC-PROD-002",
            "AC-VAR-001"
          ],
          "relatedBRs": []
        },
        {
          "id": "OP-PRODUCT-003",
          "name": "createProduct",
          "method": "POST",
          "path": "/",
          "description": "Create a new product in draft status",
          "inputSchema": {
            "categoryId": {
              "type": "CategoryId (UUID)",
              "required": true
            },
            "description": {
              "type": "string"
            },
            "name": {
              "type": "string",
              "required": true
            },
            "price": {
              "type": "Money",
              "required": true
            }
          },
          "outputSchema": {
            "createdAt": {
              "type": "DateTime"
            },
            "createdBy": {
              "type": "UserId"
            },
            "name": {
              "type": "string"
            },
            "productId": {
              "type": "ProductId (UUID)"
            },
            "status": {
              "type": "enum(draft, active)"
            }
          },
          "errors": [
            {
              "code": "INVALID_PRICE",
              "httpStatus": 400,
              "message": "Price must be at least $0.01"
            },
            {
              "code": "INVALID_PRODUCT_NAME",
              "httpStatus": 400,
              "message": "Product name must be between 2 and 200 characters"
            },
            {
              "code": "DESCRIPTION_TOO_LONG",
              "httpStatus": 400,
              "message": "Product description must not exceed 5000 characters"
            },
            {
              "code": "CATEGORY_NOT_FOUND",
              "httpStatus": 404,
              "message": "Specified category does not exist"
            }
          ],
          "preconditions": [
            "User must be authenticated as admin",
            "Category must exist"
          ],
          "postconditions": [
            "Product created in draft status",
            "ProductCreated event emitted"
          ],
          "relatedACs": [
            "AC-ADMIN-001"
          ],
          "relatedBRs": [
            "BR-PRICE-001",
            "BR-PROD-002",
            "BR-PROD-003"
          ]
        },
        {
          "id": "OP-PRODUCT-004",
          "name": "updateProduct",
          "method": "PUT",
          "path": "/{productId}",
          "description": "Update existing product attributes",
          "inputSchema": {
            "categoryId": {
              "type": "CategoryId (UUID)"
            },
            "description": {
              "type": "string"
            },
            "name": {
              "type": "string"
            },
            "price": {
              "type": "Money"
            },
            "productId": {
              "type": "ProductId (UUID)",
              "required": true
            }
          },
          "outputSchema": {
            "categoryId": {
              "type": "CategoryId"
            },
            "description": {
              "type": "string"
            },
            "name": {
              "type": "string"
            },
            "price": {
              "type": "Money"
            },
            "productId": {
              "type": "ProductId (UUID)"
            },
            "updatedAt": {
              "type": "DateTime"
            },
            "updatedBy": {
              "type": "UserId"
            }
          },
          "errors": [
            {
              "code": "PRODUCT_NOT_FOUND",
              "httpStatus": 404,
              "message": "Product with specified ID does not exist"
            },
            {
              "code": "INVALID_PRICE",
              "httpStatus": 400,
              "message": "Price must be at least $0.01"
            },
            {
              "code": "INVALID_PRODUCT_NAME",
              "httpStatus": 400,
              "message": "Product name must be between 2 and 200 characters"
            },
            {
              "code": "DESCRIPTION_TOO_LONG",
              "httpStatus": 400,
              "message": "Product description must not exceed 5000 characters"
            },
            {
              "code": "CATEGORY_NOT_FOUND",
              "httpStatus": 404,
              "message": "Specified category does not exist"
            }
          ],
          "preconditions": [
            "User must be authenticated as admin",
            "Product must exist"
          ],
          "postconditions": [
            "Product updated",
            "Price changes logged in audit trail",
            "ProductUpdated event emitted",
            "Carts with this product reflect new price"
          ],
          "relatedACs": [
            "AC-ADMIN-002"
          ],
          "relatedBRs": [
            "BR-PRICE-001",
            "BR-PROD-002",
            "BR-PROD-003",
            "BR-AUDIT-003"
          ]
        },
        {
          "id": "OP-PRODUCT-005",
          "name": "deleteProduct",
          "method": "DELETE",
          "path": "/{productId}",
          "description": "Soft delete a product (preserved for order history)",
          "inputSchema": {
            "productId": {
              "type": "ProductId (UUID)",
              "required": true
            }
          },
          "outputSchema": {
            "deletedAt": {
              "type": "DateTime"
            },
            "success": {
              "type": "boolean"
            }
          },
          "errors": [
            {
              "code": "PRODUCT_NOT_FOUND",
              "httpStatus": 404,
              "message": "Product with specified ID does not exist"
            }
          ],
          "preconditions": [
            "User must be authenticated as admin",
            "Product must exist"
          ],
          "postconditions": [
            "Product soft-deleted",
            "Removed from carts",
            "No longer appears in listings",
            "ProductDeactivated event emitted"
          ],
          "relatedACs": [
            "AC-ADMIN-003"
          ],
          "relatedBRs": [
            "BR-PROD-001"
          ]
        },
        {
          "id": "OP-PRODUCT-006",
          "name": "addProductImages",
          "method": "POST",
          "path": "/{productId}/images",
          "description": "Add images to a product (max 10 with one primary)",
          "inputSchema": {
            "images": {
              "type": "ImageUpload[]",
              "required": true
            },
            "primaryImageIndex": {
              "type": "integer"
            },
            "productId": {
              "type": "ProductId (UUID)",
              "required": true
            }
          },
          "outputSchema": {
            "images": {
              "type": "ProductImage[]"
            },
            "primaryImage": {
              "type": "ProductImage"
            }
          },
          "errors": [
            {
              "code": "PRODUCT_NOT_FOUND",
              "httpStatus": 404,
              "message": "Product with specified ID does not exist"
            },
            {
              "code": "IMAGE_LIMIT_EXCEEDED",
              "httpStatus": 400,
              "message": "Products cannot have more than 10 images"
            }
          ],
          "preconditions": [
            "User must be authenticated as admin",
            "Product must exist",
            "Total images after add must not exceed 10"
          ],
          "postconditions": [
            "Images added to product",
            "Exactly one image marked as primary"
          ],
          "relatedACs": [
            "AC-ADMIN-001"
          ],
          "relatedBRs": [
            "BR-PROD-004"
          ]
        },
        {
          "id": "OP-PRODUCT-007",
          "name": "addProductVariant",
          "method": "POST",
          "path": "/{productId}/variants",
          "description": "Add a variant to a product with unique SKU",
          "inputSchema": {
            "color": {
              "type": "string"
            },
            "priceAdjustment": {
              "type": "Money"
            },
            "productId": {
              "type": "ProductId (UUID)",
              "required": true
            },
            "size": {
              "type": "string"
            },
            "sku": {
              "type": "string",
              "required": true
            }
          },
          "outputSchema": {
            "color": {
              "type": "string"
            },
            "priceAdjustment": {
              "type": "Money"
            },
            "size": {
              "type": "string"
            },
            "sku": {
              "type": "string"
            },
            "variantId": {
              "type": "VariantId (UUID)"
            }
          },
          "errors": [
            {
              "code": "PRODUCT_NOT_FOUND",
              "httpStatus": 404,
              "message": "Product with specified ID does not exist"
            },
            {
              "code": "DUPLICATE_SKU",
              "httpStatus": 409,
              "message": "A variant with this SKU already exists"
            },
            {
              "code": "VARIANT_ATTRIBUTES_REQUIRED",
              "httpStatus": 400,
              "message": "At least one variant attribute (size or color) must be specified"
            }
          ],
          "preconditions": [
            "User must be authenticated as admin",
            "Product must exist",
            "SKU must be unique"
          ],
          "postconditions": [
            "Variant added to product"
          ],
          "relatedACs": [
            "AC-VAR-001"
          ],
          "relatedBRs": [
            "BR-VAR-001"
          ]
        }
      ],
      "events": [
        {
          "name": "ProductCreated",
          "description": "Emitted when a new product is created",
          "payload": [
            "productId",
            "name",
            "price",
            "categoryId",
            "createdAt",
            "createdBy"
          ]
        },
        {
          "name": "ProductUpdated",
          "description": "Emitted when product attributes are modified",
          "payload": [
            "productId",
            "changedFields",
            "previousPrice",
            "newPrice",
            "updatedAt",
            "updatedBy"
          ]
        },
        {
          "name": "ProductDeactivated",
          "description": "Emitted when a product is soft-deleted",
          "payload": [
            "productId",
            "deletedAt",
            "deletedBy"
          ]
        }
      ],
      "securityRequirements": {
        "authentication": "Bearer JWT",
        "authorization": "Admin role required for create/update/delete operations; public read for active products"
      }
    },
    {
      "id": "IC-CATEGORY-001",
      "serviceName": "Category Service",
      "purpose": "Organizes products into hierarchical browsable groupings",
      "baseUrl": "/api/v1/categories",
      "operations": [
        {
          "id": "OP-CATEGORY-001",
          "name": "listCategories",
          "method": "GET",
          "path": "/",
          "description": "List all categories in hierarchical structure",
          "inputSchema": {
            "includeInactive": {
              "type": "boolean"
            },
            "parentId": {
              "type": "CategoryId (UUID)"
            }
          },
          "outputSchema": {
            "categories": {
              "type": "Category[]"
            }
          },
          "errors": [],
          "preconditions": [],
          "postconditions": [
            "Categories returned in hierarchical structure up to 3 levels"
          ],
          "relatedACs": [
            "AC-CAT-001"
          ],
          "relatedBRs": [
            "BR-CAT-001"
          ]
        },
        {
          "id": "OP-CATEGORY-002",
          "name": "getCategory",
          "method": "GET",
          "path": "/{categoryId}",
          "description": "Get category details with products",
          "inputSchema": {
            "categoryId": {
              "type": "CategoryId (UUID)",
              "required": true
            }
          },
          "outputSchema": {
            "categoryId": {
              "type": "CategoryId (UUID)"
            },
            "description": {
              "type": "string"
            },
            "name": {
              "type": "string"
            },
            "parentCategoryId": {
              "type": "CategoryId (UUID)"
            },
            "productCount": {
              "type": "integer"
            },
            "subcategories": {
              "type": "Category[]"
            }
          },
          "errors": [
            {
              "code": "CATEGORY_NOT_FOUND",
              "httpStatus": 404,
              "message": "Category with specified ID does not exist"
            }
          ],
          "preconditions": [
            "Category must exist"
          ],
          "postconditions": [
            "Category details with subcategories returned"
          ],
          "relatedACs": [
            "AC-CAT-001"
          ],
          "relatedBRs": []
        },
        {
          "id": "OP-CATEGORY-003",
          "name": "createCategory",
          "method": "POST",
          "path": "/",
          "description": "Create a new category",
          "inputSchema": {
            "description": {
              "type": "string"
            },
            "name": {
              "type": "string",
              "required": true
            },
            "parentCategoryId": {
              "type": "CategoryId (UUID)"
            }
          },
          "outputSchema": {
            "categoryId": {
              "type": "CategoryId (UUID)"
            },
            "depth": {
              "type": "integer"
            },
            "name": {
              "type": "string"
            }
          },
          "errors": [
            {
              "code": "DUPLICATE_CATEGORY_NAME",
              "httpStatus": 409,
              "message": "A category with this name already exists"
            },
            {
              "code": "PARENT_CATEGORY_NOT_FOUND",
              "httpStatus": 404,
              "message": "Parent category does not exist"
            },
            {
              "code": "CATEGORY_DEPTH_EXCEEDED",
              "httpStatus": 400,
              "message": "Categories cannot be nested more than 3 levels deep"
            }
          ],
          "preconditions": [
            "User must be authenticated as admin",
            "Category name must be unique",
            "If parent specified, parent must exist",
            "Resulting depth must not exceed 3"
          ],
          "postconditions": [
            "Category created",
            "CategoryCreated event emitted"
          ],
          "relatedACs": [
            "AC-CAT-001"
          ],
          "relatedBRs": [
            "BR-CAT-001"
          ]
        }
      ],
      "events": [
        {
          "name": "CategoryCreated",
          "description": "Emitted when a new category is created",
          "payload": [
            "categoryId",
            "name",
            "parentCategoryId",
            "depth",
            "createdAt"
          ]
        }
      ],
      "securityRequirements": {
        "authentication": "Bearer JWT",
        "authorization": "Admin role required for create/update/delete; public read for active categories"
      }
    },
    {
      "id": "IC-CART-001",
      "serviceName": "Cart Service",
      "purpose": "Manages shopping carts for customers, handling item additions, updates, and cart lifecycle",
      "baseUrl": "/api/v1/carts",
      "operations": [
        {
          "id": "OP-CART-001",
          "name": "getCart",
          "method": "GET",
          "path": "/",
          "description": "Get current user's cart with items and totals",
          "inputSchema": {},
          "outputSchema": {
            "cartId": {
              "type": "CartId (UUID)"
            },
            "customerId": {
              "type": "CustomerId (UUID)"
            },
            "itemCount": {
              "type": "integer"
            },
            "items": {
              "type": "CartItem[]"
            },
            "priceChanges": {
              "type": "PriceChange[]"
            },
            "stockWarnings": {
              "type": "StockWarning[]"
            },
            "totalPrice": {
              "type": "Money"
            }
          },
          "errors": [],
          "preconditions": [],
          "postconditions": [
            "Cart returned with current prices",
            "Price changes since last view indicated",
            "Out-of-stock items flagged"
          ],
          "relatedACs": [
            "AC-CART-007",
            "AC-CART-008"
          ],
          "relatedBRs": [
            "BR-CART-001"
          ]
        },
        {
          "id": "OP-CART-002",
          "name": "addToCart",
          "method": "POST",
          "path": "/items",
          "description": "Add a product to the cart",
          "inputSchema": {
            "productId": {
              "type": "ProductId (UUID)",
              "required": true
            },
            "quantity": {
              "type": "integer",
              "required": true
            },
            "variantId": {
              "type": "VariantId (UUID)"
            }
          },
          "outputSchema": {
            "cartId": {
              "type": "CartId (UUID)"
            },
            "cartItem": {
              "type": "CartItem"
            },
            "itemCount": {
              "type": "integer"
            },
            "totalPrice": {
              "type": "Money"
            }
          },
          "errors": [
            {
              "code": "PRODUCT_NOT_FOUND",
              "httpStatus": 404,
              "message": "Product with specified ID does not exist"
            },
            {
              "code": "OUT_OF_STOCK",
              "httpStatus": 409,
              "message": "Product is out of stock"
            },
            {
              "code": "QUANTITY_EXCEEDS_STOCK",
              "httpStatus": 409,
              "message": "Requested quantity exceeds available stock"
            },
            {
              "code": "VARIANT_REQUIRED",
              "httpStatus": 400,
              "message": "Product has variants; variant selection is required"
            },
            {
              "code": "VARIANT_NOT_FOUND",
              "httpStatus": 404,
              "message": "Specified variant does not exist"
            },
            {
              "code": "PRODUCT_INACTIVE",
              "httpStatus": 409,
              "message": "Product is not available for purchase"
            }
          ],
          "preconditions": [
            "Product must exist and be active",
            "If product has variants, variant must be specified",
            "Quantity must be greater than 0",
            "Available stock must be sufficient"
          ],
          "postconditions": [
            "Item added to cart or quantity updated if already exists",
            "Cart total recalculated",
            "ItemAddedToCart event emitted"
          ],
          "relatedACs": [
            "AC-CART-001",
            "AC-CART-002"
          ],
          "relatedBRs": [
            "BR-STOCK-001",
            "BR-VAR-002",
            "BR-CART-002"
          ]
        },
        {
          "id": "OP-CART-003",
          "name": "updateCartItemQuantity",
          "method": "PATCH",
          "path": "/items/{cartItemId}",
          "description": "Update quantity of a cart item",
          "inputSchema": {
            "cartItemId": {
              "type": "CartItemId (UUID)",
              "required": true
            },
            "quantity": {
              "type": "integer",
              "required": true
            }
          },
          "outputSchema": {
            "cartItem": {
              "type": "CartItem"
            },
            "totalPrice": {
              "type": "Money"
            }
          },
          "errors": [
            {
              "code": "CART_ITEM_NOT_FOUND",
              "httpStatus": 404,
              "message": "Cart item with specified ID does not exist"
            },
            {
              "code": "QUANTITY_EXCEEDS_STOCK",
              "httpStatus": 409,
              "message": "Requested quantity exceeds available stock"
            },
            {
              "code": "INVALID_QUANTITY",
              "httpStatus": 400,
              "message": "Quantity must be at least 0"
            }
          ],
          "preconditions": [
            "Cart item must exist",
            "Quantity must be \u003e= 0"
          ],
          "postconditions": [
            "Quantity updated (or item removed if quantity is 0)",
            "Cart total recalculated",
            "CartQuantityUpdated event emitted"
          ],
          "relatedACs": [
            "AC-CART-005"
          ],
          "relatedBRs": [
            "BR-CART-002"
          ]
        },
        {
          "id": "OP-CART-004",
          "name": "removeFromCart",
          "method": "DELETE",
          "path": "/items/{cartItemId}",
          "description": "Remove an item from the cart",
          "inputSchema": {
            "cartItemId": {
              "type": "CartItemId (UUID)",
              "required": true
            }
          },
          "outputSchema": {
            "success": {
              "type": "boolean"
            },
            "undoExpiresAt": {
              "type": "DateTime"
            },
            "undoToken": {
              "type": "string"
            }
          },
          "errors": [
            {
              "code": "CART_ITEM_NOT_FOUND",
              "httpStatus": 404,
              "message": "Cart item with specified ID does not exist"
            }
          ],
          "preconditions": [
            "Cart item must exist"
          ],
          "postconditions": [
            "Item removed from cart",
            "Cart total recalculated",
            "Undo option available briefly",
            "ItemRemovedFromCart event emitted"
          ],
          "relatedACs": [
            "AC-CART-006"
          ],
          "relatedBRs": []
        },
        {
          "id": "OP-CART-005",
          "name": "undoRemoveFromCart",
          "method": "POST",
          "path": "/items/undo",
          "description": "Restore a recently removed cart item",
          "inputSchema": {
            "undoToken": {
              "type": "string",
              "required": true
            }
          },
          "outputSchema": {
            "cartItem": {
              "type": "CartItem"
            },
            "totalPrice": {
              "type": "Money"
            }
          },
          "errors": [
            {
              "code": "UNDO_TOKEN_EXPIRED",
              "httpStatus": 410,
              "message": "Undo window has expired"
            },
            {
              "code": "UNDO_TOKEN_INVALID",
              "httpStatus": 400,
              "message": "Invalid undo token"
            }
          ],
          "preconditions": [
            "Undo token must be valid and not expired"
          ],
          "postconditions": [
            "Item restored to cart",
            "Cart total recalculated"
          ],
          "relatedACs": [
            "AC-CART-006"
          ],
          "relatedBRs": []
        },
        {
          "id": "OP-CART-006",
          "name": "clearCart",
          "method": "DELETE",
          "path": "/",
          "description": "Remove all items from the cart",
          "inputSchema": {},
          "outputSchema": {
            "success": {
              "type": "boolean"
            }
          },
          "errors": [],
          "preconditions": [],
          "postconditions": [
            "All items removed from cart",
            "CartCleared event emitted"
          ],
          "relatedACs": [],
          "relatedBRs": []
        },
        {
          "id": "OP-CART-007",
          "name": "mergeGuestCart",
          "method": "POST",
          "path": "/merge",
          "description": "Merge guest cart into authenticated user's cart on login",
          "inputSchema": {
            "guestCartId": {
              "type": "CartId (UUID)",
              "required": true
            }
          },
          "outputSchema": {
            "cartId": {
              "type": "CartId (UUID)"
            },
            "items": {
              "type": "CartItem[]"
            },
            "mergeConflicts": {
              "type": "MergeConflict[]"
            },
            "totalPrice": {
              "type": "Money"
            }
          },
          "errors": [
            {
              "code": "GUEST_CART_NOT_FOUND",
              "httpStatus": 404,
              "message": "Guest cart with specified ID does not exist"
            },
            {
              "code": "GUEST_CART_EXPIRED",
              "httpStatus": 410,
              "message": "Guest cart has expired"
            }
          ],
          "preconditions": [
            "User must be authenticated",
            "Guest cart must exist"
          ],
          "postconditions": [
            "Guest cart items merged into user cart",
            "Quantities combined for duplicate products",
            "Stock limits enforced with notifications"
          ],
          "relatedACs": [
            "AC-CART-004"
          ],
          "relatedBRs": [
            "BR-CART-002"
          ]
        }
      ],
      "events": [
        {
          "name": "ItemAddedToCart",
          "description": "Emitted when an item is added to cart",
          "payload": [
            "cartId",
            "customerId",
            "productId",
            "variantId",
            "quantity",
            "unitPrice"
          ]
        },
        {
          "name": "CartQuantityUpdated",
          "description": "Emitted when cart item quantity changes",
          "payload": [
            "cartId",
            "cartItemId",
            "previousQuantity",
            "newQuantity"
          ]
        },
        {
          "name": "ItemRemovedFromCart",
          "description": "Emitted when an item is removed from cart",
          "payload": [
            "cartId",
            "cartItemId",
            "productId"
          ]
        },
        {
          "name": "CartCleared",
          "description": "Emitted when cart is emptied",
          "payload": [
            "cartId",
            "customerId",
            "reason"
          ]
        }
      ],
      "securityRequirements": {
        "authentication": "Bearer JWT or session token for guest carts",
        "authorization": "User can only access their own cart"
      }
    },
    {
      "id": "IC-ORDER-001",
      "serviceName": "Order Service",
      "purpose": "Handles order placement, status management, and order history for customers and administrators",
      "baseUrl": "/api/v1/orders",
      "operations": [
        {
          "id": "OP-ORDER-001",
          "name": "placeOrder",
          "method": "POST",
          "path": "/",
          "description": "Create a new order from the customer's cart",
          "inputSchema": {
            "paymentMethod": {
              "type": "PaymentMethod"
            },
            "paymentMethodId": {
              "type": "PaymentMethodId (UUID)"
            },
            "shippingAddress": {
              "type": "ShippingAddress"
            },
            "shippingAddressId": {
              "type": "AddressId (UUID)"
            }
          },
          "outputSchema": {
            "createdAt": {
              "type": "DateTime"
            },
            "lineItems": {
              "type": "OrderLineItem[]"
            },
            "orderId": {
              "type": "OrderId (UUID)"
            },
            "orderNumber": {
              "type": "string"
            },
            "shippingAddress": {
              "type": "ShippingAddress"
            },
            "shippingCost": {
              "type": "Money"
            },
            "status": {
              "type": "OrderStatus"
            },
            "subtotal": {
              "type": "Money"
            },
            "tax": {
              "type": "Money"
            },
            "totalAmount": {
              "type": "Money"
            }
          },
          "errors": [
            {
              "code": "REGISTRATION_REQUIRED",
              "httpStatus": 403,
              "message": "Only registered customers can place orders"
            },
            {
              "code": "EMAIL_NOT_VERIFIED",
              "httpStatus": 403,
              "message": "Email verification required before placing orders"
            },
            {
              "code": "CART_EMPTY",
              "httpStatus": 400,
              "message": "Cannot place order with empty cart"
            },
            {
              "code": "OUT_OF_STOCK",
              "httpStatus": 409,
              "message": "One or more items are out of stock"
            },
            {
              "code": "INSUFFICIENT_STOCK",
              "httpStatus": 409,
              "message": "Requested quantity exceeds available stock"
            },
            {
              "code": "BACKORDER_NOT_SUPPORTED",
              "httpStatus": 409,
              "message": "Backorders are not allowed"
            },
            {
              "code": "PAYMENT_REQUIRED",
              "httpStatus": 402,
              "message": "Payment authorization failed"
            },
            {
              "code": "INCOMPLETE_ADDRESS",
              "httpStatus": 400,
              "message": "Shipping address is missing required fields"
            },
            {
              "code": "INTERNATIONAL_SHIPPING_NOT_AVAILABLE",
              "httpStatus": 400,
              "message": "Shipping is only available domestically"
            }
          ],
          "preconditions": [
            "Customer must be registered with verified email",
            "Cart must not be empty",
            "All items must be in stock",
            "Shipping address must be valid and domestic",
            "Payment must be authorized"
          ],
          "postconditions": [
            "Order created with status PENDING",
            "Inventory decremented",
            "Cart cleared",
            "Prices captured at order time",
            "OrderPlaced event emitted",
            "Confirmation email queued"
          ],
          "relatedACs": [
            "AC-ORDER-001",
            "AC-ORDER-002",
            "AC-ORDER-003",
            "AC-ORDER-007"
          ],
          "relatedBRs": [
            "BR-AUTH-001",
            "BR-STOCK-001",
            "BR-SHIP-001",
            "BR-PAY-001",
            "BR-INV-001",
            "BR-INV-002",
            "BR-PRICE-002",
            "BR-CUST-003"
          ]
        },
        {
          "id": "OP-ORDER-002",
          "name": "getOrder",
          "method": "GET",
          "path": "/{orderId}",
          "description": "Get order details by ID",
          "inputSchema": {
            "orderId": {
              "type": "OrderId (UUID)",
              "required": true
            }
          },
          "outputSchema": {
            "createdAt": {
              "type": "DateTime"
            },
            "lineItems": {
              "type": "OrderLineItem[]"
            },
            "orderId": {
              "type": "OrderId (UUID)"
            },
            "orderNumber": {
              "type": "string"
            },
            "shippingAddress": {
              "type": "ShippingAddress"
            },
            "shippingCost": {
              "type": "Money"
            },
            "status": {
              "type": "OrderStatus"
            },
            "statusHistory": {
              "type": "StatusChange[]"
            },
            "subtotal": {
              "type": "Money"
            },
            "tax": {
              "type": "Money"
            },
            "totalAmount": {
              "type": "Money"
            },
            "trackingNumber": {
              "type": "string"
            }
          },
          "errors": [
            {
              "code": "ORDER_NOT_FOUND",
              "httpStatus": 404,
              "message": "Order with specified ID does not exist"
            },
            {
              "code": "ACCESS_DENIED",
              "httpStatus": 403,
              "message": "You do not have permission to view this order"
            }
          ],
          "preconditions": [
            "Order must exist",
            "User must be order owner or admin"
          ],
          "postconditions": [
            "Order details returned"
          ],
          "relatedACs": [
            "AC-ORDER-005"
          ],
          "relatedBRs": []
        },
        {
          "id": "OP-ORDER-003",
          "name": "listOrders",
          "method": "GET",
          "path": "/",
          "description": "List orders for current customer or all orders for admin",
          "inputSchema": {
            "customerId": {
              "type": "CustomerId (UUID)"
            },
            "endDate": {
              "type": "Date"
            },
            "orderNumber": {
              "type": "string"
            },
            "page": {
              "type": "integer"
            },
            "pageSize": {
              "type": "integer"
            },
            "startDate": {
              "type": "Date"
            },
            "status": {
              "type": "OrderStatus"
            }
          },
          "outputSchema": {
            "orders": {
              "type": "OrderSummary[]"
            },
            "page": {
              "type": "integer"
            },
            "pageSize": {
              "type": "integer"
            },
            "totalCount": {
              "type": "integer"
            }
          },
          "errors": [],
          "preconditions": [
            "User must be authenticated"
          ],
          "postconditions": [
            "Orders returned with pagination"
          ],
          "relatedACs": [
            "AC-ORDER-005",
            "AC-ADMIN-004"
          ],
          "relatedBRs": []
        },
        {
          "id": "OP-ORDER-004",
          "name": "cancelOrder",
          "method": "POST",
          "path": "/{orderId}/cancel",
          "description": "Cancel an order before it ships",
          "inputSchema": {
            "orderId": {
              "type": "OrderId (UUID)",
              "required": true
            },
            "reason": {
              "type": "string"
            }
          },
          "outputSchema": {
            "cancelledAt": {
              "type": "DateTime"
            },
            "orderId": {
              "type": "OrderId (UUID)"
            },
            "refundInitiated": {
              "type": "boolean"
            },
            "status": {
              "type": "OrderStatus"
            }
          },
          "errors": [
            {
              "code": "ORDER_NOT_FOUND",
              "httpStatus": 404,
              "message": "Order with specified ID does not exist"
            },
            {
              "code": "CANCELLATION_NOT_ALLOWED",
              "httpStatus": 409,
              "message": "Order cannot be cancelled after shipping"
            },
            {
              "code": "ORDER_ALREADY_CANCELLED",
              "httpStatus": 409,
              "message": "Order has already been cancelled"
            }
          ],
          "preconditions": [
            "Order must exist",
            "Order status must be PENDING or CONFIRMED",
            "User must be order owner or admin"
          ],
          "postconditions": [
            "Order status changed to CANCELLED",
            "Inventory restored",
            "Refund initiated",
            "OrderCancelled event emitted",
            "Cancellation email sent"
          ],
          "relatedACs": [
            "AC-ORDER-006"
          ],
          "relatedBRs": [
            "BR-CANCEL-001",
            "BR-INV-003",
            "BR-PAY-002"
          ]
        },
        {
          "id": "OP-ORDER-005",
          "name": "confirmOrder",
          "method": "POST",
          "path": "/{orderId}/confirm",
          "description": "Confirm a pending order (admin operation)",
          "inputSchema": {
            "orderId": {
              "type": "OrderId (UUID)",
              "required": true
            }
          },
          "outputSchema": {
            "confirmedAt": {
              "type": "DateTime"
            },
            "orderId": {
              "type": "OrderId (UUID)"
            },
            "status": {
              "type": "OrderStatus"
            }
          },
          "errors": [
            {
              "code": "ORDER_NOT_FOUND",
              "httpStatus": 404,
              "message": "Order with specified ID does not exist"
            },
            {
              "code": "INVALID_STATUS_TRANSITION",
              "httpStatus": 409,
              "message": "Order can only be confirmed from pending status"
            }
          ],
          "preconditions": [
            "User must be authenticated as admin",
            "Order must exist",
            "Order status must be PENDING"
          ],
          "postconditions": [
            "Order status changed to CONFIRMED",
            "OrderConfirmed event emitted",
            "Customer notified"
          ],
          "relatedACs": [
            "AC-ADMIN-005"
          ],
          "relatedBRs": [
            "BR-ORDER-001",
            "BR-AUDIT-001"
          ]
        },
        {
          "id": "OP-ORDER-006",
          "name": "shipOrder",
          "method": "POST",
          "path": "/{orderId}/ship",
          "description": "Mark order as shipped with optional tracking number",
          "inputSchema": {
            "orderId": {
              "type": "OrderId (UUID)",
              "required": true
            },
            "trackingNumber": {
              "type": "string"
            }
          },
          "outputSchema": {
            "orderId": {
              "type": "OrderId (UUID)"
            },
            "shippedAt": {
              "type": "DateTime"
            },
            "status": {
              "type": "OrderStatus"
            },
            "trackingNumber": {
              "type": "string"
            }
          },
          "errors": [
            {
              "code": "ORDER_NOT_FOUND",
              "httpStatus": 404,
              "message": "Order with specified ID does not exist"
            },
            {
              "code": "INVALID_STATUS_TRANSITION",
              "httpStatus": 409,
              "message": "Order can only be shipped from confirmed status"
            }
          ],
          "preconditions": [
            "User must be authenticated as admin",
            "Order must exist",
            "Order status must be CONFIRMED"
          ],
          "postconditions": [
            "Order status changed to SHIPPED",
            "All items ship as single unit",
            "OrderShipped event emitted",
            "Customer notified"
          ],
          "relatedACs": [
            "AC-ADMIN-005"
          ],
          "relatedBRs": [
            "BR-ORDER-001",
            "BR-ORDER-003",
            "BR-AUDIT-001"
          ]
        },
        {
          "id": "OP-ORDER-007",
          "name": "deliverOrder",
          "method": "POST",
          "path": "/{orderId}/deliver",
          "description": "Mark order as delivered",
          "inputSchema": {
            "orderId": {
              "type": "OrderId (UUID)",
              "required": true
            }
          },
          "outputSchema": {
            "deliveredAt": {
              "type": "DateTime"
            },
            "orderId": {
              "type": "OrderId (UUID)"
            },
            "status": {
              "type": "OrderStatus"
            }
          },
          "errors": [
            {
              "code": "ORDER_NOT_FOUND",
              "httpStatus": 404,
              "message": "Order with specified ID does not exist"
            },
            {
              "code": "INVALID_STATUS_TRANSITION",
              "httpStatus": 409,
              "message": "Order can only be delivered from shipped status"
            }
          ],
          "preconditions": [
            "User must be authenticated as admin",
            "Order must exist",
            "Order status must be SHIPPED"
          ],
          "postconditions": [
            "Order status changed to DELIVERED",
            "OrderDelivered event emitted",
            "Customer notified"
          ],
          "relatedACs": [
            "AC-ADMIN-005"
          ],
          "relatedBRs": [
            "BR-ORDER-001",
            "BR-AUDIT-001"
          ]
        }
      ],
      "events": [
        {
          "name": "OrderPlaced",
          "description": "Emitted when a new order is created",
          "payload": [
            "orderId",
            "orderNumber",
            "customerId",
            "totalAmount",
            "lineItemCount",
            "createdAt"
          ]
        },
        {
          "name": "OrderConfirmed",
          "description": "Emitted when order is confirmed by admin",
          "payload": [
            "orderId",
            "confirmedAt",
            "confirmedBy"
          ]
        },
        {
          "name": "OrderShipped",
          "description": "Emitted when order is marked as shipped",
          "payload": [
            "orderId",
            "trackingNumber",
            "shippedAt",
            "shippedBy"
          ]
        },
        {
          "name": "OrderDelivered",
          "description": "Emitted when order is marked as delivered",
          "payload": [
            "orderId",
            "deliveredAt"
          ]
        },
        {
          "name": "OrderCancelled",
          "description": "Emitted when order is cancelled",
          "payload": [
            "orderId",
            "reason",
            "cancelledAt",
            "cancelledBy",
            "refundAmount"
          ]
        }
      ],
      "securityRequirements": {
        "authentication": "Bearer JWT",
        "authorization": "Customers can view/cancel own orders; Admin role required for status updates"
      }
    },
    {
      "id": "IC-CUSTOMER-001",
      "serviceName": "Customer Service",
      "purpose": "Manages customer registration, authentication, profiles, and saved addresses/payment methods",
      "baseUrl": "/api/v1/customers",
      "operations": [
        {
          "id": "OP-CUSTOMER-001",
          "name": "registerCustomer",
          "method": "POST",
          "path": "/register",
          "description": "Create a new customer account",
          "inputSchema": {
            "email": {
              "type": "Email",
              "required": true
            },
            "firstName": {
              "type": "string",
              "required": true
            },
            "lastName": {
              "type": "string",
              "required": true
            },
            "password": {
              "type": "string",
              "required": true
            }
          },
          "outputSchema": {
            "customerId": {
              "type": "CustomerId (UUID)"
            },
            "email": {
              "type": "Email"
            },
            "emailVerified": {
              "type": "boolean"
            },
            "registrationStatus": {
              "type": "RegistrationStatus"
            }
          },
          "errors": [
            {
              "code": "EMAIL_ALREADY_REGISTERED",
              "httpStatus": 409,
              "message": "An account with this email already exists"
            },
            {
              "code": "WEAK_PASSWORD",
              "httpStatus": 400,
              "message": "Password must be at least 8 characters and contain at least one number"
            },
            {
              "code": "INVALID_EMAIL",
              "httpStatus": 400,
              "message": "Invalid email format"
            }
          ],
          "preconditions": [
            "Email must not be registered"
          ],
          "postconditions": [
            "Customer account created",
            "Verification email sent",
            "CustomerRegistered event emitted"
          ],
          "relatedACs": [
            "AC-CUST-001"
          ],
          "relatedBRs": [
            "BR-CUST-001",
            "BR-CUST-002"
          ]
        },
        {
          "id": "OP-CUSTOMER-002",
          "name": "verifyEmail",
          "method": "POST",
          "path": "/verify-email",
          "description": "Verify customer email address",
          "inputSchema": {
            "token": {
              "type": "string",
              "required": true
            }
          },
          "outputSchema": {
            "emailVerified": {
              "type": "boolean"
            },
            "success": {
              "type": "boolean"
            }
          },
          "errors": [
            {
              "code": "INVALID_VERIFICATION_TOKEN",
              "httpStatus": 400,
              "message": "Verification token is invalid or expired"
            }
          ],
          "preconditions": [
            "Token must be valid and not expired"
          ],
          "postconditions": [
            "Email marked as verified",
            "Customer can place orders"
          ],
          "relatedACs": [
            "AC-CUST-001"
          ],
          "relatedBRs": [
            "BR-CUST-003"
          ]
        },
        {
          "id": "OP-CUSTOMER-003",
          "name": "getCustomerProfile",
          "method": "GET",
          "path": "/me",
          "description": "Get current customer's profile",
          "inputSchema": {},
          "outputSchema": {
            "addresses": {
              "type": "ShippingAddress[]"
            },
            "customerId": {
              "type": "CustomerId (UUID)"
            },
            "email": {
              "type": "Email"
            },
            "emailVerified": {
              "type": "boolean"
            },
            "firstName": {
              "type": "string"
            },
            "lastName": {
              "type": "string"
            },
            "paymentMethods": {
              "type": "PaymentMethodSummary[]"
            }
          },
          "errors": [],
          "preconditions": [
            "User must be authenticated"
          ],
          "postconditions": [
            "Customer profile returned"
          ],
          "relatedACs": [],
          "relatedBRs": []
        },
        {
          "id": "OP-CUSTOMER-004",
          "name": "addShippingAddress",
          "method": "POST",
          "path": "/me/addresses",
          "description": "Add a shipping address to customer profile",
          "inputSchema": {
            "city": {
              "type": "string",
              "required": true
            },
            "country": {
              "type": "string",
              "required": true
            },
            "isDefault": {
              "type": "boolean"
            },
            "postalCode": {
              "type": "string",
              "required": true
            },
            "recipientName": {
              "type": "string",
              "required": true
            },
            "state": {
              "type": "string",
              "required": true
            },
            "street": {
              "type": "string",
              "required": true
            }
          },
          "outputSchema": {
            "address": {
              "type": "ShippingAddress"
            },
            "addressId": {
              "type": "AddressId (UUID)"
            },
            "isDefault": {
              "type": "boolean"
            }
          },
          "errors": [
            {
              "code": "INCOMPLETE_ADDRESS",
              "httpStatus": 400,
              "message": "All required address fields must be provided"
            },
            {
              "code": "INVALID_POSTAL_CODE",
              "httpStatus": 400,
              "message": "Invalid postal code format"
            },
            {
              "code": "INTERNATIONAL_SHIPPING_NOT_AVAILABLE",
              "httpStatus": 400,
              "message": "Shipping is only available domestically"
            }
          ],
          "preconditions": [
            "User must be authenticated",
            "Address must be domestic"
          ],
          "postconditions": [
            "Address saved to profile",
            "If marked default, previous default cleared"
          ],
          "relatedACs": [
            "AC-CUST-002"
          ],
          "relatedBRs": [
            "BR-ADDR-001",
            "BR-SHIP-002"
          ]
        },
        {
          "id": "OP-CUSTOMER-005",
          "name": "addPaymentMethod",
          "method": "POST",
          "path": "/me/payment-methods",
          "description": "Add a payment method to customer profile",
          "inputSchema": {
            "isDefault": {
              "type": "boolean"
            },
            "token": {
              "type": "string",
              "required": true
            },
            "type": {
              "type": "PaymentType",
              "required": true
            }
          },
          "outputSchema": {
            "isDefault": {
              "type": "boolean"
            },
            "lastFourDigits": {
              "type": "string"
            },
            "paymentMethodId": {
              "type": "PaymentMethodId (UUID)"
            },
            "type": {
              "type": "PaymentType"
            }
          },
          "errors": [
            {
              "code": "INVALID_PAYMENT_TOKEN",
              "httpStatus": 400,
              "message": "Payment token validation failed"
            },
            {
              "code": "UNSUPPORTED_CARD_TYPE",
              "httpStatus": 400,
              "message": "Only Visa, Mastercard, and American Express are supported"
            }
          ],
          "preconditions": [
            "User must be authenticated",
            "Payment token must be valid from payment gateway"
          ],
          "postconditions": [
            "Tokenized payment method saved",
            "If marked default, previous default cleared"
          ],
          "relatedACs": [
            "AC-CUST-003"
          ],
          "relatedBRs": []
        },
        {
          "id": "OP-CUSTOMER-006",
          "name": "deleteCustomer",
          "method": "DELETE",
          "path": "/me",
          "description": "Request account deletion (GDPR compliance)",
          "inputSchema": {
            "confirmation": {
              "type": "string",
              "required": true
            },
            "deleteType": {
              "type": "enum(soft_delete, full_erasure)",
              "required": true
            }
          },
          "outputSchema": {
            "scheduledDeletionDate": {
              "type": "DateTime"
            },
            "success": {
              "type": "boolean"
            }
          },
          "errors": [
            {
              "code": "PENDING_ORDERS_EXIST",
              "httpStatus": 409,
              "message": "Cannot delete account while orders are pending"
            },
            {
              "code": "INVALID_CONFIRMATION",
              "httpStatus": 400,
              "message": "Deletion confirmation does not match"
            }
          ],
          "preconditions": [
            "User must be authenticated",
            "No pending orders"
          ],
          "postconditions": [
            "Account deactivated or scheduled for erasure"
          ],
          "relatedACs": [
            "AC-CUST-004"
          ],
          "relatedBRs": []
        }
      ],
      "events": [
        {
          "name": "CustomerRegistered",
          "description": "Emitted when a new customer registers",
          "payload": [
            "customerId",
            "email",
            "createdAt"
          ]
        }
      ],
      "securityRequirements": {
        "authentication": "Bearer JWT",
        "authorization": "Users can only access their own profile"
      }
    },
    {
      "id": "IC-INVENTORY-001",
      "serviceName": "Inventory Service",
      "purpose": "Tracks and manages stock levels for products and variants",
      "baseUrl": "/api/v1/inventory",
      "operations": [
        {
          "id": "OP-INVENTORY-001",
          "name": "getInventory",
          "method": "GET",
          "path": "/{productId}",
          "description": "Get inventory levels for a product",
          "inputSchema": {
            "productId": {
              "type": "ProductId (UUID)",
              "required": true
            }
          },
          "outputSchema": {
            "availableQuantity": {
              "type": "integer"
            },
            "inventoryId": {
              "type": "InventoryId (UUID)"
            },
            "productId": {
              "type": "ProductId (UUID)"
            },
            "quantityOnHand": {
              "type": "integer"
            },
            "reservedQuantity": {
              "type": "integer"
            }
          },
          "errors": [
            {
              "code": "PRODUCT_NOT_FOUND",
              "httpStatus": 404,
              "message": "Product with specified ID does not exist"
            }
          ],
          "preconditions": [
            "Product must exist"
          ],
          "postconditions": [
            "Inventory levels returned"
          ],
          "relatedACs": [
            "AC-ADMIN-006"
          ],
          "relatedBRs": []
        },
        {
          "id": "OP-INVENTORY-002",
          "name": "adjustInventory",
          "method": "PATCH",
          "path": "/{productId}",
          "description": "Adjust stock level (set absolute or delta)",
          "inputSchema": {
            "adjustmentType": {
              "type": "enum(set, delta)",
              "required": true
            },
            "productId": {
              "type": "ProductId (UUID)",
              "required": true
            },
            "quantity": {
              "type": "integer",
              "required": true
            },
            "reason": {
              "type": "string"
            }
          },
          "outputSchema": {
            "adjustedAt": {
              "type": "DateTime"
            },
            "adjustedBy": {
              "type": "UserId"
            },
            "inventoryId": {
              "type": "InventoryId (UUID)"
            },
            "newQuantity": {
              "type": "integer"
            },
            "previousQuantity": {
              "type": "integer"
            }
          },
          "errors": [
            {
              "code": "PRODUCT_NOT_FOUND",
              "httpStatus": 404,
              "message": "Product with specified ID does not exist"
            },
            {
              "code": "NEGATIVE_INVENTORY",
              "httpStatus": 400,
              "message": "Inventory cannot go below zero"
            },
            {
              "code": "INSUFFICIENT_STOCK",
              "httpStatus": 409,
              "message": "Cannot reduce inventory below reserved quantity"
            }
          ],
          "preconditions": [
            "User must be authenticated as admin",
            "Product must exist",
            "Resulting quantity must be \u003e= 0"
          ],
          "postconditions": [
            "Inventory adjusted",
            "Full audit trail recorded",
            "Low stock alert triggered if applicable",
            "InventoryAdjusted event emitted"
          ],
          "relatedACs": [
            "AC-ADMIN-006"
          ],
          "relatedBRs": [
            "BR-INV-001",
            "BR-AUDIT-002"
          ]
        },
        {
          "id": "OP-INVENTORY-003",
          "name": "restockInventory",
          "method": "POST",
          "path": "/{productId}/restock",
          "description": "Add stock to inventory",
          "inputSchema": {
            "productId": {
              "type": "ProductId (UUID)",
              "required": true
            },
            "quantity": {
              "type": "integer",
              "required": true
            },
            "reason": {
              "type": "string"
            }
          },
          "outputSchema": {
            "inventoryId": {
              "type": "InventoryId (UUID)"
            },
            "newQuantity": {
              "type": "integer"
            },
            "previousQuantity": {
              "type": "integer"
            },
            "restockedAt": {
              "type": "DateTime"
            }
          },
          "errors": [
            {
              "code": "PRODUCT_NOT_FOUND",
              "httpStatus": 404,
              "message": "Product with specified ID does not exist"
            },
            {
              "code": "INVALID_QUANTITY",
              "httpStatus": 400,
              "message": "Restock quantity must be greater than zero"
            }
          ],
          "preconditions": [
            "User must be authenticated as admin",
            "Product must exist",
            "Quantity must be \u003e 0"
          ],
          "postconditions": [
            "Inventory increased",
            "Audit trail recorded",
            "InventoryRestocked event emitted"
          ],
          "relatedACs": [
            "AC-ADMIN-006"
          ],
          "relatedBRs": [
            "BR-AUDIT-002"
          ]
        },
        {
          "id": "OP-INVENTORY-004",
          "name": "bulkImportInventory",
          "method": "POST",
          "path": "/import",
          "description": "Bulk update inventory from CSV",
          "inputSchema": {
            "file": {
              "type": "CSV file",
              "required": true
            }
          },
          "outputSchema": {
            "errors": {
              "type": "ImportError[]"
            },
            "failureCount": {
              "type": "integer"
            },
            "successCount": {
              "type": "integer"
            }
          },
          "errors": [
            {
              "code": "INVALID_CSV_FORMAT",
              "httpStatus": 400,
              "message": "CSV file format is invalid"
            },
            {
              "code": "PARTIAL_IMPORT_FAILURE",
              "httpStatus": 207,
              "message": "Some rows failed validation"
            }
          ],
          "preconditions": [
            "User must be authenticated as admin",
            "CSV must have valid format"
          ],
          "postconditions": [
            "Valid rows processed",
            "Row-by-row errors returned for failures"
          ],
          "relatedACs": [
            "AC-ADMIN-006"
          ],
          "relatedBRs": []
        }
      ],
      "events": [
        {
          "name": "InventoryReserved",
          "description": "Emitted when stock is reserved for an order",
          "payload": [
            "inventoryId",
            "productId",
            "quantity",
            "orderId"
          ]
        },
        {
          "name": "InventoryReleased",
          "description": "Emitted when reserved stock is released",
          "payload": [
            "inventoryId",
            "productId",
            "quantity",
            "reason"
          ]
        },
        {
          "name": "InventoryDeducted",
          "description": "Emitted when stock is permanently reduced",
          "payload": [
            "inventoryId",
            "productId",
            "quantity",
            "orderId"
          ]
        },
        {
          "name": "InventoryRestocked",
          "description": "Emitted when stock is added",
          "payload": [
            "inventoryId",
            "productId",
            "previousQuantity",
            "newQuantity",
            "reason"
          ]
        },
        {
          "name": "OutOfStock",
          "description": "Emitted when available quantity reaches zero",
          "payload": [
            "inventoryId",
            "productId"
          ]
        }
      ],
      "securityRequirements": {
        "authentication": "Bearer JWT",
        "authorization": "Admin role required for all operations"
      }
    }
  ],
  "sequences": [
    {
      "id": "SEQ-REG-001",
      "name": "Customer Registration",
      "description": "Register a new customer account with email verification",
      "trigger": {
        "type": "user_action",
        "description": "Customer submits registration form with email and password"
      },
      "participants": [
        {
          "name": "Customer",
          "type": "actor"
        },
        {
          "name": "CustomerService",
          "type": "service"
        },
        {
          "name": "CustomerAggregate",
          "type": "aggregate"
        },
        {
          "name": "EmailService",
          "type": "external"
        }
      ],
      "steps": [
        {
          "step": 1,
          "actor": "Customer",
          "action": "submitRegistration",
          "target": "CustomerService",
          "data": [
            "email",
            "password"
          ],
          "returns": "registrationResult"
        },
        {
          "step": 2,
          "actor": "CustomerService",
          "action": "validateEmailUniqueness",
          "target": "CustomerAggregate",
          "data": [
            "email"
          ],
          "returns": "isUnique"
        },
        {
          "step": 3,
          "actor": "CustomerService",
          "action": "validatePasswordStrength",
          "target": "CustomerService",
          "data": [
            "password"
          ],
          "returns": "isValid"
        },
        {
          "step": 4,
          "actor": "CustomerService",
          "action": "register",
          "target": "CustomerAggregate",
          "data": [
            "email",
            "hashedPassword"
          ],
          "returns": "customerId",
          "event": "CustomerRegistered"
        },
        {
          "step": 5,
          "actor": "CustomerService",
          "action": "sendVerificationEmail",
          "target": "EmailService",
          "data": [
            "email",
            "verificationToken"
          ],
          "returns": "emailSent"
        },
        {
          "step": 6,
          "actor": "CustomerService",
          "action": "returnResult",
          "target": "Customer",
          "data": [
            "customerId",
            "verificationPending"
          ]
        }
      ],
      "outcome": {
        "success": "Customer account created with REGISTERED status, verification email sent",
        "state_changes": [
          "Customer.status = REGISTERED",
          "Customer.emailVerified = false",
          "Cart created for customer"
        ]
      },
      "exceptions": [
        {
          "condition": "Email already registered",
          "step": 2,
          "handling": "Return EMAIL_ALREADY_REGISTERED error"
        },
        {
          "condition": "Password too weak",
          "step": 3,
          "handling": "Return WEAK_PASSWORD error with requirements"
        },
        {
          "condition": "Email service unavailable",
          "step": 5,
          "handling": "Queue email for retry, continue with registration"
        }
      ],
      "relatedACs": [],
      "relatedBRs": [
        "BR-CUST-001",
        "BR-CUST-002",
        "BR-CUST-003"
      ]
    },
    {
      "id": "SEQ-CART-001",
      "name": "Add Item to Cart",
      "description": "Add a product to the customer's shopping cart with stock validation",
      "trigger": {
        "type": "user_action",
        "description": "Customer clicks Add to Cart button on product page"
      },
      "participants": [
        {
          "name": "Customer",
          "type": "actor"
        },
        {
          "name": "CartService",
          "type": "service"
        },
        {
          "name": "InventoryService",
          "type": "service"
        },
        {
          "name": "CartAggregate",
          "type": "aggregate"
        },
        {
          "name": "InventoryAggregate",
          "type": "aggregate"
        }
      ],
      "steps": [
        {
          "step": 1,
          "actor": "Customer",
          "action": "addToCart",
          "target": "CartService",
          "data": [
            "productId",
            "variantId",
            "quantity"
          ],
          "returns": "cartResult"
        },
        {
          "step": 2,
          "actor": "CartService",
          "action": "checkAvailability",
          "target": "InventoryService",
          "data": [
            "productId",
            "variantId",
            "quantity"
          ],
          "returns": "availableQuantity"
        },
        {
          "step": 3,
          "actor": "CartService",
          "action": "addItem",
          "target": "CartAggregate",
          "data": [
            "productId",
            "productName",
            "unitPrice",
            "quantity"
          ],
          "returns": "updatedCart",
          "event": "ItemAddedToCart"
        },
        {
          "step": 4,
          "actor": "CartService",
          "action": "recalculateTotal",
          "target": "CartAggregate",
          "returns": "newTotal"
        },
        {
          "step": 5,
          "actor": "CartService",
          "action": "returnCart",
          "target": "Customer",
          "data": [
            "cartItems",
            "totalPrice"
          ]
        }
      ],
      "outcome": {
        "success": "Item added to cart, total recalculated",
        "state_changes": [
          "Cart.items += CartItem",
          "Cart.totalPrice updated"
        ]
      },
      "exceptions": [
        {
          "condition": "Product out of stock",
          "step": 2,
          "handling": "Return OUT_OF_STOCK error"
        },
        {
          "condition": "Requested quantity exceeds available stock",
          "step": 2,
          "handling": "Return QUANTITY_EXCEEDS_STOCK error with available amount"
        },
        {
          "condition": "Variant not selected for product with variants",
          "step": 1,
          "handling": "Return VARIANT_REQUIRED error"
        },
        {
          "condition": "Product is inactive",
          "step": 2,
          "handling": "Return PRODUCT_NOT_AVAILABLE error"
        }
      ],
      "relatedACs": [],
      "relatedBRs": [
        "BR-STOCK-001",
        "BR-CART-002",
        "BR-VAR-002"
      ]
    },
    {
      "id": "SEQ-CART-002",
      "name": "Update Cart Quantity",
      "description": "Update the quantity of an item already in the cart",
      "trigger": {
        "type": "user_action",
        "description": "Customer changes quantity in cart view"
      },
      "participants": [
        {
          "name": "Customer",
          "type": "actor"
        },
        {
          "name": "CartService",
          "type": "service"
        },
        {
          "name": "InventoryService",
          "type": "service"
        },
        {
          "name": "CartAggregate",
          "type": "aggregate"
        }
      ],
      "steps": [
        {
          "step": 1,
          "actor": "Customer",
          "action": "updateQuantity",
          "target": "CartService",
          "data": [
            "cartItemId",
            "newQuantity"
          ],
          "returns": "cartResult"
        },
        {
          "step": 2,
          "actor": "CartService",
          "action": "checkAvailability",
          "target": "InventoryService",
          "data": [
            "productId",
            "newQuantity"
          ],
          "returns": "availableQuantity"
        },
        {
          "step": 3,
          "actor": "CartService",
          "action": "updateQuantity",
          "target": "CartAggregate",
          "data": [
            "productId",
            "newQuantity"
          ],
          "returns": "updatedCart",
          "event": "CartQuantityUpdated"
        },
        {
          "step": 4,
          "actor": "CartService",
          "action": "returnCart",
          "target": "Customer",
          "data": [
            "cartItems",
            "totalPrice"
          ]
        }
      ],
      "outcome": {
        "success": "Cart quantity updated, total recalculated",
        "state_changes": [
          "CartItem.quantity = newQuantity",
          "CartItem.subtotal recalculated",
          "Cart.totalPrice updated"
        ]
      },
      "exceptions": [
        {
          "condition": "Requested quantity exceeds stock",
          "step": 2,
          "handling": "Return QUANTITY_EXCEEDS_STOCK with available amount"
        },
        {
          "condition": "Item not in cart",
          "step": 3,
          "handling": "Return ITEM_NOT_FOUND error"
        }
      ],
      "relatedACs": [],
      "relatedBRs": [
        "BR-CART-002"
      ]
    },
    {
      "id": "SEQ-CART-003",
      "name": "Remove Item from Cart",
      "description": "Remove a product from the shopping cart",
      "trigger": {
        "type": "user_action",
        "description": "Customer clicks remove button on cart item"
      },
      "participants": [
        {
          "name": "Customer",
          "type": "actor"
        },
        {
          "name": "CartService",
          "type": "service"
        },
        {
          "name": "CartAggregate",
          "type": "aggregate"
        }
      ],
      "steps": [
        {
          "step": 1,
          "actor": "Customer",
          "action": "removeItem",
          "target": "CartService",
          "data": [
            "productId"
          ],
          "returns": "cartResult"
        },
        {
          "step": 2,
          "actor": "CartService",
          "action": "removeItem",
          "target": "CartAggregate",
          "data": [
            "productId"
          ],
          "returns": "updatedCart",
          "event": "ItemRemovedFromCart"
        },
        {
          "step": 3,
          "actor": "CartService",
          "action": "returnCart",
          "target": "Customer",
          "data": [
            "cartItems",
            "totalPrice"
          ]
        }
      ],
      "outcome": {
        "success": "Item removed from cart, total recalculated",
        "state_changes": [
          "Cart.items -= CartItem",
          "Cart.totalPrice updated"
        ]
      },
      "exceptions": [
        {
          "condition": "Item not in cart",
          "step": 2,
          "handling": "Return ITEM_NOT_FOUND error"
        }
      ],
      "relatedACs": [],
      "relatedBRs": []
    },
    {
      "id": "SEQ-ORD-001",
      "name": "Place Order",
      "description": "Complete checkout process: validate cart, reserve inventory, process payment, create order",
      "trigger": {
        "type": "user_action",
        "description": "Customer clicks Place Order button at checkout"
      },
      "participants": [
        {
          "name": "Customer",
          "type": "actor"
        },
        {
          "name": "OrderService",
          "type": "service"
        },
        {
          "name": "CartService",
          "type": "service"
        },
        {
          "name": "InventoryService",
          "type": "service"
        },
        {
          "name": "PaymentService",
          "type": "external"
        },
        {
          "name": "OrderAggregate",
          "type": "aggregate"
        },
        {
          "name": "InventoryAggregate",
          "type": "aggregate"
        },
        {
          "name": "CartAggregate",
          "type": "aggregate"
        }
      ],
      "steps": [
        {
          "step": 1,
          "actor": "Customer",
          "action": "placeOrder",
          "target": "OrderService",
          "data": [
            "cartId",
            "shippingAddress",
            "paymentMethod"
          ],
          "returns": "orderResult"
        },
        {
          "step": 2,
          "actor": "OrderService",
          "action": "validateCustomer",
          "target": "CustomerService",
          "data": [
            "customerId"
          ],
          "returns": "isRegistered, isEmailVerified"
        },
        {
          "step": 3,
          "actor": "OrderService",
          "action": "getCart",
          "target": "CartService",
          "data": [
            "cartId"
          ],
          "returns": "cartItems, cartTotal"
        },
        {
          "step": 4,
          "actor": "OrderService",
          "action": "validateShippingAddress",
          "target": "OrderService",
          "data": [
            "shippingAddress"
          ],
          "returns": "isValid"
        },
        {
          "step": 5,
          "actor": "OrderService",
          "action": "reserveInventory",
          "target": "InventoryService",
          "data": [
            "cartItems"
          ],
          "returns": "reservationId",
          "event": "InventoryReserved"
        },
        {
          "step": 6,
          "actor": "OrderService",
          "action": "calculateShipping",
          "target": "OrderService",
          "data": [
            "subtotal",
            "shippingAddress"
          ],
          "returns": "shippingCost"
        },
        {
          "step": 7,
          "actor": "OrderService",
          "action": "processPayment",
          "target": "PaymentService",
          "data": [
            "totalAmount",
            "paymentMethod"
          ],
          "returns": "paymentAuthorizationId"
        },
        {
          "step": 8,
          "actor": "OrderService",
          "action": "createOrder",
          "target": "OrderAggregate",
          "data": [
            "customerId",
            "lineItems",
            "shippingAddress",
            "paymentMethod",
            "totals"
          ],
          "returns": "orderId",
          "event": "OrderPlaced"
        },
        {
          "step": 9,
          "actor": "OrderService",
          "action": "clearCart",
          "target": "CartService",
          "data": [
            "cartId"
          ],
          "returns": "cleared",
          "event": "CartCleared"
        },
        {
          "step": 10,
          "actor": "OrderService",
          "action": "returnConfirmation",
          "target": "Customer",
          "data": [
            "orderId",
            "orderSummary",
            "estimatedDelivery"
          ]
        }
      ],
      "outcome": {
        "success": "Order created in PENDING status, inventory reserved, payment authorized, cart cleared",
        "state_changes": [
          "Order.status = PENDING",
          "Order.lineItems = snapshot of cart items with current prices",
          "Inventory.reservedQuantity += order quantities",
          "Cart.items = empty",
          "Cart.totalPrice = 0"
        ]
      },
      "exceptions": [
        {
          "condition": "Customer not registered",
          "step": 2,
          "handling": "Return REGISTRATION_REQUIRED error"
        },
        {
          "condition": "Email not verified",
          "step": 2,
          "handling": "Return EMAIL_NOT_VERIFIED error"
        },
        {
          "condition": "Cart is empty",
          "step": 3,
          "handling": "Return EMPTY_CART error"
        },
        {
          "condition": "International shipping address",
          "step": 4,
          "handling": "Return INTERNATIONAL_SHIPPING_NOT_AVAILABLE error"
        },
        {
          "condition": "Incomplete shipping address",
          "step": 4,
          "handling": "Return INCOMPLETE_ADDRESS error"
        },
        {
          "condition": "Insufficient stock for one or more items",
          "step": 5,
          "handling": "Return INSUFFICIENT_STOCK error with affected items"
        },
        {
          "condition": "Payment authorization failed",
          "step": 7,
          "handling": "Return PAYMENT_FAILED error"
        },
        {
          "condition": "Order creation failed",
          "step": 8,
          "handling": "Return ORDER_CREATION_FAILED error"
        }
      ],
      "relatedACs": [],
      "relatedBRs": [
        "BR-AUTH-001",
        "BR-STOCK-001",
        "BR-INV-001",
        "BR-INV-002",
        "BR-PAY-001",
        "BR-SHIP-001",
        "BR-SHIP-002",
        "BR-ADDR-001",
        "BR-ORDER-002",
        "BR-PRICE-002"
      ]
    },
    {
      "id": "SEQ-ORD-002",
      "name": "Confirm Order",
      "description": "Confirm a pending order after payment capture",
      "trigger": {
        "type": "system_event",
        "description": "Payment captured successfully or admin confirms order"
      },
      "participants": [
        {
          "name": "OrderService",
          "type": "service"
        },
        {
          "name": "PaymentService",
          "type": "external"
        },
        {
          "name": "OrderAggregate",
          "type": "aggregate"
        },
        {
          "name": "NotificationService",
          "type": "service"
        }
      ],
      "steps": [
        {
          "step": 1,
          "actor": "OrderService",
          "action": "capturePayment",
          "target": "PaymentService",
          "data": [
            "paymentAuthorizationId",
            "amount"
          ],
          "returns": "captureResult"
        },
        {
          "step": 2,
          "actor": "OrderService",
          "action": "confirm",
          "target": "OrderAggregate",
          "data": [
            "orderId"
          ],
          "returns": "updatedOrder",
          "event": "OrderConfirmed"
        },
        {
          "step": 3,
          "actor": "OrderService",
          "action": "logAuditEvent",
          "target": "AuditLog",
          "data": [
            "orderId",
            "PENDING-\u003eCONFIRMED",
            "timestamp",
            "actor"
          ]
        },
        {
          "step": 4,
          "actor": "NotificationService",
          "action": "sendOrderConfirmation",
          "target": "EmailService",
          "data": [
            "customerEmail",
            "orderDetails"
          ]
        }
      ],
      "outcome": {
        "success": "Order status changed to CONFIRMED, customer notified",
        "state_changes": [
          "Order.status = CONFIRMED"
        ]
      },
      "exceptions": [
        {
          "condition": "Payment capture failed",
          "step": 1,
          "handling": "Keep order in PENDING, retry capture, notify admin"
        },
        {
          "condition": "Order not in PENDING status",
          "step": 2,
          "handling": "Return INVALID_STATUS_TRANSITION error"
        }
      ],
      "relatedACs": [],
      "relatedBRs": [
        "BR-ORDER-001",
        "BR-AUDIT-001"
      ]
    },
    {
      "id": "SEQ-ORD-003",
      "name": "Ship Order",
      "description": "Mark order as shipped with tracking information",
      "trigger": {
        "type": "user_action",
        "description": "Warehouse staff marks order as shipped with tracking number"
      },
      "participants": [
        {
          "name": "WarehouseStaff",
          "type": "actor"
        },
        {
          "name": "OrderService",
          "type": "service"
        },
        {
          "name": "InventoryService",
          "type": "service"
        },
        {
          "name": "OrderAggregate",
          "type": "aggregate"
        },
        {
          "name": "NotificationService",
          "type": "service"
        }
      ],
      "steps": [
        {
          "step": 1,
          "actor": "WarehouseStaff",
          "action": "shipOrder",
          "target": "OrderService",
          "data": [
            "orderId",
            "trackingNumber"
          ],
          "returns": "shipResult"
        },
        {
          "step": 2,
          "actor": "OrderService",
          "action": "deductInventory",
          "target": "InventoryService",
          "data": [
            "orderLineItems"
          ],
          "returns": "deducted",
          "event": "InventoryDeducted"
        },
        {
          "step": 3,
          "actor": "OrderService",
          "action": "ship",
          "target": "OrderAggregate",
          "data": [
            "orderId",
            "trackingNumber"
          ],
          "returns": "updatedOrder",
          "event": "OrderShipped"
        },
        {
          "step": 4,
          "actor": "OrderService",
          "action": "logAuditEvent",
          "target": "AuditLog",
          "data": [
            "orderId",
            "CONFIRMED-\u003eSHIPPED",
            "trackingNumber",
            "timestamp"
          ]
        },
        {
          "step": 5,
          "actor": "NotificationService",
          "action": "sendShippingNotification",
          "target": "EmailService",
          "data": [
            "customerEmail",
            "trackingNumber",
            "estimatedDelivery"
          ]
        }
      ],
      "outcome": {
        "success": "Order status changed to SHIPPED, inventory deducted, customer notified with tracking",
        "state_changes": [
          "Order.status = SHIPPED",
          "Inventory.quantityOnHand -= order quantities",
          "Inventory.reservedQuantity -= order quantities"
        ]
      },
      "exceptions": [
        {
          "condition": "Order not in CONFIRMED status",
          "step": 3,
          "handling": "Return INVALID_STATUS_TRANSITION error"
        },
        {
          "condition": "Inventory deduction failed",
          "step": 2,
          "handling": "Return error, do not change order status"
        }
      ],
      "relatedACs": [],
      "relatedBRs": [
        "BR-ORDER-001",
        "BR-ORDER-003",
        "BR-AUDIT-001"
      ]
    },
    {
      "id": "SEQ-ORD-004",
      "name": "Deliver Order",
      "description": "Mark order as delivered when customer receives package",
      "trigger": {
        "type": "system_event",
        "description": "Carrier confirms delivery or manual delivery confirmation"
      },
      "participants": [
        {
          "name": "CarrierWebhook",
          "type": "external"
        },
        {
          "name": "OrderService",
          "type": "service"
        },
        {
          "name": "OrderAggregate",
          "type": "aggregate"
        },
        {
          "name": "NotificationService",
          "type": "service"
        }
      ],
      "steps": [
        {
          "step": 1,
          "actor": "CarrierWebhook",
          "action": "deliveryConfirmation",
          "target": "OrderService",
          "data": [
            "trackingNumber",
            "deliveryTimestamp"
          ],
          "returns": "acknowledged"
        },
        {
          "step": 2,
          "actor": "OrderService",
          "action": "findOrderByTracking",
          "target": "OrderAggregate",
          "data": [
            "trackingNumber"
          ],
          "returns": "orderId"
        },
        {
          "step": 3,
          "actor": "OrderService",
          "action": "deliver",
          "target": "OrderAggregate",
          "data": [
            "orderId"
          ],
          "returns": "updatedOrder",
          "event": "OrderDelivered"
        },
        {
          "step": 4,
          "actor": "OrderService",
          "action": "logAuditEvent",
          "target": "AuditLog",
          "data": [
            "orderId",
            "SHIPPED-\u003eDELIVERED",
            "timestamp"
          ]
        },
        {
          "step": 5,
          "actor": "NotificationService",
          "action": "sendDeliveryConfirmation",
          "target": "EmailService",
          "data": [
            "customerEmail",
            "orderDetails"
          ]
        }
      ],
      "outcome": {
        "success": "Order status changed to DELIVERED, customer notified",
        "state_changes": [
          "Order.status = DELIVERED"
        ]
      },
      "exceptions": [
        {
          "condition": "Order not found for tracking number",
          "step": 2,
          "handling": "Log error, notify operations team"
        },
        {
          "condition": "Order not in SHIPPED status",
          "step": 3,
          "handling": "Return INVALID_STATUS_TRANSITION error"
        }
      ],
      "relatedACs": [],
      "relatedBRs": [
        "BR-ORDER-001",
        "BR-AUDIT-001"
      ]
    },
    {
      "id": "SEQ-ORD-005",
      "name": "Cancel Order",
      "description": "Cancel an order before shipping, restore inventory, process refund",
      "trigger": {
        "type": "user_action",
        "description": "Customer requests order cancellation"
      },
      "participants": [
        {
          "name": "Customer",
          "type": "actor"
        },
        {
          "name": "OrderService",
          "type": "service"
        },
        {
          "name": "InventoryService",
          "type": "service"
        },
        {
          "name": "PaymentService",
          "type": "external"
        },
        {
          "name": "OrderAggregate",
          "type": "aggregate"
        },
        {
          "name": "NotificationService",
          "type": "service"
        }
      ],
      "steps": [
        {
          "step": 1,
          "actor": "Customer",
          "action": "cancelOrder",
          "target": "OrderService",
          "data": [
            "orderId",
            "cancellationReason"
          ],
          "returns": "cancellationResult"
        },
        {
          "step": 2,
          "actor": "OrderService",
          "action": "validateCancellable",
          "target": "OrderAggregate",
          "data": [
            "orderId"
          ],
          "returns": "canCancel"
        },
        {
          "step": 3,
          "actor": "OrderService",
          "action": "cancel",
          "target": "OrderAggregate",
          "data": [
            "orderId",
            "reason"
          ],
          "returns": "cancelledOrder",
          "event": "OrderCancelled"
        },
        {
          "step": 4,
          "actor": "OrderService",
          "action": "releaseInventory",
          "target": "InventoryService",
          "data": [
            "orderLineItems"
          ],
          "returns": "released",
          "event": "InventoryReleased"
        },
        {
          "step": 5,
          "actor": "OrderService",
          "action": "processRefund",
          "target": "PaymentService",
          "data": [
            "paymentId",
            "amount",
            "paymentMethod"
          ],
          "returns": "refundId"
        },
        {
          "step": 6,
          "actor": "OrderService",
          "action": "logAuditEvent",
          "target": "AuditLog",
          "data": [
            "orderId",
            "status-\u003eCANCELLED",
            "reason",
            "timestamp"
          ]
        },
        {
          "step": 7,
          "actor": "NotificationService",
          "action": "sendCancellationConfirmation",
          "target": "EmailService",
          "data": [
            "customerEmail",
            "orderId",
            "refundDetails"
          ]
        }
      ],
      "outcome": {
        "success": "Order cancelled, inventory restored, refund initiated, customer notified",
        "state_changes": [
          "Order.status = CANCELLED",
          "Inventory.reservedQuantity -= order quantities",
          "Inventory.availableQuantity += order quantities"
        ]
      },
      "exceptions": [
        {
          "condition": "Order already shipped or delivered",
          "step": 2,
          "handling": "Return CANCELLATION_NOT_ALLOWED error"
        },
        {
          "condition": "Refund processing failed",
          "step": 5,
          "handling": "Log error, queue for manual refund, notify customer of delay"
        }
      ],
      "relatedACs": [],
      "relatedBRs": [
        "BR-CANCEL-001",
        "BR-INV-003",
        "BR-PAY-002",
        "BR-AUDIT-001"
      ]
    },
    {
      "id": "SEQ-PROD-001",
      "name": "Create Product",
      "description": "Create a new product in the catalog with initial inventory",
      "trigger": {
        "type": "user_action",
        "description": "Admin creates a new product in catalog"
      },
      "participants": [
        {
          "name": "Admin",
          "type": "actor"
        },
        {
          "name": "ProductService",
          "type": "service"
        },
        {
          "name": "InventoryService",
          "type": "service"
        },
        {
          "name": "ProductAggregate",
          "type": "aggregate"
        },
        {
          "name": "InventoryAggregate",
          "type": "aggregate"
        }
      ],
      "steps": [
        {
          "step": 1,
          "actor": "Admin",
          "action": "createProduct",
          "target": "ProductService",
          "data": [
            "name",
            "description",
            "price",
            "categoryId",
            "initialStock"
          ],
          "returns": "productResult"
        },
        {
          "step": 2,
          "actor": "ProductService",
          "action": "validateProduct",
          "target": "ProductService",
          "data": [
            "name",
            "price",
            "description"
          ],
          "returns": "isValid"
        },
        {
          "step": 3,
          "actor": "ProductService",
          "action": "validateCategory",
          "target": "CategoryService",
          "data": [
            "categoryId"
          ],
          "returns": "categoryExists"
        },
        {
          "step": 4,
          "actor": "ProductService",
          "action": "create",
          "target": "ProductAggregate",
          "data": [
            "name",
            "description",
            "price",
            "categoryId"
          ],
          "returns": "productId",
          "event": "ProductCreated"
        },
        {
          "step": 5,
          "actor": "ProductService",
          "action": "createInventory",
          "target": "InventoryService",
          "data": [
            "productId",
            "initialStock"
          ],
          "returns": "inventoryId"
        },
        {
          "step": 6,
          "actor": "ProductService",
          "action": "returnProduct",
          "target": "Admin",
          "data": [
            "productId",
            "productDetails"
          ]
        }
      ],
      "outcome": {
        "success": "Product created and active, inventory initialized",
        "state_changes": [
          "Product created with isActive = true",
          "Inventory.quantityOnHand = initialStock",
          "Inventory.reservedQuantity = 0"
        ]
      },
      "exceptions": [
        {
          "condition": "Price less than $0.01",
          "step": 2,
          "handling": "Return INVALID_PRICE error"
        },
        {
          "condition": "Name too short or too long",
          "step": 2,
          "handling": "Return INVALID_PRODUCT_NAME error"
        },
        {
          "condition": "Description too long",
          "step": 2,
          "handling": "Return DESCRIPTION_TOO_LONG error"
        },
        {
          "condition": "Category does not exist",
          "step": 3,
          "handling": "Return INVALID_CATEGORY error"
        }
      ],
      "relatedACs": [],
      "relatedBRs": [
        "BR-PRICE-001",
        "BR-PROD-002",
        "BR-PROD-003"
      ]
    },
    {
      "id": "SEQ-PROD-002",
      "name": "Deactivate Product",
      "description": "Soft delete a product while preserving order history",
      "trigger": {
        "type": "user_action",
        "description": "Admin deactivates product from catalog"
      },
      "participants": [
        {
          "name": "Admin",
          "type": "actor"
        },
        {
          "name": "ProductService",
          "type": "service"
        },
        {
          "name": "ProductAggregate",
          "type": "aggregate"
        }
      ],
      "steps": [
        {
          "step": 1,
          "actor": "Admin",
          "action": "deactivateProduct",
          "target": "ProductService",
          "data": [
            "productId"
          ],
          "returns": "deactivateResult"
        },
        {
          "step": 2,
          "actor": "ProductService",
          "action": "deactivate",
          "target": "ProductAggregate",
          "data": [
            "productId"
          ],
          "returns": "updatedProduct",
          "event": "ProductDeactivated"
        },
        {
          "step": 3,
          "actor": "ProductService",
          "action": "returnResult",
          "target": "Admin",
          "data": [
            "productId",
            "deactivatedAt"
          ]
        }
      ],
      "outcome": {
        "success": "Product deactivated, no longer visible in catalog, order history preserved",
        "state_changes": [
          "Product.isActive = false"
        ]
      },
      "exceptions": [
        {
          "condition": "Product already inactive",
          "step": 2,
          "handling": "Return success (idempotent operation)"
        }
      ],
      "relatedACs": [],
      "relatedBRs": [
        "BR-PROD-001"
      ]
    },
    {
      "id": "SEQ-INV-001",
      "name": "Restock Inventory",
      "description": "Add stock to product inventory",
      "trigger": {
        "type": "user_action",
        "description": "Warehouse staff receives shipment and adds stock"
      },
      "participants": [
        {
          "name": "WarehouseStaff",
          "type": "actor"
        },
        {
          "name": "InventoryService",
          "type": "service"
        },
        {
          "name": "InventoryAggregate",
          "type": "aggregate"
        }
      ],
      "steps": [
        {
          "step": 1,
          "actor": "WarehouseStaff",
          "action": "restock",
          "target": "InventoryService",
          "data": [
            "productId",
            "quantity",
            "reason"
          ],
          "returns": "restockResult"
        },
        {
          "step": 2,
          "actor": "InventoryService",
          "action": "restock",
          "target": "InventoryAggregate",
          "data": [
            "productId",
            "quantity"
          ],
          "returns": "newQuantity",
          "event": "InventoryRestocked"
        },
        {
          "step": 3,
          "actor": "InventoryService",
          "action": "logAuditEvent",
          "target": "AuditLog",
          "data": [
            "productId",
            "previousQty",
            "newQty",
            "reason",
            "operator",
            "timestamp"
          ]
        },
        {
          "step": 4,
          "actor": "InventoryService",
          "action": "returnResult",
          "target": "WarehouseStaff",
          "data": [
            "productId",
            "newQuantityOnHand"
          ]
        }
      ],
      "outcome": {
        "success": "Inventory increased, audit trail recorded",
        "state_changes": [
          "Inventory.quantityOnHand += quantity",
          "Inventory.availableQuantity += quantity"
        ]
      },
      "exceptions": [
        {
          "condition": "Invalid quantity (zero or negative)",
          "step": 2,
          "handling": "Return INVALID_QUANTITY error"
        },
        {
          "condition": "Product not found",
          "step": 2,
          "handling": "Return PRODUCT_NOT_FOUND error"
        }
      ],
      "relatedACs": [],
      "relatedBRs": [
        "BR-AUDIT-002"
      ]
    },
    {
      "id": "SEQ-INV-002",
      "name": "Out of Stock Notification",
      "description": "Notify operations when product goes out of stock",
      "trigger": {
        "type": "system_event",
        "description": "Inventory available quantity reaches zero"
      },
      "participants": [
        {
          "name": "InventoryService",
          "type": "service"
        },
        {
          "name": "NotificationService",
          "type": "service"
        },
        {
          "name": "EmailService",
          "type": "external"
        }
      ],
      "steps": [
        {
          "step": 1,
          "actor": "InventoryService",
          "action": "emit",
          "target": "EventBus",
          "data": [
            "productId",
            "productName"
          ],
          "event": "OutOfStock"
        },
        {
          "step": 2,
          "actor": "NotificationService",
          "action": "handleOutOfStock",
          "target": "NotificationService",
          "data": [
            "productId",
            "productName"
          ]
        },
        {
          "step": 3,
          "actor": "NotificationService",
          "action": "notifyOperations",
          "target": "EmailService",
          "data": [
            "operationsEmail",
            "productDetails"
          ]
        }
      ],
      "outcome": {
        "success": "Operations team notified of out-of-stock product",
        "state_changes": []
      },
      "exceptions": [
        {
          "condition": "Email delivery failed",
          "step": 3,
          "handling": "Retry 3 times, log for manual follow-up"
        }
      ],
      "relatedACs": [],
      "relatedBRs": []
    },
    {
      "id": "SEQ-CAT-001",
      "name": "Create Category",
      "description": "Create a new product category with optional parent",
      "trigger": {
        "type": "user_action",
        "description": "Admin creates a new category"
      },
      "participants": [
        {
          "name": "Admin",
          "type": "actor"
        },
        {
          "name": "CategoryService",
          "type": "service"
        },
        {
          "name": "CategoryAggregate",
          "type": "aggregate"
        }
      ],
      "steps": [
        {
          "step": 1,
          "actor": "Admin",
          "action": "createCategory",
          "target": "CategoryService",
          "data": [
            "name",
            "description",
            "parentCategoryId"
          ],
          "returns": "categoryResult"
        },
        {
          "step": 2,
          "actor": "CategoryService",
          "action": "validateUniqueName",
          "target": "CategoryAggregate",
          "data": [
            "name"
          ],
          "returns": "isUnique"
        },
        {
          "step": 3,
          "actor": "CategoryService",
          "action": "validateHierarchyDepth",
          "target": "CategoryService",
          "data": [
            "parentCategoryId"
          ],
          "returns": "currentDepth"
        },
        {
          "step": 4,
          "actor": "CategoryService",
          "action": "create",
          "target": "CategoryAggregate",
          "data": [
            "name",
            "description",
            "parentCategoryId"
          ],
          "returns": "categoryId",
          "event": "CategoryCreated"
        },
        {
          "step": 5,
          "actor": "CategoryService",
          "action": "returnCategory",
          "target": "Admin",
          "data": [
            "categoryId",
            "categoryDetails"
          ]
        }
      ],
      "outcome": {
        "success": "Category created in hierarchy",
        "state_changes": [
          "Category created with optional parent reference"
        ]
      },
      "exceptions": [
        {
          "condition": "Category name already exists",
          "step": 2,
          "handling": "Return DUPLICATE_CATEGORY_NAME error"
        },
        {
          "condition": "Parent category would exceed depth limit",
          "step": 3,
          "handling": "Return CATEGORY_DEPTH_EXCEEDED error"
        },
        {
          "condition": "Parent category not found",
          "step": 3,
          "handling": "Return PARENT_CATEGORY_NOT_FOUND error"
        }
      ],
      "relatedACs": [],
      "relatedBRs": [
        "BR-CAT-001"
      ]
    },
    {
      "id": "SEQ-VAR-001",
      "name": "Add Product Variant",
      "description": "Add a size/color variant to an existing product",
      "trigger": {
        "type": "user_action",
        "description": "Admin adds variant to product"
      },
      "participants": [
        {
          "name": "Admin",
          "type": "actor"
        },
        {
          "name": "ProductService",
          "type": "service"
        },
        {
          "name": "ProductAggregate",
          "type": "aggregate"
        },
        {
          "name": "InventoryService",
          "type": "service"
        }
      ],
      "steps": [
        {
          "step": 1,
          "actor": "Admin",
          "action": "addVariant",
          "target": "ProductService",
          "data": [
            "productId",
            "sku",
            "size",
            "color",
            "priceAdjustment",
            "initialStock"
          ],
          "returns": "variantResult"
        },
        {
          "step": 2,
          "actor": "ProductService",
          "action": "validateSkuUniqueness",
          "target": "ProductAggregate",
          "data": [
            "sku"
          ],
          "returns": "isUnique"
        },
        {
          "step": 3,
          "actor": "ProductService",
          "action": "addVariant",
          "target": "ProductAggregate",
          "data": [
            "productId",
            "variantDetails"
          ],
          "returns": "variantId"
        },
        {
          "step": 4,
          "actor": "ProductService",
          "action": "createVariantInventory",
          "target": "InventoryService",
          "data": [
            "variantId",
            "initialStock"
          ],
          "returns": "inventoryId"
        },
        {
          "step": 5,
          "actor": "ProductService",
          "action": "returnVariant",
          "target": "Admin",
          "data": [
            "variantId",
            "variantDetails"
          ]
        }
      ],
      "outcome": {
        "success": "Variant added to product with initial inventory",
        "state_changes": [
          "Product.variants += new variant",
          "Inventory record created for variant"
        ]
      },
      "exceptions": [
        {
          "condition": "SKU already exists",
          "step": 2,
          "handling": "Return DUPLICATE_SKU error"
        },
        {
          "condition": "Product not found",
          "step": 3,
          "handling": "Return PRODUCT_NOT_FOUND error"
        },
        {
          "condition": "Neither size nor color specified",
          "step": 1,
          "handling": "Return VARIANT_ATTRIBUTE_REQUIRED error"
        }
      ],
      "relatedACs": [],
      "relatedBRs": [
        "BR-VAR-001"
      ]
    },
    {
      "id": "SEQ-CART-004",
      "name": "Cart Expiration Cleanup",
      "description": "Scheduled job to clean up expired carts",
      "trigger": {
        "type": "scheduled",
        "description": "Daily scheduled job runs at midnight"
      },
      "participants": [
        {
          "name": "Scheduler",
          "type": "service"
        },
        {
          "name": "CartService",
          "type": "service"
        },
        {
          "name": "CartAggregate",
          "type": "aggregate"
        }
      ],
      "steps": [
        {
          "step": 1,
          "actor": "Scheduler",
          "action": "triggerCleanup",
          "target": "CartService"
        },
        {
          "step": 2,
          "actor": "CartService",
          "action": "findExpiredCarts",
          "target": "CartAggregate",
          "data": [
            "loggedInExpiry: 30 days",
            "guestExpiry: 7 days"
          ],
          "returns": "expiredCartIds"
        },
        {
          "step": 3,
          "actor": "CartService",
          "action": "deleteExpiredCarts",
          "target": "CartAggregate",
          "data": [
            "expiredCartIds"
          ],
          "returns": "deletedCount"
        },
        {
          "step": 4,
          "actor": "CartService",
          "action": "logCleanupResult",
          "target": "Logger",
          "data": [
            "deletedCount",
            "timestamp"
          ]
        }
      ],
      "outcome": {
        "success": "Expired carts deleted, resources freed",
        "state_changes": [
          "Expired Cart records deleted"
        ]
      },
      "exceptions": [
        {
          "condition": "Database error during deletion",
          "step": 3,
          "handling": "Log error, continue with next batch, retry failed deletions"
        }
      ],
      "relatedACs": [],
      "relatedBRs": [
        "BR-CART-003"
      ]
    },
    {
      "id": "SEQ-PRICE-001",
      "name": "Update Product Price",
      "description": "Update product price with audit trail",
      "trigger": {
        "type": "user_action",
        "description": "Admin updates product pricing"
      },
      "participants": [
        {
          "name": "Admin",
          "type": "actor"
        },
        {
          "name": "ProductService",
          "type": "service"
        },
        {
          "name": "ProductAggregate",
          "type": "aggregate"
        }
      ],
      "steps": [
        {
          "step": 1,
          "actor": "Admin",
          "action": "updatePrice",
          "target": "ProductService",
          "data": [
            "productId",
            "newPrice"
          ],
          "returns": "updateResult"
        },
        {
          "step": 2,
          "actor": "ProductService",
          "action": "validatePrice",
          "target": "ProductService",
          "data": [
            "newPrice"
          ],
          "returns": "isValid"
        },
        {
          "step": 3,
          "actor": "ProductService",
          "action": "getPreviousPrice",
          "target": "ProductAggregate",
          "data": [
            "productId"
          ],
          "returns": "previousPrice"
        },
        {
          "step": 4,
          "actor": "ProductService",
          "action": "update",
          "target": "ProductAggregate",
          "data": [
            "productId",
            "newPrice"
          ],
          "returns": "updatedProduct",
          "event": "ProductUpdated"
        },
        {
          "step": 5,
          "actor": "ProductService",
          "action": "logPriceChange",
          "target": "AuditLog",
          "data": [
            "productId",
            "previousPrice",
            "newPrice",
            "modifier",
            "timestamp"
          ]
        },
        {
          "step": 6,
          "actor": "ProductService",
          "action": "returnResult",
          "target": "Admin",
          "data": [
            "productId",
            "newPrice"
          ]
        }
      ],
      "outcome": {
        "success": "Product price updated, audit trail recorded, cart prices will reflect change on next view",
        "state_changes": [
          "Product.price = newPrice"
        ]
      },
      "exceptions": [
        {
          "condition": "Price less than $0.01",
          "step": 2,
          "handling": "Return INVALID_PRICE error"
        },
        {
          "condition": "Product not found",
          "step": 3,
          "handling": "Return PRODUCT_NOT_FOUND error"
        }
      ],
      "relatedACs": [],
      "relatedBRs": [
        "BR-AUDIT-003",
        "BR-CART-001",
        "BR-PRICE-001"
      ]
    }
  ],
  "shared_types": [
    {
      "name": "Money",
      "fields": [
        {
          "name": "amount",
          "type": "decimal",
          "constraints": "Precision 2 decimal places"
        },
        {
          "name": "currency",
          "type": "string",
          "constraints": "ISO 4217 code, default USD"
        }
      ]
    },
    {
      "name": "ShippingAddress",
      "fields": [
        {
          "name": "street",
          "type": "string",
          "constraints": "Required, 1-200 characters"
        },
        {
          "name": "city",
          "type": "string",
          "constraints": "Required, 1-100 characters"
        },
        {
          "name": "state",
          "type": "string",
          "constraints": "Required, 2-100 characters"
        },
        {
          "name": "postalCode",
          "type": "string",
          "constraints": "Required, valid postal format"
        },
        {
          "name": "country",
          "type": "string",
          "constraints": "Required, ISO 3166 code"
        },
        {
          "name": "recipientName",
          "type": "string",
          "constraints": "Required"
        }
      ]
    },
    {
      "name": "PaymentMethod",
      "fields": [
        {
          "name": "type",
          "type": "PaymentType",
          "constraints": "Required, CREDIT_CARD or PAYPAL"
        },
        {
          "name": "lastFourDigits",
          "type": "string",
          "constraints": "Required for CREDIT_CARD, 4 digits"
        },
        {
          "name": "expiryMonth",
          "type": "integer",
          "constraints": "Required for CREDIT_CARD, 1-12"
        },
        {
          "name": "expiryYear",
          "type": "integer",
          "constraints": "Required for CREDIT_CARD"
        },
        {
          "name": "paypalEmail",
          "type": "Email",
          "constraints": "Required for PAYPAL"
        }
      ]
    },
    {
      "name": "Email",
      "fields": [
        {
          "name": "value",
          "type": "string",
          "constraints": "Valid email format per RFC 5322"
        }
      ]
    },
    {
      "name": "OrderStatus",
      "fields": [
        {
          "name": "value",
          "type": "enum",
          "constraints": "PENDING, CONFIRMED, SHIPPED, DELIVERED, CANCELLED"
        }
      ]
    },
    {
      "name": "CartItem",
      "fields": [
        {
          "name": "cartItemId",
          "type": "CartItemId (UUID)",
          "constraints": "Required, immutable"
        },
        {
          "name": "productId",
          "type": "ProductId (UUID)",
          "constraints": "Required"
        },
        {
          "name": "variantId",
          "type": "VariantId (UUID)",
          "constraints": "Optional"
        },
        {
          "name": "productName",
          "type": "string",
          "constraints": "Snapshot at time of add"
        },
        {
          "name": "unitPrice",
          "type": "Money",
          "constraints": "Current price"
        },
        {
          "name": "quantity",
          "type": "integer",
          "constraints": "Required, \u003e= 1"
        },
        {
          "name": "subtotal",
          "type": "Money",
          "constraints": "Calculated: unitPrice * quantity"
        }
      ]
    },
    {
      "name": "OrderLineItem",
      "fields": [
        {
          "name": "lineItemId",
          "type": "LineItemId (UUID)",
          "constraints": "Required, immutable"
        },
        {
          "name": "productId",
          "type": "ProductId (UUID)",
          "constraints": "Required"
        },
        {
          "name": "productName",
          "type": "string",
          "constraints": "Snapshot at order time"
        },
        {
          "name": "unitPrice",
          "type": "Money",
          "constraints": "Snapshot at order time, immutable"
        },
        {
          "name": "quantity",
          "type": "integer",
          "constraints": "Required, \u003e= 1"
        },
        {
          "name": "subtotal",
          "type": "Money",
          "constraints": "Calculated: unitPrice * quantity"
        }
      ]
    },
    {
      "name": "ProductVariant",
      "fields": [
        {
          "name": "variantId",
          "type": "VariantId (UUID)",
          "constraints": "Required, immutable"
        },
        {
          "name": "sku",
          "type": "string",
          "constraints": "Required, unique"
        },
        {
          "name": "size",
          "type": "string",
          "constraints": "Optional"
        },
        {
          "name": "color",
          "type": "string",
          "constraints": "Optional"
        },
        {
          "name": "priceAdjustment",
          "type": "Money",
          "constraints": "Optional, can be positive or negative"
        }
      ]
    }
  ],
  "tables": [
    {
      "id": "TBL-CUSTOMER-001",
      "name": "customers",
      "aggregate": "Customer",
      "purpose": "Stores registered users who can browse products, maintain carts, and place orders",
      "fields": [
        {
          "name": "id",
          "type": "UUID",
          "constraints": "PRIMARY KEY"
        },
        {
          "name": "email",
          "type": "VARCHAR(255)",
          "constraints": "NOT NULL UNIQUE"
        },
        {
          "name": "password_hash",
          "type": "VARCHAR(255)",
          "constraints": "NOT NULL"
        },
        {
          "name": "registration_status",
          "type": "registration_status_enum",
          "constraints": "NOT NULL",
          "default": "'REGISTERED'"
        },
        {
          "name": "version",
          "type": "INTEGER",
          "constraints": "NOT NULL",
          "default": "1"
        },
        {
          "name": "created_at",
          "type": "TIMESTAMP WITH TIME ZONE",
          "constraints": "NOT NULL",
          "default": "NOW()"
        },
        {
          "name": "updated_at",
          "type": "TIMESTAMP WITH TIME ZONE",
          "constraints": "NOT NULL",
          "default": "NOW()"
        }
      ],
      "primaryKey": {
        "columns": [
          "id"
        ]
      },
      "indexes": [
        {
          "name": "idx_customers_email",
          "columns": [
            "email"
          ]
        }
      ],
      "foreignKeys": [],
      "checkConstraints": []
    },
    {
      "id": "TBL-CART-001",
      "name": "carts",
      "aggregate": "Cart",
      "purpose": "Holds products a customer intends to purchase before checkout",
      "fields": [
        {
          "name": "id",
          "type": "UUID",
          "constraints": "PRIMARY KEY"
        },
        {
          "name": "customer_id",
          "type": "UUID",
          "constraints": "NOT NULL UNIQUE"
        },
        {
          "name": "total_price_amount",
          "type": "DECIMAL(12,2)",
          "constraints": "NOT NULL",
          "default": "0.00"
        },
        {
          "name": "total_price_currency",
          "type": "CHAR(3)",
          "constraints": "NOT NULL",
          "default": "'USD'"
        },
        {
          "name": "version",
          "type": "INTEGER",
          "constraints": "NOT NULL",
          "default": "1"
        },
        {
          "name": "created_at",
          "type": "TIMESTAMP WITH TIME ZONE",
          "constraints": "NOT NULL",
          "default": "NOW()"
        },
        {
          "name": "updated_at",
          "type": "TIMESTAMP WITH TIME ZONE",
          "constraints": "NOT NULL",
          "default": "NOW()"
        }
      ],
      "primaryKey": {
        "columns": [
          "id"
        ]
      },
      "indexes": [
        {
          "name": "idx_carts_customer",
          "columns": [
            "customer_id"
          ]
        }
      ],
      "foreignKeys": [
        {
          "columns": [
            "customer_id"
          ],
          "references": "customers(id)",
          "onDelete": "CASCADE"
        }
      ],
      "checkConstraints": [
        {
          "name": "chk_cart_total_non_negative",
          "expression": "total_price_amount \u003e= 0"
        }
      ]
    },
    {
      "id": "TBL-CARTITEM-001",
      "name": "cart_items",
      "aggregate": "Cart",
      "purpose": "Represents a product and quantity within a shopping cart",
      "fields": [
        {
          "name": "id",
          "type": "UUID",
          "constraints": "PRIMARY KEY"
        },
        {
          "name": "cart_id",
          "type": "UUID",
          "constraints": "NOT NULL"
        },
        {
          "name": "product_id",
          "type": "UUID",
          "constraints": "NOT NULL"
        },
        {
          "name": "product_name",
          "type": "VARCHAR(200)",
          "constraints": "NOT NULL"
        },
        {
          "name": "unit_price_amount",
          "type": "DECIMAL(12,2)",
          "constraints": "NOT NULL"
        },
        {
          "name": "unit_price_currency",
          "type": "CHAR(3)",
          "constraints": "NOT NULL",
          "default": "'USD'"
        },
        {
          "name": "quantity",
          "type": "INTEGER",
          "constraints": "NOT NULL"
        },
        {
          "name": "subtotal_amount",
          "type": "DECIMAL(12,2)",
          "constraints": "NOT NULL"
        },
        {
          "name": "subtotal_currency",
          "type": "CHAR(3)",
          "constraints": "NOT NULL",
          "default": "'USD'"
        },
        {
          "name": "created_at",
          "type": "TIMESTAMP WITH TIME ZONE",
          "constraints": "NOT NULL",
          "default": "NOW()"
        },
        {
          "name": "updated_at",
          "type": "TIMESTAMP WITH TIME ZONE",
          "constraints": "NOT NULL",
          "default": "NOW()"
        }
      ],
      "primaryKey": {
        "columns": [
          "id"
        ]
      },
      "indexes": [
        {
          "name": "idx_cart_items_cart",
          "columns": [
            "cart_id"
          ]
        },
        {
          "name": "idx_cart_items_cart_product",
          "columns": [
            "cart_id",
            "product_id"
          ]
        }
      ],
      "foreignKeys": [
        {
          "columns": [
            "cart_id"
          ],
          "references": "carts(id)",
          "onDelete": "CASCADE"
        },
        {
          "columns": [
            "product_id"
          ],
          "references": "products(id)",
          "onDelete": "RESTRICT"
        }
      ],
      "checkConstraints": [
        {
          "name": "chk_cart_item_quantity",
          "expression": "quantity \u003e= 1"
        },
        {
          "name": "chk_cart_item_price_positive",
          "expression": "unit_price_amount \u003e 0"
        }
      ]
    },
    {
      "id": "TBL-ORDER-001",
      "name": "orders",
      "aggregate": "Order",
      "purpose": "Represents a customer's purchase transaction with shipping and payment details",
      "fields": [
        {
          "name": "id",
          "type": "UUID",
          "constraints": "PRIMARY KEY"
        },
        {
          "name": "customer_id",
          "type": "UUID",
          "constraints": "NOT NULL"
        },
        {
          "name": "status",
          "type": "order_status_enum",
          "constraints": "NOT NULL",
          "default": "'PENDING'"
        },
        {
          "name": "shipping_street",
          "type": "VARCHAR(200)",
          "constraints": "NOT NULL"
        },
        {
          "name": "shipping_city",
          "type": "VARCHAR(100)",
          "constraints": "NOT NULL"
        },
        {
          "name": "shipping_state",
          "type": "VARCHAR(100)",
          "constraints": "NOT NULL"
        },
        {
          "name": "shipping_postal_code",
          "type": "VARCHAR(20)",
          "constraints": "NOT NULL"
        },
        {
          "name": "shipping_country",
          "type": "CHAR(2)",
          "constraints": "NOT NULL"
        },
        {
          "name": "payment_type",
          "type": "payment_type_enum",
          "constraints": "NOT NULL"
        },
        {
          "name": "payment_last_four_digits",
          "type": "CHAR(4)",
          "constraints": ""
        },
        {
          "name": "payment_expiry_month",
          "type": "SMALLINT",
          "constraints": ""
        },
        {
          "name": "payment_expiry_year",
          "type": "SMALLINT",
          "constraints": ""
        },
        {
          "name": "payment_paypal_email",
          "type": "VARCHAR(255)",
          "constraints": ""
        },
        {
          "name": "subtotal_amount",
          "type": "DECIMAL(12,2)",
          "constraints": "NOT NULL"
        },
        {
          "name": "subtotal_currency",
          "type": "CHAR(3)",
          "constraints": "NOT NULL",
          "default": "'USD'"
        },
        {
          "name": "shipping_cost_amount",
          "type": "DECIMAL(12,2)",
          "constraints": "NOT NULL"
        },
        {
          "name": "shipping_cost_currency",
          "type": "CHAR(3)",
          "constraints": "NOT NULL",
          "default": "'USD'"
        },
        {
          "name": "total_amount",
          "type": "DECIMAL(12,2)",
          "constraints": "NOT NULL"
        },
        {
          "name": "total_currency",
          "type": "CHAR(3)",
          "constraints": "NOT NULL",
          "default": "'USD'"
        },
        {
          "name": "tracking_number",
          "type": "VARCHAR(100)",
          "constraints": ""
        },
        {
          "name": "cancellation_reason",
          "type": "VARCHAR(500)",
          "constraints": ""
        },
        {
          "name": "version",
          "type": "INTEGER",
          "constraints": "NOT NULL",
          "default": "1"
        },
        {
          "name": "created_at",
          "type": "TIMESTAMP WITH TIME ZONE",
          "constraints": "NOT NULL",
          "default": "NOW()"
        },
        {
          "name": "updated_at",
          "type": "TIMESTAMP WITH TIME ZONE",
          "constraints": "NOT NULL",
          "default": "NOW()"
        }
      ],
      "primaryKey": {
        "columns": [
          "id"
        ]
      },
      "indexes": [
        {
          "name": "idx_orders_customer",
          "columns": [
            "customer_id"
          ]
        },
        {
          "name": "idx_orders_status",
          "columns": [
            "status"
          ]
        },
        {
          "name": "idx_orders_created_at",
          "columns": [
            "created_at"
          ]
        }
      ],
      "foreignKeys": [
        {
          "columns": [
            "customer_id"
          ],
          "references": "customers(id)",
          "onDelete": "RESTRICT"
        }
      ],
      "checkConstraints": [
        {
          "name": "chk_order_subtotal_non_negative",
          "expression": "subtotal_amount \u003e= 0"
        },
        {
          "name": "chk_order_shipping_non_negative",
          "expression": "shipping_cost_amount \u003e= 0"
        },
        {
          "name": "chk_order_total_non_negative",
          "expression": "total_amount \u003e= 0"
        },
        {
          "name": "chk_order_expiry_month",
          "expression": "payment_expiry_month IS NULL OR (payment_expiry_month \u003e= 1 AND payment_expiry_month \u003c= 12)"
        },
        {
          "name": "chk_order_payment_credit_card",
          "expression": "payment_type != 'CREDIT_CARD' OR (payment_last_four_digits IS NOT NULL AND payment_expiry_month IS NOT NULL AND payment_expiry_year IS NOT NULL)"
        },
        {
          "name": "chk_order_payment_paypal",
          "expression": "payment_type != 'PAYPAL' OR payment_paypal_email IS NOT NULL"
        }
      ]
    },
    {
      "id": "TBL-ORDERLINEITEM-001",
      "name": "order_line_items",
      "aggregate": "Order",
      "purpose": "Immutable snapshot of a product at time of order with quantity and pricing",
      "fields": [
        {
          "name": "id",
          "type": "UUID",
          "constraints": "PRIMARY KEY"
        },
        {
          "name": "order_id",
          "type": "UUID",
          "constraints": "NOT NULL"
        },
        {
          "name": "product_id",
          "type": "UUID",
          "constraints": "NOT NULL"
        },
        {
          "name": "product_name",
          "type": "VARCHAR(200)",
          "constraints": "NOT NULL"
        },
        {
          "name": "unit_price_amount",
          "type": "DECIMAL(12,2)",
          "constraints": "NOT NULL"
        },
        {
          "name": "unit_price_currency",
          "type": "CHAR(3)",
          "constraints": "NOT NULL",
          "default": "'USD'"
        },
        {
          "name": "quantity",
          "type": "INTEGER",
          "constraints": "NOT NULL"
        },
        {
          "name": "subtotal_amount",
          "type": "DECIMAL(12,2)",
          "constraints": "NOT NULL"
        },
        {
          "name": "subtotal_currency",
          "type": "CHAR(3)",
          "constraints": "NOT NULL",
          "default": "'USD'"
        },
        {
          "name": "created_at",
          "type": "TIMESTAMP WITH TIME ZONE",
          "constraints": "NOT NULL",
          "default": "NOW()"
        },
        {
          "name": "updated_at",
          "type": "TIMESTAMP WITH TIME ZONE",
          "constraints": "NOT NULL",
          "default": "NOW()"
        }
      ],
      "primaryKey": {
        "columns": [
          "id"
        ]
      },
      "indexes": [
        {
          "name": "idx_order_line_items_order",
          "columns": [
            "order_id"
          ]
        }
      ],
      "foreignKeys": [
        {
          "columns": [
            "order_id"
          ],
          "references": "orders(id)",
          "onDelete": "CASCADE"
        },
        {
          "columns": [
            "product_id"
          ],
          "references": "products(id)",
          "onDelete": "RESTRICT"
        }
      ],
      "checkConstraints": [
        {
          "name": "chk_line_item_quantity",
          "expression": "quantity \u003e= 1"
        },
        {
          "name": "chk_line_item_price_positive",
          "expression": "unit_price_amount \u003e 0"
        }
      ]
    },
    {
      "id": "TBL-PRODUCT-001",
      "name": "products",
      "aggregate": "Product",
      "purpose": "Represents an item available for sale in the store",
      "fields": [
        {
          "name": "id",
          "type": "UUID",
          "constraints": "PRIMARY KEY"
        },
        {
          "name": "name",
          "type": "VARCHAR(200)",
          "constraints": "NOT NULL"
        },
        {
          "name": "description",
          "type": "TEXT",
          "constraints": ""
        },
        {
          "name": "price_amount",
          "type": "DECIMAL(12,2)",
          "constraints": "NOT NULL"
        },
        {
          "name": "price_currency",
          "type": "CHAR(3)",
          "constraints": "NOT NULL",
          "default": "'USD'"
        },
        {
          "name": "category_id",
          "type": "UUID",
          "constraints": "NOT NULL"
        },
        {
          "name": "is_active",
          "type": "BOOLEAN",
          "constraints": "NOT NULL",
          "default": "true"
        },
        {
          "name": "version",
          "type": "INTEGER",
          "constraints": "NOT NULL",
          "default": "1"
        },
        {
          "name": "created_at",
          "type": "TIMESTAMP WITH TIME ZONE",
          "constraints": "NOT NULL",
          "default": "NOW()"
        },
        {
          "name": "updated_at",
          "type": "TIMESTAMP WITH TIME ZONE",
          "constraints": "NOT NULL",
          "default": "NOW()"
        }
      ],
      "primaryKey": {
        "columns": [
          "id"
        ]
      },
      "indexes": [
        {
          "name": "idx_products_category",
          "columns": [
            "category_id"
          ]
        },
        {
          "name": "idx_products_active",
          "columns": [
            "is_active"
          ]
        },
        {
          "name": "idx_products_name",
          "columns": [
            "name"
          ]
        }
      ],
      "foreignKeys": [
        {
          "columns": [
            "category_id"
          ],
          "references": "categories(id)",
          "onDelete": "RESTRICT"
        }
      ],
      "checkConstraints": [
        {
          "name": "chk_product_price_positive",
          "expression": "price_amount \u003e 0"
        },
        {
          "name": "chk_product_name_length",
          "expression": "LENGTH(name) \u003e= 1 AND LENGTH(name) \u003c= 200"
        },
        {
          "name": "chk_product_description_length",
          "expression": "description IS NULL OR LENGTH(description) \u003c= 5000"
        }
      ]
    },
    {
      "id": "TBL-PRODUCTVARIANT-001",
      "name": "product_variants",
      "aggregate": "Product",
      "purpose": "Represents a specific variation of a product (e.g., size, color combination)",
      "fields": [
        {
          "name": "id",
          "type": "UUID",
          "constraints": "PRIMARY KEY"
        },
        {
          "name": "product_id",
          "type": "UUID",
          "constraints": "NOT NULL"
        },
        {
          "name": "sku",
          "type": "VARCHAR(100)",
          "constraints": "NOT NULL UNIQUE"
        },
        {
          "name": "size",
          "type": "VARCHAR(50)",
          "constraints": ""
        },
        {
          "name": "color",
          "type": "VARCHAR(50)",
          "constraints": ""
        },
        {
          "name": "price_adjustment_amount",
          "type": "DECIMAL(12,2)",
          "constraints": "",
          "default": "0.00"
        },
        {
          "name": "price_adjustment_currency",
          "type": "CHAR(3)",
          "constraints": "",
          "default": "'USD'"
        },
        {
          "name": "created_at",
          "type": "TIMESTAMP WITH TIME ZONE",
          "constraints": "NOT NULL",
          "default": "NOW()"
        },
        {
          "name": "updated_at",
          "type": "TIMESTAMP WITH TIME ZONE",
          "constraints": "NOT NULL",
          "default": "NOW()"
        }
      ],
      "primaryKey": {
        "columns": [
          "id"
        ]
      },
      "indexes": [
        {
          "name": "idx_product_variants_product",
          "columns": [
            "product_id"
          ]
        },
        {
          "name": "idx_product_variants_sku",
          "columns": [
            "sku"
          ]
        }
      ],
      "foreignKeys": [
        {
          "columns": [
            "product_id"
          ],
          "references": "products(id)",
          "onDelete": "CASCADE"
        }
      ],
      "checkConstraints": [
        {
          "name": "chk_variant_has_attribute",
          "expression": "size IS NOT NULL OR color IS NOT NULL"
        }
      ]
    },
    {
      "id": "TBL-CATEGORY-001",
      "name": "categories",
      "aggregate": "Category",
      "purpose": "Organizes products into browsable groupings",
      "fields": [
        {
          "name": "id",
          "type": "UUID",
          "constraints": "PRIMARY KEY"
        },
        {
          "name": "name",
          "type": "VARCHAR(100)",
          "constraints": "NOT NULL UNIQUE"
        },
        {
          "name": "description",
          "type": "TEXT",
          "constraints": ""
        },
        {
          "name": "parent_category_id",
          "type": "UUID",
          "constraints": ""
        },
        {
          "name": "version",
          "type": "INTEGER",
          "constraints": "NOT NULL",
          "default": "1"
        },
        {
          "name": "created_at",
          "type": "TIMESTAMP WITH TIME ZONE",
          "constraints": "NOT NULL",
          "default": "NOW()"
        },
        {
          "name": "updated_at",
          "type": "TIMESTAMP WITH TIME ZONE",
          "constraints": "NOT NULL",
          "default": "NOW()"
        }
      ],
      "primaryKey": {
        "columns": [
          "id"
        ]
      },
      "indexes": [
        {
          "name": "idx_categories_parent",
          "columns": [
            "parent_category_id"
          ]
        },
        {
          "name": "idx_categories_name",
          "columns": [
            "name"
          ]
        }
      ],
      "foreignKeys": [
        {
          "columns": [
            "parent_category_id"
          ],
          "references": "categories(id)",
          "onDelete": "SET NULL"
        }
      ],
      "checkConstraints": [
        {
          "name": "chk_category_not_self_parent",
          "expression": "parent_category_id IS NULL OR parent_category_id != id"
        },
        {
          "name": "chk_category_name_length",
          "expression": "LENGTH(name) \u003e= 1 AND LENGTH(name) \u003c= 100"
        }
      ]
    },
    {
      "id": "TBL-INVENTORY-001",
      "name": "inventories",
      "aggregate": "Inventory",
      "purpose": "Tracks stock levels for products and manages availability",
      "fields": [
        {
          "name": "id",
          "type": "UUID",
          "constraints": "PRIMARY KEY"
        },
        {
          "name": "product_id",
          "type": "UUID",
          "constraints": "NOT NULL UNIQUE"
        },
        {
          "name": "quantity_on_hand",
          "type": "INTEGER",
          "constraints": "NOT NULL",
          "default": "0"
        },
        {
          "name": "reserved_quantity",
          "type": "INTEGER",
          "constraints": "NOT NULL",
          "default": "0"
        },
        {
          "name": "version",
          "type": "INTEGER",
          "constraints": "NOT NULL",
          "default": "1"
        },
        {
          "name": "created_at",
          "type": "TIMESTAMP WITH TIME ZONE",
          "constraints": "NOT NULL",
          "default": "NOW()"
        },
        {
          "name": "updated_at",
          "type": "TIMESTAMP WITH TIME ZONE",
          "constraints": "NOT NULL",
          "default": "NOW()"
        }
      ],
      "primaryKey": {
        "columns": [
          "id"
        ]
      },
      "indexes": [
        {
          "name": "idx_inventories_product",
          "columns": [
            "product_id"
          ]
        }
      ],
      "foreignKeys": [
        {
          "columns": [
            "product_id"
          ],
          "references": "products(id)",
          "onDelete": "CASCADE"
        }
      ],
      "checkConstraints": [
        {
          "name": "chk_inventory_quantity_non_negative",
          "expression": "quantity_on_hand \u003e= 0"
        },
        {
          "name": "chk_inventory_reserved_non_negative",
          "expression": "reserved_quantity \u003e= 0"
        },
        {
          "name": "chk_inventory_reserved_not_exceed",
          "expression": "reserved_quantity \u003c= quantity_on_hand"
        }
      ]
    }
  ],
  "tech_specs": [
    {
      "id": "TS-BR-AUTH-001",
      "name": "Customer registration and email verification for orders",
      "br_ref": "BR-AUTH-001",
      "rule": "Only registered customers with verified email addresses can place orders",
      "implementation": "Checkout service validates customer exists and has emailVerified=true before order creation",
      "validation_points": [
        "POST /orders API",
        "CheckoutService.placeOrder()",
        "OrderService.create()"
      ],
      "data_requirements": [
        {
          "field": "customer_id",
          "type": "UUID",
          "constraints": "NOT NULL, FK to customers",
          "source": "Order aggregate"
        },
        {
          "field": "email_verified",
          "type": "boolean",
          "constraints": "must be true for order placement",
          "source": "Customer aggregate"
        }
      ],
      "error_handling": [
        {
          "condition": "customer not found or not authenticated",
          "error_code": "REGISTRATION_REQUIRED",
          "message": "You must be registered to place an order",
          "http_status": 401
        },
        {
          "condition": "customer.emailVerified == false",
          "error_code": "EMAIL_NOT_VERIFIED",
          "message": "Please verify your email address before placing an order",
          "http_status": 403
        }
      ],
      "related_acs": []
    },
    {
      "id": "TS-BR-STOCK-001",
      "name": "Stock availability validation for cart additions",
      "br_ref": "BR-STOCK-001",
      "rule": "Products must have available inventory to be added to cart",
      "implementation": "Check inventory.availableStock \u003e 0 on add to cart; allow cart items with warnings but validate at checkout",
      "validation_points": [
        "POST /cart/items API",
        "CartService.addItem()",
        "CheckoutService.validateCart()"
      ],
      "data_requirements": [
        {
          "field": "available_stock",
          "type": "integer",
          "constraints": "\u003e= 0",
          "source": "Inventory aggregate"
        },
        {
          "field": "product_id",
          "type": "UUID",
          "constraints": "NOT NULL",
          "source": "CartItem entity"
        },
        {
          "field": "variant_id",
          "type": "UUID",
          "constraints": "nullable, required if product has variants",
          "source": "CartItem entity"
        }
      ],
      "error_handling": [
        {
          "condition": "availableStock == 0",
          "error_code": "OUT_OF_STOCK",
          "message": "This product is currently out of stock",
          "http_status": 409
        },
        {
          "condition": "availableStock \u003c requested at checkout",
          "error_code": "INSUFFICIENT_STOCK",
          "message": "Not enough stock available for checkout",
          "http_status": 409
        }
      ],
      "related_acs": []
    },
    {
      "id": "TS-BR-SHIP-001",
      "name": "Free shipping threshold calculation",
      "br_ref": "BR-SHIP-001",
      "rule": "Orders with subtotal of $50 or more qualify for free shipping",
      "implementation": "ShippingCalculator checks subtotal \u003e= 50.00; returns 0 for shipping cost if met, otherwise $5.99",
      "validation_points": [
        "ShippingService.calculateCost()",
        "Cart.getShippingEstimate()",
        "Order.calculateTotals()"
      ],
      "data_requirements": [
        {
          "field": "subtotal",
          "type": "decimal(10,2)",
          "constraints": "calculated from line items after discounts, before tax",
          "source": "Order/Cart aggregate"
        },
        {
          "field": "shipping_cost",
          "type": "decimal(10,2)",
          "constraints": "0.00 if subtotal \u003e= 50.00, else 5.99",
          "source": "Order aggregate"
        }
      ],
      "error_handling": [],
      "related_acs": []
    },
    {
      "id": "TS-BR-CANCEL-001",
      "name": "Order cancellation status validation",
      "br_ref": "BR-CANCEL-001",
      "rule": "Orders can only be cancelled while in pending or confirmed status",
      "implementation": "CancelOrder operation checks current status is in allowed set before proceeding",
      "validation_points": [
        "POST /orders/{id}/cancel API",
        "OrderService.cancel()"
      ],
      "data_requirements": [
        {
          "field": "status",
          "type": "OrderStatus enum",
          "constraints": "must be 'pending' or 'confirmed' to allow cancellation",
          "source": "Order aggregate"
        }
      ],
      "error_handling": [
        {
          "condition": "status NOT IN ('pending', 'confirmed')",
          "error_code": "CANCELLATION_NOT_ALLOWED",
          "message": "This order cannot be cancelled as it has already been shipped",
          "http_status": 409
        }
      ],
      "related_acs": []
    },
    {
      "id": "TS-BR-PRICE-001",
      "name": "Minimum product price validation",
      "br_ref": "BR-PRICE-001",
      "rule": "Product price must be at least $0.01",
      "implementation": "Validate price \u003e= 0.01 on product create/update; enforce 2 decimal precision",
      "validation_points": [
        "POST /products API",
        "PUT /products/{id} API",
        "ProductService.create()",
        "ProductService.update()",
        "DB CHECK constraint"
      ],
      "data_requirements": [
        {
          "field": "price",
          "type": "decimal(10,2)",
          "constraints": "\u003e= 0.01",
          "source": "Product aggregate"
        }
      ],
      "error_handling": [
        {
          "condition": "price \u003c 0.01",
          "error_code": "INVALID_PRICE",
          "message": "Product price must be at least $0.01",
          "http_status": 400
        }
      ],
      "related_acs": []
    },
    {
      "id": "TS-BR-PRICE-002",
      "name": "Order price snapshot at placement",
      "br_ref": "BR-PRICE-002",
      "rule": "Order items must capture prices at the time of order placement",
      "implementation": "Copy current Product/Variant price to OrderItem.unitPrice during order creation; OrderItem prices are immutable after creation",
      "validation_points": [
        "OrderService.create()",
        "OrderItem entity constructor"
      ],
      "data_requirements": [
        {
          "field": "unit_price",
          "type": "decimal(10,2)",
          "constraints": "immutable after order creation",
          "source": "OrderItem entity"
        },
        {
          "field": "quantity",
          "type": "integer",
          "constraints": "\u003e= 1",
          "source": "OrderItem entity"
        },
        {
          "field": "line_total",
          "type": "decimal(10,2)",
          "constraints": "calculated: unit_price * quantity",
          "source": "OrderItem entity"
        }
      ],
      "error_handling": [],
      "related_acs": []
    },
    {
      "id": "TS-BR-CART-001",
      "name": "Cart prices reflect current product prices",
      "br_ref": "BR-CART-001",
      "rule": "Cart items always reflect current product prices",
      "implementation": "Cart.calculateTotal() fetches current prices from Product/Variant; detect and flag price changes since item was added",
      "validation_points": [
        "GET /cart API",
        "CartService.getCart()",
        "Cart.calculateTotal()"
      ],
      "data_requirements": [
        {
          "field": "product_id",
          "type": "UUID",
          "constraints": "NOT NULL, FK to products",
          "source": "CartItem entity"
        },
        {
          "field": "price_at_add",
          "type": "decimal(10,2)",
          "constraints": "stored for change detection only",
          "source": "CartItem entity"
        },
        {
          "field": "current_price",
          "type": "decimal(10,2)",
          "constraints": "fetched from Product at runtime",
          "source": "Product aggregate"
        }
      ],
      "error_handling": [],
      "related_acs": []
    },
    {
      "id": "TS-BR-INV-001",
      "name": "Non-negative inventory constraint",
      "br_ref": "BR-INV-001",
      "rule": "Inventory stock level must never be negative",
      "implementation": "All inventory operations validate resulting quantity \u003e= 0; use atomic decrement with check in database",
      "validation_points": [
        "InventoryService.adjust()",
        "InventoryService.decrement()",
        "DB CHECK constraint on available_stock"
      ],
      "data_requirements": [
        {
          "field": "available_stock",
          "type": "integer",
          "constraints": "\u003e= 0, CHECK constraint",
          "source": "Inventory aggregate"
        }
      ],
      "error_handling": [
        {
          "condition": "resulting stock would be \u003c 0",
          "error_code": "INSUFFICIENT_STOCK",
          "message": "Insufficient stock available",
          "http_status": 409
        }
      ],
      "related_acs": []
    },
    {
      "id": "TS-BR-INV-002",
      "name": "No backorder validation at checkout",
      "br_ref": "BR-INV-002",
      "rule": "Orders cannot be placed for quantities exceeding available stock",
      "implementation": "Checkout atomically validates all line items have sufficient stock before payment authorization",
      "validation_points": [
        "CheckoutService.validateStock()",
        "OrderService.create()"
      ],
      "data_requirements": [
        {
          "field": "available_stock",
          "type": "integer",
          "constraints": "\u003e= order quantity",
          "source": "Inventory aggregate"
        },
        {
          "field": "quantity",
          "type": "integer",
          "constraints": "\u003e= 1",
          "source": "OrderItem/CartItem entity"
        }
      ],
      "error_handling": [
        {
          "condition": "any item quantity \u003e available stock",
          "error_code": "BACKORDER_NOT_SUPPORTED",
          "message": "One or more items exceed available stock. Backorders are not supported.",
          "http_status": 409
        }
      ],
      "related_acs": []
    },
    {
      "id": "TS-BR-INV-003",
      "name": "Inventory restoration on order cancellation",
      "br_ref": "BR-INV-003",
      "rule": "Cancelled orders must automatically restore inventory",
      "implementation": "Order cancellation handler iterates OrderItems and increments Inventory.availableStock for each",
      "validation_points": [
        "OrderService.cancel()",
        "InventoryService.restore()"
      ],
      "data_requirements": [
        {
          "field": "order_items",
          "type": "OrderItem[]",
          "constraints": "list of items to restore",
          "source": "Order aggregate"
        },
        {
          "field": "available_stock",
          "type": "integer",
          "constraints": "incremented by item quantity",
          "source": "Inventory aggregate"
        }
      ],
      "error_handling": [],
      "related_acs": []
    },
    {
      "id": "TS-BR-ORDER-001",
      "name": "Order state machine transition validation",
      "br_ref": "BR-ORDER-001",
      "rule": "Orders must follow defined state machine transitions",
      "implementation": "OrderStateMachine validates transition legality before allowing status change",
      "validation_points": [
        "PUT /orders/{id}/status API",
        "OrderService.updateStatus()",
        "Order.transitionTo()"
      ],
      "data_requirements": [
        {
          "field": "status",
          "type": "OrderStatus enum",
          "constraints": "pending|confirmed|shipped|delivered|cancelled",
          "source": "Order aggregate"
        },
        {
          "field": "allowed_transitions",
          "type": "map",
          "constraints": "pending[confirmed,cancelled], confirmed[shipped,cancelled], shipped[delivered], delivered[], cancelled[]",
          "source": "Order state machine"
        }
      ],
      "error_handling": [
        {
          "condition": "transition not in allowed set",
          "error_code": "INVALID_STATUS_TRANSITION",
          "message": "Cannot transition order from {current} to {requested}",
          "http_status": 409
        }
      ],
      "related_acs": []
    },
    {
      "id": "TS-BR-ORDER-002",
      "name": "Order immutability after placement",
      "br_ref": "BR-ORDER-002",
      "rule": "Orders cannot be modified after placement",
      "implementation": "No PUT endpoints for order items/quantities/address; only status transitions exposed",
      "validation_points": [
        "API layer - no edit endpoints exposed",
        "OrderService - no modify methods"
      ],
      "data_requirements": [
        {
          "field": "order_items",
          "type": "OrderItem[]",
          "constraints": "immutable after creation",
          "source": "Order aggregate"
        },
        {
          "field": "shipping_address",
          "type": "ShippingAddress",
          "constraints": "immutable after creation",
          "source": "Order aggregate"
        }
      ],
      "error_handling": [
        {
          "condition": "attempt to modify placed order",
          "error_code": "ORDER_MODIFICATION_NOT_ALLOWED",
          "message": "Orders cannot be modified after placement. Please cancel and create a new order.",
          "http_status": 403
        }
      ],
      "related_acs": []
    },
    {
      "id": "TS-BR-ORDER-003",
      "name": "Single shipment per order constraint",
      "br_ref": "BR-ORDER-003",
      "rule": "Each order ships as a single unit",
      "implementation": "Order has single shipment reference; no partial shipment API or functionality",
      "validation_points": [
        "Order entity design",
        "ShipmentService.ship()"
      ],
      "data_requirements": [
        {
          "field": "shipment_id",
          "type": "UUID",
          "constraints": "nullable, single value per order",
          "source": "Order aggregate"
        },
        {
          "field": "tracking_number",
          "type": "string",
          "constraints": "single tracking number per order",
          "source": "Shipment entity"
        }
      ],
      "error_handling": [],
      "related_acs": []
    },
    {
      "id": "TS-BR-CUST-001",
      "name": "Unique customer email validation",
      "br_ref": "BR-CUST-001",
      "rule": "Email addresses must be unique across all customer accounts",
      "implementation": "Check email uniqueness before customer creation; DB unique constraint as backup",
      "validation_points": [
        "POST /customers API",
        "CustomerService.register()",
        "DB UNIQUE constraint on email"
      ],
      "data_requirements": [
        {
          "field": "email",
          "type": "varchar(255)",
          "constraints": "UNIQUE, NOT NULL, valid email format",
          "source": "Customer aggregate"
        }
      ],
      "error_handling": [
        {
          "condition": "email already exists",
          "error_code": "EMAIL_ALREADY_REGISTERED",
          "message": "An account with this email address already exists",
          "http_status": 409
        }
      ],
      "related_acs": []
    },
    {
      "id": "TS-BR-CUST-002",
      "name": "Password strength validation",
      "br_ref": "BR-CUST-002",
      "rule": "Customer passwords must meet minimum security requirements",
      "implementation": "Validate password on registration and password change; regex: ^(?=.*[0-9]).{8,}$",
      "validation_points": [
        "POST /customers API",
        "PUT /customers/{id}/password API",
        "CustomerService.register()",
        "CustomerService.changePassword()"
      ],
      "data_requirements": [
        {
          "field": "password",
          "type": "varchar(255)",
          "constraints": "min 8 chars, at least one digit, stored as hash",
          "source": "Customer aggregate"
        }
      ],
      "error_handling": [
        {
          "condition": "password \u003c 8 chars OR no digit",
          "error_code": "WEAK_PASSWORD",
          "message": "Password must be at least 8 characters and contain at least one number",
          "http_status": 400
        }
      ],
      "related_acs": []
    },
    {
      "id": "TS-BR-CUST-003",
      "name": "Email verification required for checkout",
      "br_ref": "BR-CUST-003",
      "rule": "Customers must verify their email before placing orders",
      "implementation": "Check customer.emailVerified == true in checkout flow before order creation",
      "validation_points": [
        "CheckoutService.placeOrder()",
        "POST /orders API"
      ],
      "data_requirements": [
        {
          "field": "email_verified",
          "type": "boolean",
          "constraints": "default false, set true after verification",
          "source": "Customer aggregate"
        }
      ],
      "error_handling": [
        {
          "condition": "emailVerified == false",
          "error_code": "EMAIL_NOT_VERIFIED",
          "message": "Please verify your email address before placing an order",
          "http_status": 403
        }
      ],
      "related_acs": []
    },
    {
      "id": "TS-BR-PROD-001",
      "name": "Product soft delete for order history preservation",
      "br_ref": "BR-PROD-001",
      "rule": "Products with order history must be soft-deleted",
      "implementation": "Delete operation checks for OrderItem references; if found, set deletedAt timestamp instead of hard delete",
      "validation_points": [
        "DELETE /products/{id} API",
        "ProductService.delete()"
      ],
      "data_requirements": [
        {
          "field": "deleted_at",
          "type": "timestamp",
          "constraints": "nullable, set for soft delete",
          "source": "Product aggregate"
        },
        {
          "field": "has_orders",
          "type": "boolean",
          "constraints": "derived from OrderItem existence",
          "source": "Computed"
        }
      ],
      "error_handling": [],
      "related_acs": []
    },
    {
      "id": "TS-BR-PROD-002",
      "name": "Product name length validation",
      "br_ref": "BR-PROD-002",
      "rule": "Product names must be between 2 and 200 characters",
      "implementation": "Validate name length on create and update operations",
      "validation_points": [
        "POST /products API",
        "PUT /products/{id} API",
        "ProductService.create()",
        "ProductService.update()"
      ],
      "data_requirements": [
        {
          "field": "name",
          "type": "varchar(200)",
          "constraints": "length \u003e= 2 AND \u003c= 200, NOT NULL",
          "source": "Product aggregate"
        }
      ],
      "error_handling": [
        {
          "condition": "name.length \u003c 2 OR name.length \u003e 200",
          "error_code": "INVALID_PRODUCT_NAME",
          "message": "Product name must be between 2 and 200 characters",
          "http_status": 400
        }
      ],
      "related_acs": []
    },
    {
      "id": "TS-BR-PROD-003",
      "name": "Product description length validation",
      "br_ref": "BR-PROD-003",
      "rule": "Product descriptions must not exceed 5000 characters",
      "implementation": "Validate description length on create and update operations",
      "validation_points": [
        "POST /products API",
        "PUT /products/{id} API",
        "ProductService.create()",
        "ProductService.update()"
      ],
      "data_requirements": [
        {
          "field": "description",
          "type": "text",
          "constraints": "length \u003c= 5000, nullable",
          "source": "Product aggregate"
        }
      ],
      "error_handling": [
        {
          "condition": "description.length \u003e 5000",
          "error_code": "DESCRIPTION_TOO_LONG",
          "message": "Product description cannot exceed 5000 characters",
          "http_status": 400
        }
      ],
      "related_acs": []
    },
    {
      "id": "TS-BR-PROD-004",
      "name": "Product image limit and primary image validation",
      "br_ref": "BR-PROD-004",
      "rule": "Products can have up to 10 images with exactly one primary image",
      "implementation": "Validate image count on upload; enforce single primary via toggle logic (setting one as primary unsets others)",
      "validation_points": [
        "POST /products/{id}/images API",
        "ProductService.addImage()",
        "ProductService.setPrimaryImage()"
      ],
      "data_requirements": [
        {
          "field": "images",
          "type": "ProductImage[]",
          "constraints": "max 10 items",
          "source": "Product aggregate"
        },
        {
          "field": "is_primary",
          "type": "boolean",
          "constraints": "exactly one true per product",
          "source": "ProductImage entity"
        }
      ],
      "error_handling": [
        {
          "condition": "images.count \u003e= 10 on upload",
          "error_code": "IMAGE_LIMIT_EXCEEDED",
          "message": "Products cannot have more than 10 images",
          "http_status": 400
        },
        {
          "condition": "no primary image set",
          "error_code": "PRIMARY_IMAGE_REQUIRED",
          "message": "Product must have exactly one primary image",
          "http_status": 400
        }
      ],
      "related_acs": []
    },
    {
      "id": "TS-BR-VAR-001",
      "name": "Variant SKU uniqueness validation",
      "br_ref": "BR-VAR-001",
      "rule": "Each product variant must have a unique SKU",
      "implementation": "Check SKU uniqueness on variant create/update; DB unique constraint as backup",
      "validation_points": [
        "POST /products/{id}/variants API",
        "PUT /variants/{id} API",
        "VariantService.create()",
        "DB UNIQUE constraint on sku"
      ],
      "data_requirements": [
        {
          "field": "sku",
          "type": "varchar(100)",
          "constraints": "UNIQUE, NOT NULL",
          "source": "ProductVariant entity"
        }
      ],
      "error_handling": [
        {
          "condition": "SKU already exists",
          "error_code": "DUPLICATE_SKU",
          "message": "A variant with this SKU already exists",
          "http_status": 409
        }
      ],
      "related_acs": []
    },
    {
      "id": "TS-BR-VAR-002",
      "name": "Variant selection required for products with variants",
      "br_ref": "BR-VAR-002",
      "rule": "Products with variants require variant selection before add to cart",
      "implementation": "Add to cart validates: if product.hasVariants then variantId is required",
      "validation_points": [
        "POST /cart/items API",
        "CartService.addItem()"
      ],
      "data_requirements": [
        {
          "field": "has_variants",
          "type": "boolean",
          "constraints": "derived from variants.count \u003e 0",
          "source": "Product aggregate"
        },
        {
          "field": "variant_id",
          "type": "UUID",
          "constraints": "required if product has variants",
          "source": "CartItem entity"
        }
      ],
      "error_handling": [
        {
          "condition": "product has variants AND variantId is null",
          "error_code": "VARIANT_REQUIRED",
          "message": "Please select a variant before adding to cart",
          "http_status": 400
        }
      ],
      "related_acs": []
    },
    {
      "id": "TS-BR-CART-002",
      "name": "Cart quantity limited by available stock",
      "br_ref": "BR-CART-002",
      "rule": "Cart item quantity cannot exceed available inventory",
      "implementation": "Cap requested quantity at availableStock on add/update; return actual quantity added",
      "validation_points": [
        "POST /cart/items API",
        "PUT /cart/items/{id} API",
        "CartService.addItem()",
        "CartService.updateQuantity()"
      ],
      "data_requirements": [
        {
          "field": "quantity",
          "type": "integer",
          "constraints": "\u003e= 1 AND \u003c= availableStock",
          "source": "CartItem entity"
        },
        {
          "field": "available_stock",
          "type": "integer",
          "constraints": "\u003e= 0",
          "source": "Inventory aggregate"
        }
      ],
      "error_handling": [
        {
          "condition": "requested quantity \u003e availableStock",
          "error_code": "QUANTITY_EXCEEDS_STOCK",
          "message": "Requested quantity exceeds available stock. Quantity has been adjusted.",
          "http_status": 200
        }
      ],
      "related_acs": []
    },
    {
      "id": "TS-BR-CART-003",
      "name": "Cart expiration by user type",
      "br_ref": "BR-CART-003",
      "rule": "Carts expire after period of inactivity based on user type",
      "implementation": "Background job runs daily to delete carts where lastActivityAt + TTL \u003c now; TTL = 30 days for authenticated, 7 days for guest",
      "validation_points": [
        "CartExpirationJob (scheduled)",
        "CartService.getCart() - check expiration"
      ],
      "data_requirements": [
        {
          "field": "last_activity_at",
          "type": "timestamp",
          "constraints": "updated on any cart modification",
          "source": "Cart aggregate"
        },
        {
          "field": "customer_id",
          "type": "UUID",
          "constraints": "nullable, null for guest carts",
          "source": "Cart aggregate"
        }
      ],
      "error_handling": [
        {
          "condition": "cart accessed after expiration",
          "error_code": "CART_EXPIRED",
          "message": "Your cart has expired due to inactivity",
          "http_status": 410
        }
      ],
      "related_acs": []
    },
    {
      "id": "TS-BR-PAY-001",
      "name": "Payment authorization before order creation",
      "br_ref": "BR-PAY-001",
      "rule": "Payment must be fully authorized before order is created",
      "implementation": "Checkout flow: 1) validate cart, 2) authorize payment, 3) create order only on successful auth",
      "validation_points": [
        "CheckoutService.placeOrder()",
        "PaymentService.authorize()"
      ],
      "data_requirements": [
        {
          "field": "payment_authorization_id",
          "type": "string",
          "constraints": "NOT NULL on order creation",
          "source": "Order aggregate"
        },
        {
          "field": "payment_status",
          "type": "enum",
          "constraints": "authorized|captured|failed",
          "source": "Payment entity"
        }
      ],
      "error_handling": [
        {
          "condition": "payment authorization fails",
          "error_code": "PAYMENT_REQUIRED",
          "message": "Payment authorization failed. Please try again or use a different payment method.",
          "http_status": 402
        }
      ],
      "related_acs": []
    },
    {
      "id": "TS-BR-PAY-002",
      "name": "Automatic refund on order cancellation",
      "br_ref": "BR-PAY-002",
      "rule": "Cancelled orders must receive automatic refund",
      "implementation": "Order cancellation triggers refund via payment gateway; refund is async but must be initiated",
      "validation_points": [
        "OrderService.cancel()",
        "PaymentService.refund()"
      ],
      "data_requirements": [
        {
          "field": "payment_authorization_id",
          "type": "string",
          "constraints": "required for refund",
          "source": "Order aggregate"
        },
        {
          "field": "refund_status",
          "type": "enum",
          "constraints": "pending|completed|failed",
          "source": "Payment entity"
        }
      ],
      "error_handling": [],
      "related_acs": []
    },
    {
      "id": "TS-BR-SHIP-002",
      "name": "Domestic shipping only validation",
      "br_ref": "BR-SHIP-002",
      "rule": "Shipping is only available within configured domestic country",
      "implementation": "Validate ShippingAddress.country matches system configured domestic country",
      "validation_points": [
        "POST /addresses API",
        "CheckoutService.validateAddress()"
      ],
      "data_requirements": [
        {
          "field": "country",
          "type": "varchar(2)",
          "constraints": "ISO 3166-1 alpha-2, must match DOMESTIC_COUNTRY config",
          "source": "ShippingAddress entity"
        },
        {
          "field": "domestic_country",
          "type": "string",
          "constraints": "system configuration",
          "source": "Application config"
        }
      ],
      "error_handling": [
        {
          "condition": "country != DOMESTIC_COUNTRY",
          "error_code": "INTERNATIONAL_SHIPPING_NOT_AVAILABLE",
          "message": "We currently only ship within {country}. International shipping is not available.",
          "http_status": 400
        }
      ],
      "related_acs": []
    },
    {
      "id": "TS-BR-ADDR-001",
      "name": "Required shipping address fields validation",
      "br_ref": "BR-ADDR-001",
      "rule": "Shipping addresses must include all required fields",
      "implementation": "Validate all required fields are present and non-empty on address create/update",
      "validation_points": [
        "POST /addresses API",
        "PUT /addresses/{id} API",
        "AddressService.validate()"
      ],
      "data_requirements": [
        {
          "field": "recipient_name",
          "type": "varchar(100)",
          "constraints": "NOT NULL, non-empty",
          "source": "ShippingAddress entity"
        },
        {
          "field": "street",
          "type": "varchar(200)",
          "constraints": "NOT NULL, non-empty",
          "source": "ShippingAddress entity"
        },
        {
          "field": "city",
          "type": "varchar(100)",
          "constraints": "NOT NULL, non-empty",
          "source": "ShippingAddress entity"
        },
        {
          "field": "state",
          "type": "varchar(100)",
          "constraints": "NOT NULL, non-empty",
          "source": "ShippingAddress entity"
        },
        {
          "field": "postal_code",
          "type": "varchar(20)",
          "constraints": "NOT NULL, non-empty",
          "source": "ShippingAddress entity"
        },
        {
          "field": "country",
          "type": "varchar(2)",
          "constraints": "NOT NULL, ISO 3166-1 alpha-2",
          "source": "ShippingAddress entity"
        }
      ],
      "error_handling": [
        {
          "condition": "any required field missing or empty",
          "error_code": "INCOMPLETE_ADDRESS",
          "message": "Please provide all required address fields: name, street, city, state, postal code, and country",
          "http_status": 400
        }
      ],
      "related_acs": []
    },
    {
      "id": "TS-BR-CAT-001",
      "name": "Category hierarchy depth limit",
      "br_ref": "BR-CAT-001",
      "rule": "Categories can be nested up to 3 levels deep",
      "implementation": "On category create with parent, calculate depth and reject if \u003e 3; depth = parent.depth + 1",
      "validation_points": [
        "POST /categories API",
        "CategoryService.create()"
      ],
      "data_requirements": [
        {
          "field": "parent_id",
          "type": "UUID",
          "constraints": "nullable, FK to categories",
          "source": "Category entity"
        },
        {
          "field": "depth",
          "type": "integer",
          "constraints": "\u003e= 1 AND \u003c= 3",
          "source": "Category entity"
        }
      ],
      "error_handling": [
        {
          "condition": "calculated depth \u003e 3",
          "error_code": "CATEGORY_DEPTH_EXCEEDED",
          "message": "Categories cannot be nested more than 3 levels deep",
          "http_status": 400
        }
      ],
      "related_acs": []
    },
    {
      "id": "TS-BR-AUDIT-001",
      "name": "Order event audit logging",
      "br_ref": "BR-AUDIT-001",
      "rule": "All order events must be logged for audit purposes",
      "implementation": "OrderEventListener logs all order domain events to audit_log table",
      "validation_points": [
        "OrderService.create()",
        "OrderService.updateStatus()",
        "OrderService.cancel()",
        "AuditLogService.log()"
      ],
      "data_requirements": [
        {
          "field": "entity_type",
          "type": "varchar(50)",
          "constraints": "'Order'",
          "source": "AuditLog entity"
        },
        {
          "field": "entity_id",
          "type": "UUID",
          "constraints": "Order ID",
          "source": "AuditLog entity"
        },
        {
          "field": "action",
          "type": "varchar(50)",
          "constraints": "created|status_changed|cancelled",
          "source": "AuditLog entity"
        },
        {
          "field": "before_value",
          "type": "jsonb",
          "constraints": "nullable, previous state",
          "source": "AuditLog entity"
        },
        {
          "field": "after_value",
          "type": "jsonb",
          "constraints": "new state",
          "source": "AuditLog entity"
        },
        {
          "field": "user_id",
          "type": "UUID",
          "constraints": "actor who made change",
          "source": "AuditLog entity"
        },
        {
          "field": "timestamp",
          "type": "timestamp",
          "constraints": "NOT NULL",
          "source": "AuditLog entity"
        }
      ],
      "error_handling": [],
      "related_acs": []
    },
    {
      "id": "TS-BR-AUDIT-002",
      "name": "Inventory change audit logging",
      "br_ref": "BR-AUDIT-002",
      "rule": "All inventory changes must be logged with full audit trail",
      "implementation": "InventoryEventListener logs all inventory adjustments to audit_log table",
      "validation_points": [
        "InventoryService.adjust()",
        "InventoryService.decrement()",
        "InventoryService.restore()",
        "AuditLogService.log()"
      ],
      "data_requirements": [
        {
          "field": "entity_type",
          "type": "varchar(50)",
          "constraints": "'Inventory'",
          "source": "AuditLog entity"
        },
        {
          "field": "entity_id",
          "type": "UUID",
          "constraints": "Inventory ID",
          "source": "AuditLog entity"
        },
        {
          "field": "action",
          "type": "varchar(50)",
          "constraints": "adjusted|decremented|restored",
          "source": "AuditLog entity"
        },
        {
          "field": "before_value",
          "type": "jsonb",
          "constraints": "previous stock level",
          "source": "AuditLog entity"
        },
        {
          "field": "after_value",
          "type": "jsonb",
          "constraints": "new stock level",
          "source": "AuditLog entity"
        },
        {
          "field": "reason",
          "type": "varchar(200)",
          "constraints": "adjustment reason",
          "source": "AuditLog entity"
        },
        {
          "field": "user_id",
          "type": "UUID",
          "constraints": "operator who made change",
          "source": "AuditLog entity"
        }
      ],
      "error_handling": [],
      "related_acs": []
    },
    {
      "id": "TS-BR-AUDIT-003",
      "name": "Price change audit logging",
      "br_ref": "BR-AUDIT-003",
      "rule": "Product price changes must be tracked in audit trail",
      "implementation": "ProductEventListener detects price changes and logs to audit_log table",
      "validation_points": [
        "ProductService.update()",
        "AuditLogService.log()"
      ],
      "data_requirements": [
        {
          "field": "entity_type",
          "type": "varchar(50)",
          "constraints": "'Product'",
          "source": "AuditLog entity"
        },
        {
          "field": "entity_id",
          "type": "UUID",
          "constraints": "Product ID",
          "source": "AuditLog entity"
        },
        {
          "field": "action",
          "type": "varchar(50)",
          "constraints": "price_changed",
          "source": "AuditLog entity"
        },
        {
          "field": "before_value",
          "type": "jsonb",
          "constraints": "{\"price\": previous_price}",
          "source": "AuditLog entity"
        },
        {
          "field": "after_value",
          "type": "jsonb",
          "constraints": "{\"price\": new_price}",
          "source": "AuditLog entity"
        },
        {
          "field": "user_id",
          "type": "UUID",
          "constraints": "modifier who changed price",
          "source": "AuditLog entity"
        }
      ],
      "error_handling": [],
      "related_acs": []
    }
  ],
  "test_cases": [
    {
      "id": "TC-AC-PROD-001-P01",
      "name": "Filter products by single category",
      "category": "positive",
      "ac_ref": "AC-PROD-001",
      "br_refs": [
        "BR-PROD"
      ],
      "preconditions": [
        "Products exist in multiple categories",
        "User is on product listing page"
      ],
      "test_data": [
        {
          "field": "category",
          "value": "Electronics",
          "notes": "Valid category with products"
        }
      ],
      "steps": [
        "Navigate to product listing",
        "Select category filter 'Electronics'",
        "Apply filters"
      ],
      "expected_results": [
        "Only Electronics products displayed",
        "Other categories hidden"
      ]
    },
    {
      "id": "TC-AC-PROD-001-P02",
      "name": "Filter products by price range and availability",
      "category": "positive",
      "ac_ref": "AC-PROD-001",
      "br_refs": [
        "BR-PROD"
      ],
      "preconditions": [
        "Products exist with various prices",
        "Some products in/out of stock"
      ],
      "test_data": [
        {
          "field": "priceMin",
          "value": "10",
          "notes": "Lower bound"
        },
        {
          "field": "priceMax",
          "value": "50",
          "notes": "Upper bound"
        },
        {
          "field": "availability",
          "value": "inStock",
          "notes": "Only available items"
        }
      ],
      "steps": [
        "Set price range 10-50",
        "Select 'In Stock' filter",
        "Apply filters"
      ],
      "expected_results": [
        "Only in-stock products $10-$50 shown",
        "Out of stock items hidden"
      ]
    },
    {
      "id": "TC-AC-PROD-001-P03",
      "name": "Sort products by price descending",
      "category": "positive",
      "ac_ref": "AC-PROD-001",
      "br_refs": [
        "BR-PROD"
      ],
      "preconditions": [
        "Multiple products with different prices exist"
      ],
      "test_data": [
        {
          "field": "sortBy",
          "value": "price_desc",
          "notes": "Price high to low"
        }
      ],
      "steps": [
        "Navigate to product listing",
        "Select sort by 'Price: High to Low'"
      ],
      "expected_results": [
        "Products ordered by price descending",
        "Highest price first"
      ]
    },
    {
      "id": "TC-AC-PROD-001-P04",
      "name": "Display 20 products per page",
      "category": "positive",
      "ac_ref": "AC-PROD-001",
      "br_refs": [
        "BR-PROD"
      ],
      "preconditions": [
        "More than 20 products exist matching criteria"
      ],
      "test_data": [
        {
          "field": "totalProducts",
          "value": "50",
          "notes": "Enough for pagination"
        }
      ],
      "steps": [
        "Navigate to product listing with 50+ products",
        "Count displayed products"
      ],
      "expected_results": [
        "Exactly 20 products shown",
        "Pagination controls visible"
      ]
    },
    {
      "id": "TC-AC-PROD-001-N01",
      "name": "Show empty state when no products match filters",
      "category": "negative",
      "ac_ref": "AC-PROD-001",
      "br_refs": [
        "BR-PROD"
      ],
      "preconditions": [
        "Products exist but none match filter combination"
      ],
      "test_data": [
        {
          "field": "category",
          "value": "NonExistent",
          "notes": "No matching products"
        }
      ],
      "steps": [
        "Apply filters that match no products",
        "Observe result"
      ],
      "expected_results": [
        "'No products found' message displayed",
        "Clear filters option shown"
      ]
    },
    {
      "id": "TC-AC-PROD-001-N02",
      "name": "Reject invalid price range where min exceeds max",
      "category": "negative",
      "ac_ref": "AC-PROD-001",
      "br_refs": [
        "BR-PROD"
      ],
      "preconditions": [
        "User is on product listing page"
      ],
      "test_data": [
        {
          "field": "priceMin",
          "value": "100",
          "notes": "Higher than max"
        },
        {
          "field": "priceMax",
          "value": "50",
          "notes": "Lower than min"
        }
      ],
      "steps": [
        "Enter min price 100",
        "Enter max price 50",
        "Apply filters"
      ],
      "expected_results": [
        "Validation error displayed",
        "Filters not applied"
      ]
    },
    {
      "id": "TC-AC-PROD-001-N03",
      "name": "Reject negative price values in filter",
      "category": "negative",
      "ac_ref": "AC-PROD-001",
      "br_refs": [
        "BR-PROD"
      ],
      "preconditions": [
        "User is on product listing page"
      ],
      "test_data": [
        {
          "field": "priceMin",
          "value": "-10",
          "notes": "Invalid negative price"
        }
      ],
      "steps": [
        "Enter negative price in min field",
        "Attempt to apply filters"
      ],
      "expected_results": [
        "Validation error for invalid price",
        "Filter not applied"
      ]
    },
    {
      "id": "TC-AC-PROD-001-B01",
      "name": "Filter with price range at zero minimum",
      "category": "boundary",
      "ac_ref": "AC-PROD-001",
      "br_refs": [
        "BR-PROD"
      ],
      "preconditions": [
        "Products exist including free items (price 0)"
      ],
      "test_data": [
        {
          "field": "priceMin",
          "value": "0",
          "notes": "Boundary: zero price"
        },
        {
          "field": "priceMax",
          "value": "10",
          "notes": "Small range"
        }
      ],
      "steps": [
        "Set price range 0-10",
        "Apply filters"
      ],
      "expected_results": [
        "Products with price 0-10 displayed",
        "Free items included"
      ]
    },
    {
      "id": "TC-AC-PROD-001-B02",
      "name": "Display exactly 20th and 21st product across pages",
      "category": "boundary",
      "ac_ref": "AC-PROD-001",
      "br_refs": [
        "BR-PROD"
      ],
      "preconditions": [
        "At least 21 products exist"
      ],
      "test_data": [
        {
          "field": "totalProducts",
          "value": "21",
          "notes": "Just over page boundary"
        }
      ],
      "steps": [
        "View first page",
        "Note 20th product",
        "Go to page 2",
        "Verify 21st product"
      ],
      "expected_results": [
        "Page 1 has exactly 20 products",
        "Page 2 has 1 product"
      ]
    },
    {
      "id": "TC-AC-PROD-001-H01",
      "name": "Search text filter should NOT be available",
      "category": "hallucination",
      "ac_ref": "AC-PROD-001",
      "br_refs": [
        "BR-PROD"
      ],
      "preconditions": [
        "User is on product listing page"
      ],
      "test_data": [],
      "steps": [
        "Examine available filter options on product listing"
      ],
      "expected_results": [
        "Only category, price range, availability filters present"
      ],
      "should_not": "Text search or keyword filter should NOT be present"
    },
    {
      "id": "TC-AC-PROD-001-H02",
      "name": "Rating filter should NOT be available",
      "category": "hallucination",
      "ac_ref": "AC-PROD-001",
      "br_refs": [
        "BR-PROD"
      ],
      "preconditions": [
        "User is on product listing page"
      ],
      "test_data": [],
      "steps": [
        "Check all available sorting and filtering options"
      ],
      "expected_results": [
        "No rating-based filter exists"
      ],
      "should_not": "Rating or review score filter should NOT exist"
    },
    {
      "id": "TC-AC-PROD-002-P01",
      "name": "Display out of stock indicator on product listing",
      "category": "positive",
      "ac_ref": "AC-PROD-002",
      "br_refs": [
        "BR-PROD"
      ],
      "preconditions": [
        "Product exists with zero inventory"
      ],
      "test_data": [
        {
          "field": "inventory",
          "value": "0",
          "notes": "Zero stock"
        }
      ],
      "steps": [
        "Navigate to product listing",
        "Locate out-of-stock product"
      ],
      "expected_results": [
        "'Out of Stock' indicator visible",
        "Product still displayed"
      ]
    },
    {
      "id": "TC-AC-PROD-002-P02",
      "name": "Display out of stock indicator on product detail page",
      "category": "positive",
      "ac_ref": "AC-PROD-002",
      "br_refs": [
        "BR-PROD"
      ],
      "preconditions": [
        "Product exists with zero inventory"
      ],
      "test_data": [
        {
          "field": "productId",
          "value": "PROD-001",
          "notes": "Out of stock product"
        }
      ],
      "steps": [
        "Navigate to product detail page for out-of-stock item"
      ],
      "expected_results": [
        "'Out of Stock' indicator visible on detail page"
      ]
    },
    {
      "id": "TC-AC-PROD-002-P03",
      "name": "Add to cart button disabled for out of stock product",
      "category": "positive",
      "ac_ref": "AC-PROD-002",
      "br_refs": [
        "BR-PROD"
      ],
      "preconditions": [
        "Product has zero inventory"
      ],
      "test_data": [
        {
          "field": "inventory",
          "value": "0",
          "notes": "No stock available"
        }
      ],
      "steps": [
        "View out-of-stock product detail",
        "Examine add-to-cart button"
      ],
      "expected_results": [
        "Add to cart button is disabled",
        "Button not clickable"
      ]
    },
    {
      "id": "TC-AC-PROD-002-N01",
      "name": "Cannot add out of stock product via direct API call",
      "category": "negative",
      "ac_ref": "AC-PROD-002",
      "br_refs": [
        "BR-PROD"
      ],
      "preconditions": [
        "Product has zero inventory",
        "User attempts API bypass"
      ],
      "test_data": [
        {
          "field": "productId",
          "value": "PROD-OOS",
          "notes": "Out of stock item"
        },
        {
          "field": "quantity",
          "value": "1",
          "notes": "Attempted quantity"
        }
      ],
      "steps": [
        "Send direct add-to-cart API request for out-of-stock item"
      ],
      "expected_results": [
        "Request rejected",
        "Appropriate error returned"
      ]
    },
    {
      "id": "TC-AC-PROD-002-N02",
      "name": "Out of stock indicator persists after page refresh",
      "category": "negative",
      "ac_ref": "AC-PROD-002",
      "br_refs": [
        "BR-PROD"
      ],
      "preconditions": [
        "Product is out of stock",
        "User views product"
      ],
      "test_data": [
        {
          "field": "inventory",
          "value": "0",
          "notes": "Remains zero"
        }
      ],
      "steps": [
        "View out-of-stock product",
        "Refresh page",
        "Check indicator"
      ],
      "expected_results": [
        "Out of Stock indicator still visible",
        "Button still disabled"
      ]
    },
    {
      "id": "TC-AC-PROD-002-B01",
      "name": "Product with exactly zero inventory shows out of stock",
      "category": "boundary",
      "ac_ref": "AC-PROD-002",
      "br_refs": [
        "BR-PROD"
      ],
      "preconditions": [
        "Product inventory is exactly 0"
      ],
      "test_data": [
        {
          "field": "inventory",
          "value": "0",
          "notes": "Boundary: exactly zero"
        }
      ],
      "steps": [
        "Set product inventory to exactly 0",
        "View product"
      ],
      "expected_results": [
        "Out of Stock indicator shown",
        "Add to cart disabled"
      ]
    },
    {
      "id": "TC-AC-PROD-002-B02",
      "name": "Product with inventory 1 does NOT show out of stock",
      "category": "boundary",
      "ac_ref": "AC-PROD-002",
      "br_refs": [
        "BR-PROD"
      ],
      "preconditions": [
        "Product inventory is exactly 1"
      ],
      "test_data": [
        {
          "field": "inventory",
          "value": "1",
          "notes": "Boundary: just above zero"
        }
      ],
      "steps": [
        "Set product inventory to 1",
        "View product"
      ],
      "expected_results": [
        "No Out of Stock indicator",
        "Add to cart enabled"
      ]
    },
    {
      "id": "TC-AC-PROD-002-H01",
      "name": "Waitlist or notify option should NOT be shown",
      "category": "hallucination",
      "ac_ref": "AC-PROD-002",
      "br_refs": [
        "BR-PROD"
      ],
      "preconditions": [
        "Product is out of stock"
      ],
      "test_data": [],
      "steps": [
        "View out-of-stock product detail page",
        "Check for notify/waitlist"
      ],
      "expected_results": [
        "Only Out of Stock indicator present"
      ],
      "should_not": "Waitlist signup or 'Notify when available' should NOT exist"
    },
    {
      "id": "TC-AC-PROD-002-H02",
      "name": "Pre-order option should NOT be available for out of stock",
      "category": "hallucination",
      "ac_ref": "AC-PROD-002",
      "br_refs": [
        "BR-PROD"
      ],
      "preconditions": [
        "Product has zero inventory"
      ],
      "test_data": [],
      "steps": [
        "View out-of-stock product",
        "Check for alternative purchase options"
      ],
      "expected_results": [
        "No pre-order or backorder option visible"
      ],
      "should_not": "Pre-order or backorder functionality should NOT be present"
    },
    {
      "id": "TC-AC-CART-001-P01",
      "name": "Add single quantity of in-stock product to cart",
      "category": "positive",
      "ac_ref": "AC-CART-001",
      "br_refs": [
        "BR-CART"
      ],
      "preconditions": [
        "Product in stock",
        "Customer on product page"
      ],
      "test_data": [
        {
          "field": "productId",
          "value": "PROD-001",
          "notes": "In-stock product"
        },
        {
          "field": "quantity",
          "value": "1",
          "notes": "Single item"
        }
      ],
      "steps": [
        "View in-stock product",
        "Set quantity to 1",
        "Click Add to Cart"
      ],
      "expected_results": [
        "Item added to cart",
        "Toast notification appears"
      ]
    },
    {
      "id": "TC-AC-CART-001-P02",
      "name": "Toast notification with View Cart option appears",
      "category": "positive",
      "ac_ref": "AC-CART-001",
      "br_refs": [
        "BR-CART"
      ],
      "preconditions": [
        "Product added to cart successfully"
      ],
      "test_data": [
        {
          "field": "productId",
          "value": "PROD-002",
          "notes": "Valid product"
        }
      ],
      "steps": [
        "Add product to cart",
        "Observe notification"
      ],
      "expected_results": [
        "Toast notification visible",
        "'View Cart' link in toast"
      ]
    },
    {
      "id": "TC-AC-CART-001-P03",
      "name": "Cart icon updates with new item count",
      "category": "positive",
      "ac_ref": "AC-CART-001",
      "br_refs": [
        "BR-CART"
      ],
      "preconditions": [
        "Cart initially empty or has known count"
      ],
      "test_data": [
        {
          "field": "initialCount",
          "value": "0",
          "notes": "Empty cart"
        },
        {
          "field": "quantity",
          "value": "3",
          "notes": "Adding 3 items"
        }
      ],
      "steps": [
        "Note cart icon count",
        "Add 3 items",
        "Check cart icon"
      ],
      "expected_results": [
        "Cart icon shows updated count of 3"
      ]
    },
    {
      "id": "TC-AC-CART-001-P04",
      "name": "Add product with selected variant to cart",
      "category": "positive",
      "ac_ref": "AC-CART-001",
      "br_refs": [
        "BR-CART"
      ],
      "preconditions": [
        "Product has variants",
        "Variant selected"
      ],
      "test_data": [
        {
          "field": "productId",
          "value": "PROD-VAR",
          "notes": "Product with variants"
        },
        {
          "field": "variant",
          "value": "Size: Large",
          "notes": "Selected variant"
        }
      ],
      "steps": [
        "Select variant",
        "Click Add to Cart"
      ],
      "expected_results": [
        "Correct variant added to cart",
        "Toast shown"
      ]
    },
    {
      "id": "TC-AC-CART-001-N01",
      "name": "Add to cart disabled for out of stock product",
      "category": "negative",
      "ac_ref": "AC-CART-001",
      "br_refs": [
        "BR-CART"
      ],
      "preconditions": [
        "Product has zero inventory"
      ],
      "test_data": [
        {
          "field": "inventory",
          "value": "0",
          "notes": "Out of stock"
        }
      ],
      "steps": [
        "View out-of-stock product",
        "Check Add to Cart button"
      ],
      "expected_results": [
        "Button disabled",
        "'Out of Stock' message shown"
      ]
    },
    {
      "id": "TC-AC-CART-001-N02",
      "name": "Quantity limited when exceeding available stock",
      "category": "negative",
      "ac_ref": "AC-CART-001",
      "br_refs": [
        "BR-CART"
      ],
      "preconditions": [
        "Product has limited stock"
      ],
      "test_data": [
        {
          "field": "inventory",
          "value": "5",
          "notes": "Limited stock"
        },
        {
          "field": "requestedQty",
          "value": "10",
          "notes": "Exceeds stock"
        }
      ],
      "steps": [
        "Set quantity to 10",
        "Click Add to Cart"
      ],
      "expected_results": [
        "Quantity limited to 5",
        "Notification about limit shown"
      ]
    },
    {
      "id": "TC-AC-CART-001-N03",
      "name": "Add to cart disabled until variant selected",
      "category": "negative",
      "ac_ref": "AC-CART-001",
      "br_refs": [
        "BR-CART"
      ],
      "preconditions": [
        "Product requires variant selection"
      ],
      "test_data": [
        {
          "field": "hasVariants",
          "value": "true",
          "notes": "Variants required"
        },
        {
          "field": "selectedVariant",
          "value": "null",
          "notes": "None selected"
        }
      ],
      "steps": [
        "View product with variants",
        "Do not select variant",
        "Check button"
      ],
      "expected_results": [
        "Add to Cart button disabled"
      ]
    },
    {
      "id": "TC-AC-CART-001-B01",
      "name": "Add quantity equal to exact available stock",
      "category": "boundary",
      "ac_ref": "AC-CART-001",
      "br_refs": [
        "BR-CART"
      ],
      "preconditions": [
        "Product has known stock level"
      ],
      "test_data": [
        {
          "field": "inventory",
          "value": "5",
          "notes": "Exact stock"
        },
        {
          "field": "quantity",
          "value": "5",
          "notes": "Equals stock"
        }
      ],
      "steps": [
        "Set quantity to exact available stock (5)",
        "Add to cart"
      ],
      "expected_results": [
        "All 5 items added successfully",
        "No error shown"
      ]
    },
    {
      "id": "TC-AC-CART-001-B02",
      "name": "Add minimum quantity of 1",
      "category": "boundary",
      "ac_ref": "AC-CART-001",
      "br_refs": [
        "BR-CART"
      ],
      "preconditions": [
        "Product in stock"
      ],
      "test_data": [
        {
          "field": "quantity",
          "value": "1",
          "notes": "Minimum allowed"
        }
      ],
      "steps": [
        "Set quantity to 1",
        "Add to cart"
      ],
      "expected_results": [
        "1 item added to cart"
      ]
    },
    {
      "id": "TC-AC-CART-001-H01",
      "name": "Wishlist option should NOT appear in add to cart flow",
      "category": "hallucination",
      "ac_ref": "AC-CART-001",
      "br_refs": [
        "BR-CART"
      ],
      "preconditions": [
        "User viewing product"
      ],
      "test_data": [],
      "steps": [
        "View product page",
        "Check available actions"
      ],
      "expected_results": [
        "Only Add to Cart functionality present"
      ],
      "should_not": "Wishlist or Save for Later should NOT be in this flow"
    },
    {
      "id": "TC-AC-CART-001-H02",
      "name": "Buy Now button should NOT be available",
      "category": "hallucination",
      "ac_ref": "AC-CART-001",
      "br_refs": [
        "BR-CART"
      ],
      "preconditions": [
        "User on product page"
      ],
      "test_data": [],
      "steps": [
        "View product detail page",
        "Check for instant purchase options"
      ],
      "expected_results": [
        "Only Add to Cart button present"
      ],
      "should_not": "Buy Now or instant checkout should NOT exist"
    },
    {
      "id": "TC-AC-CART-002-P01",
      "name": "Increment quantity when adding existing product",
      "category": "positive",
      "ac_ref": "AC-CART-002",
      "br_refs": [
        "BR-CART"
      ],
      "preconditions": [
        "Product A in cart with quantity 2"
      ],
      "test_data": [
        {
          "field": "productId",
          "value": "PROD-A",
          "notes": "Already in cart"
        },
        {
          "field": "existingQty",
          "value": "2",
          "notes": "Current quantity"
        },
        {
          "field": "addQty",
          "value": "1",
          "notes": "Adding 1 more"
        }
      ],
      "steps": [
        "Add Product A again with quantity 1"
      ],
      "expected_results": [
        "Cart shows Product A with quantity 3"
      ]
    },
    {
      "id": "TC-AC-CART-002-P02",
      "name": "No new line item created for existing product",
      "category": "positive",
      "ac_ref": "AC-CART-002",
      "br_refs": [
        "BR-CART"
      ],
      "preconditions": [
        "Cart has 1 line item for Product A"
      ],
      "test_data": [
        {
          "field": "initialLineItems",
          "value": "1",
          "notes": "One line item"
        },
        {
          "field": "productId",
          "value": "PROD-A",
          "notes": "Same product"
        }
      ],
      "steps": [
        "Count line items",
        "Add Product A again",
        "Count line items"
      ],
      "expected_results": [
        "Still only 1 line item",
        "Quantity increased"
      ]
    },
    {
      "id": "TC-AC-CART-002-P03",
      "name": "Multiple additions increment correctly",
      "category": "positive",
      "ac_ref": "AC-CART-002",
      "br_refs": [
        "BR-CART"
      ],
      "preconditions": [
        "Product in cart with quantity 1",
        "Stock is 10"
      ],
      "test_data": [
        {
          "field": "existingQty",
          "value": "1",
          "notes": "Starting quantity"
        },
        {
          "field": "additions",
          "value": "3",
          "notes": "Three separate adds of 1"
        }
      ],
      "steps": [
        "Add product 1",
        "Add same product again",
        "Add again",
        "Add again"
      ],
      "expected_results": [
        "Final quantity is 4",
        "Single line item"
      ]
    },
    {
      "id": "TC-AC-CART-002-N01",
      "name": "Limit combined quantity to available stock",
      "category": "negative",
      "ac_ref": "AC-CART-002",
      "br_refs": [
        "BR-CART"
      ],
      "preconditions": [
        "Product A in cart qty 8",
        "Stock is 10"
      ],
      "test_data": [
        {
          "field": "existingQty",
          "value": "8",
          "notes": "Already in cart"
        },
        {
          "field": "addQty",
          "value": "5",
          "notes": "Would exceed stock"
        },
        {
          "field": "stock",
          "value": "10",
          "notes": "Max available"
        }
      ],
      "steps": [
        "Try to add 5 more of Product A"
      ],
      "expected_results": [
        "Quantity limited to 10",
        "Notification shown about limit"
      ]
    },
    {
      "id": "TC-AC-CART-002-N02",
      "name": "Cannot increment beyond stock even with multiple attempts",
      "category": "negative",
      "ac_ref": "AC-CART-002",
      "br_refs": [
        "BR-CART"
      ],
      "preconditions": [
        "Cart at max stock for product"
      ],
      "test_data": [
        {
          "field": "existingQty",
          "value": "10",
          "notes": "At max stock"
        },
        {
          "field": "stock",
          "value": "10",
          "notes": "Max available"
        }
      ],
      "steps": [
        "Try to add 1 more when at max",
        "Try again"
      ],
      "expected_results": [
        "Quantity stays at 10",
        "Notification each attempt"
      ]
    },
    {
      "id": "TC-AC-CART-002-B01",
      "name": "Increment to exactly max stock",
      "category": "boundary",
      "ac_ref": "AC-CART-002",
      "br_refs": [
        "BR-CART"
      ],
      "preconditions": [
        "Product A qty 9 in cart",
        "Stock is 10"
      ],
      "test_data": [
        {
          "field": "existingQty",
          "value": "9",
          "notes": "One below max"
        },
        {
          "field": "addQty",
          "value": "1",
          "notes": "Reaches exactly max"
        },
        {
          "field": "stock",
          "value": "10",
          "notes": "Maximum"
        }
      ],
      "steps": [
        "Add 1 more to reach stock limit"
      ],
      "expected_results": [
        "Quantity becomes 10",
        "No error shown"
      ]
    },
    {
      "id": "TC-AC-CART-002-B02",
      "name": "Adding 0 quantity should not change cart",
      "category": "boundary",
      "ac_ref": "AC-CART-002",
      "br_refs": [
        "BR-CART"
      ],
      "preconditions": [
        "Product A in cart with quantity 2"
      ],
      "test_data": [
        {
          "field": "existingQty",
          "value": "2",
          "notes": "Current"
        },
        {
          "field": "addQty",
          "value": "0",
          "notes": "Zero addition"
        }
      ],
      "steps": [
        "Attempt to add 0 quantity"
      ],
      "expected_results": [
        "Quantity remains 2",
        "No change or error handled gracefully"
      ]
    },
    {
      "id": "TC-AC-CART-002-H01",
      "name": "Different variants should NOT merge into same line item",
      "category": "hallucination",
      "ac_ref": "AC-CART-002",
      "br_refs": [
        "BR-CART"
      ],
      "preconditions": [
        "Product A (Size M) in cart",
        "Adding Product A (Size L)"
      ],
      "test_data": [
        {
          "field": "variant1",
          "value": "Size: M",
          "notes": "In cart"
        },
        {
          "field": "variant2",
          "value": "Size: L",
          "notes": "Being added"
        }
      ],
      "steps": [
        "Add Product A Size L when Size M already in cart"
      ],
      "expected_results": [
        "Two separate line items created"
      ],
      "should_not": "Different variants should NOT merge into single line item"
    },
    {
      "id": "TC-AC-CART-002-H02",
      "name": "Cart should NOT automatically remove lower-priced duplicate",
      "category": "hallucination",
      "ac_ref": "AC-CART-002",
      "br_refs": [
        "BR-CART"
      ],
      "preconditions": [
        "Same product at different prices due to sale"
      ],
      "test_data": [],
      "steps": [
        "Check cart behavior when adding same product"
      ],
      "expected_results": [
        "Quantities merge, price handled per business rules"
      ],
      "should_not": "System should NOT auto-remove items or change prices unexpectedly"
    },
    {
      "id": "TC-AC-CART-003-P01",
      "name": "Guest user can add items to cart without login",
      "category": "positive",
      "ac_ref": "AC-CART-003",
      "br_refs": [
        "BR-CART"
      ],
      "preconditions": [
        "User not logged in",
        "Product available"
      ],
      "test_data": [
        {
          "field": "userState",
          "value": "guest",
          "notes": "Not authenticated"
        }
      ],
      "steps": [
        "Browse as guest",
        "Add product to cart"
      ],
      "expected_results": [
        "Product added successfully",
        "Cart created for session"
      ]
    },
    {
      "id": "TC-AC-CART-003-P02",
      "name": "Session-based cart persists across page navigation",
      "category": "positive",
      "ac_ref": "AC-CART-003",
      "br_refs": [
        "BR-CART"
      ],
      "preconditions": [
        "Guest has items in cart"
      ],
      "test_data": [
        {
          "field": "cartItems",
          "value": "2",
          "notes": "Items in guest cart"
        }
      ],
      "steps": [
        "Add items as guest",
        "Navigate to other pages",
        "Return to cart"
      ],
      "expected_results": [
        "Cart still contains items",
        "No data lost"
      ]
    },
    {
      "id": "TC-AC-CART-003-P03",
      "name": "Guest cart persists after browser close within 7 days",
      "category": "positive",
      "ac_ref": "AC-CART-003",
      "br_refs": [
        "BR-CART"
      ],
      "preconditions": [
        "Guest added items to cart"
      ],
      "test_data": [
        {
          "field": "daysSinceActivity",
          "value": "3",
          "notes": "Within 7 day window"
        }
      ],
      "steps": [
        "Add items as guest",
        "Close browser",
        "Return after 3 days"
      ],
      "expected_results": [
        "Cart still contains items"
      ]
    },
    {
      "id": "TC-AC-CART-003-N01",
      "name": "Cart cleared after 7 days of inactivity",
      "category": "negative",
      "ac_ref": "AC-CART-003",
      "br_refs": [
        "BR-CART"
      ],
      "preconditions": [
        "Guest cart exists",
        "7 days passed"
      ],
      "test_data": [
        {
          "field": "daysSinceActivity",
          "value": "8",
          "notes": "Beyond 7 day limit"
        }
      ],
      "steps": [
        "Create guest cart",
        "Wait 8 days",
        "Return to site"
      ],
      "expected_results": [
        "Cart is empty",
        "User sees empty cart"
      ]
    },
    {
      "id": "TC-AC-CART-003-N02",
      "name": "Guest cannot access another guest session cart",
      "category": "negative",
      "ac_ref": "AC-CART-003",
      "br_refs": [
        "BR-CART"
      ],
      "preconditions": [
        "Two separate guest sessions exist"
      ],
      "test_data": [
        {
          "field": "session1",
          "value": "ABC123",
          "notes": "First guest"
        },
        {
          "field": "session2",
          "value": "XYZ789",
          "notes": "Second guest"
        }
      ],
      "steps": [
        "Guest 1 adds items",
        "Guest 2 opens site",
        "Check Guest 2 cart"
      ],
      "expected_results": [
        "Guest 2 has empty cart",
        "Sessions isolated"
      ]
    },
    {
      "id": "TC-AC-CART-003-B01",
      "name": "Cart persists at exactly 7 days minus 1 hour",
      "category": "boundary",
      "ac_ref": "AC-CART-003",
      "br_refs": [
        "BR-CART"
      ],
      "preconditions": [
        "Guest cart created"
      ],
      "test_data": [
        {
          "field": "timeSinceActivity",
          "value": "167 hours",
          "notes": "Just under 7 days"
        }
      ],
      "steps": [
        "Create guest cart",
        "Return at 6 days 23 hours"
      ],
      "expected_results": [
        "Cart still exists",
        "Items preserved"
      ]
    },
    {
      "id": "TC-AC-CART-003-B02",
      "name": "Cart cleared at exactly 7 days of inactivity",
      "category": "boundary",
      "ac_ref": "AC-CART-003",
      "br_refs": [
        "BR-CART"
      ],
      "preconditions": [
        "Guest cart created exactly 7 days ago"
      ],
      "test_data": [
        {
          "field": "timeSinceActivity",
          "value": "168 hours",
          "notes": "Exactly 7 days"
        }
      ],
      "steps": [
        "Create guest cart",
        "Return at exactly 7 days"
      ],
      "expected_results": [
        "Cart is cleared per policy"
      ]
    },
    {
      "id": "TC-AC-CART-003-H01",
      "name": "Guest cart should NOT require email to create",
      "category": "hallucination",
      "ac_ref": "AC-CART-003",
      "br_refs": [
        "BR-CART"
      ],
      "preconditions": [
        "User not logged in"
      ],
      "test_data": [],
      "steps": [
        "Attempt to add to cart as guest",
        "Check if email is requested"
      ],
      "expected_results": [
        "No email required to create cart"
      ],
      "should_not": "Email or any personal info should NOT be required for guest cart"
    },
    {
      "id": "TC-AC-CART-003-H02",
      "name": "Guest cart should NOT auto-merge with logged-in user cart",
      "category": "hallucination",
      "ac_ref": "AC-CART-003",
      "br_refs": [
        "BR-CART"
      ],
      "preconditions": [
        "Guest has items in cart",
        "User logs in"
      ],
      "test_data": [],
      "steps": [
        "Add items as guest",
        "Log in to existing account",
        "Check cart"
      ],
      "expected_results": [
        "Behavior is undefined in spec, test actual implementation"
      ],
      "should_not": "Cart merge behavior is NOT specified - should NOT assume auto-merge"
    },
    {
      "id": "TC-AC-CART-004-P01",
      "name": "Merge guest cart with empty account cart",
      "category": "positive",
      "ac_ref": "AC-CART-004",
      "br_refs": [
        "AMB-ENT-013"
      ],
      "preconditions": [
        "Guest has 2 items in session cart",
        "Account cart is empty"
      ],
      "test_data": [
        {
          "field": "guestCartItems",
          "value": "[SKU-A:2, SKU-B:1]",
          "notes": "Guest items"
        },
        {
          "field": "accountCartItems",
          "value": "[]",
          "notes": "Empty account cart"
        }
      ],
      "steps": [
        "Add items to guest cart",
        "Login with registered account",
        "Verify merged cart"
      ],
      "expected_results": [
        "Account cart contains SKU-A:2 and SKU-B:1"
      ]
    },
    {
      "id": "TC-AC-CART-004-P02",
      "name": "Merge carts combining quantities for duplicate products",
      "category": "positive",
      "ac_ref": "AC-CART-004",
      "br_refs": [
        "AMB-ENT-013"
      ],
      "preconditions": [
        "Guest has SKU-A:2",
        "Account has SKU-A:3"
      ],
      "test_data": [
        {
          "field": "guestCartItems",
          "value": "[SKU-A:2]",
          "notes": "Guest quantity"
        },
        {
          "field": "accountCartItems",
          "value": "[SKU-A:3]",
          "notes": "Account quantity"
        }
      ],
      "steps": [
        "Add SKU-A to guest cart",
        "Login",
        "Verify quantities combined"
      ],
      "expected_results": [
        "Account cart contains SKU-A:5 (2+3)"
      ]
    },
    {
      "id": "TC-AC-CART-004-P03",
      "name": "Merge carts with mix of unique and duplicate items",
      "category": "positive",
      "ac_ref": "AC-CART-004",
      "br_refs": [
        "AMB-ENT-013"
      ],
      "preconditions": [
        "Guest has SKU-A:1, SKU-B:2",
        "Account has SKU-A:1, SKU-C:1"
      ],
      "test_data": [
        {
          "field": "guestCartItems",
          "value": "[SKU-A:1, SKU-B:2]",
          "notes": "Guest items"
        },
        {
          "field": "accountCartItems",
          "value": "[SKU-A:1, SKU-C:1]",
          "notes": "Account items"
        }
      ],
      "steps": [
        "Setup guest and account carts",
        "Login",
        "Verify merged result"
      ],
      "expected_results": [
        "Cart contains SKU-A:2, SKU-B:2, SKU-C:1"
      ]
    },
    {
      "id": "TC-AC-CART-004-N01",
      "name": "Merged quantity exceeds stock - limit to available",
      "category": "negative",
      "ac_ref": "AC-CART-004",
      "br_refs": [
        "AMB-ENT-013"
      ],
      "preconditions": [
        "Guest has SKU-A:8",
        "Account has SKU-A:7",
        "Stock is 10"
      ],
      "test_data": [
        {
          "field": "guestQty",
          "value": "8",
          "notes": "Guest quantity"
        },
        {
          "field": "accountQty",
          "value": "7",
          "notes": "Account quantity"
        },
        {
          "field": "availableStock",
          "value": "10",
          "notes": "Max available"
        }
      ],
      "steps": [
        "Setup carts totaling 15",
        "Login",
        "Verify quantity limited"
      ],
      "expected_results": [
        "Cart contains SKU-A:10",
        "Notification shown about limit"
      ]
    },
    {
      "id": "TC-AC-CART-004-N02",
      "name": "Show notification when merge quantity is limited",
      "category": "negative",
      "ac_ref": "AC-CART-004",
      "br_refs": [
        "AMB-ENT-013"
      ],
      "preconditions": [
        "Combined quantity would exceed stock"
      ],
      "test_data": [
        {
          "field": "combinedQty",
          "value": "15",
          "notes": "Exceeds stock"
        },
        {
          "field": "stock",
          "value": "10",
          "notes": "Available"
        }
      ],
      "steps": [
        "Trigger merge that exceeds stock",
        "Verify notification"
      ],
      "expected_results": [
        "User notification displayed about stock limit"
      ]
    },
    {
      "id": "TC-AC-CART-004-B01",
      "name": "Merge when combined quantity exactly equals stock",
      "category": "boundary",
      "ac_ref": "AC-CART-004",
      "br_refs": [
        "AMB-ENT-013"
      ],
      "preconditions": [
        "Guest has 5, Account has 5, Stock is 10"
      ],
      "test_data": [
        {
          "field": "guestQty",
          "value": "5",
          "notes": "Half of stock"
        },
        {
          "field": "accountQty",
          "value": "5",
          "notes": "Half of stock"
        },
        {
          "field": "stock",
          "value": "10",
          "notes": "Exact boundary"
        }
      ],
      "steps": [
        "Setup carts totaling exactly stock",
        "Login",
        "Verify merge"
      ],
      "expected_results": [
        "Cart contains quantity 10",
        "No stock warning shown"
      ]
    },
    {
      "id": "TC-AC-CART-004-B02",
      "name": "Merge when combined quantity is stock plus one",
      "category": "boundary",
      "ac_ref": "AC-CART-004",
      "br_refs": [
        "AMB-ENT-013"
      ],
      "preconditions": [
        "Guest has 6, Account has 5, Stock is 10"
      ],
      "test_data": [
        {
          "field": "guestQty",
          "value": "6",
          "notes": "Over half"
        },
        {
          "field": "accountQty",
          "value": "5",
          "notes": "Half"
        },
        {
          "field": "stock",
          "value": "10",
          "notes": "Max boundary"
        }
      ],
      "steps": [
        "Setup carts totaling stock+1",
        "Login",
        "Verify limit applied"
      ],
      "expected_results": [
        "Cart limited to 10",
        "Notification shown"
      ]
    },
    {
      "id": "TC-AC-CART-004-H01",
      "name": "Guest cart items should NOT be lost after merge",
      "category": "hallucination",
      "ac_ref": "AC-CART-004",
      "br_refs": [
        "AMB-ENT-013"
      ],
      "preconditions": [
        "Guest has unique items not in account cart"
      ],
      "test_data": [
        {
          "field": "guestItems",
          "value": "[SKU-X:1]",
          "notes": "Unique to guest"
        }
      ],
      "steps": [
        "Add unique item to guest cart",
        "Login",
        "Verify item preserved"
      ],
      "expected_results": [
        "Guest-only items appear in merged cart"
      ],
      "should_not": "Guest cart items should NOT be discarded during merge"
    },
    {
      "id": "TC-AC-CART-004-H02",
      "name": "Merge should NOT create duplicate line items",
      "category": "hallucination",
      "ac_ref": "AC-CART-004",
      "br_refs": [
        "AMB-ENT-013"
      ],
      "preconditions": [
        "Same SKU exists in both carts"
      ],
      "test_data": [
        {
          "field": "sku",
          "value": "SKU-A",
          "notes": "Duplicate product"
        }
      ],
      "steps": [
        "Have same SKU in both carts",
        "Login",
        "Check line items"
      ],
      "expected_results": [
        "Single line item with combined quantity"
      ],
      "should_not": "Should NOT create two separate line items for same SKU"
    },
    {
      "id": "TC-AC-CART-005-P01",
      "name": "Update quantity and recalculate cart total",
      "category": "positive",
      "ac_ref": "AC-CART-005",
      "br_refs": [
        "AMB-OP-011",
        "AMB-OP-012",
        "AMB-OP-013"
      ],
      "preconditions": [
        "Cart has SKU-A qty 2 at $10 each"
      ],
      "test_data": [
        {
          "field": "oldQuantity",
          "value": "2",
          "notes": "Current qty"
        },
        {
          "field": "newQuantity",
          "value": "5",
          "notes": "New qty"
        },
        {
          "field": "unitPrice",
          "value": "10.00",
          "notes": "Price per item"
        }
      ],
      "steps": [
        "View cart",
        "Change quantity to 5",
        "Verify total"
      ],
      "expected_results": [
        "Quantity shows 5",
        "Total recalculated to $50"
      ]
    },
    {
      "id": "TC-AC-CART-005-P02",
      "name": "Decrease quantity successfully",
      "category": "positive",
      "ac_ref": "AC-CART-005",
      "br_refs": [
        "AMB-OP-011"
      ],
      "preconditions": [
        "Cart has SKU-A qty 5"
      ],
      "test_data": [
        {
          "field": "oldQuantity",
          "value": "5",
          "notes": "Current"
        },
        {
          "field": "newQuantity",
          "value": "2",
          "notes": "Decreased"
        }
      ],
      "steps": [
        "Change quantity from 5 to 2",
        "Verify update"
      ],
      "expected_results": [
        "Quantity updated to 2",
        "Total recalculated"
      ]
    },
    {
      "id": "TC-AC-CART-005-N01",
      "name": "Setting quantity to 0 removes item from cart",
      "category": "negative",
      "ac_ref": "AC-CART-005",
      "br_refs": [
        "AMB-OP-011"
      ],
      "preconditions": [
        "Cart has SKU-A qty 2"
      ],
      "test_data": [
        {
          "field": "newQuantity",
          "value": "0",
          "notes": "Zero removes item"
        }
      ],
      "steps": [
        "Set quantity to 0",
        "Verify cart"
      ],
      "expected_results": [
        "Item removed from cart",
        "Cart total excludes item"
      ]
    },
    {
      "id": "TC-AC-CART-005-N02",
      "name": "Quantity exceeding stock limited with notification",
      "category": "negative",
      "ac_ref": "AC-CART-005",
      "br_refs": [
        "AMB-OP-012"
      ],
      "preconditions": [
        "Cart has SKU-A",
        "Stock is 10"
      ],
      "test_data": [
        {
          "field": "requestedQty",
          "value": "15",
          "notes": "Over stock"
        },
        {
          "field": "stock",
          "value": "10",
          "notes": "Available"
        }
      ],
      "steps": [
        "Try to set quantity to 15",
        "Verify behavior"
      ],
      "expected_results": [
        "Quantity set to 10",
        "Notification shown"
      ]
    },
    {
      "id": "TC-AC-CART-005-N03",
      "name": "Setting same quantity is idempotent - no change",
      "category": "negative",
      "ac_ref": "AC-CART-005",
      "br_refs": [
        "AMB-OP-013"
      ],
      "preconditions": [
        "Cart has SKU-A qty 3"
      ],
      "test_data": [
        {
          "field": "currentQty",
          "value": "3",
          "notes": "Current"
        },
        {
          "field": "newQty",
          "value": "3",
          "notes": "Same value"
        }
      ],
      "steps": [
        "Set quantity to current value 3",
        "Verify no change"
      ],
      "expected_results": [
        "Quantity remains 3",
        "No unnecessary updates triggered"
      ]
    },
    {
      "id": "TC-AC-CART-005-B01",
      "name": "Set quantity to 1 - minimum valid",
      "category": "boundary",
      "ac_ref": "AC-CART-005",
      "br_refs": [
        "AMB-OP-011"
      ],
      "preconditions": [
        "Cart has SKU-A qty 5"
      ],
      "test_data": [
        {
          "field": "newQuantity",
          "value": "1",
          "notes": "Minimum valid"
        }
      ],
      "steps": [
        "Change quantity to 1",
        "Verify update"
      ],
      "expected_results": [
        "Quantity set to 1",
        "Total recalculated"
      ]
    },
    {
      "id": "TC-AC-CART-005-B02",
      "name": "Set quantity to exactly available stock",
      "category": "boundary",
      "ac_ref": "AC-CART-005",
      "br_refs": [
        "AMB-OP-012"
      ],
      "preconditions": [
        "Stock is 10"
      ],
      "test_data": [
        {
          "field": "newQuantity",
          "value": "10",
          "notes": "Exact stock"
        },
        {
          "field": "stock",
          "value": "10",
          "notes": "Available"
        }
      ],
      "steps": [
        "Set quantity to exactly stock level",
        "Verify success"
      ],
      "expected_results": [
        "Quantity set to 10",
        "No warning shown"
      ]
    },
    {
      "id": "TC-AC-CART-005-H01",
      "name": "Update should NOT affect other items in cart",
      "category": "hallucination",
      "ac_ref": "AC-CART-005",
      "br_refs": [
        "AMB-OP-011"
      ],
      "preconditions": [
        "Cart has SKU-A:2 and SKU-B:3"
      ],
      "test_data": [
        {
          "field": "targetItem",
          "value": "SKU-A",
          "notes": "Item to update"
        },
        {
          "field": "otherItem",
          "value": "SKU-B",
          "notes": "Should not change"
        }
      ],
      "steps": [
        "Update SKU-A quantity",
        "Check SKU-B quantity"
      ],
      "expected_results": [
        "SKU-B quantity unchanged at 3"
      ],
      "should_not": "Should NOT modify quantities of other cart items"
    },
    {
      "id": "TC-AC-CART-005-H02",
      "name": "Negative quantity should NOT be accepted",
      "category": "hallucination",
      "ac_ref": "AC-CART-005",
      "br_refs": [
        "AMB-OP-011"
      ],
      "preconditions": [
        "Cart has item"
      ],
      "test_data": [
        {
          "field": "newQuantity",
          "value": "-1",
          "notes": "Invalid negative"
        }
      ],
      "steps": [
        "Attempt to set quantity to -1",
        "Verify rejection"
      ],
      "expected_results": [
        "Negative quantity rejected or treated as 0"
      ],
      "should_not": "Should NOT accept negative quantities"
    },
    {
      "id": "TC-AC-CART-006-P01",
      "name": "Remove item immediately without confirmation",
      "category": "positive",
      "ac_ref": "AC-CART-006",
      "br_refs": [
        "AMB-OP-014",
        "AMB-OP-015"
      ],
      "preconditions": [
        "Cart has SKU-A and SKU-B"
      ],
      "test_data": [
        {
          "field": "itemToRemove",
          "value": "SKU-A",
          "notes": "Target item"
        }
      ],
      "steps": [
        "Click remove on SKU-A",
        "Verify immediate removal"
      ],
      "expected_results": [
        "SKU-A removed immediately",
        "No confirmation dialog shown"
      ]
    },
    {
      "id": "TC-AC-CART-006-P02",
      "name": "Undo option shown briefly after removal",
      "category": "positive",
      "ac_ref": "AC-CART-006",
      "br_refs": [
        "AMB-OP-015"
      ],
      "preconditions": [
        "Cart has items"
      ],
      "test_data": [
        {
          "field": "itemToRemove",
          "value": "SKU-A",
          "notes": "Any item"
        }
      ],
      "steps": [
        "Remove item",
        "Verify undo option appears"
      ],
      "expected_results": [
        "Undo option displayed",
        "Option disappears after brief period"
      ]
    },
    {
      "id": "TC-AC-CART-006-P03",
      "name": "Undo restores removed item",
      "category": "positive",
      "ac_ref": "AC-CART-006",
      "br_refs": [
        "AMB-OP-015"
      ],
      "preconditions": [
        "Item just removed",
        "Undo option visible"
      ],
      "test_data": [
        {
          "field": "removedItem",
          "value": "SKU-A:2",
          "notes": "Item to restore"
        }
      ],
      "steps": [
        "Remove item",
        "Click Undo",
        "Verify restoration"
      ],
      "expected_results": [
        "Item restored to cart",
        "Original quantity preserved"
      ]
    },
    {
      "id": "TC-AC-CART-006-N01",
      "name": "Last item removed shows empty cart state",
      "category": "negative",
      "ac_ref": "AC-CART-006",
      "br_refs": [
        "AMB-OP-014"
      ],
      "preconditions": [
        "Cart has only one item"
      ],
      "test_data": [
        {
          "field": "cartItems",
          "value": "[SKU-A:1]",
          "notes": "Single item"
        }
      ],
      "steps": [
        "Remove the only item",
        "Verify empty cart state"
      ],
      "expected_results": [
        "Empty cart state displayed"
      ]
    },
    {
      "id": "TC-AC-CART-006-N02",
      "name": "Empty cart shows Continue Shopping link",
      "category": "negative",
      "ac_ref": "AC-CART-006",
      "br_refs": [
        "AMB-OP-014"
      ],
      "preconditions": [
        "Cart is empty after removal"
      ],
      "test_data": [],
      "steps": [
        "Remove last item",
        "Verify Continue Shopping link"
      ],
      "expected_results": [
        "Continue Shopping link visible",
        "Link navigates to shop"
      ]
    },
    {
      "id": "TC-AC-CART-006-B01",
      "name": "Remove one of two items - cart not empty",
      "category": "boundary",
      "ac_ref": "AC-CART-006",
      "br_refs": [
        "AMB-OP-014"
      ],
      "preconditions": [
        "Cart has exactly 2 items"
      ],
      "test_data": [
        {
          "field": "cartItems",
          "value": "[SKU-A, SKU-B]",
          "notes": "Two items"
        }
      ],
      "steps": [
        "Remove one item",
        "Verify cart state"
      ],
      "expected_results": [
        "One item remains",
        "Empty cart state NOT shown"
      ]
    },
    {
      "id": "TC-AC-CART-006-B02",
      "name": "Undo at last moment before option disappears",
      "category": "boundary",
      "ac_ref": "AC-CART-006",
      "br_refs": [
        "AMB-OP-015"
      ],
      "preconditions": [
        "Item removed",
        "Undo option about to expire"
      ],
      "test_data": [
        {
          "field": "undoTimeout",
          "value": "near-expiry",
          "notes": "Edge of window"
        }
      ],
      "steps": [
        "Remove item",
        "Wait until undo almost expires",
        "Click undo"
      ],
      "expected_results": [
        "Item successfully restored"
      ]
    },
    {
      "id": "TC-AC-CART-006-H01",
      "name": "Removed item should NOT appear in cart after refresh",
      "category": "hallucination",
      "ac_ref": "AC-CART-006",
      "br_refs": [
        "AMB-OP-014"
      ],
      "preconditions": [
        "Item removed",
        "Undo not clicked"
      ],
      "test_data": [
        {
          "field": "removedItem",
          "value": "SKU-A",
          "notes": "Removed item"
        }
      ],
      "steps": [
        "Remove item",
        "Wait for undo to expire",
        "Refresh page"
      ],
      "expected_results": [
        "Removed item not in cart"
      ],
      "should_not": "Removed item should NOT reappear after page refresh"
    },
    {
      "id": "TC-AC-CART-006-H02",
      "name": "Remove should NOT require confirmation dialog",
      "category": "hallucination",
      "ac_ref": "AC-CART-006",
      "br_refs": [
        "AMB-OP-014"
      ],
      "preconditions": [
        "Cart has items"
      ],
      "test_data": [],
      "steps": [
        "Click remove on item",
        "Observe behavior"
      ],
      "expected_results": [
        "Item removed immediately"
      ],
      "should_not": "Should NOT show confirmation dialog before removal"
    },
    {
      "id": "TC-AC-CART-007-P01",
      "name": "Out of stock item remains in cart with warning",
      "category": "positive",
      "ac_ref": "AC-CART-007",
      "br_refs": [
        "AMB-ENT-014"
      ],
      "preconditions": [
        "Cart has SKU-A",
        "SKU-A stock drops to 0"
      ],
      "test_data": [
        {
          "field": "item",
          "value": "SKU-A",
          "notes": "Out of stock item"
        },
        {
          "field": "stock",
          "value": "0",
          "notes": "No inventory"
        }
      ],
      "steps": [
        "Add item to cart",
        "Stock drops to 0",
        "View cart"
      ],
      "expected_results": [
        "Item still in cart",
        "Warning indicator shown"
      ]
    },
    {
      "id": "TC-AC-CART-007-P02",
      "name": "Warning indicator visible on out of stock item",
      "category": "positive",
      "ac_ref": "AC-CART-007",
      "br_refs": [
        "AMB-ENT-014"
      ],
      "preconditions": [
        "Item in cart has 0 stock"
      ],
      "test_data": [
        {
          "field": "stockLevel",
          "value": "0",
          "notes": "Zero stock"
        }
      ],
      "steps": [
        "View cart with out of stock item"
      ],
      "expected_results": [
        "Visual warning indicator displayed on item"
      ]
    },
    {
      "id": "TC-AC-CART-007-N01",
      "name": "Checkout blocked for out of stock item",
      "category": "negative",
      "ac_ref": "AC-CART-007",
      "br_refs": [
        "AMB-ENT-014"
      ],
      "preconditions": [
        "Cart has out of stock item"
      ],
      "test_data": [
        {
          "field": "item",
          "value": "SKU-A",
          "notes": "Out of stock"
        }
      ],
      "steps": [
        "Try to proceed to checkout with out of stock item"
      ],
      "expected_results": [
        "Checkout blocked",
        "User informed about blocked item"
      ]
    },
    {
      "id": "TC-AC-CART-007-N02",
      "name": "Cannot increase quantity of out of stock item",
      "category": "negative",
      "ac_ref": "AC-CART-007",
      "br_refs": [
        "AMB-ENT-014"
      ],
      "preconditions": [
        "Item has 0 stock",
        "Item qty in cart is 2"
      ],
      "test_data": [
        {
          "field": "currentQty",
          "value": "2",
          "notes": "Cart quantity"
        },
        {
          "field": "stock",
          "value": "0",
          "notes": "No stock"
        }
      ],
      "steps": [
        "Try to increase quantity of out of stock item"
      ],
      "expected_results": [
        "Quantity increase rejected or limited"
      ]
    },
    {
      "id": "TC-AC-CART-007-B01",
      "name": "Stock drops to exactly zero - warning appears",
      "category": "boundary",
      "ac_ref": "AC-CART-007",
      "br_refs": [
        "AMB-ENT-014"
      ],
      "preconditions": [
        "Stock at 1",
        "Another user purchases last item"
      ],
      "test_data": [
        {
          "field": "stockBefore",
          "value": "1",
          "notes": "Last item"
        },
        {
          "field": "stockAfter",
          "value": "0",
          "notes": "Now zero"
        }
      ],
      "steps": [
        "Have item in cart",
        "Stock drops to 0",
        "Verify warning"
      ],
      "expected_results": [
        "Warning appears when stock hits zero"
      ]
    },
    {
      "id": "TC-AC-CART-007-B02",
      "name": "Stock at 1 - no warning shown yet",
      "category": "boundary",
      "ac_ref": "AC-CART-007",
      "br_refs": [
        "AMB-ENT-014"
      ],
      "preconditions": [
        "Stock at 1",
        "Cart qty is 1"
      ],
      "test_data": [
        {
          "field": "stock",
          "value": "1",
          "notes": "Not yet zero"
        }
      ],
      "steps": [
        "View cart when stock is 1"
      ],
      "expected_results": [
        "No out of stock warning",
        "Checkout not blocked"
      ]
    },
    {
      "id": "TC-AC-CART-007-H01",
      "name": "Out of stock item should NOT be auto-removed",
      "category": "hallucination",
      "ac_ref": "AC-CART-007",
      "br_refs": [
        "AMB-ENT-014"
      ],
      "preconditions": [
        "Item goes out of stock"
      ],
      "test_data": [
        {
          "field": "item",
          "value": "SKU-A",
          "notes": "Out of stock"
        }
      ],
      "steps": [
        "Item goes out of stock",
        "Refresh cart",
        "Verify presence"
      ],
      "expected_results": [
        "Item still present in cart"
      ],
      "should_not": "Should NOT automatically remove out of stock items"
    },
    {
      "id": "TC-AC-CART-007-H02",
      "name": "Other in-stock items should NOT be blocked",
      "category": "hallucination",
      "ac_ref": "AC-CART-007",
      "br_refs": [
        "AMB-ENT-014"
      ],
      "preconditions": [
        "Cart has SKU-A (out of stock) and SKU-B (in stock)"
      ],
      "test_data": [
        {
          "field": "outOfStock",
          "value": "SKU-A",
          "notes": "Blocked item"
        },
        {
          "field": "inStock",
          "value": "SKU-B",
          "notes": "Available item"
        }
      ],
      "steps": [
        "Remove out of stock item",
        "Proceed to checkout"
      ],
      "expected_results": [
        "Checkout succeeds for in-stock items"
      ],
      "should_not": "Should NOT block checkout for items that ARE in stock"
    },
    {
      "id": "TC-AC-CART-008-P01",
      "name": "Cart displays current price after price increase",
      "category": "positive",
      "ac_ref": "AC-CART-008",
      "br_refs": [
        "AMB-ENT-016"
      ],
      "preconditions": [
        "Cart has SKU-A at $10",
        "Price changes to $12"
      ],
      "test_data": [
        {
          "field": "oldPrice",
          "value": "10.00",
          "notes": "Original"
        },
        {
          "field": "newPrice",
          "value": "12.00",
          "notes": "Updated"
        }
      ],
      "steps": [
        "Add item at $10",
        "Price changes to $12",
        "View cart"
      ],
      "expected_results": [
        "Cart shows $12 price",
        "Total reflects new price"
      ]
    },
    {
      "id": "TC-AC-CART-008-P02",
      "name": "Cart displays current price after price decrease",
      "category": "positive",
      "ac_ref": "AC-CART-008",
      "br_refs": [
        "AMB-ENT-016"
      ],
      "preconditions": [
        "Cart has SKU-A at $10",
        "Price changes to $8"
      ],
      "test_data": [
        {
          "field": "oldPrice",
          "value": "10.00",
          "notes": "Original"
        },
        {
          "field": "newPrice",
          "value": "8.00",
          "notes": "Reduced"
        }
      ],
      "steps": [
        "Add item at $10",
        "Price drops to $8",
        "View cart"
      ],
      "expected_results": [
        "Cart shows $8 price",
        "Customer benefits from reduction"
      ]
    },
    {
      "id": "TC-AC-CART-008-P03",
      "name": "Customer notified of price change",
      "category": "positive",
      "ac_ref": "AC-CART-008",
      "br_refs": [
        "AMB-ENT-016"
      ],
      "preconditions": [
        "Item price changed since added to cart"
      ],
      "test_data": [
        {
          "field": "priceChange",
          "value": "+2.00",
          "notes": "Price increased"
        }
      ],
      "steps": [
        "View cart after price change"
      ],
      "expected_results": [
        "Notification about price change shown to customer"
      ]
    },
    {
      "id": "TC-AC-CART-008-N01",
      "name": "Old price not used for cart total",
      "category": "negative",
      "ac_ref": "AC-CART-008",
      "br_refs": [
        "AMB-ENT-016"
      ],
      "preconditions": [
        "Price changed from $10 to $15"
      ],
      "test_data": [
        {
          "field": "qty",
          "value": "2",
          "notes": "Quantity"
        },
        {
          "field": "newPrice",
          "value": "15.00",
          "notes": "Current price"
        }
      ],
      "steps": [
        "Check cart total calculation"
      ],
      "expected_results": [
        "Total is $30 (2x$15)",
        "Not $20 (old price)"
      ]
    },
    {
      "id": "TC-AC-CART-008-N02",
      "name": "Price change notification distinguishes increase vs decrease",
      "category": "negative",
      "ac_ref": "AC-CART-008",
      "br_refs": [
        "AMB-ENT-016"
      ],
      "preconditions": [
        "Price changed"
      ],
      "test_data": [
        {
          "field": "changeType",
          "value": "increase",
          "notes": "Direction matters"
        }
      ],
      "steps": [
        "View notification for price increase"
      ],
      "expected_results": [
        "Notification clearly indicates price went up"
      ]
    },
    {
      "id": "TC-AC-CART-008-B01",
      "name": "Minimal price change triggers notification",
      "category": "boundary",
      "ac_ref": "AC-CART-008",
      "br_refs": [
        "AMB-ENT-016"
      ],
      "preconditions": [
        "Price changes by smallest unit"
      ],
      "test_data": [
        {
          "field": "oldPrice",
          "value": "10.00",
          "notes": "Original"
        },
        {
          "field": "newPrice",
          "value": "10.01",
          "notes": "Minimal change"
        }
      ],
      "steps": [
        "Price changes by $0.01",
        "View cart"
      ],
      "expected_results": [
        "Notification shown for minimal change"
      ]
    },
    {
      "id": "TC-AC-CART-008-B02",
      "name": "Price changed to zero - free item",
      "category": "boundary",
      "ac_ref": "AC-CART-008",
      "br_refs": [
        "AMB-ENT-016"
      ],
      "preconditions": [
        "Price set to $0"
      ],
      "test_data": [
        {
          "field": "oldPrice",
          "value": "10.00",
          "notes": "Had cost"
        },
        {
          "field": "newPrice",
          "value": "0.00",
          "notes": "Now free"
        }
      ],
      "steps": [
        "Price drops to zero",
        "View cart"
      ],
      "expected_results": [
        "Cart shows $0 price",
        "Notification shown"
      ]
    },
    {
      "id": "TC-AC-CART-008-H01",
      "name": "Should NOT lock in price from time of adding to cart",
      "category": "hallucination",
      "ac_ref": "AC-CART-008",
      "br_refs": [
        "AMB-ENT-016"
      ],
      "preconditions": [
        "Item added at old price",
        "Price changed"
      ],
      "test_data": [
        {
          "field": "addedAt",
          "value": "10.00",
          "notes": "Price when added"
        },
        {
          "field": "current",
          "value": "12.00",
          "notes": "Current price"
        }
      ],
      "steps": [
        "Check price displayed in cart"
      ],
      "expected_results": [
        "Current price shown, not original"
      ],
      "should_not": "Should NOT honor original price from when item was added"
    },
    {
      "id": "TC-AC-CART-008-H02",
      "name": "Price change should NOT auto-remove item from cart",
      "category": "hallucination",
      "ac_ref": "AC-CART-008",
      "br_refs": [
        "AMB-ENT-016"
      ],
      "preconditions": [
        "Item price significantly increased"
      ],
      "test_data": [
        {
          "field": "oldPrice",
          "value": "10.00",
          "notes": "Original"
        },
        {
          "field": "newPrice",
          "value": "50.00",
          "notes": "5x increase"
        }
      ],
      "steps": [
        "Significant price change occurs",
        "View cart"
      ],
      "expected_results": [
        "Item remains in cart with new price"
      ],
      "should_not": "Should NOT auto-remove items due to price changes"
    },
    {
      "id": "TC-AC-ORDER-001-P01",
      "name": "Successfully place order with all prerequisites met",
      "category": "positive",
      "ac_ref": "AC-ORDER-001",
      "br_refs": [
        "BR-ORDER"
      ],
      "preconditions": [
        "Customer is registered",
        "Email is verified",
        "Cart has items",
        "Valid shipping address exists",
        "Valid payment method exists"
      ],
      "test_data": [
        {
          "field": "cartItems",
          "value": "2 valid products",
          "notes": "Multiple items to verify all decremented"
        },
        {
          "field": "paymentMethod",
          "value": "valid credit card",
          "notes": "Pre-authorized payment method"
        }
      ],
      "steps": [
        "Login as verified customer",
        "Add items to cart",
        "Proceed to checkout",
        "Select shipping address",
        "Select payment method",
        "Submit order"
      ],
      "expected_results": [
        "Payment is authorized",
        "Inventory decremented for all items",
        "Order created with status pending",
        "Cart is cleared",
        "Confirmation page shown"
      ]
    },
    {
      "id": "TC-AC-ORDER-001-P02",
      "name": "Confirmation email queued after successful order",
      "category": "positive",
      "ac_ref": "AC-ORDER-001",
      "br_refs": [
        "BR-ORDER"
      ],
      "preconditions": [
        "Customer is registered and verified",
        "Cart has items",
        "Valid address and payment"
      ],
      "test_data": [
        {
          "field": "email",
          "value": "customer@example.com",
          "notes": "Verified email address"
        }
      ],
      "steps": [
        "Complete checkout process",
        "Submit order successfully",
        "Check email queue"
      ],
      "expected_results": [
        "Order confirmation email is added to queue",
        "Email contains order details"
      ]
    },
    {
      "id": "TC-AC-ORDER-001-P03",
      "name": "Cart cleared after successful order placement",
      "category": "positive",
      "ac_ref": "AC-ORDER-001",
      "br_refs": [
        "BR-ORDER"
      ],
      "preconditions": [
        "Verified customer with items in cart"
      ],
      "test_data": [
        {
          "field": "cartItems",
          "value": "3 products",
          "notes": "Multiple items to verify all cleared"
        }
      ],
      "steps": [
        "Add multiple items to cart",
        "Complete checkout",
        "View cart after order"
      ],
      "expected_results": [
        "Cart shows 0 items",
        "Cart total is $0.00"
      ]
    },
    {
      "id": "TC-AC-ORDER-001-N01",
      "name": "Reject order from unregistered customer",
      "category": "negative",
      "ac_ref": "AC-ORDER-001",
      "br_refs": [
        "BR-ORDER"
      ],
      "preconditions": [
        "User is not logged in",
        "Guest session with cart items"
      ],
      "test_data": [
        {
          "field": "sessionType",
          "value": "guest",
          "notes": "Anonymous user"
        }
      ],
      "steps": [
        "Add items to cart as guest",
        "Attempt to proceed to checkout"
      ],
      "expected_results": [
        "User is redirected to registration/login page",
        "Cart items are preserved"
      ]
    },
    {
      "id": "TC-AC-ORDER-001-N02",
      "name": "Reject order when email not verified",
      "category": "negative",
      "ac_ref": "AC-ORDER-001",
      "br_refs": [
        "BR-ORDER"
      ],
      "preconditions": [
        "Customer registered but email not verified"
      ],
      "test_data": [
        {
          "field": "emailVerified",
          "value": "false",
          "notes": "Unverified email status"
        }
      ],
      "steps": [
        "Login as unverified customer",
        "Add items to cart",
        "Attempt checkout"
      ],
      "expected_results": [
        "Verification required message is displayed",
        "Order is not created"
      ]
    },
    {
      "id": "TC-AC-ORDER-001-N03",
      "name": "Handle payment authorization failure",
      "category": "negative",
      "ac_ref": "AC-ORDER-001",
      "br_refs": [
        "BR-ORDER"
      ],
      "preconditions": [
        "Verified customer",
        "Cart has items",
        "Payment will fail"
      ],
      "test_data": [
        {
          "field": "cardNumber",
          "value": "4000000000000002",
          "notes": "Test card that declines"
        }
      ],
      "steps": [
        "Proceed to checkout",
        "Enter declining payment method",
        "Submit order"
      ],
      "expected_results": [
        "Payment error message shown",
        "Cart remains intact",
        "Retry option available"
      ]
    },
    {
      "id": "TC-AC-ORDER-001-N04",
      "name": "Handle out of stock during checkout",
      "category": "negative",
      "ac_ref": "AC-ORDER-001",
      "br_refs": [
        "BR-ORDER"
      ],
      "preconditions": [
        "Item becomes out of stock between cart add and checkout"
      ],
      "test_data": [
        {
          "field": "productStock",
          "value": "0",
          "notes": "Stock depleted by other order"
        }
      ],
      "steps": [
        "Add item to cart",
        "Another user buys last stock",
        "Submit order"
      ],
      "expected_results": [
        "Error shown for out of stock items",
        "Cart modification allowed"
      ]
    },
    {
      "id": "TC-AC-ORDER-001-N05",
      "name": "Reject invalid shipping address",
      "category": "negative",
      "ac_ref": "AC-ORDER-001",
      "br_refs": [
        "BR-ORDER"
      ],
      "preconditions": [
        "Verified customer with items in cart"
      ],
      "test_data": [
        {
          "field": "zipCode",
          "value": "invalid",
          "notes": "Malformed postal code"
        },
        {
          "field": "state",
          "value": "",
          "notes": "Missing required state"
        }
      ],
      "steps": [
        "Proceed to checkout",
        "Enter invalid shipping address",
        "Submit order"
      ],
      "expected_results": [
        "Validation errors displayed for invalid fields",
        "Order not created"
      ]
    },
    {
      "id": "TC-AC-ORDER-001-B01",
      "name": "Place order with minimum cart (1 item)",
      "category": "boundary",
      "ac_ref": "AC-ORDER-001",
      "br_refs": [
        "BR-ORDER"
      ],
      "preconditions": [
        "Verified customer",
        "Valid address and payment"
      ],
      "test_data": [
        {
          "field": "cartItemCount",
          "value": "1",
          "notes": "Minimum possible cart size"
        }
      ],
      "steps": [
        "Add exactly 1 item to cart",
        "Complete checkout"
      ],
      "expected_results": [
        "Order created successfully",
        "Single item order confirmed"
      ]
    },
    {
      "id": "TC-AC-ORDER-001-B02",
      "name": "Place order with empty cart rejected",
      "category": "boundary",
      "ac_ref": "AC-ORDER-001",
      "br_refs": [
        "BR-ORDER"
      ],
      "preconditions": [
        "Verified customer",
        "Empty cart"
      ],
      "test_data": [
        {
          "field": "cartItemCount",
          "value": "0",
          "notes": "Empty cart boundary"
        }
      ],
      "steps": [
        "Navigate to checkout with empty cart"
      ],
      "expected_results": [
        "Checkout blocked",
        "Message to add items first"
      ]
    },
    {
      "id": "TC-AC-ORDER-001-H01",
      "name": "Order should NOT be created if payment not authorized",
      "category": "hallucination",
      "ac_ref": "AC-ORDER-001",
      "br_refs": [
        "BR-ORDER"
      ],
      "preconditions": [
        "Payment authorization pending or failed"
      ],
      "test_data": [
        {
          "field": "paymentStatus",
          "value": "pending",
          "notes": "Auth not completed"
        }
      ],
      "steps": [
        "Interrupt payment authorization",
        "Check order status"
      ],
      "expected_results": [
        "No order record exists in database"
      ],
      "should_not": "Order should NOT be created before payment authorization completes"
    },
    {
      "id": "TC-AC-ORDER-001-H02",
      "name": "Inventory should NOT decrement on failed payment",
      "category": "hallucination",
      "ac_ref": "AC-ORDER-001",
      "br_refs": [
        "BR-ORDER"
      ],
      "preconditions": [
        "Payment will fail"
      ],
      "test_data": [
        {
          "field": "initialStock",
          "value": "10",
          "notes": "Track stock before attempt"
        }
      ],
      "steps": [
        "Record initial inventory",
        "Attempt order with failing payment",
        "Check inventory"
      ],
      "expected_results": [
        "Inventory remains at initial level"
      ],
      "should_not": "Inventory should NOT be decremented when payment fails"
    },
    {
      "id": "TC-AC-ORDER-002-P01",
      "name": "Free shipping applied at $50 subtotal",
      "category": "positive",
      "ac_ref": "AC-ORDER-002",
      "br_refs": [
        "BR-SHIPPING"
      ],
      "preconditions": [
        "Customer at checkout"
      ],
      "test_data": [
        {
          "field": "subtotal",
          "value": "$50.00",
          "notes": "Exact threshold amount"
        }
      ],
      "steps": [
        "Add items totaling $50",
        "Proceed to checkout",
        "View shipping options"
      ],
      "expected_results": [
        "Free shipping is automatically applied",
        "Shipping cost shows $0.00"
      ]
    },
    {
      "id": "TC-AC-ORDER-002-P02",
      "name": "Free shipping applied at $75 subtotal (above threshold)",
      "category": "positive",
      "ac_ref": "AC-ORDER-002",
      "br_refs": [
        "BR-SHIPPING"
      ],
      "preconditions": [
        "Customer at checkout"
      ],
      "test_data": [
        {
          "field": "subtotal",
          "value": "$75.00",
          "notes": "Well above threshold"
        }
      ],
      "steps": [
        "Add items totaling $75",
        "Proceed to checkout"
      ],
      "expected_results": [
        "Free shipping automatically applied"
      ]
    },
    {
      "id": "TC-AC-ORDER-002-P03",
      "name": "Free shipping based on post-discount subtotal",
      "category": "positive",
      "ac_ref": "AC-ORDER-002",
      "br_refs": [
        "BR-SHIPPING"
      ],
      "preconditions": [
        "Customer has discount code"
      ],
      "test_data": [
        {
          "field": "originalSubtotal",
          "value": "$60.00",
          "notes": "Pre-discount total"
        },
        {
          "field": "discount",
          "value": "$5.00",
          "notes": "Applied discount"
        },
        {
          "field": "finalSubtotal",
          "value": "$55.00",
          "notes": "Still above $50"
        }
      ],
      "steps": [
        "Add $60 worth of items",
        "Apply $5 discount",
        "Check shipping"
      ],
      "expected_results": [
        "Free shipping applied based on $55 subtotal"
      ]
    },
    {
      "id": "TC-AC-ORDER-002-N01",
      "name": "Standard shipping fee for subtotal below $50",
      "category": "negative",
      "ac_ref": "AC-ORDER-002",
      "br_refs": [
        "BR-SHIPPING"
      ],
      "preconditions": [
        "Customer at checkout"
      ],
      "test_data": [
        {
          "field": "subtotal",
          "value": "$30.00",
          "notes": "Below threshold"
        }
      ],
      "steps": [
        "Add items totaling $30",
        "Proceed to checkout"
      ],
      "expected_results": [
        "Standard shipping fee of $5.99 is applied"
      ]
    },
    {
      "id": "TC-AC-ORDER-002-N02",
      "name": "No free shipping when discount drops subtotal below $50",
      "category": "negative",
      "ac_ref": "AC-ORDER-002",
      "br_refs": [
        "BR-SHIPPING"
      ],
      "preconditions": [
        "Discount causes subtotal to drop below threshold"
      ],
      "test_data": [
        {
          "field": "originalSubtotal",
          "value": "$55.00",
          "notes": "Above threshold"
        },
        {
          "field": "discount",
          "value": "$10.00",
          "notes": "Drops below threshold"
        },
        {
          "field": "finalSubtotal",
          "value": "$45.00",
          "notes": "Now below $50"
        }
      ],
      "steps": [
        "Add $55 worth of items",
        "Apply $10 discount",
        "Check shipping"
      ],
      "expected_results": [
        "$5.99 shipping fee applied",
        "Free shipping not available"
      ]
    },
    {
      "id": "TC-AC-ORDER-002-B01",
      "name": "Free shipping at exact $50.00 boundary",
      "category": "boundary",
      "ac_ref": "AC-ORDER-002",
      "br_refs": [
        "BR-SHIPPING"
      ],
      "preconditions": [
        "Customer at checkout"
      ],
      "test_data": [
        {
          "field": "subtotal",
          "value": "$50.00",
          "notes": "Exact boundary value"
        }
      ],
      "steps": [
        "Add items totaling exactly $50.00",
        "Check shipping at checkout"
      ],
      "expected_results": [
        "Free shipping is applied"
      ]
    },
    {
      "id": "TC-AC-ORDER-002-B02",
      "name": "Standard shipping at $49.99 (just below threshold)",
      "category": "boundary",
      "ac_ref": "AC-ORDER-002",
      "br_refs": [
        "BR-SHIPPING"
      ],
      "preconditions": [
        "Customer at checkout"
      ],
      "test_data": [
        {
          "field": "subtotal",
          "value": "$49.99",
          "notes": "One cent below threshold"
        }
      ],
      "steps": [
        "Add items totaling $49.99",
        "Check shipping at checkout"
      ],
      "expected_results": [
        "Standard shipping fee of $5.99 applied"
      ]
    },
    {
      "id": "TC-AC-ORDER-002-B03",
      "name": "Free shipping at $50.01 (just above threshold)",
      "category": "boundary",
      "ac_ref": "AC-ORDER-002",
      "br_refs": [
        "BR-SHIPPING"
      ],
      "preconditions": [
        "Customer at checkout"
      ],
      "test_data": [
        {
          "field": "subtotal",
          "value": "$50.01",
          "notes": "One cent above threshold"
        }
      ],
      "steps": [
        "Add items totaling $50.01",
        "Check shipping"
      ],
      "expected_results": [
        "Free shipping is applied"
      ]
    },
    {
      "id": "TC-AC-ORDER-002-H01",
      "name": "Tax should NOT be included in free shipping calculation",
      "category": "hallucination",
      "ac_ref": "AC-ORDER-002",
      "br_refs": [
        "BR-SHIPPING"
      ],
      "preconditions": [
        "Subtotal $45, tax $8"
      ],
      "test_data": [
        {
          "field": "subtotal",
          "value": "$45.00",
          "notes": "Below threshold"
        },
        {
          "field": "tax",
          "value": "$8.00",
          "notes": "Would push total over $50"
        }
      ],
      "steps": [
        "Add items with $45 subtotal",
        "Tax calculated as $8",
        "Check shipping"
      ],
      "expected_results": [
        "$5.99 shipping fee applied despite $53 total"
      ],
      "should_not": "Tax should NOT be included when calculating free shipping eligibility"
    },
    {
      "id": "TC-AC-ORDER-002-H02",
      "name": "Previous order total should NOT affect current shipping",
      "category": "hallucination",
      "ac_ref": "AC-ORDER-002",
      "br_refs": [
        "BR-SHIPPING"
      ],
      "preconditions": [
        "Customer had $100 order last week",
        "Current cart is $30"
      ],
      "test_data": [
        {
          "field": "currentSubtotal",
          "value": "$30.00",
          "notes": "Current order below threshold"
        }
      ],
      "steps": [
        "Login as customer with order history",
        "Add $30 to cart",
        "Checkout"
      ],
      "expected_results": [
        "$5.99 shipping applied to current order"
      ],
      "should_not": "Previous order amounts should NOT affect current shipping calculation"
    },
    {
      "id": "TC-AC-ORDER-003-P01",
      "name": "Tax calculated based on shipping state",
      "category": "positive",
      "ac_ref": "AC-ORDER-003",
      "br_refs": [
        "BR-TAX"
      ],
      "preconditions": [
        "Customer at checkout with shipping address"
      ],
      "test_data": [
        {
          "field": "shippingState",
          "value": "CA",
          "notes": "California tax rate"
        },
        {
          "field": "subtotal",
          "value": "$100.00",
          "notes": "Easy calculation base"
        }
      ],
      "steps": [
        "Add items to cart",
        "Enter California shipping address",
        "View order total"
      ],
      "expected_results": [
        "California state tax rate applied",
        "Tax amount shown in order total"
      ]
    },
    {
      "id": "TC-AC-ORDER-003-P02",
      "name": "Tax recalculated when shipping address changes",
      "category": "positive",
      "ac_ref": "AC-ORDER-003",
      "br_refs": [
        "BR-TAX"
      ],
      "preconditions": [
        "Customer has multiple saved addresses"
      ],
      "test_data": [
        {
          "field": "initialState",
          "value": "NY",
          "notes": "Higher tax state"
        },
        {
          "field": "newState",
          "value": "OR",
          "notes": "No sales tax state"
        }
      ],
      "steps": [
        "Select NY address",
        "Note tax amount",
        "Change to OR address",
        "Note new tax"
      ],
      "expected_results": [
        "Tax recalculated for new state",
        "OR shows $0 tax"
      ]
    },
    {
      "id": "TC-AC-ORDER-003-N01",
      "name": "Tax calculation fails with incomplete address",
      "category": "negative",
      "ac_ref": "AC-ORDER-003",
      "br_refs": [
        "BR-TAX"
      ],
      "preconditions": [
        "Shipping address missing state"
      ],
      "test_data": [
        {
          "field": "state",
          "value": "",
          "notes": "Missing state field"
        }
      ],
      "steps": [
        "Enter address without state",
        "Attempt to calculate total"
      ],
      "expected_results": [
        "Error requesting state selection",
        "Tax cannot be calculated"
      ]
    },
    {
      "id": "TC-AC-ORDER-003-N02",
      "name": "Invalid state code rejected",
      "category": "negative",
      "ac_ref": "AC-ORDER-003",
      "br_refs": [
        "BR-TAX"
      ],
      "preconditions": [
        "Customer entering shipping address"
      ],
      "test_data": [
        {
          "field": "state",
          "value": "XX",
          "notes": "Invalid state code"
        }
      ],
      "steps": [
        "Enter address with invalid state code",
        "Submit address"
      ],
      "expected_results": [
        "Validation error for invalid state",
        "Tax not calculated"
      ]
    },
    {
      "id": "TC-AC-ORDER-003-B01",
      "name": "Tax on minimum order amount",
      "category": "boundary",
      "ac_ref": "AC-ORDER-003",
      "br_refs": [
        "BR-TAX"
      ],
      "preconditions": [
        "Minimum value order"
      ],
      "test_data": [
        {
          "field": "subtotal",
          "value": "$0.01",
          "notes": "Smallest possible amount"
        },
        {
          "field": "state",
          "value": "CA",
          "notes": "State with tax"
        }
      ],
      "steps": [
        "Create order with $0.01 subtotal",
        "Check tax calculation"
      ],
      "expected_results": [
        "Tax calculated correctly on small amount",
        "Rounds appropriately"
      ]
    },
    {
      "id": "TC-AC-ORDER-003-B02",
      "name": "Tax in zero-tax state",
      "category": "boundary",
      "ac_ref": "AC-ORDER-003",
      "br_refs": [
        "BR-TAX"
      ],
      "preconditions": [
        "Shipping to state with no sales tax"
      ],
      "test_data": [
        {
          "field": "state",
          "value": "OR",
          "notes": "Oregon has no sales tax"
        },
        {
          "field": "subtotal",
          "value": "$100.00",
          "notes": "Test amount"
        }
      ],
      "steps": [
        "Enter Oregon shipping address",
        "View tax calculation"
      ],
      "expected_results": [
        "Tax shows as $0.00",
        "Order total equals subtotal plus shipping"
      ]
    },
    {
      "id": "TC-AC-ORDER-003-H01",
      "name": "Billing address should NOT affect tax calculation",
      "category": "hallucination",
      "ac_ref": "AC-ORDER-003",
      "br_refs": [
        "BR-TAX"
      ],
      "preconditions": [
        "Different billing and shipping states"
      ],
      "test_data": [
        {
          "field": "billingState",
          "value": "CA",
          "notes": "High tax state"
        },
        {
          "field": "shippingState",
          "value": "OR",
          "notes": "No tax state"
        }
      ],
      "steps": [
        "Enter CA billing address",
        "Enter OR shipping address",
        "Check tax"
      ],
      "expected_results": [
        "Tax is $0 based on OR shipping address"
      ],
      "should_not": "Billing address state should NOT be used for tax calculation"
    },
    {
      "id": "TC-AC-ORDER-003-H02",
      "name": "Customer home state should NOT override shipping tax",
      "category": "hallucination",
      "ac_ref": "AC-ORDER-003",
      "br_refs": [
        "BR-TAX"
      ],
      "preconditions": [
        "Customer profile has home state different from shipping"
      ],
      "test_data": [
        {
          "field": "profileState",
          "value": "NY",
          "notes": "Customer home state"
        },
        {
          "field": "shippingState",
          "value": "NH",
          "notes": "No tax state for shipping"
        }
      ],
      "steps": [
        "Ship to NH address",
        "Verify tax calculation"
      ],
      "expected_results": [
        "Tax based on NH shipping, not NY profile"
      ],
      "should_not": "Customer profile state should NOT be used for tax calculation"
    },
    {
      "id": "TC-AC-ORDER-004-P01",
      "name": "Confirmation email queued with all required fields",
      "category": "positive",
      "ac_ref": "AC-ORDER-004",
      "br_refs": [
        "BR-EMAIL"
      ],
      "preconditions": [
        "Order successfully placed"
      ],
      "test_data": [
        {
          "field": "orderNumber",
          "value": "ORD-12345",
          "notes": "Generated order ID"
        },
        {
          "field": "itemCount",
          "value": "3",
          "notes": "Multiple items ordered"
        }
      ],
      "steps": [
        "Place order successfully",
        "Check email queue",
        "Verify email content"
      ],
      "expected_results": [
        "Email queued with order number",
        "Contains all items with quantities and prices",
        "Shows total and shipping address",
        "Includes estimated delivery"
      ]
    },
    {
      "id": "TC-AC-ORDER-004-P02",
      "name": "Email queued asynchronously without blocking order",
      "category": "positive",
      "ac_ref": "AC-ORDER-004",
      "br_refs": [
        "BR-EMAIL"
      ],
      "preconditions": [
        "Order being placed"
      ],
      "test_data": [
        {
          "field": "emailDelay",
          "value": "simulated",
          "notes": "Slow email service"
        }
      ],
      "steps": [
        "Place order",
        "Measure order creation time",
        "Verify email in queue"
      ],
      "expected_results": [
        "Order completes without waiting for email",
        "Email appears in async queue"
      ]
    },
    {
      "id": "TC-AC-ORDER-004-N01",
      "name": "Order creation continues when email service fails",
      "category": "negative",
      "ac_ref": "AC-ORDER-004",
      "br_refs": [
        "BR-EMAIL"
      ],
      "preconditions": [
        "Email service is down"
      ],
      "test_data": [
        {
          "field": "emailServiceStatus",
          "value": "unavailable",
          "notes": "Simulated outage"
        }
      ],
      "steps": [
        "Disable email service",
        "Place order",
        "Check order status"
      ],
      "expected_results": [
        "Order is created successfully",
        "Email queued for retry",
        "Failure is logged"
      ]
    },
    {
      "id": "TC-AC-ORDER-004-N02",
      "name": "Failed email logged with error details",
      "category": "negative",
      "ac_ref": "AC-ORDER-004",
      "br_refs": [
        "BR-EMAIL"
      ],
      "preconditions": [
        "Email service returns error"
      ],
      "test_data": [
        {
          "field": "errorType",
          "value": "SMTP_TIMEOUT",
          "notes": "Specific error type"
        }
      ],
      "steps": [
        "Trigger email failure",
        "Check system logs"
      ],
      "expected_results": [
        "Error logged with timestamp",
        "Error details captured",
        "Order ID in log"
      ]
    },
    {
      "id": "TC-AC-ORDER-004-B01",
      "name": "Email content with single item order",
      "category": "boundary",
      "ac_ref": "AC-ORDER-004",
      "br_refs": [
        "BR-EMAIL"
      ],
      "preconditions": [
        "Order with single item"
      ],
      "test_data": [
        {
          "field": "itemCount",
          "value": "1",
          "notes": "Minimum items"
        }
      ],
      "steps": [
        "Place single item order",
        "Check email content"
      ],
      "expected_results": [
        "Email correctly shows single item",
        "No plural grammar issues"
      ]
    },
    {
      "id": "TC-AC-ORDER-004-B02",
      "name": "Email content with many items",
      "category": "boundary",
      "ac_ref": "AC-ORDER-004",
      "br_refs": [
        "BR-EMAIL"
      ],
      "preconditions": [
        "Order with many different items"
      ],
      "test_data": [
        {
          "field": "itemCount",
          "value": "50",
          "notes": "Large order"
        }
      ],
      "steps": [
        "Place order with 50 different items",
        "Verify email renders correctly"
      ],
      "expected_results": [
        "All 50 items listed in email",
        "Email renders properly"
      ]
    },
    {
      "id": "TC-AC-ORDER-004-H01",
      "name": "Email should NOT contain payment card details",
      "category": "hallucination",
      "ac_ref": "AC-ORDER-004",
      "br_refs": [
        "BR-EMAIL"
      ],
      "preconditions": [
        "Order placed with credit card"
      ],
      "test_data": [
        {
          "field": "cardNumber",
          "value": "4111111111111111",
          "notes": "Test card used"
        }
      ],
      "steps": [
        "Place order with credit card",
        "Check email content"
      ],
      "expected_results": [
        "Email contains only specified fields"
      ],
      "should_not": "Email should NOT contain full credit card number or CVV"
    },
    {
      "id": "TC-AC-ORDER-004-H02",
      "name": "Email should NOT be sent synchronously",
      "category": "hallucination",
      "ac_ref": "AC-ORDER-004",
      "br_refs": [
        "BR-EMAIL"
      ],
      "preconditions": [
        "Order being placed"
      ],
      "test_data": [
        {
          "field": "emailSendTime",
          "value": "measured",
          "notes": "Track timing"
        }
      ],
      "steps": [
        "Place order",
        "Measure if order waits for email send"
      ],
      "expected_results": [
        "Order returns before email actually sent"
      ],
      "should_not": "Order completion should NOT wait for email delivery confirmation"
    },
    {
      "id": "TC-AC-ORDER-005-P01",
      "name": "View order history with all order details",
      "category": "positive",
      "ac_ref": "AC-ORDER-005",
      "br_refs": [
        "BR-TRACKING"
      ],
      "preconditions": [
        "Customer has placed orders"
      ],
      "test_data": [
        {
          "field": "orderCount",
          "value": "5",
          "notes": "Multiple orders to display"
        }
      ],
      "steps": [
        "Login as customer",
        "Navigate to order history",
        "View order list"
      ],
      "expected_results": [
        "All orders displayed",
        "Each shows number, date, items, status",
        "Shipping address visible",
        "Tracking number shown if available"
      ]
    },
    {
      "id": "TC-AC-ORDER-005-P02",
      "name": "Order history displays with pagination",
      "category": "positive",
      "ac_ref": "AC-ORDER-005",
      "br_refs": [
        "BR-TRACKING"
      ],
      "preconditions": [
        "Customer has many orders"
      ],
      "test_data": [
        {
          "field": "orderCount",
          "value": "50",
          "notes": "Exceeds single page"
        }
      ],
      "steps": [
        "Login as customer with 50 orders",
        "View order history",
        "Navigate pages"
      ],
      "expected_results": [
        "Orders split across pages",
        "Pagination controls visible",
        "Can navigate between pages"
      ]
    },
    {
      "id": "TC-AC-ORDER-005-P03",
      "name": "Tracking number shown for shipped orders",
      "category": "positive",
      "ac_ref": "AC-ORDER-005",
      "br_refs": [
        "BR-TRACKING"
      ],
      "preconditions": [
        "Order has been shipped with tracking"
      ],
      "test_data": [
        {
          "field": "trackingNumber",
          "value": "1Z999AA10123456784",
          "notes": "UPS tracking"
        }
      ],
      "steps": [
        "View shipped order in history"
      ],
      "expected_results": [
        "Tracking number displayed",
        "Tracking number is clickable/usable"
      ]
    },
    {
      "id": "TC-AC-ORDER-005-N01",
      "name": "Empty state shown when no orders exist",
      "category": "negative",
      "ac_ref": "AC-ORDER-005",
      "br_refs": [
        "BR-TRACKING"
      ],
      "preconditions": [
        "New customer with no order history"
      ],
      "test_data": [
        {
          "field": "orderCount",
          "value": "0",
          "notes": "No orders placed"
        }
      ],
      "steps": [
        "Login as new customer",
        "Navigate to order history"
      ],
      "expected_results": [
        "Empty state message displayed",
        "Start Shopping link visible and functional"
      ]
    },
    {
      "id": "TC-AC-ORDER-005-N02",
      "name": "Unauthenticated user cannot view order history",
      "category": "negative",
      "ac_ref": "AC-ORDER-005",
      "br_refs": [
        "BR-TRACKING"
      ],
      "preconditions": [
        "User not logged in"
      ],
      "test_data": [
        {
          "field": "sessionType",
          "value": "guest",
          "notes": "No authentication"
        }
      ],
      "steps": [
        "Navigate to order history without login"
      ],
      "expected_results": [
        "Redirected to login page",
        "Order history not accessible"
      ]
    },
    {
      "id": "TC-AC-ORDER-005-B01",
      "name": "Order history with single order",
      "category": "boundary",
      "ac_ref": "AC-ORDER-005",
      "br_refs": [
        "BR-TRACKING"
      ],
      "preconditions": [
        "Customer has exactly one order"
      ],
      "test_data": [
        {
          "field": "orderCount",
          "value": "1",
          "notes": "Minimum orders"
        }
      ],
      "steps": [
        "Login as customer with 1 order",
        "View order history"
      ],
      "expected_results": [
        "Single order displayed correctly",
        "No pagination needed",
        "No empty state shown"
      ]
    },
    {
      "id": "TC-AC-ORDER-005-B02",
      "name": "Pagination boundary at page limit",
      "category": "boundary",
      "ac_ref": "AC-ORDER-005",
      "br_refs": [
        "BR-TRACKING"
      ],
      "preconditions": [
        "Customer has exactly page limit number of orders"
      ],
      "test_data": [
        {
          "field": "orderCount",
          "value": "20",
          "notes": "Assuming 20 per page limit"
        }
      ],
      "steps": [
        "View order history with exactly page limit orders"
      ],
      "expected_results": [
        "All orders on single page",
        "No next page link or shows disabled"
      ]
    },
    {
      "id": "TC-AC-ORDER-005-H01",
      "name": "Should NOT show other customers orders",
      "category": "hallucination",
      "ac_ref": "AC-ORDER-005",
      "br_refs": [
        "BR-TRACKING"
      ],
      "preconditions": [
        "Multiple customers with orders"
      ],
      "test_data": [
        {
          "field": "customerAOrders",
          "value": "5",
          "notes": "Current user orders"
        },
        {
          "field": "customerBOrders",
          "value": "10",
          "notes": "Other user orders"
        }
      ],
      "steps": [
        "Login as Customer A",
        "View order history"
      ],
      "expected_results": [
        "Only 5 orders visible (Customer A orders)"
      ],
      "should_not": "Other customers orders should NOT appear in order history"
    },
    {
      "id": "TC-AC-ORDER-005-H02",
      "name": "Cancelled orders should NOT be hidden from history",
      "category": "hallucination",
      "ac_ref": "AC-ORDER-005",
      "br_refs": [
        "BR-TRACKING"
      ],
      "preconditions": [
        "Customer has cancelled orders"
      ],
      "test_data": [
        {
          "field": "cancelledOrders",
          "value": "2",
          "notes": "Orders with cancelled status"
        }
      ],
      "steps": [
        "Login as customer with cancelled orders",
        "View order history"
      ],
      "expected_results": [
        "Cancelled orders visible in history",
        "Status shows as cancelled"
      ],
      "should_not": "Cancelled orders should NOT be filtered out from order history"
    },
    {
      "id": "TC-AC-ORDER-006-P01",
      "name": "Cancel pending order successfully",
      "category": "positive",
      "ac_ref": "AC-ORDER-006",
      "br_refs": [
        "AMB-OP-028"
      ],
      "preconditions": [
        "Customer has existing order",
        "Order status is 'pending'"
      ],
      "test_data": [
        {
          "field": "orderId",
          "value": "ORD-12345",
          "notes": "Valid pending order"
        },
        {
          "field": "orderStatus",
          "value": "pending",
          "notes": "Cancellable state"
        }
      ],
      "steps": [
        "Navigate to order details",
        "Click cancel order",
        "Confirm cancellation"
      ],
      "expected_results": [
        "Order status changes to 'cancelled'",
        "Success message displayed"
      ]
    },
    {
      "id": "TC-AC-ORDER-006-P02",
      "name": "Cancel confirmed order successfully",
      "category": "positive",
      "ac_ref": "AC-ORDER-006",
      "br_refs": [
        "AMB-OP-028"
      ],
      "preconditions": [
        "Customer has existing order",
        "Order status is 'confirmed'"
      ],
      "test_data": [
        {
          "field": "orderId",
          "value": "ORD-12346",
          "notes": "Valid confirmed order"
        },
        {
          "field": "orderStatus",
          "value": "confirmed",
          "notes": "Cancellable state"
        }
      ],
      "steps": [
        "Navigate to order details",
        "Click cancel order",
        "Confirm cancellation"
      ],
      "expected_results": [
        "Order status changes to 'cancelled'"
      ]
    },
    {
      "id": "TC-AC-ORDER-006-P03",
      "name": "Inventory restored on cancellation",
      "category": "positive",
      "ac_ref": "AC-ORDER-006",
      "br_refs": [
        "AMB-OP-029"
      ],
      "preconditions": [
        "Order exists with 3 items",
        "Order status is 'pending'"
      ],
      "test_data": [
        {
          "field": "productId",
          "value": "PROD-001",
          "notes": "Product in order"
        },
        {
          "field": "quantity",
          "value": "3",
          "notes": "Ordered quantity"
        }
      ],
      "steps": [
        "Note current inventory level",
        "Cancel order",
        "Check inventory level"
      ],
      "expected_results": [
        "Inventory increased by ordered quantity"
      ]
    },
    {
      "id": "TC-AC-ORDER-006-P04",
      "name": "Refund initiated to original payment method",
      "category": "positive",
      "ac_ref": "AC-ORDER-006",
      "br_refs": [
        "AMB-OP-030"
      ],
      "preconditions": [
        "Order paid via credit card",
        "Order status is 'pending'"
      ],
      "test_data": [
        {
          "field": "paymentMethod",
          "value": "Visa ending 4242",
          "notes": "Original payment"
        },
        {
          "field": "orderTotal",
          "value": "99.99",
          "notes": "Amount to refund"
        }
      ],
      "steps": [
        "Cancel order",
        "Check payment gateway logs"
      ],
      "expected_results": [
        "Refund request sent to original payment method"
      ]
    },
    {
      "id": "TC-AC-ORDER-006-P05",
      "name": "Cancellation confirmation email sent",
      "category": "positive",
      "ac_ref": "AC-ORDER-006",
      "br_refs": [
        "AMB-OP-031"
      ],
      "preconditions": [
        "Customer has valid email",
        "Order is cancellable"
      ],
      "test_data": [
        {
          "field": "customerEmail",
          "value": "test@example.com",
          "notes": "Customer email"
        }
      ],
      "steps": [
        "Cancel order",
        "Check email queue/logs"
      ],
      "expected_results": [
        "Cancellation confirmation email queued for delivery"
      ]
    },
    {
      "id": "TC-AC-ORDER-006-N01",
      "name": "Reject cancellation for shipped order",
      "category": "negative",
      "ac_ref": "AC-ORDER-006",
      "br_refs": [
        "AMB-OP-032"
      ],
      "preconditions": [
        "Order exists",
        "Order status is 'shipped'"
      ],
      "test_data": [
        {
          "field": "orderStatus",
          "value": "shipped",
          "notes": "Non-cancellable state"
        }
      ],
      "steps": [
        "Navigate to shipped order",
        "Attempt to cancel"
      ],
      "expected_results": [
        "Error message: cancellation not allowed",
        "Order status unchanged"
      ]
    },
    {
      "id": "TC-AC-ORDER-006-N02",
      "name": "Reject cancellation for delivered order",
      "category": "negative",
      "ac_ref": "AC-ORDER-006",
      "br_refs": [
        "AMB-OP-032"
      ],
      "preconditions": [
        "Order exists",
        "Order status is 'delivered'"
      ],
      "test_data": [
        {
          "field": "orderStatus",
          "value": "delivered",
          "notes": "Non-cancellable state"
        }
      ],
      "steps": [
        "Navigate to delivered order",
        "Attempt to cancel"
      ],
      "expected_results": [
        "Error message: cancellation not allowed"
      ]
    },
    {
      "id": "TC-AC-ORDER-006-N03",
      "name": "Show message for already cancelled order",
      "category": "negative",
      "ac_ref": "AC-ORDER-006",
      "br_refs": [
        "AMB-OP-032"
      ],
      "preconditions": [
        "Order exists",
        "Order status is 'cancelled'"
      ],
      "test_data": [
        {
          "field": "orderStatus",
          "value": "cancelled",
          "notes": "Already cancelled"
        }
      ],
      "steps": [
        "Navigate to cancelled order",
        "Check cancel option"
      ],
      "expected_results": [
        "Message: order already cancelled",
        "No cancel action available"
      ]
    },
    {
      "id": "TC-AC-ORDER-006-N04",
      "name": "Reject cancellation by non-owner customer",
      "category": "negative",
      "ac_ref": "AC-ORDER-006",
      "br_refs": [
        "AMB-OP-028"
      ],
      "preconditions": [
        "Order belongs to Customer A",
        "Customer B is logged in"
      ],
      "test_data": [
        {
          "field": "orderOwner",
          "value": "customer-A",
          "notes": "Order owner"
        },
        {
          "field": "requestingUser",
          "value": "customer-B",
          "notes": "Different customer"
        }
      ],
      "steps": [
        "Customer B attempts to access order",
        "Attempt cancellation"
      ],
      "expected_results": [
        "Access denied or order not found"
      ]
    },
    {
      "id": "TC-AC-ORDER-006-B01",
      "name": "Cancel at exact moment status changes to shipped",
      "category": "boundary",
      "ac_ref": "AC-ORDER-006",
      "br_refs": [
        "AMB-ENT-044"
      ],
      "preconditions": [
        "Order is confirmed",
        "Shipping process about to start"
      ],
      "test_data": [
        {
          "field": "orderStatus",
          "value": "confirmed",
          "notes": "About to ship"
        },
        {
          "field": "timing",
          "value": "concurrent",
          "notes": "Race condition test"
        }
      ],
      "steps": [
        "Initiate cancel and ship concurrently",
        "Check final state"
      ],
      "expected_results": [
        "Only one operation succeeds",
        "Consistent final state"
      ]
    },
    {
      "id": "TC-AC-ORDER-006-B02",
      "name": "Cancel order with zero total amount",
      "category": "boundary",
      "ac_ref": "AC-ORDER-006",
      "br_refs": [
        "AMB-OP-030"
      ],
      "preconditions": [
        "Order total is 0 (100% discount)",
        "Order is pending"
      ],
      "test_data": [
        {
          "field": "orderTotal",
          "value": "0.00",
          "notes": "Zero total order"
        }
      ],
      "steps": [
        "Cancel zero-total order"
      ],
      "expected_results": [
        "Order cancelled",
        "No refund initiated (nothing to refund)"
      ]
    },
    {
      "id": "TC-AC-ORDER-006-H01",
      "name": "Cancelled order should NOT appear in active orders",
      "category": "hallucination",
      "ac_ref": "AC-ORDER-006",
      "br_refs": [
        "AMB-OP-028"
      ],
      "preconditions": [
        "Order was cancelled"
      ],
      "test_data": [
        {
          "field": "orderId",
          "value": "ORD-12345",
          "notes": "Cancelled order"
        }
      ],
      "steps": [
        "View active orders list",
        "Search for cancelled order"
      ],
      "expected_results": [
        "Order not in active orders list"
      ],
      "should_not": "Cancelled order should NOT appear in active/pending orders list"
    },
    {
      "id": "TC-AC-ORDER-006-H02",
      "name": "Partial cancellation should NOT be allowed",
      "category": "hallucination",
      "ac_ref": "AC-ORDER-006",
      "br_refs": [
        "AMB-OP-028"
      ],
      "preconditions": [
        "Order has multiple items"
      ],
      "test_data": [
        {
          "field": "orderItems",
          "value": "3",
          "notes": "Multi-item order"
        }
      ],
      "steps": [
        "Attempt to cancel single item from order"
      ],
      "expected_results": [
        "Partial cancellation not available"
      ],
      "should_not": "System should NOT allow cancelling individual items (whole order only)"
    },
    {
      "id": "TC-AC-ORDER-007-P01",
      "name": "Item prices captured at order creation",
      "category": "positive",
      "ac_ref": "AC-ORDER-007",
      "br_refs": [
        "AMB-ENT-019"
      ],
      "preconditions": [
        "Product exists with price $29.99",
        "Customer has items in cart"
      ],
      "test_data": [
        {
          "field": "productPrice",
          "value": "29.99",
          "notes": "Current price"
        },
        {
          "field": "quantity",
          "value": "2",
          "notes": "Ordered quantity"
        }
      ],
      "steps": [
        "Place order",
        "Check order details"
      ],
      "expected_results": [
        "Order shows captured price $29.99 per item"
      ]
    },
    {
      "id": "TC-AC-ORDER-007-P02",
      "name": "Order prices unchanged after product price increase",
      "category": "positive",
      "ac_ref": "AC-ORDER-007",
      "br_refs": [
        "AMB-ENT-019"
      ],
      "preconditions": [
        "Order placed at $29.99",
        "Admin increases price to $39.99"
      ],
      "test_data": [
        {
          "field": "originalPrice",
          "value": "29.99",
          "notes": "Order time price"
        },
        {
          "field": "newPrice",
          "value": "39.99",
          "notes": "Updated catalog price"
        }
      ],
      "steps": [
        "Place order at $29.99",
        "Admin updates price to $39.99",
        "View order"
      ],
      "expected_results": [
        "Order still shows $29.99",
        "Product catalog shows $39.99"
      ]
    },
    {
      "id": "TC-AC-ORDER-007-P03",
      "name": "Order prices unchanged after product price decrease",
      "category": "positive",
      "ac_ref": "AC-ORDER-007",
      "br_refs": [
        "AMB-ENT-019"
      ],
      "preconditions": [
        "Order placed at $29.99",
        "Admin decreases price to $19.99"
      ],
      "test_data": [
        {
          "field": "originalPrice",
          "value": "29.99",
          "notes": "Order time price"
        },
        {
          "field": "newPrice",
          "value": "19.99",
          "notes": "Reduced catalog price"
        }
      ],
      "steps": [
        "Place order at $29.99",
        "Admin updates price to $19.99",
        "View order"
      ],
      "expected_results": [
        "Order still shows $29.99"
      ]
    },
    {
      "id": "TC-AC-ORDER-007-N01",
      "name": "Price snapshot includes discounted prices",
      "category": "negative",
      "ac_ref": "AC-ORDER-007",
      "br_refs": [
        "AMB-ENT-019"
      ],
      "preconditions": [
        "Product on sale at $19.99 (original $29.99)"
      ],
      "test_data": [
        {
          "field": "salePrice",
          "value": "19.99",
          "notes": "Active sale price"
        },
        {
          "field": "originalPrice",
          "value": "29.99",
          "notes": "Regular price"
        }
      ],
      "steps": [
        "Place order during sale",
        "Sale ends",
        "View order"
      ],
      "expected_results": [
        "Order shows sale price $19.99, not original $29.99"
      ]
    },
    {
      "id": "TC-AC-ORDER-007-N02",
      "name": "Reject manual price edit on existing order",
      "category": "negative",
      "ac_ref": "AC-ORDER-007",
      "br_refs": [
        "AMB-ENT-019"
      ],
      "preconditions": [
        "Order exists with captured prices"
      ],
      "test_data": [
        {
          "field": "capturedPrice",
          "value": "29.99",
          "notes": "Original order price"
        }
      ],
      "steps": [
        "Attempt to edit order item price via API",
        "Check order"
      ],
      "expected_results": [
        "Price modification rejected or not available"
      ]
    },
    {
      "id": "TC-AC-ORDER-007-B01",
      "name": "Price snapshot with maximum decimal precision",
      "category": "boundary",
      "ac_ref": "AC-ORDER-007",
      "br_refs": [
        "AMB-ENT-019"
      ],
      "preconditions": [
        "Product price has extended decimals"
      ],
      "test_data": [
        {
          "field": "productPrice",
          "value": "29.999",
          "notes": "3 decimal price"
        }
      ],
      "steps": [
        "Place order with extended decimal price",
        "View order"
      ],
      "expected_results": [
        "Price correctly rounded/captured"
      ]
    },
    {
      "id": "TC-AC-ORDER-007-B02",
      "name": "Price snapshot at zero price (free item)",
      "category": "boundary",
      "ac_ref": "AC-ORDER-007",
      "br_refs": [
        "AMB-ENT-019"
      ],
      "preconditions": [
        "Free promotional item in cart"
      ],
      "test_data": [
        {
          "field": "productPrice",
          "value": "0.00",
          "notes": "Free item"
        }
      ],
      "steps": [
        "Place order with free item",
        "View order details"
      ],
      "expected_results": [
        "Order shows $0.00 for free item"
      ]
    },
    {
      "id": "TC-AC-ORDER-007-H01",
      "name": "Order should NOT auto-update to new prices",
      "category": "hallucination",
      "ac_ref": "AC-ORDER-007",
      "br_refs": [
        "AMB-ENT-019"
      ],
      "preconditions": [
        "Order placed",
        "Product price changed"
      ],
      "test_data": [
        {
          "field": "orderDate",
          "value": "2024-01-01",
          "notes": "Order date"
        },
        {
          "field": "priceChangeDate",
          "value": "2024-01-02",
          "notes": "Price update"
        }
      ],
      "steps": [
        "Check order after price change",
        "Run any batch jobs"
      ],
      "expected_results": [
        "Order prices remain at original captured values"
      ],
      "should_not": "System should NOT have auto-sync or price update feature for orders"
    },
    {
      "id": "TC-AC-ORDER-007-H02",
      "name": "Customer should NOT see current price on order history",
      "category": "hallucination",
      "ac_ref": "AC-ORDER-007",
      "br_refs": [
        "AMB-ENT-019"
      ],
      "preconditions": [
        "Order placed at $29.99",
        "Current price is $39.99"
      ],
      "test_data": [
        {
          "field": "orderPrice",
          "value": "29.99",
          "notes": "Captured"
        },
        {
          "field": "currentPrice",
          "value": "39.99",
          "notes": "Current catalog"
        }
      ],
      "steps": [
        "View order history"
      ],
      "expected_results": [
        "Shows only captured order price"
      ],
      "should_not": "Order history should NOT display current catalog prices"
    },
    {
      "id": "TC-AC-CUST-001-P01",
      "name": "Register with valid email and compliant password",
      "category": "positive",
      "ac_ref": "AC-CUST-001",
      "br_refs": [
        "AMB-ENT-024",
        "AMB-ENT-025"
      ],
      "preconditions": [
        "Email not previously registered"
      ],
      "test_data": [
        {
          "field": "email",
          "value": "newuser@example.com",
          "notes": "Valid email"
        },
        {
          "field": "password",
          "value": "SecurePass1",
          "notes": "8+ chars with number"
        },
        {
          "field": "firstName",
          "value": "John",
          "notes": "Required field"
        },
        {
          "field": "lastName",
          "value": "Doe",
          "notes": "Required field"
        }
      ],
      "steps": [
        "Navigate to registration",
        "Fill all required fields",
        "Submit form"
      ],
      "expected_results": [
        "Account created",
        "Success message displayed"
      ]
    },
    {
      "id": "TC-AC-CUST-001-P02",
      "name": "Verification email sent after registration",
      "category": "positive",
      "ac_ref": "AC-CUST-001",
      "br_refs": [
        "AMB-ENT-026"
      ],
      "preconditions": [
        "Valid registration data"
      ],
      "test_data": [
        {
          "field": "email",
          "value": "verify@example.com",
          "notes": "Email to verify"
        }
      ],
      "steps": [
        "Complete registration",
        "Check email queue"
      ],
      "expected_results": [
        "Verification email queued",
        "Email contains verification link"
      ]
    },
    {
      "id": "TC-AC-CUST-001-P03",
      "name": "User informed to verify email before ordering",
      "category": "positive",
      "ac_ref": "AC-CUST-001",
      "br_refs": [
        "AMB-ENT-030"
      ],
      "preconditions": [
        "User just registered"
      ],
      "test_data": [
        {
          "field": "verificationStatus",
          "value": "pending",
          "notes": "Not yet verified"
        }
      ],
      "steps": [
        "Complete registration",
        "View confirmation page"
      ],
      "expected_results": [
        "Message displayed about email verification requirement"
      ]
    },
    {
      "id": "TC-AC-CUST-001-N01",
      "name": "Reject registration with already used email",
      "category": "negative",
      "ac_ref": "AC-CUST-001",
      "br_refs": [
        "AMB-ENT-024"
      ],
      "preconditions": [
        "Email already exists in system"
      ],
      "test_data": [
        {
          "field": "email",
          "value": "existing@example.com",
          "notes": "Already registered"
        }
      ],
      "steps": [
        "Attempt registration with existing email"
      ],
      "expected_results": [
        "Error: 'Email already in use'",
        "Account not created"
      ]
    },
    {
      "id": "TC-AC-CUST-001-N02",
      "name": "Reject password without number",
      "category": "negative",
      "ac_ref": "AC-CUST-001",
      "br_refs": [
        "AMB-ENT-025"
      ],
      "preconditions": [
        "Registration form open"
      ],
      "test_data": [
        {
          "field": "password",
          "value": "NoNumbers",
          "notes": "Missing number requirement"
        }
      ],
      "steps": [
        "Enter password without number",
        "Submit form"
      ],
      "expected_results": [
        "Error showing password requirements"
      ]
    },
    {
      "id": "TC-AC-CUST-001-N03",
      "name": "Reject password shorter than 8 characters",
      "category": "negative",
      "ac_ref": "AC-CUST-001",
      "br_refs": [
        "AMB-ENT-025"
      ],
      "preconditions": [
        "Registration form open"
      ],
      "test_data": [
        {
          "field": "password",
          "value": "Short1",
          "notes": "Only 6 characters"
        }
      ],
      "steps": [
        "Enter short password",
        "Submit form"
      ],
      "expected_results": [
        "Error: password must be at least 8 characters"
      ]
    },
    {
      "id": "TC-AC-CUST-001-N04",
      "name": "Reject registration with missing required fields",
      "category": "negative",
      "ac_ref": "AC-CUST-001",
      "br_refs": [
        "AMB-ENT-024"
      ],
      "preconditions": [
        "Registration form open"
      ],
      "test_data": [
        {
          "field": "email",
          "value": "test@example.com",
          "notes": "Provided"
        },
        {
          "field": "firstName",
          "value": "",
          "notes": "Missing required field"
        }
      ],
      "steps": [
        "Submit form with missing first name"
      ],
      "expected_results": [
        "Validation error for missing first name"
      ]
    },
    {
      "id": "TC-AC-CUST-001-N05",
      "name": "Reject invalid email format",
      "category": "negative",
      "ac_ref": "AC-CUST-001",
      "br_refs": [
        "AMB-ENT-024"
      ],
      "preconditions": [
        "Registration form open"
      ],
      "test_data": [
        {
          "field": "email",
          "value": "notanemail",
          "notes": "Invalid format"
        }
      ],
      "steps": [
        "Enter invalid email format",
        "Submit form"
      ],
      "expected_results": [
        "Validation error for email format"
      ]
    },
    {
      "id": "TC-AC-CUST-001-B01",
      "name": "Register with exactly 8 character password with number",
      "category": "boundary",
      "ac_ref": "AC-CUST-001",
      "br_refs": [
        "AMB-ENT-025"
      ],
      "preconditions": [
        "Registration form open"
      ],
      "test_data": [
        {
          "field": "password",
          "value": "Abcdefg1",
          "notes": "Exactly 8 chars"
        }
      ],
      "steps": [
        "Enter 8-char password with number",
        "Submit form"
      ],
      "expected_results": [
        "Password accepted",
        "Registration succeeds"
      ]
    },
    {
      "id": "TC-AC-CUST-001-B02",
      "name": "Reject 7 character password even with number",
      "category": "boundary",
      "ac_ref": "AC-CUST-001",
      "br_refs": [
        "AMB-ENT-025"
      ],
      "preconditions": [
        "Registration form open"
      ],
      "test_data": [
        {
          "field": "password",
          "value": "Abcdef1",
          "notes": "Only 7 characters"
        }
      ],
      "steps": [
        "Enter 7-char password",
        "Submit form"
      ],
      "expected_results": [
        "Error: password must be at least 8 characters"
      ]
    },
    {
      "id": "TC-AC-CUST-001-H01",
      "name": "Phone number should NOT be required for registration",
      "category": "hallucination",
      "ac_ref": "AC-CUST-001",
      "br_refs": [
        "AMB-ENT-024"
      ],
      "preconditions": [
        "Registration form open"
      ],
      "test_data": [
        {
          "field": "phone",
          "value": "",
          "notes": "Not provided"
        }
      ],
      "steps": [
        "Register without phone number"
      ],
      "expected_results": [
        "Registration succeeds without phone"
      ],
      "should_not": "System should NOT require phone number (not in spec)"
    },
    {
      "id": "TC-AC-CUST-001-H02",
      "name": "Unverified user should NOT be able to place orders",
      "category": "hallucination",
      "ac_ref": "AC-CUST-001",
      "br_refs": [
        "AMB-ENT-030"
      ],
      "preconditions": [
        "User registered but not verified"
      ],
      "test_data": [
        {
          "field": "verificationStatus",
          "value": "pending",
          "notes": "Not verified"
        }
      ],
      "steps": [
        "Login as unverified user",
        "Attempt to place order"
      ],
      "expected_results": [
        "Order placement blocked",
        "Prompt to verify email"
      ],
      "should_not": "Unverified users should NOT be able to complete orders"
    },
    {
      "id": "TC-AC-CUST-002-P01",
      "name": "Add shipping address with all required fields",
      "category": "positive",
      "ac_ref": "AC-CUST-002",
      "br_refs": [
        "AMB-ENT-027",
        "AMB-ENT-031"
      ],
      "preconditions": [
        "Customer is logged in",
        "Profile management page open"
      ],
      "test_data": [
        {
          "field": "street",
          "value": "123 Main St",
          "notes": "Valid street"
        },
        {
          "field": "city",
          "value": "New York",
          "notes": "Valid city"
        },
        {
          "field": "state",
          "value": "NY",
          "notes": "Valid state"
        },
        {
          "field": "postalCode",
          "value": "10001",
          "notes": "Valid postal"
        },
        {
          "field": "country",
          "value": "USA",
          "notes": "Valid country"
        },
        {
          "field": "recipientName",
          "value": "John Doe",
          "notes": "Required"
        }
      ],
      "steps": [
        "Navigate to addresses",
        "Click add address",
        "Fill all fields",
        "Save"
      ],
      "expected_results": [
        "Address saved to account",
        "Address appears in list"
      ]
    },
    {
      "id": "TC-AC-CUST-002-P02",
      "name": "Set address as default",
      "category": "positive",
      "ac_ref": "AC-CUST-002",
      "br_refs": [
        "AMB-ENT-032"
      ],
      "preconditions": [
        "Customer has at least one address"
      ],
      "test_data": [
        {
          "field": "isDefault",
          "value": "true",
          "notes": "Set as default"
        }
      ],
      "steps": [
        "Add new address",
        "Check 'set as default'",
        "Save"
      ],
      "expected_results": [
        "Address marked as default",
        "Previous default unmarked"
      ]
    },
    {
      "id": "TC-AC-CUST-002-P03",
      "name": "Add multiple addresses to account",
      "category": "positive",
      "ac_ref": "AC-CUST-002",
      "br_refs": [
        "AMB-ENT-027"
      ],
      "preconditions": [
        "Customer has one existing address"
      ],
      "test_data": [
        {
          "field": "addressCount",
          "value": "2",
          "notes": "Second address"
        }
      ],
      "steps": [
        "Add second address",
        "Save"
      ],
      "expected_results": [
        "Both addresses visible in list"
      ]
    },
    {
      "id": "TC-AC-CUST-002-N01",
      "name": "Reject address with missing required fields",
      "category": "negative",
      "ac_ref": "AC-CUST-002",
      "br_refs": [
        "AMB-ENT-031"
      ],
      "preconditions": [
        "Add address form open"
      ],
      "test_data": [
        {
          "field": "city",
          "value": "",
          "notes": "Missing required field"
        }
      ],
      "steps": [
        "Submit address without city"
      ],
      "expected_results": [
        "Validation error for missing city"
      ]
    },
    {
      "id": "TC-AC-CUST-002-N02",
      "name": "Reject invalid postal code format",
      "category": "negative",
      "ac_ref": "AC-CUST-002",
      "br_refs": [
        "AMB-ENT-033"
      ],
      "preconditions": [
        "Add address form open",
        "Country is USA"
      ],
      "test_data": [
        {
          "field": "postalCode",
          "value": "ABCDE",
          "notes": "Invalid US postal"
        }
      ],
      "steps": [
        "Enter invalid postal code",
        "Submit form"
      ],
      "expected_results": [
        "Error: invalid postal code format"
      ]
    },
    {
      "id": "TC-AC-CUST-002-N03",
      "name": "Reject address without recipient name",
      "category": "negative",
      "ac_ref": "AC-CUST-002",
      "br_refs": [
        "AMB-ENT-031"
      ],
      "preconditions": [
        "Add address form open"
      ],
      "test_data": [
        {
          "field": "recipientName",
          "value": "",
          "notes": "Missing recipient"
        }
      ],
      "steps": [
        "Submit address without recipient name"
      ],
      "expected_results": [
        "Validation error for missing recipient name"
      ]
    },
    {
      "id": "TC-AC-CUST-002-B01",
      "name": "Add address with minimum length values",
      "category": "boundary",
      "ac_ref": "AC-CUST-002",
      "br_refs": [
        "AMB-ENT-027"
      ],
      "preconditions": [
        "Add address form open"
      ],
      "test_data": [
        {
          "field": "street",
          "value": "1 A",
          "notes": "Minimum street"
        },
        {
          "field": "city",
          "value": "LA",
          "notes": "2 char city"
        }
      ],
      "steps": [
        "Enter minimum length values",
        "Submit form"
      ],
      "expected_results": [
        "Address saved successfully"
      ]
    },
    {
      "id": "TC-AC-CUST-002-B02",
      "name": "Validate postal code for different countries",
      "category": "boundary",
      "ac_ref": "AC-CUST-002",
      "br_refs": [
        "AMB-ENT-033"
      ],
      "preconditions": [
        "Add address form open"
      ],
      "test_data": [
        {
          "field": "country",
          "value": "Canada",
          "notes": "Different format"
        },
        {
          "field": "postalCode",
          "value": "K1A 0B1",
          "notes": "Canadian postal"
        }
      ],
      "steps": [
        "Select Canada",
        "Enter Canadian postal code",
        "Submit"
      ],
      "expected_results": [
        "Canadian postal format accepted"
      ]
    },
    {
      "id": "TC-AC-CUST-002-H01",
      "name": "Billing address should NOT be required for shipping",
      "category": "hallucination",
      "ac_ref": "AC-CUST-002",
      "br_refs": [
        "AMB-ENT-027"
      ],
      "preconditions": [
        "Add shipping address form open"
      ],
      "test_data": [
        {
          "field": "billingAddress",
          "value": "",
          "notes": "Not provided"
        }
      ],
      "steps": [
        "Add shipping address only"
      ],
      "expected_results": [
        "Shipping address saved without billing"
      ],
      "should_not": "System should NOT require billing address when adding shipping"
    },
    {
      "id": "TC-AC-CUST-002-H02",
      "name": "Email should NOT be required per address",
      "category": "hallucination",
      "ac_ref": "AC-CUST-002",
      "br_refs": [
        "AMB-ENT-027"
      ],
      "preconditions": [
        "Add address form open"
      ],
      "test_data": [
        {
          "field": "addressEmail",
          "value": "",
          "notes": "Not in spec"
        }
      ],
      "steps": [
        "Add address without separate email field"
      ],
      "expected_results": [
        "Address saved without requiring email"
      ],
      "should_not": "System should NOT require email field for each address"
    },
    {
      "id": "TC-AC-CUST-003-P01",
      "name": "Add Visa card via Stripe tokenization",
      "category": "positive",
      "ac_ref": "AC-CUST-003",
      "br_refs": [
        "AMB-ENT-028",
        "AMB-ENT-034"
      ],
      "preconditions": [
        "Customer logged in",
        "Stripe integration active"
      ],
      "test_data": [
        {
          "field": "cardType",
          "value": "Visa",
          "notes": "Supported type"
        },
        {
          "field": "cardNumber",
          "value": "4242424242424242",
          "notes": "Stripe test card"
        }
      ],
      "steps": [
        "Navigate to payment methods",
        "Add card",
        "Enter Visa details",
        "Save"
      ],
      "expected_results": [
        "Card tokenized via Stripe",
        "Saved to account"
      ]
    },
    {
      "id": "TC-AC-CUST-003-P02",
      "name": "Add PayPal payment method",
      "category": "positive",
      "ac_ref": "AC-CUST-003",
      "br_refs": [
        "AMB-ENT-028"
      ],
      "preconditions": [
        "Customer logged in",
        "PayPal integration active"
      ],
      "test_data": [
        {
          "field": "paymentType",
          "value": "PayPal",
          "notes": "PayPal option"
        }
      ],
      "steps": [
        "Select PayPal",
        "Complete PayPal authorization",
        "Save"
      ],
      "expected_results": [
        "PayPal linked to account"
      ]
    },
    {
      "id": "TC-AC-CUST-003-P03",
      "name": "Set payment method as default",
      "category": "positive",
      "ac_ref": "AC-CUST-003",
      "br_refs": [
        "AMB-ENT-036"
      ],
      "preconditions": [
        "Customer has existing payment method"
      ],
      "test_data": [
        {
          "field": "isDefault",
          "value": "true",
          "notes": "Set as default"
        }
      ],
      "steps": [
        "Add new payment method",
        "Check 'set as default'",
        "Save"
      ],
      "expected_results": [
        "New method is default",
        "Previous default unmarked"
      ]
    },
    {
      "id": "TC-AC-CUST-003-P04",
      "name": "Add Mastercard via Stripe",
      "category": "positive",
      "ac_ref": "AC-CUST-003",
      "br_refs": [
        "AMB-ENT-034"
      ],
      "preconditions": [
        "Customer logged in"
      ],
      "test_data": [
        {
          "field": "cardType",
          "value": "Mastercard",
          "notes": "Supported type"
        },
        {
          "field": "cardNumber",
          "value": "5555555555554444",
          "notes": "MC test card"
        }
      ],
      "steps": [
        "Add Mastercard details",
        "Save"
      ],
      "expected_results": [
        "Mastercard tokenized and saved"
      ]
    },
    {
      "id": "TC-AC-CUST-003-N01",
      "name": "Reject invalid card number",
      "category": "negative",
      "ac_ref": "AC-CUST-003",
      "br_refs": [
        "AMB-ENT-035"
      ],
      "preconditions": [
        "Add payment form open"
      ],
      "test_data": [
        {
          "field": "cardNumber",
          "value": "1234567890123456",
          "notes": "Invalid card"
        }
      ],
      "steps": [
        "Enter invalid card number",
        "Attempt to save"
      ],
      "expected_results": [
        "Error from payment gateway displayed"
      ]
    },
    {
      "id": "TC-AC-CUST-003-N02",
      "name": "Reject unsupported card type (Discover)",
      "category": "negative",
      "ac_ref": "AC-CUST-003",
      "br_refs": [
        "AMB-ENT-034"
      ],
      "preconditions": [
        "Add payment form open"
      ],
      "test_data": [
        {
          "field": "cardType",
          "value": "Discover",
          "notes": "Not in supported list"
        }
      ],
      "steps": [
        "Attempt to add Discover card"
      ],
      "expected_results": [
        "Error: show supported card types (Visa, MC, Amex)"
      ]
    },
    {
      "id": "TC-AC-CUST-003-N03",
      "name": "Reject expired card",
      "category": "negative",
      "ac_ref": "AC-CUST-003",
      "br_refs": [
        "AMB-ENT-035"
      ],
      "preconditions": [
        "Add payment form open"
      ],
      "test_data": [
        {
          "field": "expiryDate",
          "value": "01/2020",
          "notes": "Expired date"
        }
      ],
      "steps": [
        "Enter expired card details",
        "Attempt to save"
      ],
      "expected_results": [
        "Error: card expired"
      ]
    },
    {
      "id": "TC-AC-CUST-003-B01",
      "name": "Add card expiring this month",
      "category": "boundary",
      "ac_ref": "AC-CUST-003",
      "br_refs": [
        "AMB-ENT-035"
      ],
      "preconditions": [
        "Add payment form open"
      ],
      "test_data": [
        {
          "field": "expiryDate",
          "value": "current month/year",
          "notes": "Edge of expiry"
        }
      ],
      "steps": [
        "Enter card expiring this month",
        "Save"
      ],
      "expected_results": [
        "Card accepted (still valid)"
      ]
    },
    {
      "id": "TC-AC-CUST-003-B02",
      "name": "Reject card expiring last month",
      "category": "boundary",
      "ac_ref": "AC-CUST-003",
      "br_refs": [
        "AMB-ENT-035"
      ],
      "preconditions": [
        "Add payment form open"
      ],
      "test_data": [
        {
          "field": "expiryDate",
          "value": "last month",
          "notes": "Just expired"
        }
      ],
      "steps": [
        "Enter card expired last month",
        "Save"
      ],
      "expected_results": [
        "Error: card expired"
      ]
    },
    {
      "id": "TC-AC-CUST-003-H01",
      "name": "Raw card numbers should NOT be stored in database",
      "category": "hallucination",
      "ac_ref": "AC-CUST-003",
      "br_refs": [
        "AMB-ENT-028"
      ],
      "preconditions": [
        "Card has been added"
      ],
      "test_data": [
        {
          "field": "cardNumber",
          "value": "4242424242424242",
          "notes": "Original card"
        }
      ],
      "steps": [
        "Add card",
        "Query database directly"
      ],
      "expected_results": [
        "Only token stored, no raw card number"
      ],
      "should_not": "System should NOT store raw card numbers (only tokens)"
    },
    {
      "id": "TC-AC-CUST-003-H02",
      "name": "Bank account/ACH should NOT be supported",
      "category": "hallucination",
      "ac_ref": "AC-CUST-003",
      "br_refs": [
        "AMB-ENT-028"
      ],
      "preconditions": [
        "Payment methods page"
      ],
      "test_data": [
        {
          "field": "paymentType",
          "value": "ACH",
          "notes": "Bank transfer"
        }
      ],
      "steps": [
        "Check available payment method options"
      ],
      "expected_results": [
        "ACH/bank account option not available"
      ],
      "should_not": "System should NOT offer ACH/bank account (not in spec)"
    },
    {
      "id": "TC-AC-CUST-004-P01",
      "name": "Soft delete customer account on preference selection",
      "category": "positive",
      "ac_ref": "AC-CUST-004",
      "br_refs": [
        "BR-CUST"
      ],
      "preconditions": [
        "Customer is registered",
        "Customer has no pending orders"
      ],
      "test_data": [
        {
          "field": "customerId",
          "value": "cust-123",
          "notes": "Valid customer"
        },
        {
          "field": "deletionType",
          "value": "soft_delete",
          "notes": "Deactivation preference"
        }
      ],
      "steps": [
        "Login as customer",
        "Navigate to account settings",
        "Request account deletion",
        "Select soft delete option",
        "Confirm deletion"
      ],
      "expected_results": [
        "Account status changed to deactivated",
        "Customer cannot login",
        "Data preserved in system"
      ]
    },
    {
      "id": "TC-AC-CUST-004-P02",
      "name": "Full GDPR erasure on customer preference",
      "category": "positive",
      "ac_ref": "AC-CUST-004",
      "br_refs": [
        "BR-CUST"
      ],
      "preconditions": [
        "Customer is registered",
        "No pending orders exist"
      ],
      "test_data": [
        {
          "field": "customerId",
          "value": "cust-456",
          "notes": "Valid customer"
        },
        {
          "field": "deletionType",
          "value": "full_erasure",
          "notes": "GDPR erasure preference"
        }
      ],
      "steps": [
        "Login as customer",
        "Navigate to account settings",
        "Request account deletion",
        "Select full erasure option",
        "Confirm deletion"
      ],
      "expected_results": [
        "All personal data permanently deleted",
        "Anonymized records for order history",
        "Confirmation sent"
      ]
    },
    {
      "id": "TC-AC-CUST-004-P03",
      "name": "Deletion confirmation required before processing",
      "category": "positive",
      "ac_ref": "AC-CUST-004",
      "br_refs": [
        "BR-CUST"
      ],
      "preconditions": [
        "Customer logged in",
        "No pending orders"
      ],
      "test_data": [
        {
          "field": "customerId",
          "value": "cust-789",
          "notes": "Valid customer"
        }
      ],
      "steps": [
        "Request account deletion",
        "System displays confirmation dialog",
        "Customer confirms"
      ],
      "expected_results": [
        "Deletion only proceeds after explicit confirmation"
      ]
    },
    {
      "id": "TC-AC-CUST-004-N01",
      "name": "Block deletion when customer has pending orders",
      "category": "negative",
      "ac_ref": "AC-CUST-004",
      "br_refs": [
        "BR-CUST"
      ],
      "preconditions": [
        "Customer is registered",
        "Customer has pending order"
      ],
      "test_data": [
        {
          "field": "customerId",
          "value": "cust-111",
          "notes": "Customer with pending order"
        },
        {
          "field": "orderStatus",
          "value": "pending",
          "notes": "Blocking condition"
        }
      ],
      "steps": [
        "Login as customer with pending order",
        "Request account deletion"
      ],
      "expected_results": [
        "Deletion blocked",
        "Error message displayed",
        "Order completion required"
      ]
    },
    {
      "id": "TC-AC-CUST-004-N02",
      "name": "Block deletion when orders are in processing state",
      "category": "negative",
      "ac_ref": "AC-CUST-004",
      "br_refs": [
        "BR-CUST"
      ],
      "preconditions": [
        "Customer has order in processing"
      ],
      "test_data": [
        {
          "field": "customerId",
          "value": "cust-222",
          "notes": "Customer with processing order"
        },
        {
          "field": "orderStatus",
          "value": "processing",
          "notes": "Incomplete order"
        }
      ],
      "steps": [
        "Login as customer",
        "Request deletion with processing order"
      ],
      "expected_results": [
        "Deletion blocked",
        "Shows list of incomplete orders"
      ]
    },
    {
      "id": "TC-AC-CUST-004-N03",
      "name": "Reject deletion without confirmation",
      "category": "negative",
      "ac_ref": "AC-CUST-004",
      "br_refs": [
        "BR-CUST"
      ],
      "preconditions": [
        "Customer is registered"
      ],
      "test_data": [
        {
          "field": "customerId",
          "value": "cust-333",
          "notes": "Valid customer"
        }
      ],
      "steps": [
        "Request account deletion",
        "Cancel at confirmation dialog"
      ],
      "expected_results": [
        "Account remains active",
        "No data modified"
      ]
    },
    {
      "id": "TC-AC-CUST-004-B01",
      "name": "Delete account immediately after last order completes",
      "category": "boundary",
      "ac_ref": "AC-CUST-004",
      "br_refs": [
        "BR-CUST"
      ],
      "preconditions": [
        "Customer has one order just completed"
      ],
      "test_data": [
        {
          "field": "customerId",
          "value": "cust-444",
          "notes": "Customer with just-completed order"
        },
        {
          "field": "orderStatus",
          "value": "completed",
          "notes": "Just transitioned"
        }
      ],
      "steps": [
        "Complete last pending order",
        "Immediately request deletion"
      ],
      "expected_results": [
        "Deletion allowed",
        "No blocking error shown"
      ]
    },
    {
      "id": "TC-AC-CUST-004-H01",
      "name": "Soft-deleted customer should NOT appear in active lists",
      "category": "hallucination",
      "ac_ref": "AC-CUST-004",
      "br_refs": [
        "BR-CUST"
      ],
      "preconditions": [
        "Customer account soft-deleted"
      ],
      "test_data": [
        {
          "field": "customerId",
          "value": "cust-555",
          "notes": "Soft-deleted customer"
        }
      ],
      "steps": [
        "Soft delete customer",
        "Search active customers",
        "View customer lists"
      ],
      "expected_results": [
        "Customer not in active lists"
      ],
      "should_not": "Soft-deleted customer should NOT appear in active customer searches"
    },
    {
      "id": "TC-AC-CUST-004-H02",
      "name": "GDPR erased data should NOT be recoverable",
      "category": "hallucination",
      "ac_ref": "AC-CUST-004",
      "br_refs": [
        "BR-CUST"
      ],
      "preconditions": [
        "Customer selected full erasure"
      ],
      "test_data": [
        {
          "field": "customerId",
          "value": "cust-666",
          "notes": "GDPR erased customer"
        }
      ],
      "steps": [
        "Perform full GDPR erasure",
        "Attempt to access old customer data"
      ],
      "expected_results": [
        "No personal data retrievable"
      ],
      "should_not": "Erased personal data should NOT be recoverable by any means"
    },
    {
      "id": "TC-AC-ADMIN-001-P01",
      "name": "Create product with all valid required fields",
      "category": "positive",
      "ac_ref": "AC-ADMIN-001",
      "br_refs": [
        "BR-ADMIN",
        "BR-PROD"
      ],
      "preconditions": [
        "Admin logged in",
        "On product management interface"
      ],
      "test_data": [
        {
          "field": "name",
          "value": "Test Product",
          "notes": "Valid 12 chars"
        },
        {
          "field": "description",
          "value": "Product description",
          "notes": "Valid length"
        },
        {
          "field": "price",
          "value": "19.99",
          "notes": "Above minimum"
        },
        {
          "field": "category",
          "value": "Electronics",
          "notes": "Valid category"
        }
      ],
      "steps": [
        "Navigate to add product",
        "Enter valid name",
        "Enter description",
        "Set price",
        "Select category",
        "Submit"
      ],
      "expected_results": [
        "Product created with UUID",
        "Status is draft",
        "Creator logged",
        "Timestamp recorded"
      ]
    },
    {
      "id": "TC-AC-ADMIN-001-P02",
      "name": "Create product with images and primary image set",
      "category": "positive",
      "ac_ref": "AC-ADMIN-001",
      "br_refs": [
        "BR-ADMIN",
        "BR-PROD"
      ],
      "preconditions": [
        "Admin logged in"
      ],
      "test_data": [
        {
          "field": "name",
          "value": "Product With Images",
          "notes": "Valid name"
        },
        {
          "field": "images",
          "value": "5 images",
          "notes": "Within limit"
        },
        {
          "field": "primaryImage",
          "value": "image_3",
          "notes": "Third image as primary"
        }
      ],
      "steps": [
        "Create product",
        "Upload 5 images",
        "Mark third as primary",
        "Submit"
      ],
      "expected_results": [
        "Product created",
        "5 images attached",
        "Primary image correctly set"
      ]
    },
    {
      "id": "TC-AC-ADMIN-001-P03",
      "name": "Duplicate name shows warning but allows creation",
      "category": "positive",
      "ac_ref": "AC-ADMIN-001",
      "br_refs": [
        "BR-ADMIN",
        "BR-PROD"
      ],
      "preconditions": [
        "Product with same name exists"
      ],
      "test_data": [
        {
          "field": "name",
          "value": "Existing Product",
          "notes": "Duplicate name"
        },
        {
          "field": "price",
          "value": "29.99",
          "notes": "Valid price"
        }
      ],
      "steps": [
        "Enter duplicate product name",
        "Submit product"
      ],
      "expected_results": [
        "Warning displayed",
        "Product created successfully",
        "Both products exist"
      ]
    },
    {
      "id": "TC-AC-ADMIN-001-N01",
      "name": "Reject product with name too short",
      "category": "negative",
      "ac_ref": "AC-ADMIN-001",
      "br_refs": [
        "BR-ADMIN",
        "BR-PROD"
      ],
      "preconditions": [
        "Admin on add product form"
      ],
      "test_data": [
        {
          "field": "name",
          "value": "A",
          "notes": "1 char - below minimum 2"
        }
      ],
      "steps": [
        "Enter single character name",
        "Submit form"
      ],
      "expected_results": [
        "Validation error shown",
        "Product not created"
      ]
    },
    {
      "id": "TC-AC-ADMIN-001-N02",
      "name": "Reject product with name too long",
      "category": "negative",
      "ac_ref": "AC-ADMIN-001",
      "br_refs": [
        "BR-ADMIN",
        "BR-PROD"
      ],
      "preconditions": [
        "Admin on add product form"
      ],
      "test_data": [
        {
          "field": "name",
          "value": "201 character string",
          "notes": "Exceeds 200 char limit"
        }
      ],
      "steps": [
        "Enter 201 character name",
        "Submit form"
      ],
      "expected_results": [
        "Length validation error shown",
        "Product not created"
      ]
    },
    {
      "id": "TC-AC-ADMIN-001-N03",
      "name": "Reject product with price below minimum",
      "category": "negative",
      "ac_ref": "AC-ADMIN-001",
      "br_refs": [
        "BR-ADMIN",
        "BR-PROD"
      ],
      "preconditions": [
        "Admin on add product form"
      ],
      "test_data": [
        {
          "field": "price",
          "value": "0.00",
          "notes": "Below $0.01 minimum"
        }
      ],
      "steps": [
        "Enter valid name",
        "Set price to $0.00",
        "Submit"
      ],
      "expected_results": [
        "Error: Price must be at least $0.01",
        "Product not created"
      ]
    },
    {
      "id": "TC-AC-ADMIN-001-N04",
      "name": "Reject product without category",
      "category": "negative",
      "ac_ref": "AC-ADMIN-001",
      "br_refs": [
        "BR-ADMIN",
        "BR-PROD"
      ],
      "preconditions": [
        "Admin on add product form"
      ],
      "test_data": [
        {
          "field": "category",
          "value": "null",
          "notes": "No category selected"
        }
      ],
      "steps": [
        "Enter valid name and price",
        "Leave category empty",
        "Submit"
      ],
      "expected_results": [
        "Error: Category is required",
        "Product not created"
      ]
    },
    {
      "id": "TC-AC-ADMIN-001-B01",
      "name": "Create product with minimum name length (2 chars)",
      "category": "boundary",
      "ac_ref": "AC-ADMIN-001",
      "br_refs": [
        "BR-ADMIN",
        "BR-PROD"
      ],
      "preconditions": [
        "Admin logged in"
      ],
      "test_data": [
        {
          "field": "name",
          "value": "AB",
          "notes": "Exactly 2 chars - minimum"
        }
      ],
      "steps": [
        "Enter 2 character name",
        "Fill other required fields",
        "Submit"
      ],
      "expected_results": [
        "Product created successfully"
      ]
    },
    {
      "id": "TC-AC-ADMIN-001-B02",
      "name": "Create product with maximum name length (200 chars)",
      "category": "boundary",
      "ac_ref": "AC-ADMIN-001",
      "br_refs": [
        "BR-ADMIN",
        "BR-PROD"
      ],
      "preconditions": [
        "Admin logged in"
      ],
      "test_data": [
        {
          "field": "name",
          "value": "200 character string",
          "notes": "Exactly 200 chars"
        }
      ],
      "steps": [
        "Enter exactly 200 character name",
        "Submit"
      ],
      "expected_results": [
        "Product created successfully"
      ]
    },
    {
      "id": "TC-AC-ADMIN-001-B03",
      "name": "Create product with minimum price ($0.01)",
      "category": "boundary",
      "ac_ref": "AC-ADMIN-001",
      "br_refs": [
        "BR-ADMIN",
        "BR-PROD"
      ],
      "preconditions": [
        "Admin logged in"
      ],
      "test_data": [
        {
          "field": "price",
          "value": "0.01",
          "notes": "Exactly minimum price"
        }
      ],
      "steps": [
        "Enter valid name",
        "Set price to $0.01",
        "Submit"
      ],
      "expected_results": [
        "Product created with $0.01 price"
      ]
    },
    {
      "id": "TC-AC-ADMIN-001-B04",
      "name": "Upload maximum 10 images to product",
      "category": "boundary",
      "ac_ref": "AC-ADMIN-001",
      "br_refs": [
        "BR-ADMIN",
        "BR-PROD"
      ],
      "preconditions": [
        "Admin creating product"
      ],
      "test_data": [
        {
          "field": "images",
          "value": "10 images",
          "notes": "Maximum allowed"
        }
      ],
      "steps": [
        "Create product",
        "Upload exactly 10 images",
        "Submit"
      ],
      "expected_results": [
        "All 10 images attached successfully"
      ]
    },
    {
      "id": "TC-AC-ADMIN-001-B05",
      "name": "Reject uploading 11th image",
      "category": "boundary",
      "ac_ref": "AC-ADMIN-001",
      "br_refs": [
        "BR-ADMIN",
        "BR-PROD"
      ],
      "preconditions": [
        "Product has 10 images"
      ],
      "test_data": [
        {
          "field": "images",
          "value": "11 images",
          "notes": "Exceeds maximum"
        }
      ],
      "steps": [
        "Upload 10 images",
        "Attempt to upload 11th"
      ],
      "expected_results": [
        "11th image rejected",
        "Error message shown"
      ]
    },
    {
      "id": "TC-AC-ADMIN-001-B06",
      "name": "Maximum description length (5000 chars)",
      "category": "boundary",
      "ac_ref": "AC-ADMIN-001",
      "br_refs": [
        "BR-ADMIN",
        "BR-PROD"
      ],
      "preconditions": [
        "Admin on add product form"
      ],
      "test_data": [
        {
          "field": "description",
          "value": "5000 char string",
          "notes": "Maximum allowed"
        }
      ],
      "steps": [
        "Enter 5000 character description",
        "Submit"
      ],
      "expected_results": [
        "Product created with full description"
      ]
    },
    {
      "id": "TC-AC-ADMIN-001-H01",
      "name": "Draft product should NOT appear in customer catalog",
      "category": "hallucination",
      "ac_ref": "AC-ADMIN-001",
      "br_refs": [
        "BR-ADMIN",
        "BR-PROD"
      ],
      "preconditions": [
        "New product in draft status"
      ],
      "test_data": [
        {
          "field": "status",
          "value": "draft",
          "notes": "Initial status"
        }
      ],
      "steps": [
        "Create product in draft",
        "Browse catalog as customer"
      ],
      "expected_results": [
        "Product not visible to customers"
      ],
      "should_not": "Draft products should NOT be visible in customer-facing catalog"
    },
    {
      "id": "TC-AC-ADMIN-001-H02",
      "name": "Product should NOT require SKU field",
      "category": "hallucination",
      "ac_ref": "AC-ADMIN-001",
      "br_refs": [
        "BR-ADMIN",
        "BR-PROD"
      ],
      "preconditions": [
        "Admin on add product form"
      ],
      "test_data": [
        {
          "field": "sku",
          "value": "null",
          "notes": "Not in requirements"
        }
      ],
      "steps": [
        "Create product without SKU",
        "Submit with required fields only"
      ],
      "expected_results": [
        "Product created without SKU"
      ],
      "should_not": "System should NOT require SKU as it is not in requirements"
    },
    {
      "id": "TC-AC-ADMIN-002-P01",
      "name": "Update product attributes successfully",
      "category": "positive",
      "ac_ref": "AC-ADMIN-002",
      "br_refs": [
        "BR-ADMIN",
        "BR-PROD"
      ],
      "preconditions": [
        "Product exists",
        "Admin logged in"
      ],
      "test_data": [
        {
          "field": "productId",
          "value": "prod-123",
          "notes": "Existing product"
        },
        {
          "field": "newPrice",
          "value": "29.99",
          "notes": "Updated price"
        }
      ],
      "steps": [
        "Open product for editing",
        "Modify price",
        "Save changes"
      ],
      "expected_results": [
        "Product updated",
        "Modified by admin recorded",
        "Timestamp updated"
      ]
    },
    {
      "id": "TC-AC-ADMIN-002-P02",
      "name": "Price change logged in audit trail",
      "category": "positive",
      "ac_ref": "AC-ADMIN-002",
      "br_refs": [
        "BR-ADMIN",
        "BR-PROD"
      ],
      "preconditions": [
        "Product exists with price $19.99"
      ],
      "test_data": [
        {
          "field": "oldPrice",
          "value": "19.99",
          "notes": "Original price"
        },
        {
          "field": "newPrice",
          "value": "24.99",
          "notes": "New price"
        }
      ],
      "steps": [
        "Edit product",
        "Change price from $19.99 to $24.99",
        "Save"
      ],
      "expected_results": [
        "Audit trail shows old and new price",
        "Change timestamp recorded"
      ]
    },
    {
      "id": "TC-AC-ADMIN-002-P03",
      "name": "Cart prices reflect updated product price",
      "category": "positive",
      "ac_ref": "AC-ADMIN-002",
      "br_refs": [
        "BR-ADMIN",
        "BR-PROD"
      ],
      "preconditions": [
        "Product in customer cart",
        "Admin updates price"
      ],
      "test_data": [
        {
          "field": "oldPrice",
          "value": "19.99",
          "notes": "Price when added to cart"
        },
        {
          "field": "newPrice",
          "value": "24.99",
          "notes": "Updated price"
        }
      ],
      "steps": [
        "Customer adds product to cart",
        "Admin updates price",
        "Customer views cart"
      ],
      "expected_results": [
        "Cart shows new price $24.99",
        "Cart total recalculated"
      ]
    },
    {
      "id": "TC-AC-ADMIN-002-N01",
      "name": "Concurrent edit shows conflict warning",
      "category": "negative",
      "ac_ref": "AC-ADMIN-002",
      "br_refs": [
        "BR-ADMIN",
        "BR-PROD"
      ],
      "preconditions": [
        "Two admins editing same product"
      ],
      "test_data": [
        {
          "field": "admin1",
          "value": "admin-A",
          "notes": "First editor"
        },
        {
          "field": "admin2",
          "value": "admin-B",
          "notes": "Second editor"
        }
      ],
      "steps": [
        "Admin A opens product",
        "Admin B opens same product",
        "Admin A saves",
        "Admin B saves"
      ],
      "expected_results": [
        "Admin B sees conflict warning",
        "Last write persisted"
      ]
    },
    {
      "id": "TC-AC-ADMIN-002-N02",
      "name": "Reject edit with invalid name length",
      "category": "negative",
      "ac_ref": "AC-ADMIN-002",
      "br_refs": [
        "BR-ADMIN",
        "BR-PROD"
      ],
      "preconditions": [
        "Product exists"
      ],
      "test_data": [
        {
          "field": "name",
          "value": "X",
          "notes": "Too short - 1 char"
        }
      ],
      "steps": [
        "Edit product",
        "Change name to single character",
        "Save"
      ],
      "expected_results": [
        "Validation error shown",
        "Changes not saved"
      ]
    },
    {
      "id": "TC-AC-ADMIN-002-N03",
      "name": "Reject edit with price below minimum",
      "category": "negative",
      "ac_ref": "AC-ADMIN-002",
      "br_refs": [
        "BR-ADMIN",
        "BR-PROD"
      ],
      "preconditions": [
        "Product exists"
      ],
      "test_data": [
        {
          "field": "price",
          "value": "0.00",
          "notes": "Below $0.01 minimum"
        }
      ],
      "steps": [
        "Edit product",
        "Set price to $0.00",
        "Save"
      ],
      "expected_results": [
        "Price validation error",
        "Original price retained"
      ]
    },
    {
      "id": "TC-AC-ADMIN-002-B01",
      "name": "Edit product name to exactly 2 characters",
      "category": "boundary",
      "ac_ref": "AC-ADMIN-002",
      "br_refs": [
        "BR-ADMIN",
        "BR-PROD"
      ],
      "preconditions": [
        "Product exists"
      ],
      "test_data": [
        {
          "field": "name",
          "value": "AB",
          "notes": "Minimum 2 chars"
        }
      ],
      "steps": [
        "Edit product",
        "Change name to 2 characters",
        "Save"
      ],
      "expected_results": [
        "Product updated successfully"
      ]
    },
    {
      "id": "TC-AC-ADMIN-002-B02",
      "name": "Edit product price to minimum $0.01",
      "category": "boundary",
      "ac_ref": "AC-ADMIN-002",
      "br_refs": [
        "BR-ADMIN",
        "BR-PROD"
      ],
      "preconditions": [
        "Product exists with higher price"
      ],
      "test_data": [
        {
          "field": "price",
          "value": "0.01",
          "notes": "Minimum valid price"
        }
      ],
      "steps": [
        "Edit product",
        "Set price to $0.01",
        "Save"
      ],
      "expected_results": [
        "Product updated with $0.01 price",
        "Audit trail logged"
      ]
    },
    {
      "id": "TC-AC-ADMIN-002-H01",
      "name": "Non-price changes should NOT appear in price audit",
      "category": "hallucination",
      "ac_ref": "AC-ADMIN-002",
      "br_refs": [
        "BR-ADMIN",
        "BR-PROD"
      ],
      "preconditions": [
        "Product exists"
      ],
      "test_data": [
        {
          "field": "description",
          "value": "New description",
          "notes": "Non-price change"
        }
      ],
      "steps": [
        "Edit product description only",
        "Save",
        "Check audit trail"
      ],
      "expected_results": [
        "No price audit entry created"
      ],
      "should_not": "Description-only changes should NOT create price audit entries"
    },
    {
      "id": "TC-AC-ADMIN-002-H02",
      "name": "Edit should NOT change product UUID",
      "category": "hallucination",
      "ac_ref": "AC-ADMIN-002",
      "br_refs": [
        "BR-ADMIN",
        "BR-PROD"
      ],
      "preconditions": [
        "Product exists with UUID"
      ],
      "test_data": [
        {
          "field": "originalUUID",
          "value": "uuid-abc-123",
          "notes": "Original ID"
        }
      ],
      "steps": [
        "Note product UUID",
        "Edit and save product",
        "Check UUID"
      ],
      "expected_results": [
        "UUID unchanged after edit"
      ],
      "should_not": "Product UUID should NOT change when editing"
    },
    {
      "id": "TC-AC-ADMIN-003-P01",
      "name": "Soft delete product preserves order history",
      "category": "positive",
      "ac_ref": "AC-ADMIN-003",
      "br_refs": [
        "BR-ADMIN",
        "BR-PROD"
      ],
      "preconditions": [
        "Product exists",
        "Product has order history"
      ],
      "test_data": [
        {
          "field": "productId",
          "value": "prod-456",
          "notes": "Product with orders"
        }
      ],
      "steps": [
        "Select product to delete",
        "Click delete",
        "Confirm deletion"
      ],
      "expected_results": [
        "Product soft-deleted",
        "Order history intact",
        "Product data preserved"
      ]
    },
    {
      "id": "TC-AC-ADMIN-003-P02",
      "name": "Deleted product removed from customer carts",
      "category": "positive",
      "ac_ref": "AC-ADMIN-003",
      "br_refs": [
        "BR-ADMIN",
        "BR-PROD"
      ],
      "preconditions": [
        "Product in customer cart",
        "Admin deletes product"
      ],
      "test_data": [
        {
          "field": "productId",
          "value": "prod-789",
          "notes": "Product in carts"
        }
      ],
      "steps": [
        "Delete product with items in carts",
        "Customer views cart"
      ],
      "expected_results": [
        "Product removed from cart",
        "Notification shown to customer"
      ]
    },
    {
      "id": "TC-AC-ADMIN-003-P03",
      "name": "Deleted product no longer in listings",
      "category": "positive",
      "ac_ref": "AC-ADMIN-003",
      "br_refs": [
        "BR-ADMIN",
        "BR-PROD"
      ],
      "preconditions": [
        "Product exists in catalog"
      ],
      "test_data": [
        {
          "field": "productId",
          "value": "prod-101",
          "notes": "Visible product"
        }
      ],
      "steps": [
        "Delete product",
        "Browse product catalog",
        "Search for product"
      ],
      "expected_results": [
        "Product not in listings",
        "Product not in search results"
      ]
    },
    {
      "id": "TC-AC-ADMIN-003-N01",
      "name": "Cancel deletion takes no action",
      "category": "negative",
      "ac_ref": "AC-ADMIN-003",
      "br_refs": [
        "BR-ADMIN",
        "BR-PROD"
      ],
      "preconditions": [
        "Product exists"
      ],
      "test_data": [
        {
          "field": "productId",
          "value": "prod-202",
          "notes": "Product to not delete"
        }
      ],
      "steps": [
        "Click delete on product",
        "Cancel confirmation dialog"
      ],
      "expected_results": [
        "Product still exists",
        "Product visible in listings"
      ]
    },
    {
      "id": "TC-AC-ADMIN-003-N02",
      "name": "Delete requires confirmation dialog",
      "category": "negative",
      "ac_ref": "AC-ADMIN-003",
      "br_refs": [
        "BR-ADMIN",
        "BR-PROD"
      ],
      "preconditions": [
        "Product exists"
      ],
      "test_data": [
        {
          "field": "productId",
          "value": "prod-303",
          "notes": "Product to delete"
        }
      ],
      "steps": [
        "Click delete button",
        "Observe confirmation requirement"
      ],
      "expected_results": [
        "Confirmation dialog appears",
        "No deletion without confirm"
      ]
    },
    {
      "id": "TC-AC-ADMIN-003-B01",
      "name": "Delete product with zero order history",
      "category": "boundary",
      "ac_ref": "AC-ADMIN-003",
      "br_refs": [
        "BR-ADMIN",
        "BR-PROD"
      ],
      "preconditions": [
        "Product with no orders"
      ],
      "test_data": [
        {
          "field": "productId",
          "value": "prod-404",
          "notes": "Product with zero orders"
        }
      ],
      "steps": [
        "Delete product with no order history",
        "Confirm"
      ],
      "expected_results": [
        "Product soft-deleted successfully"
      ]
    },
    {
      "id": "TC-AC-ADMIN-003-B02",
      "name": "Delete product present in single cart",
      "category": "boundary",
      "ac_ref": "AC-ADMIN-003",
      "br_refs": [
        "BR-ADMIN",
        "BR-PROD"
      ],
      "preconditions": [
        "Product in exactly one cart"
      ],
      "test_data": [
        {
          "field": "productId",
          "value": "prod-505",
          "notes": "In one cart"
        }
      ],
      "steps": [
        "Delete product in one cart",
        "Customer views their cart"
      ],
      "expected_results": [
        "Product removed from cart",
        "Notification shown"
      ]
    },
    {
      "id": "TC-AC-ADMIN-003-H01",
      "name": "Soft-deleted product should NOT be purchasable",
      "category": "hallucination",
      "ac_ref": "AC-ADMIN-003",
      "br_refs": [
        "BR-ADMIN",
        "BR-PROD"
      ],
      "preconditions": [
        "Product soft-deleted"
      ],
      "test_data": [
        {
          "field": "productId",
          "value": "prod-606",
          "notes": "Deleted product"
        }
      ],
      "steps": [
        "Soft delete product",
        "Attempt direct add to cart via API"
      ],
      "expected_results": [
        "Add to cart fails"
      ],
      "should_not": "Soft-deleted products should NOT be addable to cart"
    },
    {
      "id": "TC-AC-ADMIN-003-H02",
      "name": "Deleted product should NOT be restored without admin action",
      "category": "hallucination",
      "ac_ref": "AC-ADMIN-003",
      "br_refs": [
        "BR-ADMIN",
        "BR-PROD"
      ],
      "preconditions": [
        "Product soft-deleted"
      ],
      "test_data": [
        {
          "field": "productId",
          "value": "prod-707",
          "notes": "Deleted product"
        }
      ],
      "steps": [
        "Soft delete product",
        "Wait period",
        "Check product status"
      ],
      "expected_results": [
        "Product remains deleted"
      ],
      "should_not": "Soft-deleted products should NOT auto-restore"
    },
    {
      "id": "TC-AC-ADMIN-004-P01",
      "name": "Display orders with all required fields",
      "category": "positive",
      "ac_ref": "AC-ADMIN-004",
      "br_refs": [
        "BR-ADMIN",
        "BR-ORDER"
      ],
      "preconditions": [
        "Orders exist in system",
        "Admin logged in"
      ],
      "test_data": [
        {
          "field": "orderCount",
          "value": "10",
          "notes": "Multiple orders"
        }
      ],
      "steps": [
        "Navigate to order management",
        "View order list"
      ],
      "expected_results": [
        "Each order shows number",
        "Shows date",
        "Shows customer",
        "Shows total",
        "Shows status"
      ]
    },
    {
      "id": "TC-AC-ADMIN-004-P02",
      "name": "Filter orders by status",
      "category": "positive",
      "ac_ref": "AC-ADMIN-004",
      "br_refs": [
        "BR-ADMIN",
        "BR-ORDER"
      ],
      "preconditions": [
        "Orders with various statuses exist"
      ],
      "test_data": [
        {
          "field": "statusFilter",
          "value": "pending",
          "notes": "Filter value"
        }
      ],
      "steps": [
        "View order list",
        "Apply status filter for pending"
      ],
      "expected_results": [
        "Only pending orders displayed",
        "Other statuses hidden"
      ]
    },
    {
      "id": "TC-AC-ADMIN-004-P03",
      "name": "Filter orders by date range",
      "category": "positive",
      "ac_ref": "AC-ADMIN-004",
      "br_refs": [
        "BR-ADMIN",
        "BR-ORDER"
      ],
      "preconditions": [
        "Orders from multiple dates exist"
      ],
      "test_data": [
        {
          "field": "startDate",
          "value": "2024-01-01",
          "notes": "Range start"
        },
        {
          "field": "endDate",
          "value": "2024-01-31",
          "notes": "Range end"
        }
      ],
      "steps": [
        "Set date range filter",
        "Apply filter"
      ],
      "expected_results": [
        "Only orders within date range shown"
      ]
    },
    {
      "id": "TC-AC-ADMIN-004-P04",
      "name": "Search orders by order number",
      "category": "positive",
      "ac_ref": "AC-ADMIN-004",
      "br_refs": [
        "BR-ADMIN",
        "BR-ORDER"
      ],
      "preconditions": [
        "Order ORD-12345 exists"
      ],
      "test_data": [
        {
          "field": "searchTerm",
          "value": "ORD-12345",
          "notes": "Exact order number"
        }
      ],
      "steps": [
        "Enter order number in search",
        "Execute search"
      ],
      "expected_results": [
        "Matching order displayed",
        "Quick access to order details"
      ]
    },
    {
      "id": "TC-AC-ADMIN-004-N01",
      "name": "Show empty state when no orders match filter",
      "category": "negative",
      "ac_ref": "AC-ADMIN-004",
      "br_refs": [
        "BR-ADMIN",
        "BR-ORDER"
      ],
      "preconditions": [
        "No orders match criteria"
      ],
      "test_data": [
        {
          "field": "statusFilter",
          "value": "cancelled",
          "notes": "No cancelled orders"
        }
      ],
      "steps": [
        "Apply filter with no matching orders"
      ],
      "expected_results": [
        "Empty state message displayed",
        "Clear indication no results"
      ]
    },
    {
      "id": "TC-AC-ADMIN-004-N02",
      "name": "Show empty state for non-existent order search",
      "category": "negative",
      "ac_ref": "AC-ADMIN-004",
      "br_refs": [
        "BR-ADMIN",
        "BR-ORDER"
      ],
      "preconditions": [
        "Order ORD-99999 does not exist"
      ],
      "test_data": [
        {
          "field": "searchTerm",
          "value": "ORD-99999",
          "notes": "Non-existent order"
        }
      ],
      "steps": [
        "Search for non-existent order number"
      ],
      "expected_results": [
        "Empty state shown",
        "No false matches"
      ]
    },
    {
      "id": "TC-AC-ADMIN-004-B01",
      "name": "View orders at date range boundary",
      "category": "boundary",
      "ac_ref": "AC-ADMIN-004",
      "br_refs": [
        "BR-ADMIN",
        "BR-ORDER"
      ],
      "preconditions": [
        "Order exists at exact boundary date"
      ],
      "test_data": [
        {
          "field": "orderDate",
          "value": "2024-01-31 23:59:59",
          "notes": "End of range"
        },
        {
          "field": "endDate",
          "value": "2024-01-31",
          "notes": "Filter boundary"
        }
      ],
      "steps": [
        "Set date range ending Jan 31",
        "View orders"
      ],
      "expected_results": [
        "Order at 23:59:59 on Jan 31 included"
      ]
    },
    {
      "id": "TC-AC-ADMIN-004-B02",
      "name": "Display single order in list",
      "category": "boundary",
      "ac_ref": "AC-ADMIN-004",
      "br_refs": [
        "BR-ADMIN",
        "BR-ORDER"
      ],
      "preconditions": [
        "Only one order exists"
      ],
      "test_data": [
        {
          "field": "orderCount",
          "value": "1",
          "notes": "Single order"
        }
      ],
      "steps": [
        "Navigate to order list with single order"
      ],
      "expected_results": [
        "Single order displayed correctly",
        "All fields visible"
      ]
    },
    {
      "id": "TC-AC-ADMIN-004-H01",
      "name": "Order list should NOT show deleted orders",
      "category": "hallucination",
      "ac_ref": "AC-ADMIN-004",
      "br_refs": [
        "BR-ADMIN",
        "BR-ORDER"
      ],
      "preconditions": [
        "Some orders are soft-deleted"
      ],
      "test_data": [
        {
          "field": "deletedOrderId",
          "value": "ORD-DEL-001",
          "notes": "Deleted order"
        }
      ],
      "steps": [
        "View order list",
        "Search for deleted order"
      ],
      "expected_results": [
        "Deleted orders not in list"
      ],
      "should_not": "Deleted/cancelled orders should NOT appear in default view"
    },
    {
      "id": "TC-AC-ADMIN-004-H02",
      "name": "Filter should NOT allow SQL injection",
      "category": "hallucination",
      "ac_ref": "AC-ADMIN-004",
      "br_refs": [
        "BR-ADMIN",
        "BR-ORDER"
      ],
      "preconditions": [
        "Admin on order management"
      ],
      "test_data": [
        {
          "field": "searchTerm",
          "value": "'; DROP TABLE orders;--",
          "notes": "Injection attempt"
        }
      ],
      "steps": [
        "Enter SQL injection in search field",
        "Execute search"
      ],
      "expected_results": [
        "Search fails safely or returns no results"
      ],
      "should_not": "Filter/search should NOT execute injected SQL"
    },
    {
      "id": "TC-AC-ADMIN-005-P01",
      "name": "Update order from pending to confirmed successfully",
      "category": "positive",
      "ac_ref": "AC-ADMIN-005",
      "br_refs": [
        "AMB-ENT-018",
        "AMB-OP-047"
      ],
      "preconditions": [
        "Admin is authenticated",
        "Order exists with pending status"
      ],
      "test_data": [
        {
          "field": "orderId",
          "value": "ORD-12345",
          "notes": "Valid order ID"
        },
        {
          "field": "currentStatus",
          "value": "pending",
          "notes": "Starting status"
        },
        {
          "field": "newStatus",
          "value": "confirmed",
          "notes": "Valid next status"
        }
      ],
      "steps": [
        "Navigate to order details",
        "Select confirmed status",
        "Submit change"
      ],
      "expected_results": [
        "Status updated to confirmed",
        "Change logged with admin and timestamp",
        "Customer receives email notification"
      ]
    },
    {
      "id": "TC-AC-ADMIN-005-P02",
      "name": "Update order from shipped to delivered with email",
      "category": "positive",
      "ac_ref": "AC-ADMIN-005",
      "br_refs": [
        "AMB-OP-048",
        "AMB-OP-049"
      ],
      "preconditions": [
        "Admin is authenticated",
        "Order exists with shipped status"
      ],
      "test_data": [
        {
          "field": "orderId",
          "value": "ORD-12346",
          "notes": "Valid order ID"
        },
        {
          "field": "currentStatus",
          "value": "shipped",
          "notes": "Starting status"
        },
        {
          "field": "newStatus",
          "value": "delivered",
          "notes": "Final status"
        }
      ],
      "steps": [
        "Navigate to order details",
        "Select delivered status",
        "Submit change"
      ],
      "expected_results": [
        "Status updated to delivered",
        "Audit log entry created",
        "Delivery notification email sent to customer"
      ]
    },
    {
      "id": "TC-AC-ADMIN-005-P03",
      "name": "Set shipped status without tracking number",
      "category": "positive",
      "ac_ref": "AC-ADMIN-005",
      "br_refs": [
        "AMB-OP-050"
      ],
      "preconditions": [
        "Admin is authenticated",
        "Order exists with confirmed status"
      ],
      "test_data": [
        {
          "field": "orderId",
          "value": "ORD-12347",
          "notes": "Valid order ID"
        },
        {
          "field": "newStatus",
          "value": "shipped",
          "notes": "Target status"
        },
        {
          "field": "trackingNumber",
          "value": "",
          "notes": "Optional field left empty"
        }
      ],
      "steps": [
        "Navigate to order",
        "Select shipped status",
        "Leave tracking empty",
        "Submit"
      ],
      "expected_results": [
        "Status updated to shipped successfully",
        "No validation error for missing tracking"
      ]
    },
    {
      "id": "TC-AC-ADMIN-005-N01",
      "name": "Reject invalid transition from pending to shipped",
      "category": "negative",
      "ac_ref": "AC-ADMIN-005",
      "br_refs": [
        "AMB-OP-047"
      ],
      "preconditions": [
        "Admin is authenticated",
        "Order exists with pending status"
      ],
      "test_data": [
        {
          "field": "currentStatus",
          "value": "pending",
          "notes": "Starting status"
        },
        {
          "field": "newStatus",
          "value": "shipped",
          "notes": "Invalid skip transition"
        }
      ],
      "steps": [
        "Navigate to order",
        "Attempt to select shipped status",
        "Submit change"
      ],
      "expected_results": [
        "Error displayed",
        "Message shows allowed transitions: pendingconfirmed"
      ]
    },
    {
      "id": "TC-AC-ADMIN-005-N02",
      "name": "Reject backward transition from delivered to shipped",
      "category": "negative",
      "ac_ref": "AC-ADMIN-005",
      "br_refs": [
        "AMB-OP-047"
      ],
      "preconditions": [
        "Admin is authenticated",
        "Order is in delivered status"
      ],
      "test_data": [
        {
          "field": "currentStatus",
          "value": "delivered",
          "notes": "Final status"
        },
        {
          "field": "newStatus",
          "value": "shipped",
          "notes": "Backward transition"
        }
      ],
      "steps": [
        "Navigate to delivered order",
        "Attempt to change to shipped",
        "Submit"
      ],
      "expected_results": [
        "Error message displayed",
        "Status remains delivered"
      ]
    },
    {
      "id": "TC-AC-ADMIN-005-N03",
      "name": "Reject transition from pending directly to delivered",
      "category": "negative",
      "ac_ref": "AC-ADMIN-005",
      "br_refs": [
        "AMB-OP-047"
      ],
      "preconditions": [
        "Admin is authenticated",
        "Order is pending"
      ],
      "test_data": [
        {
          "field": "currentStatus",
          "value": "pending",
          "notes": "Initial status"
        },
        {
          "field": "newStatus",
          "value": "delivered",
          "notes": "Skips two steps"
        }
      ],
      "steps": [
        "Navigate to order",
        "Select delivered status",
        "Submit"
      ],
      "expected_results": [
        "Error with allowed transitions shown",
        "Order remains pending"
      ]
    },
    {
      "id": "TC-AC-ADMIN-005-B01",
      "name": "First valid transition in chain pending to confirmed",
      "category": "boundary",
      "ac_ref": "AC-ADMIN-005",
      "br_refs": [
        "AMB-OP-047"
      ],
      "preconditions": [
        "Order in initial pending state"
      ],
      "test_data": [
        {
          "field": "currentStatus",
          "value": "pending",
          "notes": "First state in chain"
        },
        {
          "field": "newStatus",
          "value": "confirmed",
          "notes": "First valid transition"
        }
      ],
      "steps": [
        "View pending order",
        "Change to confirmed",
        "Verify audit log"
      ],
      "expected_results": [
        "Transition succeeds",
        "Timestamp recorded accurately"
      ]
    },
    {
      "id": "TC-AC-ADMIN-005-B02",
      "name": "Final valid transition shipped to delivered",
      "category": "boundary",
      "ac_ref": "AC-ADMIN-005",
      "br_refs": [
        "AMB-OP-048"
      ],
      "preconditions": [
        "Order in shipped state"
      ],
      "test_data": [
        {
          "field": "currentStatus",
          "value": "shipped",
          "notes": "Penultimate state"
        },
        {
          "field": "newStatus",
          "value": "delivered",
          "notes": "Final state in chain"
        }
      ],
      "steps": [
        "View shipped order",
        "Change to delivered",
        "Verify no further transitions"
      ],
      "expected_results": [
        "Transition succeeds",
        "No further status options available"
      ]
    },
    {
      "id": "TC-AC-ADMIN-005-H01",
      "name": "Should NOT allow cancelled status not in spec",
      "category": "hallucination",
      "ac_ref": "AC-ADMIN-005",
      "br_refs": [],
      "preconditions": [
        "Order exists in any status"
      ],
      "test_data": [
        {
          "field": "newStatus",
          "value": "cancelled",
          "notes": "Not in defined transitions"
        }
      ],
      "steps": [
        "View order",
        "Attempt to set cancelled status"
      ],
      "expected_results": [
        "Cancelled status not available or rejected"
      ],
      "should_not": "Should NOT allow cancelled status as it is not in the defined transitions"
    },
    {
      "id": "TC-AC-ADMIN-005-H02",
      "name": "Should NOT send email for pending status",
      "category": "hallucination",
      "ac_ref": "AC-ADMIN-005",
      "br_refs": [
        "AMB-OP-049"
      ],
      "preconditions": [
        "New order created"
      ],
      "test_data": [
        {
          "field": "status",
          "value": "pending",
          "notes": "Initial status"
        }
      ],
      "steps": [
        "Create new order",
        "Order enters pending status",
        "Check email logs"
      ],
      "expected_results": [
        "No email sent for pending status"
      ],
      "should_not": "Should NOT send customer notification email when order is pending"
    },
    {
      "id": "TC-AC-ADMIN-006-P01",
      "name": "Set absolute stock value successfully",
      "category": "positive",
      "ac_ref": "AC-ADMIN-006",
      "br_refs": [
        "AMB-ENT-009",
        "AMB-OP-051"
      ],
      "preconditions": [
        "Admin authenticated",
        "Product variant exists with stock 50"
      ],
      "test_data": [
        {
          "field": "variantId",
          "value": "VAR-001",
          "notes": "Valid variant"
        },
        {
          "field": "adjustmentType",
          "value": "absolute",
          "notes": "Set exact value"
        },
        {
          "field": "newValue",
          "value": "100",
          "notes": "New stock level"
        }
      ],
      "steps": [
        "Navigate to inventory",
        "Select variant",
        "Set absolute value 100",
        "Save"
      ],
      "expected_results": [
        "Stock updated to 100",
        "Audit trail shows before:50 after:100"
      ]
    },
    {
      "id": "TC-AC-ADMIN-006-P02",
      "name": "Apply delta adjustment to increase stock",
      "category": "positive",
      "ac_ref": "AC-ADMIN-006",
      "br_refs": [
        "AMB-OP-052"
      ],
      "preconditions": [
        "Admin authenticated",
        "Variant has stock of 30"
      ],
      "test_data": [
        {
          "field": "variantId",
          "value": "VAR-002",
          "notes": "Valid variant"
        },
        {
          "field": "adjustmentType",
          "value": "delta",
          "notes": "Relative change"
        },
        {
          "field": "delta",
          "value": "+20",
          "notes": "Increase by 20"
        },
        {
          "field": "reason",
          "value": "Restock delivery",
          "notes": "Optional reason"
        }
      ],
      "steps": [
        "Select variant",
        "Choose delta adjustment",
        "Enter +20",
        "Add reason",
        "Save"
      ],
      "expected_results": [
        "Stock updated to 50",
        "Audit shows reason and before/after values"
      ]
    },
    {
      "id": "TC-AC-ADMIN-006-P03",
      "name": "Trigger low stock alert when threshold crossed",
      "category": "positive",
      "ac_ref": "AC-ADMIN-006",
      "br_refs": [
        "AMB-ENT-040",
        "AMB-OP-053"
      ],
      "preconditions": [
        "Variant has stock 15",
        "Low stock threshold is 10"
      ],
      "test_data": [
        {
          "field": "currentStock",
          "value": "15",
          "notes": "Above threshold"
        },
        {
          "field": "delta",
          "value": "-10",
          "notes": "Reduces to 5"
        },
        {
          "field": "threshold",
          "value": "10",
          "notes": "Alert trigger point"
        }
      ],
      "steps": [
        "Reduce stock by 10",
        "Save adjustment"
      ],
      "expected_results": [
        "Stock reduced to 5",
        "Low stock alert triggered"
      ]
    },
    {
      "id": "TC-AC-ADMIN-006-N01",
      "name": "Block adjustment resulting in negative inventory",
      "category": "negative",
      "ac_ref": "AC-ADMIN-006",
      "br_refs": [
        "AMB-OP-054"
      ],
      "preconditions": [
        "Variant has stock of 10"
      ],
      "test_data": [
        {
          "field": "currentStock",
          "value": "10",
          "notes": "Current level"
        },
        {
          "field": "delta",
          "value": "-15",
          "notes": "Would result in -5"
        }
      ],
      "steps": [
        "Select variant",
        "Apply delta -15",
        "Submit"
      ],
      "expected_results": [
        "Error: Inventory cannot go below zero",
        "Stock remains at 10"
      ]
    },
    {
      "id": "TC-AC-ADMIN-006-N02",
      "name": "Show row-by-row errors for invalid CSV import",
      "category": "negative",
      "ac_ref": "AC-ADMIN-006",
      "br_refs": [
        "AMB-OP-055"
      ],
      "preconditions": [
        "Admin on inventory import page"
      ],
      "test_data": [
        {
          "field": "csvRow1",
          "value": "VAR-001,abc",
          "notes": "Invalid non-numeric"
        },
        {
          "field": "csvRow2",
          "value": "VAR-002,50",
          "notes": "Valid row"
        },
        {
          "field": "csvRow3",
          "value": "INVALID,-10",
          "notes": "Invalid variant and negative"
        }
      ],
      "steps": [
        "Upload CSV with mixed valid/invalid rows",
        "Submit import"
      ],
      "expected_results": [
        "Row 1 error: invalid quantity",
        "Row 2: success",
        "Row 3 error: invalid variant and negative value"
      ]
    },
    {
      "id": "TC-AC-ADMIN-006-N03",
      "name": "Reject setting absolute value to negative number",
      "category": "negative",
      "ac_ref": "AC-ADMIN-006",
      "br_refs": [
        "AMB-OP-054"
      ],
      "preconditions": [
        "Admin managing inventory"
      ],
      "test_data": [
        {
          "field": "adjustmentType",
          "value": "absolute",
          "notes": "Direct set"
        },
        {
          "field": "newValue",
          "value": "-5",
          "notes": "Negative absolute value"
        }
      ],
      "steps": [
        "Select variant",
        "Choose absolute adjustment",
        "Enter -5",
        "Submit"
      ],
      "expected_results": [
        "Error: Inventory cannot go below zero",
        "Change rejected"
      ]
    },
    {
      "id": "TC-AC-ADMIN-006-B01",
      "name": "Set stock to exactly zero via delta",
      "category": "boundary",
      "ac_ref": "AC-ADMIN-006",
      "br_refs": [
        "AMB-OP-051"
      ],
      "preconditions": [
        "Variant has stock of 10"
      ],
      "test_data": [
        {
          "field": "currentStock",
          "value": "10",
          "notes": "Starting value"
        },
        {
          "field": "delta",
          "value": "-10",
          "notes": "Exactly depletes stock"
        }
      ],
      "steps": [
        "Apply delta -10 to reduce stock to exactly 0"
      ],
      "expected_results": [
        "Stock updated to 0",
        "No error - zero is valid minimum"
      ]
    },
    {
      "id": "TC-AC-ADMIN-006-B02",
      "name": "Delta that would result in exactly -1 blocked",
      "category": "boundary",
      "ac_ref": "AC-ADMIN-006",
      "br_refs": [
        "AMB-OP-054"
      ],
      "preconditions": [
        "Variant has stock of 10"
      ],
      "test_data": [
        {
          "field": "currentStock",
          "value": "10",
          "notes": "Starting value"
        },
        {
          "field": "delta",
          "value": "-11",
          "notes": "Would result in -1"
        }
      ],
      "steps": [
        "Apply delta -11"
      ],
      "expected_results": [
        "Error: Inventory cannot go below zero",
        "Stock remains 10"
      ]
    },
    {
      "id": "TC-AC-ADMIN-006-H01",
      "name": "Should NOT allow inventory for product without variants",
      "category": "hallucination",
      "ac_ref": "AC-ADMIN-006",
      "br_refs": [
        "AMB-ENT-009"
      ],
      "preconditions": [
        "Product exists without any variants defined"
      ],
      "test_data": [
        {
          "field": "productId",
          "value": "PROD-001",
          "notes": "Product without variants"
        }
      ],
      "steps": [
        "Navigate to product",
        "Attempt to adjust inventory at product level"
      ],
      "expected_results": [
        "No product-level inventory adjustment available"
      ],
      "should_not": "Should NOT allow inventory tracking at product level, only per variant"
    },
    {
      "id": "TC-AC-ADMIN-006-H02",
      "name": "Should NOT skip audit trail for any adjustment",
      "category": "hallucination",
      "ac_ref": "AC-ADMIN-006",
      "br_refs": [
        "AMB-ENT-041",
        "AMB-ENT-042"
      ],
      "preconditions": [
        "Any inventory adjustment"
      ],
      "test_data": [
        {
          "field": "delta",
          "value": "+1",
          "notes": "Minimal change"
        }
      ],
      "steps": [
        "Make small adjustment",
        "Check audit log"
      ],
      "expected_results": [
        "Audit entry exists with before/after values"
      ],
      "should_not": "Should NOT allow any inventory change without audit trail entry"
    },
    {
      "id": "TC-AC-VAR-001-P01",
      "name": "Display all variant options for product with size/color",
      "category": "positive",
      "ac_ref": "AC-VAR-001",
      "br_refs": [
        "AMB-ENT-008"
      ],
      "preconditions": [
        "Product exists with size (S,M,L) and color (Red,Blue) variants"
      ],
      "test_data": [
        {
          "field": "productId",
          "value": "PROD-SHIRT",
          "notes": "Product with variants"
        },
        {
          "field": "sizes",
          "value": "S,M,L",
          "notes": "Size options"
        },
        {
          "field": "colors",
          "value": "Red,Blue",
          "notes": "Color options"
        }
      ],
      "steps": [
        "Navigate to product page",
        "View variant selection area"
      ],
      "expected_results": [
        "All size options displayed",
        "All color options displayed"
      ]
    },
    {
      "id": "TC-AC-VAR-001-P02",
      "name": "Show individual stock status per variant",
      "category": "positive",
      "ac_ref": "AC-VAR-001",
      "br_refs": [
        "AMB-ENT-009"
      ],
      "preconditions": [
        "Product has variants with different stock levels"
      ],
      "test_data": [
        {
          "field": "variant1",
          "value": "S-Red",
          "notes": "In stock (qty 10)"
        },
        {
          "field": "variant2",
          "value": "M-Blue",
          "notes": "Out of stock (qty 0)"
        }
      ],
      "steps": [
        "View product",
        "Check each variant stock indicator"
      ],
      "expected_results": [
        "S-Red shows in stock",
        "M-Blue shows out of stock"
      ]
    },
    {
      "id": "TC-AC-VAR-001-P03",
      "name": "Display variant-specific price override",
      "category": "positive",
      "ac_ref": "AC-VAR-001",
      "br_refs": [
        "AMB-ENT-010"
      ],
      "preconditions": [
        "Product base price $20",
        "XL variant has +$5 override"
      ],
      "test_data": [
        {
          "field": "basePrice",
          "value": "20.00",
          "notes": "Product base price"
        },
        {
          "field": "xlOverride",
          "value": "25.00",
          "notes": "XL variant price"
        }
      ],
      "steps": [
        "View product",
        "Select XL variant",
        "Check displayed price"
      ],
      "expected_results": [
        "XL variant shows $25.00 price"
      ]
    },
    {
      "id": "TC-AC-VAR-001-N01",
      "name": "Show out of stock for unavailable variant selection",
      "category": "negative",
      "ac_ref": "AC-VAR-001",
      "br_refs": [
        "AMB-ENT-009"
      ],
      "preconditions": [
        "Variant M-Red has 0 stock"
      ],
      "test_data": [
        {
          "field": "selectedVariant",
          "value": "M-Red",
          "notes": "Zero stock variant"
        }
      ],
      "steps": [
        "View product",
        "Select M size and Red color"
      ],
      "expected_results": [
        "Out of stock message displayed for M-Red variant"
      ]
    },
    {
      "id": "TC-AC-VAR-001-N02",
      "name": "Allow selecting other variants when one is out of stock",
      "category": "negative",
      "ac_ref": "AC-VAR-001",
      "br_refs": [
        "AMB-ENT-011"
      ],
      "preconditions": [
        "M-Red out of stock",
        "L-Red in stock"
      ],
      "test_data": [
        {
          "field": "outOfStock",
          "value": "M-Red",
          "notes": "Unavailable"
        },
        {
          "field": "inStock",
          "value": "L-Red",
          "notes": "Available alternative"
        }
      ],
      "steps": [
        "View product",
        "See M-Red is out of stock",
        "Select L-Red instead"
      ],
      "expected_results": [
        "L-Red variant selectable",
        "Add to cart enabled for L-Red"
      ]
    },
    {
      "id": "TC-AC-VAR-001-B01",
      "name": "Product with single variant type only size",
      "category": "boundary",
      "ac_ref": "AC-VAR-001",
      "br_refs": [
        "AMB-ENT-008"
      ],
      "preconditions": [
        "Product has only size variants, no color"
      ],
      "test_data": [
        {
          "field": "variantTypes",
          "value": "size",
          "notes": "Single type"
        },
        {
          "field": "options",
          "value": "S,M,L,XL",
          "notes": "Size options only"
        }
      ],
      "steps": [
        "View product with size-only variants"
      ],
      "expected_results": [
        "Only size selector displayed",
        "No color selector shown"
      ]
    },
    {
      "id": "TC-AC-VAR-001-B02",
      "name": "Variant with stock of exactly 1 unit",
      "category": "boundary",
      "ac_ref": "AC-VAR-001",
      "br_refs": [
        "AMB-ENT-009"
      ],
      "preconditions": [
        "Variant has exactly 1 unit in stock"
      ],
      "test_data": [
        {
          "field": "variant",
          "value": "M-Blue",
          "notes": "Target variant"
        },
        {
          "field": "stock",
          "value": "1",
          "notes": "Minimum in-stock quantity"
        }
      ],
      "steps": [
        "View product",
        "Check M-Blue stock status"
      ],
      "expected_results": [
        "Shows as in stock or low stock",
        "Selectable for purchase"
      ]
    },
    {
      "id": "TC-AC-VAR-001-H01",
      "name": "Should NOT show aggregated product-level stock",
      "category": "hallucination",
      "ac_ref": "AC-VAR-001",
      "br_refs": [
        "AMB-ENT-009"
      ],
      "preconditions": [
        "Product has multiple variants with different stock levels"
      ],
      "test_data": [
        {
          "field": "variant1Stock",
          "value": "10",
          "notes": "First variant"
        },
        {
          "field": "variant2Stock",
          "value": "0",
          "notes": "Second variant"
        }
      ],
      "steps": [
        "View product page",
        "Check for aggregated stock display"
      ],
      "expected_results": [
        "No total product stock shown"
      ],
      "should_not": "Should NOT display combined/aggregated stock across all variants"
    },
    {
      "id": "TC-AC-VAR-001-H02",
      "name": "Should NOT auto-substitute out of stock variant",
      "category": "hallucination",
      "ac_ref": "AC-VAR-001",
      "br_refs": [],
      "preconditions": [
        "Selected variant out of stock",
        "Similar variant in stock"
      ],
      "test_data": [
        {
          "field": "selected",
          "value": "M-Red",
          "notes": "Out of stock"
        },
        {
          "field": "similar",
          "value": "M-Blue",
          "notes": "In stock alternative"
        }
      ],
      "steps": [
        "Select M-Red variant",
        "Observe system behavior"
      ],
      "expected_results": [
        "System does not auto-switch to M-Blue"
      ],
      "should_not": "Should NOT automatically substitute with different variant"
    },
    {
      "id": "TC-AC-CAT-001-P01",
      "name": "Display three-level category hierarchy",
      "category": "positive",
      "ac_ref": "AC-CAT-001",
      "br_refs": [
        "AMB-ENT-006",
        "AMB-ENT-037"
      ],
      "preconditions": [
        "Categories exist: Electronics \u003e Phones \u003e Smartphones"
      ],
      "test_data": [
        {
          "field": "level1",
          "value": "Electronics",
          "notes": "Top level"
        },
        {
          "field": "level2",
          "value": "Phones",
          "notes": "Second level"
        },
        {
          "field": "level3",
          "value": "Smartphones",
          "notes": "Third level"
        }
      ],
      "steps": [
        "Navigate to category browser",
        "Expand Electronics",
        "Expand Phones"
      ],
      "expected_results": [
        "All three levels visible",
        "Proper parent-child relationships shown"
      ]
    },
    {
      "id": "TC-AC-CAT-001-P02",
      "name": "Show product with primary and secondary categories",
      "category": "positive",
      "ac_ref": "AC-CAT-001",
      "br_refs": [
        "AMB-ENT-038",
        "AMB-ENT-039"
      ],
      "preconditions": [
        "Product in primary: Phones, secondary: Accessories"
      ],
      "test_data": [
        {
          "field": "productId",
          "value": "PROD-CASE",
          "notes": "Phone case product"
        },
        {
          "field": "primary",
          "value": "Accessories",
          "notes": "Main category"
        },
        {
          "field": "secondary",
          "value": "Phones",
          "notes": "Additional category"
        }
      ],
      "steps": [
        "View product details",
        "Check category assignments"
      ],
      "expected_results": [
        "Primary category displayed",
        "Secondary categories shown"
      ]
    },
    {
      "id": "TC-AC-CAT-001-P03",
      "name": "Browse products by selecting subcategory",
      "category": "positive",
      "ac_ref": "AC-CAT-001",
      "br_refs": [
        "AMB-ENT-006"
      ],
      "preconditions": [
        "Smartphones category has 5 products"
      ],
      "test_data": [
        {
          "field": "category",
          "value": "Smartphones",
          "notes": "Leaf category"
        },
        {
          "field": "productCount",
          "value": "5",
          "notes": "Expected products"
        }
      ],
      "steps": [
        "Navigate to Smartphones category",
        "View product listing"
      ],
      "expected_results": [
        "5 products displayed",
        "Products belong to selected category"
      ]
    },
    {
      "id": "TC-AC-CAT-001-N01",
      "name": "Hide inactive category from customer view",
      "category": "negative",
      "ac_ref": "AC-CAT-001",
      "br_refs": [
        "AMB-ENT-037"
      ],
      "preconditions": [
        "Discontinued category marked inactive with 3 products"
      ],
      "test_data": [
        {
          "field": "category",
          "value": "Discontinued",
          "notes": "Inactive category"
        },
        {
          "field": "status",
          "value": "inactive",
          "notes": "Disabled flag"
        }
      ],
      "steps": [
        "Browse categories as customer",
        "Search for Discontinued category"
      ],
      "expected_results": [
        "Discontinued category not visible",
        "Its products not shown"
      ]
    },
    {
      "id": "TC-AC-CAT-001-N02",
      "name": "Hide products of inactive category from listings",
      "category": "negative",
      "ac_ref": "AC-CAT-001",
      "br_refs": [
        "AMB-ENT-037"
      ],
      "preconditions": [
        "Product only in inactive category"
      ],
      "test_data": [
        {
          "field": "productId",
          "value": "PROD-OLD",
          "notes": "Only in inactive category"
        },
        {
          "field": "category",
          "value": "Archived",
          "notes": "Inactive"
        }
      ],
      "steps": [
        "Search for product",
        "Browse all categories"
      ],
      "expected_results": [
        "Product not found in any listing",
        "Not in search results"
      ]
    },
    {
      "id": "TC-AC-CAT-001-B01",
      "name": "Category at maximum depth level 3",
      "category": "boundary",
      "ac_ref": "AC-CAT-001",
      "br_refs": [
        "AMB-ENT-006"
      ],
      "preconditions": [
        "Category hierarchy exactly 3 levels deep"
      ],
      "test_data": [
        {
          "field": "depth",
          "value": "3",
          "notes": "Maximum allowed depth"
        },
        {
          "field": "path",
          "value": "L1 \u003e L2 \u003e L3",
          "notes": "Full hierarchy"
        }
      ],
      "steps": [
        "Navigate to level 3 category",
        "Verify products are accessible"
      ],
      "expected_results": [
        "Level 3 category displays correctly",
        "Products browsable"
      ]
    },
    {
      "id": "TC-AC-CAT-001-B02",
      "name": "Single top-level category with no children",
      "category": "boundary",
      "ac_ref": "AC-CAT-001",
      "br_refs": [
        "AMB-ENT-006"
      ],
      "preconditions": [
        "Category exists with no subcategories"
      ],
      "test_data": [
        {
          "field": "category",
          "value": "Misc",
          "notes": "Flat category"
        },
        {
          "field": "depth",
          "value": "1",
          "notes": "No children"
        }
      ],
      "steps": [
        "View category listing",
        "Select Misc category"
      ],
      "expected_results": [
        "Category displays without expand option",
        "Products shown directly"
      ]
    },
    {
      "id": "TC-AC-CAT-001-H01",
      "name": "Should NOT display fourth level categories",
      "category": "hallucination",
      "ac_ref": "AC-CAT-001",
      "br_refs": [
        "AMB-ENT-006"
      ],
      "preconditions": [
        "Attempt to create L1 \u003e L2 \u003e L3 \u003e L4 hierarchy"
      ],
      "test_data": [
        {
          "field": "attemptedDepth",
          "value": "4",
          "notes": "Beyond maximum"
        }
      ],
      "steps": [
        "Attempt to view 4-level deep category structure"
      ],
      "expected_results": [
        "Fourth level not displayed or not creatable"
      ],
      "should_not": "Should NOT allow or display categories deeper than 3 levels"
    },
    {
      "id": "TC-AC-CAT-001-H02",
      "name": "Should NOT require secondary category assignment",
      "category": "hallucination",
      "ac_ref": "AC-CAT-001",
      "br_refs": [
        "AMB-ENT-039"
      ],
      "preconditions": [
        "Product with only primary category assigned"
      ],
      "test_data": [
        {
          "field": "productId",
          "value": "PROD-SIMPLE",
          "notes": "Simple product"
        },
        {
          "field": "primaryOnly",
          "value": "true",
          "notes": "No secondary"
        }
      ],
      "steps": [
        "Create product with primary category only",
        "Save product"
      ],
      "expected_results": [
        "Product saves successfully",
        "No validation error"
      ],
      "should_not": "Should NOT require secondary category to be assigned"
    }
  ]
}