{
  "api_spec": {
    "openapi": "3.0.0",
    "info": {
      "title": "E-Commerce Order API",
      "version": "1.0.0"
    },
    "paths": {
      "/api/admin/orders": {
        "get": {
          "operationId": "listOrders",
          "parameters": [
            {
              "in": "query",
              "name": "status",
              "schema": {
                "type": "string"
              }
            },
            {
              "in": "query",
              "name": "date_from",
              "schema": {
                "format": "date",
                "type": "string"
              }
            },
            {
              "in": "query",
              "name": "date_to",
              "schema": {
                "format": "date",
                "type": "string"
              }
            },
            {
              "in": "query",
              "name": "page",
              "schema": {
                "default": 1,
                "type": "integer"
              }
            },
            {
              "in": "query",
              "name": "limit",
              "schema": {
                "default": 20,
                "type": "integer"
              }
            }
          ],
          "responses": {
            "200": {
              "description": "Filtered orders list"
            }
          },
          "summary": "List orders with filters (admin)",
          "x-related-specs": [
            "TS-BR-ORDER-003"
          ]
        }
      },
      "/api/admin/orders/export": {
        "get": {
          "operationId": "exportOrders",
          "parameters": [
            {
              "in": "query",
              "name": "status",
              "schema": {
                "type": "string"
              }
            },
            {
              "in": "query",
              "name": "date_from",
              "schema": {
                "format": "date",
                "type": "string"
              }
            },
            {
              "in": "query",
              "name": "date_to",
              "schema": {
                "format": "date",
                "type": "string"
              }
            }
          ],
          "responses": {
            "200": {
              "content": {
                "text/csv": {}
              },
              "description": "CSV file download"
            }
          },
          "summary": "Export orders to CSV (admin)",
          "x-related-specs": [
            "TS-BR-ORDER-003"
          ]
        }
      },
      "/api/cart/items": {
        "post": {
          "operationId": "addCartItem",
          "requestBody": {
            "content": {
              "application/json": {
                "schema": {
                  "properties": {
                    "product_id": {
                      "format": "uuid",
                      "type": "string"
                    },
                    "quantity": {
                      "minimum": 1,
                      "type": "integer"
                    },
                    "variant_id": {
                      "format": "uuid",
                      "type": "string"
                    }
                  },
                  "required": [
                    "product_id",
                    "quantity"
                  ],
                  "type": "object"
                }
              }
            }
          },
          "responses": {
            "200": {
              "description": "Quantity limited to available stock"
            },
            "201": {
              "description": "Item added to cart"
            },
            "400": {
              "description": "Out of stock or variant required"
            }
          },
          "summary": "Add item to cart",
          "x-related-specs": [
            "TS-BR-CART-001",
            "TS-BR-CART-002",
            "TS-BR-CART-005"
          ]
        }
      },
      "/api/cart/items/{itemId}": {
        "delete": {
          "operationId": "removeCartItem",
          "parameters": [
            {
              "in": "path",
              "name": "itemId",
              "required": true,
              "schema": {
                "format": "uuid",
                "type": "string"
              }
            }
          ],
          "responses": {
            "200": {
              "description": "Item removed"
            }
          },
          "summary": "Remove item from cart",
          "x-related-specs": [
            "TS-BR-CART-003"
          ]
        },
        "put": {
          "operationId": "updateCartItem",
          "parameters": [
            {
              "in": "path",
              "name": "itemId",
              "required": true,
              "schema": {
                "format": "uuid",
                "type": "string"
              }
            }
          ],
          "requestBody": {
            "content": {
              "application/json": {
                "schema": {
                  "properties": {
                    "quantity": {
                      "minimum": 0,
                      "type": "integer"
                    }
                  },
                  "required": [
                    "quantity"
                  ],
                  "type": "object"
                }
              }
            }
          },
          "responses": {
            "200": {
              "description": "Quantity updated or item removed"
            },
            "400": {
              "description": "Quantity limited notification"
            }
          },
          "summary": "Update cart item quantity",
          "x-related-specs": [
            "TS-BR-CART-002",
            "TS-BR-CART-003"
          ]
        }
      },
      "/api/cart/merge": {
        "post": {
          "operationId": "mergeCart",
          "requestBody": {
            "content": {
              "application/json": {
                "schema": {
                  "properties": {
                    "guest_cart_id": {
                      "format": "uuid",
                      "type": "string"
                    }
                  },
                  "required": [
                    "guest_cart_id"
                  ],
                  "type": "object"
                }
              }
            }
          },
          "responses": {
            "200": {
              "description": "Carts merged"
            }
          },
          "summary": "Merge guest cart on login",
          "x-related-specs": [
            "TS-BR-CART-001"
          ]
        }
      },
      "/api/categories": {
        "post": {
          "operationId": "createCategory",
          "requestBody": {
            "content": {
              "application/json": {
                "schema": {
                  "properties": {
                    "name": {
                      "type": "string"
                    },
                    "parent_id": {
                      "format": "uuid",
                      "type": "string"
                    }
                  },
                  "required": [
                    "name"
                  ],
                  "type": "object"
                }
              }
            }
          },
          "responses": {
            "201": {
              "description": "Category created"
            },
            "400": {
              "description": "Max nesting exceeded"
            }
          },
          "summary": "Create category (admin)",
          "x-related-specs": [
            "TS-BR-CAT-001"
          ]
        }
      },
      "/api/customers/register": {
        "post": {
          "operationId": "registerCustomer",
          "requestBody": {
            "content": {
              "application/json": {
                "schema": {
                  "properties": {
                    "email": {
                      "format": "email",
                      "maxLength": 255,
                      "type": "string"
                    },
                    "first_name": {
                      "type": "string"
                    },
                    "last_name": {
                      "type": "string"
                    },
                    "password": {
                      "minLength": 8,
                      "type": "string"
                    }
                  },
                  "required": [
                    "email",
                    "password",
                    "first_name",
                    "last_name"
                  ],
                  "type": "object"
                }
              }
            }
          },
          "responses": {
            "201": {
              "description": "Customer registered successfully"
            },
            "400": {
              "description": "Invalid password format"
            },
            "409": {
              "description": "Email already registered"
            }
          },
          "summary": "Register new customer",
          "x-related-specs": [
            "TS-BR-CUST-002",
            "TS-BR-CUST-003"
          ]
        }
      },
      "/api/customers/{customerId}/addresses": {
        "post": {
          "operationId": "addAddress",
          "parameters": [
            {
              "in": "path",
              "name": "customerId",
              "required": true,
              "schema": {
                "format": "uuid",
                "type": "string"
              }
            }
          ],
          "requestBody": {
            "content": {
              "application/json": {
                "schema": {
                  "properties": {
                    "city": {
                      "maxLength": 100,
                      "type": "string"
                    },
                    "country": {
                      "maxLength": 2,
                      "type": "string"
                    },
                    "postal_code": {
                      "maxLength": 20,
                      "type": "string"
                    },
                    "recipient_name": {
                      "maxLength": 200,
                      "type": "string"
                    },
                    "state": {
                      "maxLength": 100,
                      "type": "string"
                    },
                    "street": {
                      "maxLength": 255,
                      "type": "string"
                    }
                  },
                  "required": [
                    "street",
                    "city",
                    "state",
                    "postal_code",
                    "country",
                    "recipient_name"
                  ],
                  "type": "object"
                }
              }
            }
          },
          "responses": {
            "201": {
              "description": "Address added"
            },
            "400": {
              "description": "Invalid address or postal code"
            }
          },
          "summary": "Add shipping address",
          "x-related-specs": [
            "TS-BR-SHIP-001",
            "TS-BR-SHIP-002"
          ]
        }
      },
      "/api/customers/{customerId}/erasure": {
        "post": {
          "operationId": "requestDataErasure",
          "parameters": [
            {
              "in": "path",
              "name": "customerId",
              "required": true,
              "schema": {
                "format": "uuid",
                "type": "string"
              }
            }
          ],
          "responses": {
            "200": {
              "description": "Erasure completed"
            },
            "400": {
              "description": "Pending orders exist"
            }
          },
          "summary": "Request GDPR data erasure",
          "x-related-specs": [
            "TS-BR-CUST-001"
          ]
        }
      },
      "/api/inventory/bulk": {
        "post": {
          "operationId": "bulkUpdateInventory",
          "requestBody": {
            "content": {
              "multipart/form-data": {
                "schema": {
                  "properties": {
                    "file": {
                      "format": "binary",
                      "type": "string"
                    }
                  },
                  "required": [
                    "file"
                  ],
                  "type": "object"
                }
              }
            }
          },
          "responses": {
            "200": {
              "description": "Bulk update result with errors"
            }
          },
          "summary": "Bulk inventory update via CSV (admin)",
          "x-related-specs": [
            "TS-BR-INV-004"
          ]
        }
      },
      "/api/inventory/{productId}": {
        "put": {
          "operationId": "setInventory",
          "parameters": [
            {
              "in": "path",
              "name": "productId",
              "required": true,
              "schema": {
                "format": "uuid",
                "type": "string"
              }
            }
          ],
          "requestBody": {
            "content": {
              "application/json": {
                "schema": {
                  "properties": {
                    "quantity": {
                      "minimum": 0,
                      "type": "integer"
                    },
                    "reason": {
                      "type": "string"
                    }
                  },
                  "required": [
                    "quantity",
                    "reason"
                  ],
                  "type": "object"
                }
              }
            }
          },
          "responses": {
            "200": {
              "description": "Inventory updated"
            }
          },
          "summary": "Set inventory quantity (admin)",
          "x-related-specs": [
            "TS-BR-INV-001",
            "TS-BR-INV-004"
          ]
        }
      },
      "/api/inventory/{productId}/adjust": {
        "post": {
          "operationId": "adjustInventory",
          "parameters": [
            {
              "in": "path",
              "name": "productId",
              "required": true,
              "schema": {
                "format": "uuid",
                "type": "string"
              }
            }
          ],
          "requestBody": {
            "content": {
              "application/json": {
                "schema": {
                  "properties": {
                    "adjustment": {
                      "type": "integer"
                    },
                    "reason": {
                      "type": "string"
                    }
                  },
                  "required": [
                    "adjustment",
                    "reason"
                  ],
                  "type": "object"
                }
              }
            }
          },
          "responses": {
            "200": {
              "description": "Inventory adjusted"
            },
            "400": {
              "description": "Insufficient stock"
            }
          },
          "summary": "Adjust inventory delta (admin)",
          "x-related-specs": [
            "TS-BR-INV-001",
            "TS-BR-INV-004"
          ]
        }
      },
      "/api/orders": {
        "get": {
          "operationId": "getOrderHistory",
          "parameters": [
            {
              "in": "query",
              "name": "page",
              "schema": {
                "default": 1,
                "type": "integer"
              }
            },
            {
              "in": "query",
              "name": "limit",
              "schema": {
                "default": 20,
                "type": "integer"
              }
            }
          ],
          "responses": {
            "200": {
              "description": "Order history with pagination"
            }
          },
          "summary": "Get order history",
          "x-related-specs": [
            "TS-BR-ORDER-003"
          ]
        },
        "post": {
          "operationId": "placeOrder",
          "requestBody": {
            "content": {
              "application/json": {
                "schema": {
                  "properties": {
                    "payment_method_id": {
                      "format": "uuid",
                      "type": "string"
                    },
                    "shipping_address_id": {
                      "format": "uuid",
                      "type": "string"
                    }
                  },
                  "required": [
                    "shipping_address_id",
                    "payment_method_id"
                  ],
                  "type": "object"
                }
              }
            }
          },
          "responses": {
            "201": {
              "description": "Order created"
            },
            "400": {
              "description": "Stock unavailable or empty cart"
            },
            "402": {
              "description": "Payment failed"
            },
            "403": {
              "description": "Email not verified"
            }
          },
          "summary": "Place order",
          "x-related-specs": [
            "TS-BR-CUST-001",
            "TS-BR-ORDER-001",
            "TS-BR-ORDER-005",
            "TS-BR-ORDER-006",
            "TS-BR-INV-002",
            "TS-BR-PAY-001"
          ]
        }
      },
      "/api/orders/{orderId}": {
        "get": {
          "operationId": "getOrder",
          "parameters": [
            {
              "in": "path",
              "name": "orderId",
              "required": true,
              "schema": {
                "format": "uuid",
                "type": "string"
              }
            }
          ],
          "responses": {
            "200": {
              "description": "Order details with tracking"
            },
            "404": {
              "description": "Order not found"
            }
          },
          "summary": "Get order details",
          "x-related-specs": [
            "TS-BR-ORDER-006"
          ]
        }
      },
      "/api/orders/{orderId}/cancel": {
        "post": {
          "operationId": "cancelOrder",
          "parameters": [
            {
              "in": "path",
              "name": "orderId",
              "required": true,
              "schema": {
                "format": "uuid",
                "type": "string"
              }
            }
          ],
          "requestBody": {
            "content": {
              "application/json": {
                "schema": {
                  "properties": {
                    "reason": {
                      "type": "string"
                    }
                  },
                  "type": "object"
                }
              }
            }
          },
          "responses": {
            "200": {
              "description": "Order cancelled, refund initiated"
            },
            "400": {
              "description": "Order already shipped"
            }
          },
          "summary": "Cancel order",
          "x-related-specs": [
            "TS-BR-ORDER-002",
            "TS-BR-ORDER-004",
            "TS-BR-INV-003",
            "TS-BR-PAY-003"
          ]
        }
      },
      "/api/orders/{orderId}/status": {
        "put": {
          "operationId": "updateOrderStatus",
          "parameters": [
            {
              "in": "path",
              "name": "orderId",
              "required": true,
              "schema": {
                "format": "uuid",
                "type": "string"
              }
            }
          ],
          "requestBody": {
            "content": {
              "application/json": {
                "schema": {
                  "properties": {
                    "status": {
                      "enum": [
                        "confirmed",
                        "shipped",
                        "delivered"
                      ],
                      "type": "string"
                    },
                    "tracking_number": {
                      "type": "string"
                    }
                  },
                  "required": [
                    "status"
                  ],
                  "type": "object"
                }
              }
            }
          },
          "responses": {
            "200": {
              "description": "Status updated"
            },
            "400": {
              "description": "Invalid status transition"
            }
          },
          "summary": "Update order status (admin)",
          "x-related-specs": [
            "TS-BR-ORDER-003"
          ]
        }
      },
      "/api/payments/methods": {
        "post": {
          "operationId": "savePaymentMethod",
          "requestBody": {
            "content": {
              "application/json": {
                "schema": {
                  "properties": {
                    "card_number": {
                      "type": "string"
                    },
                    "cvv": {
                      "type": "string"
                    },
                    "expiry_month": {
                      "type": "integer"
                    },
                    "expiry_year": {
                      "type": "integer"
                    },
                    "save_for_future": {
                      "type": "boolean"
                    }
                  },
                  "required": [
                    "card_number",
                    "expiry_month",
                    "expiry_year",
                    "cvv"
                  ],
                  "type": "object"
                }
              }
            }
          },
          "responses": {
            "201": {
              "description": "Payment method saved"
            },
            "400": {
              "description": "Unsupported card type"
            }
          },
          "summary": "Save payment method",
          "x-related-specs": [
            "TS-BR-PAY-002"
          ]
        }
      },
      "/api/payments/paypal/authorize": {
        "post": {
          "operationId": "initiatePayPal",
          "requestBody": {
            "content": {
              "application/json": {
                "schema": {
                  "properties": {
                    "amount": {
                      "type": "number"
                    },
                    "cancel_url": {
                      "type": "string"
                    },
                    "return_url": {
                      "type": "string"
                    }
                  },
                  "required": [
                    "amount",
                    "return_url",
                    "cancel_url"
                  ],
                  "type": "object"
                }
              }
            }
          },
          "responses": {
            "200": {
              "description": "PayPal redirect URL"
            }
          },
          "summary": "Initiate PayPal authorization",
          "x-related-specs": [
            "TS-BR-PAY-001"
          ]
        }
      },
      "/api/payments/paypal/callback": {
        "get": {
          "operationId": "handlePayPalCallback",
          "parameters": [
            {
              "in": "query",
              "name": "token",
              "required": true,
              "schema": {
                "type": "string"
              }
            },
            {
              "in": "query",
              "name": "PayerID",
              "schema": {
                "type": "string"
              }
            }
          ],
          "responses": {
            "302": {
              "description": "Redirect to order confirmation or checkout"
            }
          },
          "summary": "PayPal callback handler",
          "x-related-specs": [
            "TS-BR-PAY-001"
          ]
        }
      },
      "/api/products": {
        "get": {
          "operationId": "listProducts",
          "parameters": [
            {
              "in": "query",
              "name": "category",
              "schema": {
                "type": "string"
              }
            },
            {
              "in": "query",
              "name": "price_min",
              "schema": {
                "type": "number"
              }
            },
            {
              "in": "query",
              "name": "price_max",
              "schema": {
                "type": "number"
              }
            },
            {
              "in": "query",
              "name": "availability",
              "schema": {
                "enum": [
                  "in_stock",
                  "out_of_stock",
                  "all"
                ],
                "type": "string"
              }
            },
            {
              "in": "query",
              "name": "page",
              "schema": {
                "default": 1,
                "type": "integer"
              }
            },
            {
              "in": "query",
              "name": "limit",
              "schema": {
                "default": 20,
                "type": "integer"
              }
            }
          ],
          "responses": {
            "200": {
              "description": "Products list"
            }
          },
          "summary": "List and filter products",
          "x-related-specs": [
            "TS-BR-PROD-001"
          ]
        },
        "post": {
          "operationId": "createProduct",
          "requestBody": {
            "content": {
              "application/json": {
                "schema": {
                  "properties": {
                    "category_id": {
                      "format": "uuid",
                      "type": "string"
                    },
                    "description": {
                      "type": "string"
                    },
                    "name": {
                      "maxLength": 200,
                      "minLength": 2,
                      "type": "string"
                    },
                    "price": {
                      "minimum": 0.01,
                      "type": "number"
                    }
                  },
                  "required": [
                    "name",
                    "price",
                    "category_id"
                  ],
                  "type": "object"
                }
              }
            }
          },
          "responses": {
            "201": {
              "description": "Product created as draft"
            },
            "400": {
              "description": "Invalid price or name"
            }
          },
          "summary": "Create new product (admin)",
          "x-related-specs": [
            "TS-BR-PROD-001",
            "TS-BR-PROD-002"
          ]
        }
      },
      "/api/products/{productId}": {
        "delete": {
          "operationId": "deleteProduct",
          "parameters": [
            {
              "in": "path",
              "name": "productId",
              "required": true,
              "schema": {
                "format": "uuid",
                "type": "string"
              }
            }
          ],
          "responses": {
            "200": {
              "description": "Product soft-deleted"
            },
            "404": {
              "description": "Product not found"
            }
          },
          "summary": "Delete product (admin)",
          "x-related-specs": [
            "TS-BR-PROD-003"
          ]
        },
        "get": {
          "operationId": "getProduct",
          "parameters": [
            {
              "in": "path",
              "name": "productId",
              "required": true,
              "schema": {
                "format": "uuid",
                "type": "string"
              }
            }
          ],
          "responses": {
            "200": {
              "description": "Product details with variants"
            },
            "404": {
              "description": "Product not found"
            }
          },
          "summary": "Get product details",
          "x-related-specs": [
            "TS-BR-PROD-004"
          ]
        },
        "put": {
          "operationId": "updateProduct",
          "parameters": [
            {
              "in": "path",
              "name": "productId",
              "required": true,
              "schema": {
                "format": "uuid",
                "type": "string"
              }
            }
          ],
          "requestBody": {
            "content": {
              "application/json": {
                "schema": {
                  "properties": {
                    "category_id": {
                      "format": "uuid",
                      "type": "string"
                    },
                    "description": {
                      "type": "string"
                    },
                    "name": {
                      "maxLength": 200,
                      "minLength": 2,
                      "type": "string"
                    },
                    "price": {
                      "minimum": 0.01,
                      "type": "number"
                    }
                  },
                  "type": "object"
                }
              }
            }
          },
          "responses": {
            "200": {
              "description": "Product updated"
            },
            "400": {
              "description": "Invalid data"
            },
            "409": {
              "description": "Concurrent edit conflict"
            }
          },
          "summary": "Update product (admin)",
          "x-related-specs": [
            "TS-BR-PROD-001",
            "TS-BR-PROD-002"
          ]
        }
      },
      "/api/products/{productId}/images": {
        "post": {
          "operationId": "uploadProductImages",
          "parameters": [
            {
              "in": "path",
              "name": "productId",
              "required": true,
              "schema": {
                "format": "uuid",
                "type": "string"
              }
            }
          ],
          "requestBody": {
            "content": {
              "multipart/form-data": {
                "schema": {
                  "properties": {
                    "images": {
                      "items": {
                        "format": "binary",
                        "type": "string"
                      },
                      "maxItems": 10,
                      "type": "array"
                    },
                    "primary_index": {
                      "type": "integer"
                    }
                  },
                  "type": "object"
                }
              }
            }
          },
          "responses": {
            "201": {
              "description": "Images uploaded"
            },
            "400": {
              "description": "Max images exceeded"
            }
          },
          "summary": "Upload product images (admin)",
          "x-related-specs": [
            "TS-BR-PROD-001"
          ]
        }
      }
    }
  },
  "implementation_skeletons": [
    {
      "name": "CustomerService",
      "type": "service",
      "functions": [
        {
          "name": "register",
          "signature": "register(email: string, password: string, firstName: string, lastName: string): Customer",
          "description": "Register new customer with email uniqueness check",
          "steps": [
            "Validate email format",
            "Check email uniqueness in database",
            "Validate password meets requirements (8+ chars, 1 number)",
            "Hash password",
            "Create customer with unverified status",
            "Queue verification email"
          ],
          "error_cases": [
            "DUPLICATE_EMAIL",
            "INVALID_PASSWORD"
          ]
        },
        {
          "name": "addAddress",
          "signature": "addAddress(customerId: UUID, address: AddressInput): Address",
          "description": "Add shipping address with validation",
          "steps": [
            "Validate all required fields present",
            "Validate postal code format",
            "Validate country is domestic",
            "Save address"
          ],
          "error_cases": [
            "INVALID_ADDRESS",
            "INVALID_POSTAL_CODE",
            "UNSUPPORTED_SHIPPING_REGION"
          ]
        },
        {
          "name": "requestDataErasure",
          "signature": "requestDataErasure(customerId: UUID): void",
          "description": "GDPR data erasure with pending order check",
          "steps": [
            "Check for pending orders",
            "Delete personal data",
            "Anonymize order history",
            "Send confirmation email"
          ],
          "error_cases": [
            "PENDING_ORDERS_EXIST"
          ]
        },
        {
          "name": "verifyOrderEligibility",
          "signature": "verifyOrderEligibility(customerId: UUID): boolean",
          "description": "Check if customer can place orders",
          "steps": [
            "Check registration status",
            "Check email verification status"
          ],
          "error_cases": [
            "UNAUTHORIZED_ORDER",
            "EMAIL_NOT_VERIFIED"
          ]
        }
      ],
      "dependencies": [
        "EmailService",
        "CustomerRepository"
      ],
      "related_specs": [
        "TS-BR-CUST-001",
        "TS-BR-CUST-002",
        "TS-BR-CUST-003",
        "TS-BR-SHIP-001",
        "TS-BR-SHIP-002"
      ]
    },
    {
      "name": "ProductService",
      "type": "service",
      "functions": [
        {
          "name": "listProducts",
          "signature": "listProducts(filters: ProductFilters, page: number, limit: number): ProductList",
          "description": "Filter and paginate products",
          "steps": [
            "Build query from filters",
            "Apply pagination",
            "Return products with total count"
          ],
          "error_cases": []
        },
        {
          "name": "createProduct",
          "signature": "createProduct(input: ProductInput): Product",
          "description": "Create new product as draft",
          "steps": [
            "Validate name length (2-200 chars)",
            "Validate price (\u003e= 0.01)",
            "Create product with draft status",
            "Generate UUID"
          ],
          "error_cases": [
            "INVALID_PRICE",
            "NAME_REQUIRED",
            "NAME_TOO_LONG"
          ]
        },
        {
          "name": "updateProduct",
          "signature": "updateProduct(productId: UUID, input: ProductInput): Product",
          "description": "Update product with conflict detection",
          "steps": [
            "Fetch current product",
            "Validate input fields",
            "Check for concurrent edits",
            "Update product",
            "Log change"
          ],
          "error_cases": [
            "INVALID_PRICE",
            "NAME_REQUIRED",
            "NAME_TOO_LONG"
          ]
        },
        {
          "name": "deleteProduct",
          "signature": "deleteProduct(productId: UUID): void",
          "description": "Soft delete product if has order history",
          "steps": [
            "Check for order line item references",
            "If has references: soft delete (set isDeleted, deletedAt)",
            "If no references: allow hard delete"
          ],
          "error_cases": []
        },
        {
          "name": "uploadImages",
          "signature": "uploadImages(productId: UUID, images: File[], primaryIndex: number): ImageList",
          "description": "Upload product images with limit check",
          "steps": [
            "Check current image count",
            "Validate total \u003c= 10",
            "Upload to storage",
            "Set primary image"
          ],
          "error_cases": [
            "MAX_IMAGES_EXCEEDED"
          ]
        }
      ],
      "dependencies": [
        "ProductRepository",
        "StorageService",
        "InventoryService"
      ],
      "related_specs": [
        "TS-BR-PROD-001",
        "TS-BR-PROD-002",
        "TS-BR-PROD-003",
        "TS-BR-PROD-004"
      ]
    },
    {
      "name": "CartService",
      "type": "service",
      "functions": [
        {
          "name": "addItem",
          "signature": "addItem(cartId: UUID, productId: UUID, variantId: UUID | null, quantity: number): CartItem",
          "description": "Add item to cart with stock validation",
          "steps": [
            "Check if product has variants and variant required",
            "Validate stock availability (must be \u003e 0)",
            "Check for existing cart item",
            "If exists: increase quantity",
            "If new: create cart item",
            "Cap quantity to available stock",
            "Update cart lastActivityDate"
          ],
          "error_cases": [
            "OUT_OF_STOCK",
            "VARIANT_REQUIRED",
            "QUANTITY_LIMITED"
          ]
        },
        {
          "name": "updateItemQuantity",
          "signature": "updateItemQuantity(cartId: UUID, itemId: UUID, quantity: number): CartItem | null",
          "description": "Update cart item quantity or remove if zero",
          "steps": [
            "If quantity \u003c= 0: remove item",
            "Check available stock",
            "Cap to available if needed",
            "Update quantity",
            "Recalculate totals"
          ],
          "error_cases": [
            "QUANTITY_LIMITED"
          ]
        },
        {
          "name": "removeItem",
          "signature": "removeItem(cartId: UUID, itemId: UUID): void",
          "description": "Remove item from cart",
          "steps": [
            "Delete cart item",
            "Return undo token (5 second window)"
          ],
          "error_cases": []
        },
        {
          "name": "mergeCarts",
          "signature": "mergeCarts(guestCartId: UUID, customerCartId: UUID): Cart",
          "description": "Merge guest cart into customer cart on login",
          "steps": [
            "Get both carts",
            "For each guest item: add to customer cart or increase quantity",
            "Apply stock limits",
            "Delete guest cart"
          ],
          "error_cases": []
        },
        {
          "name": "validateCart",
          "signature": "validateCart(cartId: UUID): CartValidationResult",
          "description": "Validate cart items for checkout",
          "steps": [
            "Check each item's current stock",
            "Check for price changes",
            "Mark invalid items",
            "Return validation result"
          ],
          "error_cases": [
            "OUT_OF_STOCK"
          ]
        },
        {
          "name": "expireInactiveCarts",
          "signature": "expireInactiveCarts(): number",
          "description": "Background job to expire old carts",
          "steps": [
            "Find carts where lastActivityDate \u003e threshold",
            "30 days for logged-in, 7 days for guest",
            "Delete expired carts",
            "Return count deleted"
          ],
          "error_cases": []
        }
      ],
      "dependencies": [
        "CartRepository",
        "InventoryService",
        "ProductService"
      ],
      "related_specs": [
        "TS-BR-CART-001",
        "TS-BR-CART-002",
        "TS-BR-CART-003",
        "TS-BR-CART-004",
        "TS-BR-CART-005"
      ]
    },
    {
      "name": "OrderService",
      "type": "service",
      "functions": [
        {
          "name": "placeOrder",
          "signature": "placeOrder(customerId: UUID, shippingAddressId: UUID, paymentMethodId: UUID): Order",
          "description": "Create order with all validations",
          "steps": [
            "Verify customer order eligibility",
            "Get and validate cart (non-empty, stock available)",
            "Calculate totals (subtotal, shipping, tax)",
            "Authorize payment",
            "Create order with price snapshots",
            "Generate order number",
            "Decrement inventory",
            "Clear cart",
            "Queue confirmation email"
          ],
          "error_cases": [
            "EMAIL_NOT_VERIFIED",
            "EMPTY_ORDER",
            "STOCK_UNAVAILABLE",
            "PAYMENT_FAILED"
          ]
        },
        {
          "name": "cancelOrder",
          "signature": "cancelOrder(orderId: UUID, reason: string): Order",
          "description": "Cancel order with refund and inventory restore",
          "steps": [
            "Verify order status is cancellable (pending or confirmed)",
            "Update status to cancelled",
            "Restore inventory for all line items",
            "Initiate refund",
            "Send cancellation email"
          ],
          "error_cases": [
            "ORDER_ALREADY_SHIPPED",
            "ORDER_NOT_MODIFIABLE"
          ]
        },
        {
          "name": "updateStatus",
          "signature": "updateStatus(orderId: UUID, newStatus: OrderStatus, trackingNumber: string | null): Order",
          "description": "Update order status with transition validation",
          "steps": [
            "Fetch order",
            "Validate status transition using state machine",
            "Update status",
            "If shipped: store tracking number",
            "Send status notification email"
          ],
          "error_cases": [
            "INVALID_STATUS_TRANSITION"
          ]
        },
        {
          "name": "getOrderHistory",
          "signature": "getOrderHistory(customerId: UUID, page: number, limit: number): OrderList",
          "description": "Get paginated order history",
          "steps": [
            "Query orders by customer",
            "Sort by date descending",
            "Apply pagination",
            "Include status and basic details"
          ],
          "error_cases": []
        },
        {
          "name": "calculateTotals",
          "signature": "calculateTotals(cart: Cart, shippingAddress: Address): OrderTotals",
          "description": "Calculate order totals including shipping and tax",
          "steps": [
            "Sum line item prices for subtotal",
            "Apply free shipping if subtotal \u003e 50",
            "Calculate tax based on shipping address",
            "Return totals breakdown"
          ],
          "error_cases": []
        },
        {
          "name": "generateOrderNumber",
          "signature": "generateOrderNumber(): string",
          "description": "Generate sequential order number",
          "steps": [
            "Get current year",
            "Get last order number for year",
            "Increment sequence",
            "Format as ORD-YYYY-NNNNN"
          ],
          "error_cases": []
        }
      ],
      "dependencies": [
        "CustomerService",
        "CartService",
        "InventoryService",
        "PaymentService",
        "EmailService",
        "OrderRepository"
      ],
      "related_specs": [
        "TS-BR-CUST-001",
        "TS-BR-ORDER-001",
        "TS-BR-ORDER-002",
        "TS-BR-ORDER-003",
        "TS-BR-ORDER-004",
        "TS-BR-ORDER-005",
        "TS-BR-ORDER-006",
        "TS-BR-INV-002",
        "TS-BR-INV-003"
      ]
    },
    {
      "name": "InventoryService",
      "type": "service",
      "functions": [
        {
          "name": "getAvailableQuantity",
          "signature": "getAvailableQuantity(productId: UUID, variantId: UUID | null): number",
          "description": "Get current available stock",
          "steps": [
            "Query inventory table",
            "Return stockLevel"
          ],
          "error_cases": []
        },
        {
          "name": "setQuantity",
          "signature": "setQuantity(productId: UUID, quantity: number, reason: string, userId: UUID): void",
          "description": "Set absolute inventory quantity",
          "steps": [
            "Get current stock level",
            "Validate quantity \u003e= 0",
            "Update stock level",
            "Create audit log entry"
          ],
          "error_cases": []
        },
        {
          "name": "adjustQuantity",
          "signature": "adjustQuantity(productId: UUID, adjustment: number, reason: string, userId: UUID): void",
          "description": "Adjust inventory by delta amount",
          "steps": [
            "Get current stock level",
            "Calculate new level",
            "Validate new level \u003e= 0",
            "Update stock level",
            "Create audit log entry",
            "Check low stock alert threshold"
          ],
          "error_cases": [
            "INSUFFICIENT_STOCK"
          ]
        },
        {
          "name": "decrementForOrder",
          "signature": "decrementForOrder(lineItems: OrderLineItem[]): void",
          "description": "Atomically decrement stock for order",
          "steps": [
            "Start transaction",
            "For each line item: decrement by quantity",
            "Verify no negative stock",
            "Commit transaction"
          ],
          "error_cases": [
            "INSUFFICIENT_STOCK"
          ]
        },
        {
          "name": "restoreForCancellation",
          "signature": "restoreForCancellation(orderId: UUID): void",
          "description": "Restore inventory when order cancelled",
          "steps": [
            "Get order line items",
            "For each item: increment stock by quantity",
            "Create audit log entries"
          ],
          "error_cases": []
        },
        {
          "name": "bulkUpdate",
          "signature": "bulkUpdate(updates: InventoryUpdate[]): BulkUpdateResult",
          "description": "Process CSV bulk update",
          "steps": [
            "Parse CSV file",
            "Validate SKUs exist",
            "Apply valid updates",
            "Collect errors for invalid rows",
            "Return summary"
          ],
          "error_cases": []
        },
        {
          "name": "checkLowStockAlerts",
          "signature": "checkLowStockAlerts(): LowStockAlert[]",
          "description": "Check products below threshold",
          "steps": [
            "Query products where stock \u003c threshold",
            "Generate alerts",
            "Send notifications"
          ],
          "error_cases": []
        }
      ],
      "dependencies": [
        "InventoryRepository",
        "InventoryAuditRepository",
        "NotificationService"
      ],
      "related_specs": [
        "TS-BR-INV-001",
        "TS-BR-INV-002",
        "TS-BR-INV-003",
        "TS-BR-INV-004"
      ]
    },
    {
      "name": "PaymentService",
      "type": "service",
      "functions": [
        {
          "name": "authorizePayment",
          "signature": "authorizePayment(paymentMethodId: UUID, amount: number): PaymentAuthorization",
          "description": "Authorize payment before order creation",
          "steps": [
            "Get payment method details",
            "Call payment gateway authorization API",
            "Store authorization ID",
            "Return authorization result"
          ],
          "error_cases": [
            "PAYMENT_FAILED",
            "PAYMENT_DECLINED"
          ]
        },
        {
          "name": "capturePayment",
          "signature": "capturePayment(authorizationId: string, amount: number): PaymentCapture",
          "description": "Capture authorized payment",
          "steps": [
            "Call payment gateway capture API",
            "Update payment status",
            "Return capture result"
          ],
          "error_cases": [
            "CAPTURE_FAILED"
          ]
        },
        {
          "name": "refundPayment",
          "signature": "refundPayment(orderId: UUID): Refund",
          "description": "Refund payment for cancelled order",
          "steps": [
            "Get original transaction ID",
            "Call payment gateway refund API",
            "Store refund record",
            "Return refund result"
          ],
          "error_cases": [
            "REFUND_FAILED"
          ]
        },
        {
          "name": "savePaymentMethod",
          "signature": "savePaymentMethod(customerId: UUID, cardDetails: CardDetails, saveForFuture: boolean): PaymentMethod",
          "description": "Tokenize and save payment method",
          "steps": [
            "Detect card type from BIN",
            "Validate card type accepted (Visa, MC, Amex)",
            "Tokenize with payment gateway",
            "If saveForFuture: store token",
            "Return payment method"
          ],
          "error_cases": [
            "UNSUPPORTED_CARD_TYPE"
          ]
        },
        {
          "name": "initiatePayPal",
          "signature": "initiatePayPal(amount: number, returnUrl: string, cancelUrl: string): PayPalSession",
          "description": "Start PayPal authorization flow",
          "steps": [
            "Create PayPal order",
            "Get approval URL",
            "Return redirect URL"
          ],
          "error_cases": []
        },
        {
          "name": "handlePayPalCallback",
          "signature": "handlePayPalCallback(token: string, payerId: string | null): PayPalResult",
          "description": "Process PayPal callback",
          "steps": [
            "If payerId present: capture payment",
            "If cancelled: mark as cancelled",
            "Return result"
          ],
          "error_cases": [
            "PAYMENT_CANCELLED"
          ]
        }
      ],
      "dependencies": [
        "PaymentGateway",
        "PaymentMethodRepository"
      ],
      "related_specs": [
        "TS-BR-PAY-001",
        "TS-BR-PAY-002",
        "TS-BR-PAY-003"
      ]
    },
    {
      "name": "CategoryService",
      "type": "service",
      "functions": [
        {
          "name": "createCategory",
          "signature": "createCategory(name: string, parentId: UUID | null): Category",
          "description": "Create category with nesting validation",
          "steps": [
            "If parentId: calculate depth by traversing parent chain",
            "Validate depth \u003c= 3",
            "Create category"
          ],
          "error_cases": [
            "MAX_NESTING_EXCEEDED"
          ]
        },
        {
          "name": "getCategoryTree",
          "signature": "getCategoryTree(): CategoryNode[]",
          "description": "Get full category hierarchy",
          "steps": [
            "Query all categories",
            "Build tree structure",
            "Return root nodes with children"
          ],
          "error_cases": []
        }
      ],
      "dependencies": [
        "CategoryRepository"
      ],
      "related_specs": [
        "TS-BR-CAT-001"
      ]
    },
    {
      "name": "EmailService",
      "type": "service",
      "functions": [
        {
          "name": "queueOrderConfirmation",
          "signature": "queueOrderConfirmation(orderId: UUID): void",
          "description": "Queue order confirmation email async",
          "steps": [
            "Create email event",
            "Publish to message queue",
            "Return immediately (non-blocking)"
          ],
          "error_cases": []
        },
        {
          "name": "processEmailQueue",
          "signature": "processEmailQueue(): void",
          "description": "Background worker to process email queue",
          "steps": [
            "Consume message from queue",
            "Check deduplication table",
            "If not sent: send email",
            "Mark as sent in deduplication table",
            "Retry on failure"
          ],
          "error_cases": []
        },
        {
          "name": "sendEmail",
          "signature": "sendEmail(type: EmailType, recipient: string, data: object): void",
          "description": "Send email via provider",
          "steps": [
            "Render email template",
            "Call email provider API",
            "Log result"
          ],
          "error_cases": []
        }
      ],
      "dependencies": [
        "MessageQueue",
        "EmailProvider",
        "EmailSentRepository"
      ],
      "related_specs": [
        "TS-BR-EMAIL-001",
        "TS-BR-EMAIL-002"
      ]
    },
    {
      "name": "AdminOrderService",
      "type": "service",
      "functions": [
        {
          "name": "listOrders",
          "signature": "listOrders(filters: OrderFilters, page: number, limit: number): OrderList",
          "description": "List orders with admin filters",
          "steps": [
            "Build query from filters (status, date range)",
            "Apply pagination",
            "Return orders with totals"
          ],
          "error_cases": []
        },
        {
          "name": "exportOrdersCsv",
          "signature": "exportOrdersCsv(filters: OrderFilters): Buffer",
          "description": "Export filtered orders to CSV",
          "steps": [
            "Query orders matching filters",
            "Format as CSV",
            "Return file buffer"
          ],
          "error_cases": []
        }
      ],
      "dependencies": [
        "OrderRepository"
      ],
      "related_specs": [
        "TS-BR-ORDER-003"
      ]
    }
  ],
  "summary": {
    "endpoints_count": 24,
    "services_count": 9,
    "functions_count": 43
  }
}