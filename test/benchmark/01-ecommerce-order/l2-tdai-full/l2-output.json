{
  "aggregates": [
    {
      "id": "AGG-CUSTOMER-001",
      "name": "Customer",
      "purpose": "Manages customer identity, authentication, and serves as the anchor for shopping cart and order history",
      "invariants": [
        {
          "id": "INV-CUST-001",
          "rule": "Customer must be registered to place orders",
          "enforcement": "Guard clause in placeOrder() validates registrationStatus='registered'"
        },
        {
          "id": "INV-CUST-002",
          "rule": "Email must be unique across all customers",
          "enforcement": "Database unique constraint on email field"
        },
        {
          "id": "INV-CUST-003",
          "rule": "Password must be at least 8 characters with at least one digit",
          "enforcement": "Validation in register() and changePassword() operations"
        },
        {
          "id": "INV-CUST-004",
          "rule": "Customer always has exactly one cart",
          "enforcement": "Cart created automatically during customer registration"
        }
      ],
      "root": {
        "entity": "Customer",
        "identity": "CustomerId (UUID)",
        "attributes": [
          {
            "name": "email",
            "type": "Email",
            "mutable": false
          },
          {
            "name": "passwordHash",
            "type": "string",
            "mutable": true
          },
          {
            "name": "registrationStatus",
            "type": "RegistrationStatus",
            "mutable": true
          },
          {
            "name": "emailVerified",
            "type": "boolean",
            "mutable": true
          },
          {
            "name": "createdAt",
            "type": "DateTime",
            "mutable": false
          }
        ]
      },
      "entities": [],
      "valueObjects": [
        "Email",
        "RegistrationStatus"
      ],
      "behaviors": [
        {
          "name": "register",
          "command": "RegisterCustomer",
          "preconditions": [
            "email not already registered"
          ],
          "postconditions": [
            "registrationStatus == 'registered'",
            "cart created"
          ],
          "emits": "CustomerRegistered"
        },
        {
          "name": "verifyEmail",
          "command": "VerifyCustomerEmail",
          "preconditions": [
            "registrationStatus == 'registered'",
            "emailVerified == false"
          ],
          "postconditions": [
            "emailVerified == true"
          ],
          "emits": "CustomerEmailVerified"
        }
      ],
      "events": [
        {
          "name": "CustomerRegistered",
          "payload": [
            "customerId",
            "email",
            "registeredAt"
          ]
        },
        {
          "name": "CustomerEmailVerified",
          "payload": [
            "customerId",
            "verifiedAt"
          ]
        }
      ],
      "repository": {
        "name": "CustomerRepository",
        "methods": [
          {
            "name": "findById",
            "params": "CustomerId",
            "returns": "Customer?"
          },
          {
            "name": "findByEmail",
            "params": "Email",
            "returns": "Customer?"
          },
          {
            "name": "save",
            "params": "Customer",
            "returns": "void"
          },
          {
            "name": "existsByEmail",
            "params": "Email",
            "returns": "boolean"
          }
        ],
        "loadStrategy": "Load customer without cart (cart is separate aggregate)",
        "concurrency": "Optimistic locking via version field"
      },
      "externalReferences": [
        {
          "aggregate": "Cart",
          "via": "customerId",
          "type": "reference"
        },
        {
          "aggregate": "Order",
          "via": "customerId",
          "type": "reference"
        }
      ]
    },
    {
      "id": "AGG-CART-001",
      "name": "Cart",
      "purpose": "Manages shopping cart state including item selection, quantity adjustments, and price calculations before checkout",
      "invariants": [
        {
          "id": "INV-CART-001",
          "rule": "Total price must equal sum of all cart item subtotals",
          "enforcement": "Recalculated after any item modification"
        },
        {
          "id": "INV-CART-002",
          "rule": "Each product can appear only once per cart",
          "enforcement": "addItem() updates quantity if product exists instead of creating duplicate"
        },
        {
          "id": "INV-CART-003",
          "rule": "Only in-stock products can be added",
          "enforcement": "Stock availability check via Inventory service before addItem()"
        },
        {
          "id": "INV-CART-004",
          "rule": "Cart item quantity cannot exceed available stock",
          "enforcement": "Quantity validation against Inventory.availableQuantity"
        },
        {
          "id": "INV-CART-005",
          "rule": "Cart item quantity must be at least 1",
          "enforcement": "Setting quantity to 0 triggers automatic item removal"
        },
        {
          "id": "INV-CART-006",
          "rule": "Products with variants require specific variant selection",
          "enforcement": "Validation in addItem() checks if product has variants"
        }
      ],
      "root": {
        "entity": "Cart",
        "identity": "CartId (UUID)",
        "attributes": [
          {
            "name": "customerId",
            "type": "CustomerId",
            "mutable": false
          },
          {
            "name": "totalPrice",
            "type": "Money",
            "mutable": true
          },
          {
            "name": "lastActivityDate",
            "type": "DateTime",
            "mutable": true
          },
          {
            "name": "createdAt",
            "type": "DateTime",
            "mutable": false
          }
        ]
      },
      "entities": [
        {
          "name": "CartItem",
          "identity": "CartItemId (UUID)",
          "purpose": "Represents a product with quantity in the shopping cart with price snapshot",
          "attributes": [
            {
              "name": "productId",
              "type": "ProductId",
              "mutable": false
            },
            {
              "name": "variantId",
              "type": "VariantId?",
              "mutable": false
            },
            {
              "name": "productName",
              "type": "string",
              "mutable": false
            },
            {
              "name": "unitPrice",
              "type": "Money",
              "mutable": false
            },
            {
              "name": "quantity",
              "type": "Quantity",
              "mutable": false
            },
            {
              "name": "subtotal",
              "type": "Money",
              "mutable": false
            }
          ]
        }
      ],
      "valueObjects": [
        "Money",
        "Quantity"
      ],
      "behaviors": [
        {
          "name": "addItem",
          "command": "AddItemToCart",
          "preconditions": [
            "product is active",
            "product is in stock",
            "quantity \u003e 0",
            "variant selected if required"
          ],
          "postconditions": [
            "item added or quantity updated",
            "totalPrice recalculated"
          ],
          "emits": "ItemAddedToCart"
        },
        {
          "name": "updateQuantity",
          "command": "UpdateCartItemQuantity",
          "preconditions": [
            "product exists in cart",
            "quantity \u003e 0",
            "quantity \u003c= availableStock"
          ],
          "postconditions": [
            "quantity updated",
            "subtotal recalculated",
            "totalPrice recalculated"
          ],
          "emits": "CartItemQuantityUpdated"
        },
        {
          "name": "removeItem",
          "command": "RemoveItemFromCart",
          "preconditions": [
            "product exists in cart"
          ],
          "postconditions": [
            "item removed",
            "totalPrice recalculated"
          ],
          "emits": "ItemRemovedFromCart"
        },
        {
          "name": "clear",
          "command": "ClearCart",
          "preconditions": [],
          "postconditions": [
            "all items removed",
            "totalPrice == 0"
          ],
          "emits": "CartCleared"
        }
      ],
      "events": [
        {
          "name": "ItemAddedToCart",
          "payload": [
            "cartId",
            "productId",
            "variantId",
            "productName",
            "unitPrice",
            "quantity"
          ]
        },
        {
          "name": "CartItemQuantityUpdated",
          "payload": [
            "cartId",
            "productId",
            "oldQuantity",
            "newQuantity"
          ]
        },
        {
          "name": "ItemRemovedFromCart",
          "payload": [
            "cartId",
            "productId"
          ]
        },
        {
          "name": "CartCleared",
          "payload": [
            "cartId"
          ]
        }
      ],
      "repository": {
        "name": "CartRepository",
        "methods": [
          {
            "name": "findById",
            "params": "CartId",
            "returns": "Cart?"
          },
          {
            "name": "findByCustomerId",
            "params": "CustomerId",
            "returns": "Cart?"
          },
          {
            "name": "save",
            "params": "Cart",
            "returns": "void"
          }
        ],
        "loadStrategy": "Load complete cart with all items",
        "concurrency": "Optimistic locking via version field"
      },
      "externalReferences": [
        {
          "aggregate": "Customer",
          "via": "customerId",
          "type": "reference"
        },
        {
          "aggregate": "Product",
          "via": "productId in items",
          "type": "snapshot"
        },
        {
          "aggregate": "Inventory",
          "via": "productId",
          "type": "query"
        }
      ]
    },
    {
      "id": "AGG-ORDER-001",
      "name": "Order",
      "purpose": "Manages the complete order lifecycle from placement through delivery, including payment, shipping, and status transitions",
      "invariants": [
        {
          "id": "INV-ORDER-001",
          "rule": "Order must have at least one line item",
          "enforcement": "Validated on creation"
        },
        {
          "id": "INV-ORDER-002",
          "rule": "Total amount must equal subtotal plus shipping cost",
          "enforcement": "Calculated during order creation"
        },
        {
          "id": "INV-ORDER-003",
          "rule": "Shipping is free when subtotal exceeds $50",
          "enforcement": "Shipping cost calculation sets to $0 when subtotal \u003e $50"
        },
        {
          "id": "INV-ORDER-004",
          "rule": "Cannot modify order after status is 'shipped' or 'delivered'",
          "enforcement": "Guard clause in all modification methods"
        },
        {
          "id": "INV-ORDER-005",
          "rule": "Can only cancel before status is 'shipped'",
          "enforcement": "Precondition check in cancel() method"
        },
        {
          "id": "INV-ORDER-006",
          "rule": "Status transitions must follow valid state machine",
          "enforcement": "State pattern: pending→confirmed→shipped→delivered, or pending/confirmed→cancelled"
        },
        {
          "id": "INV-ORDER-007",
          "rule": "Line item prices are immutable snapshots from order time",
          "enforcement": "OrderLineItem attributes set at creation, no setters provided"
        }
      ],
      "root": {
        "entity": "Order",
        "identity": "OrderId (UUID)",
        "attributes": [
          {
            "name": "customerId",
            "type": "CustomerId",
            "mutable": false
          },
          {
            "name": "status",
            "type": "OrderStatus",
            "mutable": true
          },
          {
            "name": "shippingAddress",
            "type": "Address",
            "mutable": false
          },
          {
            "name": "paymentMethod",
            "type": "PaymentMethod",
            "mutable": false
          },
          {
            "name": "subtotal",
            "type": "Money",
            "mutable": false
          },
          {
            "name": "shippingCost",
            "type": "Money",
            "mutable": false
          },
          {
            "name": "totalAmount",
            "type": "Money",
            "mutable": false
          },
          {
            "name": "createdAt",
            "type": "DateTime",
            "mutable": false
          }
        ]
      },
      "entities": [
        {
          "name": "OrderLineItem",
          "identity": "LineItemId (UUID)",
          "purpose": "Immutable snapshot of a product at the time of order with quantity and price",
          "attributes": [
            {
              "name": "productId",
              "type": "ProductId",
              "mutable": false
            },
            {
              "name": "productName",
              "type": "string",
              "mutable": false
            },
            {
              "name": "unitPrice",
              "type": "Money",
              "mutable": false
            },
            {
              "name": "quantity",
              "type": "Quantity",
              "mutable": false
            },
            {
              "name": "subtotal",
              "type": "Money",
              "mutable": false
            }
          ]
        }
      ],
      "valueObjects": [
        "Money",
        "Address",
        "PaymentMethod",
        "OrderStatus",
        "Quantity"
      ],
      "behaviors": [
        {
          "name": "create",
          "command": "PlaceOrder",
          "preconditions": [
            "customer is registered",
            "cart has items",
            "all items in stock",
            "payment authorized",
            "shipping address valid",
            "domestic shipping only"
          ],
          "postconditions": [
            "order created with status 'pending'",
            "inventory reserved",
            "cart cleared"
          ],
          "emits": "OrderPlaced"
        },
        {
          "name": "confirm",
          "command": "ConfirmOrder",
          "preconditions": [
            "status == 'pending'"
          ],
          "postconditions": [
            "status == 'confirmed'"
          ],
          "emits": "OrderConfirmed"
        },
        {
          "name": "ship",
          "command": "ShipOrder",
          "preconditions": [
            "status == 'confirmed'"
          ],
          "postconditions": [
            "status == 'shipped'"
          ],
          "emits": "OrderShipped"
        },
        {
          "name": "deliver",
          "command": "DeliverOrder",
          "preconditions": [
            "status == 'shipped'"
          ],
          "postconditions": [
            "status == 'delivered'"
          ],
          "emits": "OrderDelivered"
        },
        {
          "name": "cancel",
          "command": "CancelOrder",
          "preconditions": [
            "status in ['pending', 'confirmed']"
          ],
          "postconditions": [
            "status == 'cancelled'",
            "inventory restored",
            "refund initiated"
          ],
          "emits": "OrderCancelled"
        }
      ],
      "events": [
        {
          "name": "OrderPlaced",
          "payload": [
            "orderId",
            "customerId",
            "lineItems",
            "totalAmount",
            "shippingAddress"
          ]
        },
        {
          "name": "OrderConfirmed",
          "payload": [
            "orderId",
            "confirmedAt"
          ]
        },
        {
          "name": "OrderShipped",
          "payload": [
            "orderId",
            "shippedAt",
            "trackingNumber"
          ]
        },
        {
          "name": "OrderDelivered",
          "payload": [
            "orderId",
            "deliveredAt"
          ]
        },
        {
          "name": "OrderCancelled",
          "payload": [
            "orderId",
            "cancelledAt",
            "reason"
          ]
        }
      ],
      "repository": {
        "name": "OrderRepository",
        "methods": [
          {
            "name": "findById",
            "params": "OrderId",
            "returns": "Order?"
          },
          {
            "name": "findByCustomerId",
            "params": "CustomerId",
            "returns": "List\u003cOrder\u003e"
          },
          {
            "name": "findByStatus",
            "params": "OrderStatus",
            "returns": "List\u003cOrder\u003e"
          },
          {
            "name": "save",
            "params": "Order",
            "returns": "void"
          }
        ],
        "loadStrategy": "Load complete order with all line items",
        "concurrency": "Optimistic locking via version field"
      },
      "externalReferences": [
        {
          "aggregate": "Customer",
          "via": "customerId",
          "type": "reference"
        },
        {
          "aggregate": "Product",
          "via": "productId in line items",
          "type": "snapshot"
        },
        {
          "aggregate": "Inventory",
          "via": "productId",
          "type": "command (reserve/release/deduct)"
        }
      ]
    },
    {
      "id": "AGG-PRODUCT-001",
      "name": "Product",
      "purpose": "Manages product catalog information including descriptions, pricing, variants, and category assignment",
      "invariants": [
        {
          "id": "INV-PROD-001",
          "rule": "Price must be greater than or equal to $0.01",
          "enforcement": "Validation during creation and update"
        },
        {
          "id": "INV-PROD-002",
          "rule": "Product name must be between 2 and 200 characters",
          "enforcement": "Validation during creation and update"
        },
        {
          "id": "INV-PROD-003",
          "rule": "Product must belong to a category",
          "enforcement": "Required categoryId on creation"
        },
        {
          "id": "INV-PROD-004",
          "rule": "Inactive products cannot be added to cart",
          "enforcement": "isActive check in cart service"
        },
        {
          "id": "INV-PROD-005",
          "rule": "Each variant SKU must be unique",
          "enforcement": "Database unique constraint on SKU"
        },
        {
          "id": "INV-PROD-006",
          "rule": "Variant combination (size, color) must be unique within product",
          "enforcement": "Validation during addVariant()"
        },
        {
          "id": "INV-PROD-007",
          "rule": "Products with order history must be soft-deleted only",
          "enforcement": "Delete operation checks OrderLineItem references"
        }
      ],
      "root": {
        "entity": "Product",
        "identity": "ProductId (UUID)",
        "attributes": [
          {
            "name": "name",
            "type": "string",
            "mutable": true
          },
          {
            "name": "description",
            "type": "string",
            "mutable": true
          },
          {
            "name": "price",
            "type": "Money",
            "mutable": true
          },
          {
            "name": "categoryId",
            "type": "CategoryId",
            "mutable": true
          },
          {
            "name": "isActive",
            "type": "boolean",
            "mutable": true
          },
          {
            "name": "createdAt",
            "type": "DateTime",
            "mutable": false
          }
        ]
      },
      "entities": [
        {
          "name": "ProductVariant",
          "identity": "VariantId (UUID)",
          "purpose": "Represents a specific variation of a product with unique SKU",
          "attributes": [
            {
              "name": "sku",
              "type": "SKU",
              "mutable": false
            },
            {
              "name": "size",
              "type": "string?",
              "mutable": false
            },
            {
              "name": "color",
              "type": "string?",
              "mutable": false
            },
            {
              "name": "priceAdjustment",
              "type": "Money?",
              "mutable": false
            }
          ]
        }
      ],
      "valueObjects": [
        "Money",
        "SKU"
      ],
      "behaviors": [
        {
          "name": "create",
          "command": "CreateProduct",
          "preconditions": [
            "name is not empty",
            "price \u003e 0",
            "category exists"
          ],
          "postconditions": [
            "product created",
            "isActive == true"
          ],
          "emits": "ProductCreated"
        },
        {
          "name": "update",
          "command": "UpdateProduct",
          "preconditions": [
            "product exists"
          ],
          "postconditions": [
            "attributes updated"
          ],
          "emits": "ProductUpdated"
        },
        {
          "name": "deactivate",
          "command": "DeactivateProduct",
          "preconditions": [
            "isActive == true"
          ],
          "postconditions": [
            "isActive == false"
          ],
          "emits": "ProductDeactivated"
        },
        {
          "name": "addVariant",
          "command": "AddProductVariant",
          "preconditions": [
            "variant SKU is unique",
            "variant combination is unique within product"
          ],
          "postconditions": [
            "variant added to product"
          ],
          "emits": "ProductVariantAdded"
        }
      ],
      "events": [
        {
          "name": "ProductCreated",
          "payload": [
            "productId",
            "name",
            "price",
            "categoryId"
          ]
        },
        {
          "name": "ProductUpdated",
          "payload": [
            "productId",
            "changedFields"
          ]
        },
        {
          "name": "ProductDeactivated",
          "payload": [
            "productId",
            "deactivatedAt"
          ]
        },
        {
          "name": "ProductVariantAdded",
          "payload": [
            "productId",
            "variantId",
            "sku",
            "size",
            "color"
          ]
        }
      ],
      "repository": {
        "name": "ProductRepository",
        "methods": [
          {
            "name": "findById",
            "params": "ProductId",
            "returns": "Product?"
          },
          {
            "name": "findByCategoryId",
            "params": "CategoryId",
            "returns": "List\u003cProduct\u003e"
          },
          {
            "name": "findActive",
            "params": "PaginationParams",
            "returns": "Page\u003cProduct\u003e"
          },
          {
            "name": "save",
            "params": "Product",
            "returns": "void"
          },
          {
            "name": "hasOrderReferences",
            "params": "ProductId",
            "returns": "boolean"
          }
        ],
        "loadStrategy": "Load product with all variants",
        "concurrency": "Optimistic locking via version field"
      },
      "externalReferences": [
        {
          "aggregate": "Category",
          "via": "categoryId",
          "type": "reference"
        },
        {
          "aggregate": "Inventory",
          "via": "productId",
          "type": "reference"
        }
      ]
    },
    {
      "id": "AGG-CATEGORY-001",
      "name": "Category",
      "purpose": "Organizes products into a hierarchical structure for browsing and navigation",
      "invariants": [
        {
          "id": "INV-CAT-001",
          "rule": "Category name must be unique",
          "enforcement": "Database unique constraint on name"
        },
        {
          "id": "INV-CAT-002",
          "rule": "Category cannot be its own parent",
          "enforcement": "Validation during creation and update"
        },
        {
          "id": "INV-CAT-003",
          "rule": "Category hierarchy is limited to 3 levels deep",
          "enforcement": "Depth calculation and validation during creation"
        }
      ],
      "root": {
        "entity": "Category",
        "identity": "CategoryId (UUID)",
        "attributes": [
          {
            "name": "name",
            "type": "string",
            "mutable": true
          },
          {
            "name": "description",
            "type": "string",
            "mutable": true
          },
          {
            "name": "parentCategoryId",
            "type": "CategoryId?",
            "mutable": true
          },
          {
            "name": "depth",
            "type": "integer",
            "mutable": true
          }
        ]
      },
      "entities": [],
      "valueObjects": [],
      "behaviors": [
        {
          "name": "create",
          "command": "CreateCategory",
          "preconditions": [
            "name is unique",
            "depth \u003c= 3 if parent specified"
          ],
          "postconditions": [
            "category created"
          ],
          "emits": "CategoryCreated"
        },
        {
          "name": "rename",
          "command": "RenameCategory",
          "preconditions": [
            "new name is unique"
          ],
          "postconditions": [
            "name updated"
          ],
          "emits": "CategoryRenamed"
        },
        {
          "name": "moveToParent",
          "command": "MoveCategoryToParent",
          "preconditions": [
            "new parent exists",
            "would not exceed depth 3",
            "not creating circular reference"
          ],
          "postconditions": [
            "parentCategoryId updated",
            "depth recalculated"
          ],
          "emits": "CategoryMoved"
        }
      ],
      "events": [
        {
          "name": "CategoryCreated",
          "payload": [
            "categoryId",
            "name",
            "parentCategoryId"
          ]
        },
        {
          "name": "CategoryRenamed",
          "payload": [
            "categoryId",
            "oldName",
            "newName"
          ]
        },
        {
          "name": "CategoryMoved",
          "payload": [
            "categoryId",
            "oldParentId",
            "newParentId"
          ]
        }
      ],
      "repository": {
        "name": "CategoryRepository",
        "methods": [
          {
            "name": "findById",
            "params": "CategoryId",
            "returns": "Category?"
          },
          {
            "name": "findByName",
            "params": "string",
            "returns": "Category?"
          },
          {
            "name": "findRoots",
            "params": "",
            "returns": "List\u003cCategory\u003e"
          },
          {
            "name": "findChildren",
            "params": "CategoryId",
            "returns": "List\u003cCategory\u003e"
          },
          {
            "name": "save",
            "params": "Category",
            "returns": "void"
          },
          {
            "name": "calculateDepth",
            "params": "CategoryId?",
            "returns": "integer"
          }
        ],
        "loadStrategy": "Load single category (children loaded separately)",
        "concurrency": "Optimistic locking via version field"
      },
      "externalReferences": [
        {
          "aggregate": "Category",
          "via": "parentCategoryId",
          "type": "reference"
        },
        {
          "aggregate": "Product",
          "via": "categoryId",
          "type": "reference"
        }
      ]
    },
    {
      "id": "AGG-INVENTORY-001",
      "name": "Inventory",
      "purpose": "Tracks stock levels, reservations, and availability for products with full audit trail",
      "invariants": [
        {
          "id": "INV-INV-001",
          "rule": "Stock level cannot be negative",
          "enforcement": "Validation in all stock adjustment operations"
        },
        {
          "id": "INV-INV-002",
          "rule": "Reserved quantity cannot exceed stock level",
          "enforcement": "Validation in reserve() operation"
        },
        {
          "id": "INV-INV-003",
          "rule": "Available quantity must equal stock level minus reserved",
          "enforcement": "Calculated property, recalculated on any change"
        },
        {
          "id": "INV-INV-004",
          "rule": "All inventory changes must be logged",
          "enforcement": "Audit log entry created for every modification"
        }
      ],
      "root": {
        "entity": "Inventory",
        "identity": "InventoryId (UUID)",
        "attributes": [
          {
            "name": "productId",
            "type": "ProductId",
            "mutable": false
          },
          {
            "name": "stockLevel",
            "type": "integer",
            "mutable": true
          },
          {
            "name": "reservedQuantity",
            "type": "integer",
            "mutable": true
          },
          {
            "name": "availableQuantity",
            "type": "integer",
            "mutable": false
          }
        ]
      },
      "entities": [],
      "valueObjects": [],
      "behaviors": [
        {
          "name": "reserve",
          "command": "ReserveInventory",
          "preconditions": [
            "quantity \u003c= availableQuantity"
          ],
          "postconditions": [
            "reservedQuantity increased by quantity",
            "audit log created"
          ],
          "emits": "InventoryReserved"
        },
        {
          "name": "release",
          "command": "ReleaseInventory",
          "preconditions": [
            "quantity \u003c= reservedQuantity"
          ],
          "postconditions": [
            "reservedQuantity decreased by quantity",
            "audit log created"
          ],
          "emits": "InventoryReleased"
        },
        {
          "name": "deduct",
          "command": "DeductInventory",
          "preconditions": [
            "quantity \u003c= reservedQuantity"
          ],
          "postconditions": [
            "stockLevel decreased",
            "reservedQuantity decreased",
            "audit log created"
          ],
          "emits": "InventoryDeducted"
        },
        {
          "name": "restock",
          "command": "RestockInventory",
          "preconditions": [
            "quantity \u003e 0"
          ],
          "postconditions": [
            "stockLevel increased by quantity",
            "audit log created"
          ],
          "emits": "InventoryRestocked"
        }
      ],
      "events": [
        {
          "name": "InventoryReserved",
          "payload": [
            "inventoryId",
            "productId",
            "quantity",
            "orderId"
          ]
        },
        {
          "name": "InventoryReleased",
          "payload": [
            "inventoryId",
            "productId",
            "quantity",
            "reason"
          ]
        },
        {
          "name": "InventoryDeducted",
          "payload": [
            "inventoryId",
            "productId",
            "quantity",
            "orderId"
          ]
        },
        {
          "name": "InventoryRestocked",
          "payload": [
            "inventoryId",
            "productId",
            "quantity",
            "previousLevel",
            "newLevel"
          ]
        },
        {
          "name": "OutOfStock",
          "payload": [
            "inventoryId",
            "productId"
          ]
        }
      ],
      "repository": {
        "name": "InventoryRepository",
        "methods": [
          {
            "name": "findById",
            "params": "InventoryId",
            "returns": "Inventory?"
          },
          {
            "name": "findByProductId",
            "params": "ProductId",
            "returns": "Inventory?"
          },
          {
            "name": "findLowStock",
            "params": "threshold: integer",
            "returns": "List\u003cInventory\u003e"
          },
          {
            "name": "save",
            "params": "Inventory",
            "returns": "void"
          }
        ],
        "loadStrategy": "Load single inventory record",
        "concurrency": "Pessimistic locking for stock operations to prevent overselling"
      },
      "externalReferences": [
        {
          "aggregate": "Product",
          "via": "productId",
          "type": "reference"
        }
      ]
    }
  ],
  "enums": [
    {
      "name": "registration_status",
      "values": [
        "registered",
        "unregistered"
      ]
    },
    {
      "name": "order_status",
      "values": [
        "pending",
        "confirmed",
        "shipped",
        "delivered",
        "cancelled"
      ]
    },
    {
      "name": "payment_type",
      "values": [
        "credit_card",
        "paypal"
      ]
    }
  ],
  "interface_contracts": [
    {
      "id": "IC-CUSTOMER-001",
      "serviceName": "Customer Service",
      "purpose": "Manages customer registration, authentication, and profile data including shipping addresses",
      "baseUrl": "/api/v1/customers",
      "operations": [
        {
          "id": "OP-CUST-001",
          "name": "registerCustomer",
          "method": "POST",
          "path": "/register",
          "description": "Register a new customer account with email verification",
          "inputSchema": {
            "email": {
              "type": "Email",
              "required": true
            },
            "firstName": {
              "type": "string",
              "required": true
            },
            "lastName": {
              "type": "string",
              "required": true
            },
            "password": {
              "type": "string",
              "required": true
            }
          },
          "outputSchema": {
            "createdAt": {
              "type": "DateTime"
            },
            "customerId": {
              "type": "UUID"
            },
            "email": {
              "type": "Email"
            },
            "registrationStatus": {
              "type": "RegistrationStatus"
            }
          },
          "errors": [
            {
              "code": "DUPLICATE_EMAIL",
              "httpStatus": 409,
              "message": "Email already registered, suggest login or password reset"
            },
            {
              "code": "INVALID_PASSWORD",
              "httpStatus": 400,
              "message": "Password must be at least 8 characters with at least one number"
            },
            {
              "code": "INVALID_EMAIL",
              "httpStatus": 400,
              "message": "Invalid email format"
            }
          ],
          "preconditions": [
            "Email not already registered"
          ],
          "postconditions": [
            "Customer account created with status 'unverified'",
            "Verification email sent",
            "CustomerRegistered event emitted"
          ],
          "relatedACs": [
            "AC-CUST-001"
          ],
          "relatedBRs": [
            "BR-CUST-002",
            "BR-CUST-003"
          ]
        },
        {
          "id": "OP-CUST-002",
          "name": "verifyEmail",
          "method": "POST",
          "path": "/verify-email",
          "description": "Verify customer email address using verification token",
          "inputSchema": {
            "token": {
              "type": "string",
              "required": true
            }
          },
          "outputSchema": {
            "customerId": {
              "type": "UUID"
            },
            "emailVerified": {
              "type": "boolean"
            },
            "registrationStatus": {
              "type": "RegistrationStatus"
            }
          },
          "errors": [
            {
              "code": "INVALID_TOKEN",
              "httpStatus": 400,
              "message": "Invalid verification token"
            },
            {
              "code": "VERIFICATION_EXPIRED",
              "httpStatus": 410,
              "message": "Verification link expired, request new verification email"
            }
          ],
          "preconditions": [
            "Valid verification token exists"
          ],
          "postconditions": [
            "Customer email marked as verified",
            "Registration status updated to 'registered'"
          ],
          "relatedACs": [
            "AC-CUST-002"
          ],
          "relatedBRs": [
            "BR-CUST-001"
          ]
        },
        {
          "id": "OP-CUST-003",
          "name": "addShippingAddress",
          "method": "POST",
          "path": "/{customerId}/addresses",
          "description": "Add a new shipping address to customer account",
          "inputSchema": {
            "city": {
              "type": "string",
              "required": true
            },
            "country": {
              "type": "string",
              "required": true
            },
            "customerId": {
              "type": "UUID",
              "required": true
            },
            "postalCode": {
              "type": "string",
              "required": true
            },
            "recipientName": {
              "type": "string",
              "required": true
            },
            "state": {
              "type": "string",
              "required": true
            },
            "street": {
              "type": "string",
              "required": true
            }
          },
          "outputSchema": {
            "address": {
              "type": "Address"
            },
            "addressId": {
              "type": "UUID"
            }
          },
          "errors": [
            {
              "code": "INVALID_ADDRESS",
              "httpStatus": 400,
              "message": "Missing required address field"
            },
            {
              "code": "INVALID_POSTAL_CODE",
              "httpStatus": 400,
              "message": "Invalid postal code format"
            },
            {
              "code": "UNSUPPORTED_SHIPPING_REGION",
              "httpStatus": 400,
              "message": "Shipping only available within domestic country"
            },
            {
              "code": "CUSTOMER_NOT_FOUND",
              "httpStatus": 404,
              "message": "Customer does not exist"
            }
          ],
          "preconditions": [
            "Customer exists and is registered"
          ],
          "postconditions": [
            "Address saved to customer account",
            "Address available for order selection"
          ],
          "relatedACs": [
            "AC-CUST-003"
          ],
          "relatedBRs": [
            "BR-SHIP-001",
            "BR-SHIP-002"
          ]
        },
        {
          "id": "OP-CUST-004",
          "name": "getCustomerAddresses",
          "method": "GET",
          "path": "/{customerId}/addresses",
          "description": "Retrieve all shipping addresses for a customer",
          "inputSchema": {
            "customerId": {
              "type": "UUID",
              "required": true
            }
          },
          "outputSchema": {
            "addresses": {
              "type": "List\u003cAddress\u003e"
            }
          },
          "errors": [
            {
              "code": "CUSTOMER_NOT_FOUND",
              "httpStatus": 404,
              "message": "Customer does not exist"
            }
          ],
          "preconditions": [
            "Customer exists"
          ],
          "postconditions": [],
          "relatedACs": [
            "AC-CUST-003"
          ],
          "relatedBRs": []
        },
        {
          "id": "OP-CUST-005",
          "name": "requestDataErasure",
          "method": "DELETE",
          "path": "/{customerId}/data",
          "description": "GDPR data erasure request - permanently delete all personal data",
          "inputSchema": {
            "confirmErasure": {
              "type": "boolean",
              "required": true
            },
            "customerId": {
              "type": "UUID",
              "required": true
            }
          },
          "outputSchema": {
            "erasedAt": {
              "type": "DateTime"
            },
            "erasureConfirmed": {
              "type": "boolean"
            }
          },
          "errors": [
            {
              "code": "PENDING_ORDERS_EXIST",
              "httpStatus": 409,
              "message": "Cannot delete account with pending orders"
            },
            {
              "code": "CONFIRMATION_REQUIRED",
              "httpStatus": 400,
              "message": "Must confirm erasure request"
            }
          ],
          "preconditions": [
            "Customer exists",
            "No pending orders"
          ],
          "postconditions": [
            "All personal data permanently deleted",
            "Order history anonymized",
            "Confirmation sent"
          ],
          "relatedACs": [
            "AC-CUST-004"
          ],
          "relatedBRs": []
        },
        {
          "id": "OP-CUST-006",
          "name": "savePaymentMethod",
          "method": "POST",
          "path": "/{customerId}/payment-methods",
          "description": "Save a tokenized payment method for future purchases",
          "inputSchema": {
            "cardBrand": {
              "type": "string"
            },
            "customerId": {
              "type": "UUID",
              "required": true
            },
            "lastFourDigits": {
              "type": "string"
            },
            "paymentToken": {
              "type": "string",
              "required": true
            },
            "type": {
              "type": "PaymentType",
              "required": true
            }
          },
          "outputSchema": {
            "displayName": {
              "type": "string"
            },
            "paymentMethodId": {
              "type": "UUID"
            },
            "type": {
              "type": "PaymentType"
            }
          },
          "errors": [
            {
              "code": "INVALID_PAYMENT_TOKEN",
              "httpStatus": 400,
              "message": "Invalid payment token"
            },
            {
              "code": "CUSTOMER_NOT_FOUND",
              "httpStatus": 404,
              "message": "Customer does not exist"
            }
          ],
          "preconditions": [
            "Customer exists",
            "Valid payment token"
          ],
          "postconditions": [
            "Tokenized payment method stored",
            "Available for future checkouts"
          ],
          "relatedACs": [
            "AC-PAY-003"
          ],
          "relatedBRs": []
        }
      ],
      "events": [
        {
          "name": "CustomerRegistered",
          "description": "Emitted when a new customer registers successfully",
          "payload": [
            "customerId",
            "email",
            "registrationStatus",
            "createdAt"
          ]
        },
        {
          "name": "CustomerEmailVerified",
          "description": "Emitted when customer verifies their email",
          "payload": [
            "customerId",
            "email",
            "verifiedAt"
          ]
        },
        {
          "name": "CustomerDataErased",
          "description": "Emitted when customer data is permanently deleted (GDPR)",
          "payload": [
            "anonymizedCustomerId",
            "erasedAt"
          ]
        }
      ],
      "securityRequirements": {
        "authentication": "Bearer JWT (except registration and verification)",
        "authorization": "Customer can only access own data, admin can access all"
      }
    },
    {
      "id": "IC-PRODUCT-001",
      "serviceName": "Product Service",
      "purpose": "Manages product catalog including browsing, filtering, and product details with variants",
      "baseUrl": "/api/v1/products",
      "operations": [
        {
          "id": "OP-PROD-001",
          "name": "browseProducts",
          "method": "GET",
          "path": "/",
          "description": "Browse and filter products with pagination",
          "inputSchema": {
            "categoryId": {
              "type": "UUID"
            },
            "inStock": {
              "type": "boolean"
            },
            "maxPrice": {
              "type": "decimal"
            },
            "minPrice": {
              "type": "decimal"
            },
            "page": {
              "type": "integer"
            },
            "pageSize": {
              "type": "integer"
            },
            "sortBy": {
              "type": "string"
            },
            "sortOrder": {
              "type": "string"
            }
          },
          "outputSchema": {
            "page": {
              "type": "integer"
            },
            "pageSize": {
              "type": "integer"
            },
            "products": {
              "type": "List\u003cProductSummary\u003e"
            },
            "totalCount": {
              "type": "integer"
            },
            "totalPages": {
              "type": "integer"
            }
          },
          "errors": [
            {
              "code": "INVALID_CATEGORY",
              "httpStatus": 400,
              "message": "Category does not exist"
            },
            {
              "code": "INVALID_PRICE_RANGE",
              "httpStatus": 400,
              "message": "minPrice must be less than maxPrice"
            }
          ],
          "preconditions": [],
          "postconditions": [],
          "relatedACs": [
            "AC-PROD-001",
            "AC-PROD-002"
          ],
          "relatedBRs": []
        },
        {
          "id": "OP-PROD-002",
          "name": "getProductDetails",
          "method": "GET",
          "path": "/{productId}",
          "description": "Get detailed product information including variants and stock status",
          "inputSchema": {
            "productId": {
              "type": "UUID",
              "required": true
            }
          },
          "outputSchema": {
            "availableQuantity": {
              "type": "integer"
            },
            "categoryId": {
              "type": "UUID"
            },
            "categoryName": {
              "type": "string"
            },
            "description": {
              "type": "string"
            },
            "images": {
              "type": "List\u003cProductImage\u003e"
            },
            "isActive": {
              "type": "boolean"
            },
            "name": {
              "type": "string"
            },
            "price": {
              "type": "Money"
            },
            "productId": {
              "type": "UUID"
            },
            "variants": {
              "type": "List\u003cProductVariant\u003e"
            }
          },
          "errors": [
            {
              "code": "PRODUCT_NOT_FOUND",
              "httpStatus": 404,
              "message": "Product does not exist"
            }
          ],
          "preconditions": [],
          "postconditions": [],
          "relatedACs": [
            "AC-PROD-003"
          ],
          "relatedBRs": []
        },
        {
          "id": "OP-PROD-003",
          "name": "createProduct",
          "method": "POST",
          "path": "/",
          "description": "Create a new product in draft status (admin only)",
          "inputSchema": {
            "categoryId": {
              "type": "UUID",
              "required": true
            },
            "description": {
              "type": "string"
            },
            "name": {
              "type": "string",
              "required": true
            },
            "price": {
              "type": "Money",
              "required": true
            }
          },
          "outputSchema": {
            "createdAt": {
              "type": "DateTime"
            },
            "createdBy": {
              "type": "UUID"
            },
            "name": {
              "type": "string"
            },
            "productId": {
              "type": "UUID"
            },
            "status": {
              "type": "string"
            }
          },
          "errors": [
            {
              "code": "NAME_REQUIRED",
              "httpStatus": 400,
              "message": "Product name is required"
            },
            {
              "code": "NAME_TOO_LONG",
              "httpStatus": 400,
              "message": "Product name exceeds 200 characters"
            },
            {
              "code": "INVALID_PRICE",
              "httpStatus": 400,
              "message": "Price must be at least $0.01"
            },
            {
              "code": "CATEGORY_REQUIRED",
              "httpStatus": 400,
              "message": "Category must be selected"
            },
            {
              "code": "CATEGORY_NOT_FOUND",
              "httpStatus": 404,
              "message": "Category does not exist"
            }
          ],
          "preconditions": [
            "Admin user authenticated",
            "Category exists"
          ],
          "postconditions": [
            "Product created with status 'draft'",
            "UUID assigned",
            "Creator and timestamp logged",
            "ProductCreated event emitted"
          ],
          "relatedACs": [
            "AC-ADMIN-001"
          ],
          "relatedBRs": [
            "BR-PROD-001",
            "BR-PROD-002"
          ]
        },
        {
          "id": "OP-PROD-004",
          "name": "updateProduct",
          "method": "PUT",
          "path": "/{productId}",
          "description": "Update product details (admin only)",
          "inputSchema": {
            "categoryId": {
              "type": "UUID"
            },
            "description": {
              "type": "string"
            },
            "name": {
              "type": "string"
            },
            "price": {
              "type": "Money"
            },
            "productId": {
              "type": "UUID",
              "required": true
            }
          },
          "outputSchema": {
            "name": {
              "type": "string"
            },
            "price": {
              "type": "Money"
            },
            "productId": {
              "type": "UUID"
            },
            "updatedAt": {
              "type": "DateTime"
            },
            "updatedBy": {
              "type": "UUID"
            }
          },
          "errors": [
            {
              "code": "PRODUCT_NOT_FOUND",
              "httpStatus": 404,
              "message": "Product does not exist"
            },
            {
              "code": "NAME_TOO_LONG",
              "httpStatus": 400,
              "message": "Product name exceeds 200 characters"
            },
            {
              "code": "INVALID_PRICE",
              "httpStatus": 400,
              "message": "Price must be at least $0.01"
            },
            {
              "code": "CATEGORY_NOT_FOUND",
              "httpStatus": 404,
              "message": "Category does not exist"
            }
          ],
          "preconditions": [
            "Admin user authenticated",
            "Product exists"
          ],
          "postconditions": [
            "Product attributes updated",
            "Change logged with admin user and timestamp",
            "ProductUpdated event emitted",
            "Carts show updated price on next view"
          ],
          "relatedACs": [
            "AC-ADMIN-003",
            "AC-ADMIN-004"
          ],
          "relatedBRs": [
            "BR-PROD-001",
            "BR-PROD-002"
          ]
        },
        {
          "id": "OP-PROD-005",
          "name": "deleteProduct",
          "method": "DELETE",
          "path": "/{productId}",
          "description": "Soft-delete a product (admin only)",
          "inputSchema": {
            "productId": {
              "type": "UUID",
              "required": true
            }
          },
          "outputSchema": {
            "deletedAt": {
              "type": "DateTime"
            },
            "productId": {
              "type": "UUID"
            },
            "softDeleted": {
              "type": "boolean"
            }
          },
          "errors": [
            {
              "code": "PRODUCT_NOT_FOUND",
              "httpStatus": 404,
              "message": "Product does not exist"
            }
          ],
          "preconditions": [
            "Admin user authenticated",
            "Product exists"
          ],
          "postconditions": [
            "Product soft-deleted (not visible to customers)",
            "Order history preserved",
            "Cart items removed with notification",
            "ProductDeactivated event emitted"
          ],
          "relatedACs": [
            "AC-ADMIN-005"
          ],
          "relatedBRs": [
            "BR-PROD-003"
          ]
        },
        {
          "id": "OP-PROD-006",
          "name": "uploadProductImages",
          "method": "POST",
          "path": "/{productId}/images",
          "description": "Upload product images (admin only)",
          "inputSchema": {
            "images": {
              "type": "List\u003cMultipartFile\u003e",
              "required": true
            },
            "primaryImageIndex": {
              "type": "integer"
            },
            "productId": {
              "type": "UUID",
              "required": true
            }
          },
          "outputSchema": {
            "images": {
              "type": "List\u003cProductImage\u003e"
            },
            "primaryImageUrl": {
              "type": "string"
            }
          },
          "errors": [
            {
              "code": "PRODUCT_NOT_FOUND",
              "httpStatus": 404,
              "message": "Product does not exist"
            },
            {
              "code": "MAX_IMAGES_EXCEEDED",
              "httpStatus": 400,
              "message": "Maximum 10 images allowed per product"
            },
            {
              "code": "INVALID_IMAGE_FORMAT",
              "httpStatus": 400,
              "message": "Invalid image format, supported: JPG, PNG, WebP"
            }
          ],
          "preconditions": [
            "Admin user authenticated",
            "Product exists"
          ],
          "postconditions": [
            "Images uploaded to cloud storage",
            "URLs stored",
            "Primary image marked"
          ],
          "relatedACs": [
            "AC-ADMIN-002"
          ],
          "relatedBRs": []
        },
        {
          "id": "OP-PROD-007",
          "name": "addProductVariant",
          "method": "POST",
          "path": "/{productId}/variants",
          "description": "Add a variant to a product (admin only)",
          "inputSchema": {
            "color": {
              "type": "string"
            },
            "priceAdjustment": {
              "type": "Money"
            },
            "productId": {
              "type": "UUID",
              "required": true
            },
            "size": {
              "type": "string"
            },
            "sku": {
              "type": "SKU",
              "required": true
            }
          },
          "outputSchema": {
            "color": {
              "type": "string"
            },
            "priceAdjustment": {
              "type": "Money"
            },
            "size": {
              "type": "string"
            },
            "sku": {
              "type": "SKU"
            },
            "variantId": {
              "type": "UUID"
            }
          },
          "errors": [
            {
              "code": "PRODUCT_NOT_FOUND",
              "httpStatus": 404,
              "message": "Product does not exist"
            },
            {
              "code": "DUPLICATE_SKU",
              "httpStatus": 409,
              "message": "SKU already exists"
            },
            {
              "code": "VARIANT_ATTRIBUTE_REQUIRED",
              "httpStatus": 400,
              "message": "At least size or color must be specified"
            },
            {
              "code": "DUPLICATE_VARIANT",
              "httpStatus": 409,
              "message": "Variant combination already exists"
            }
          ],
          "preconditions": [
            "Admin user authenticated",
            "Product exists",
            "SKU is unique"
          ],
          "postconditions": [
            "Variant added to product",
            "ProductVariantAdded event emitted"
          ],
          "relatedACs": [
            "AC-PROD-003"
          ],
          "relatedBRs": [
            "BR-PROD-004"
          ]
        }
      ],
      "events": [
        {
          "name": "ProductCreated",
          "description": "Emitted when a new product is created",
          "payload": [
            "productId",
            "name",
            "price",
            "categoryId",
            "createdBy"
          ]
        },
        {
          "name": "ProductUpdated",
          "description": "Emitted when product details are updated",
          "payload": [
            "productId",
            "updatedFields",
            "updatedBy",
            "previousPrice",
            "newPrice"
          ]
        },
        {
          "name": "ProductDeactivated",
          "description": "Emitted when a product is soft-deleted",
          "payload": [
            "productId",
            "deletedBy",
            "deletedAt"
          ]
        },
        {
          "name": "ProductVariantAdded",
          "description": "Emitted when a variant is added to a product",
          "payload": [
            "productId",
            "variantId",
            "sku"
          ]
        }
      ],
      "securityRequirements": {
        "authentication": "None for browsing, Bearer JWT for admin operations",
        "authorization": "Admin role required for create/update/delete operations"
      }
    },
    {
      "id": "IC-CART-001",
      "serviceName": "Cart Service",
      "purpose": "Manages shopping cart operations including adding, updating, and removing items",
      "baseUrl": "/api/v1/carts",
      "operations": [
        {
          "id": "OP-CART-001",
          "name": "getCart",
          "method": "GET",
          "path": "/{cartId}",
          "description": "Get current cart contents with calculated totals",
          "inputSchema": {
            "cartId": {
              "type": "UUID",
              "required": true
            }
          },
          "outputSchema": {
            "cartId": {
              "type": "UUID"
            },
            "customerId": {
              "type": "UUID"
            },
            "hasOutOfStockItems": {
              "type": "boolean"
            },
            "itemCount": {
              "type": "integer"
            },
            "items": {
              "type": "List\u003cCartItem\u003e"
            },
            "priceChanges": {
              "type": "List\u003cPriceChange\u003e"
            },
            "totalPrice": {
              "type": "Money"
            }
          },
          "errors": [
            {
              "code": "CART_NOT_FOUND",
              "httpStatus": 404,
              "message": "Cart does not exist"
            },
            {
              "code": "CART_EXPIRED",
              "httpStatus": 410,
              "message": "Cart has expired due to inactivity"
            }
          ],
          "preconditions": [
            "Cart exists"
          ],
          "postconditions": [],
          "relatedACs": [
            "AC-CART-007",
            "AC-CART-008",
            "AC-CART-009"
          ],
          "relatedBRs": [
            "BR-CART-004"
          ]
        },
        {
          "id": "OP-CART-002",
          "name": "addItemToCart",
          "method": "POST",
          "path": "/{cartId}/items",
          "description": "Add a product to the cart or increase quantity if already present",
          "inputSchema": {
            "cartId": {
              "type": "UUID",
              "required": true
            },
            "productId": {
              "type": "UUID",
              "required": true
            },
            "quantity": {
              "type": "Quantity",
              "required": true
            },
            "variantId": {
              "type": "UUID"
            }
          },
          "outputSchema": {
            "cartId": {
              "type": "UUID"
            },
            "cartItemId": {
              "type": "UUID"
            },
            "cartTotal": {
              "type": "Money"
            },
            "productId": {
              "type": "UUID"
            },
            "productName": {
              "type": "string"
            },
            "quantity": {
              "type": "Quantity"
            },
            "subtotal": {
              "type": "Money"
            },
            "unitPrice": {
              "type": "Money"
            }
          },
          "errors": [
            {
              "code": "OUT_OF_STOCK",
              "httpStatus": 409,
              "message": "Product is out of stock"
            },
            {
              "code": "INSUFFICIENT_STOCK",
              "httpStatus": 409,
              "message": "Requested quantity exceeds available stock"
            },
            {
              "code": "PRODUCT_NOT_FOUND",
              "httpStatus": 404,
              "message": "Product does not exist"
            },
            {
              "code": "PRODUCT_INACTIVE",
              "httpStatus": 400,
              "message": "Product is not available for purchase"
            },
            {
              "code": "VARIANT_REQUIRED",
              "httpStatus": 400,
              "message": "Product has variants, specific variant must be selected"
            },
            {
              "code": "QUANTITY_LIMITED",
              "httpStatus": 200,
              "message": "Quantity limited to available stock"
            }
          ],
          "preconditions": [
            "Product exists and is active",
            "Product is in stock",
            "Quantity \u003e 0",
            "Variant selected if product has variants"
          ],
          "postconditions": [
            "Item added or quantity updated",
            "Total recalculated",
            "ItemAddedToCart event emitted"
          ],
          "relatedACs": [
            "AC-CART-001",
            "AC-CART-002"
          ],
          "relatedBRs": [
            "BR-CART-001",
            "BR-CART-002",
            "BR-CART-003",
            "BR-CART-005"
          ]
        },
        {
          "id": "OP-CART-003",
          "name": "updateCartItemQuantity",
          "method": "PUT",
          "path": "/{cartId}/items/{cartItemId}",
          "description": "Update quantity of an item in the cart",
          "inputSchema": {
            "cartId": {
              "type": "UUID",
              "required": true
            },
            "cartItemId": {
              "type": "UUID",
              "required": true
            },
            "quantity": {
              "type": "Quantity",
              "required": true
            }
          },
          "outputSchema": {
            "availableQuantity": {
              "type": "integer"
            },
            "cartItemId": {
              "type": "UUID"
            },
            "cartTotal": {
              "type": "Money"
            },
            "quantity": {
              "type": "Quantity"
            },
            "quantityLimited": {
              "type": "boolean"
            },
            "subtotal": {
              "type": "Money"
            }
          },
          "errors": [
            {
              "code": "CART_NOT_FOUND",
              "httpStatus": 404,
              "message": "Cart does not exist"
            },
            {
              "code": "CART_ITEM_NOT_FOUND",
              "httpStatus": 404,
              "message": "Item not found in cart"
            },
            {
              "code": "QUANTITY_LIMITED",
              "httpStatus": 200,
              "message": "Quantity limited to available stock"
            }
          ],
          "preconditions": [
            "Cart exists",
            "Item exists in cart"
          ],
          "postconditions": [
            "Quantity updated (or item removed if quantity is 0)",
            "Total recalculated",
            "CartItemQuantityUpdated event emitted"
          ],
          "relatedACs": [
            "AC-CART-004"
          ],
          "relatedBRs": [
            "BR-CART-002",
            "BR-CART-003"
          ]
        },
        {
          "id": "OP-CART-004",
          "name": "removeCartItem",
          "method": "DELETE",
          "path": "/{cartId}/items/{cartItemId}",
          "description": "Remove an item from the cart",
          "inputSchema": {
            "cartId": {
              "type": "UUID",
              "required": true
            },
            "cartItemId": {
              "type": "UUID",
              "required": true
            }
          },
          "outputSchema": {
            "cartId": {
              "type": "UUID"
            },
            "cartTotal": {
              "type": "Money"
            },
            "itemCount": {
              "type": "integer"
            },
            "removedItemId": {
              "type": "UUID"
            },
            "undoExpiresAt": {
              "type": "DateTime"
            },
            "undoToken": {
              "type": "string"
            }
          },
          "errors": [
            {
              "code": "CART_NOT_FOUND",
              "httpStatus": 404,
              "message": "Cart does not exist"
            },
            {
              "code": "CART_ITEM_NOT_FOUND",
              "httpStatus": 404,
              "message": "Item not found in cart"
            }
          ],
          "preconditions": [
            "Cart exists",
            "Item exists in cart"
          ],
          "postconditions": [
            "Item removed from cart",
            "Total recalculated",
            "Undo option available for 5 seconds",
            "ItemRemovedFromCart event emitted"
          ],
          "relatedACs": [
            "AC-CART-005",
            "AC-CART-006"
          ],
          "relatedBRs": []
        },
        {
          "id": "OP-CART-005",
          "name": "undoRemoveCartItem",
          "method": "POST",
          "path": "/{cartId}/items/undo",
          "description": "Undo the last item removal within 5 seconds",
          "inputSchema": {
            "cartId": {
              "type": "UUID",
              "required": true
            },
            "undoToken": {
              "type": "string",
              "required": true
            }
          },
          "outputSchema": {
            "cartItemId": {
              "type": "UUID"
            },
            "cartTotal": {
              "type": "Money"
            },
            "restored": {
              "type": "boolean"
            }
          },
          "errors": [
            {
              "code": "UNDO_EXPIRED",
              "httpStatus": 410,
              "message": "Undo window has expired"
            },
            {
              "code": "INVALID_UNDO_TOKEN",
              "httpStatus": 400,
              "message": "Invalid undo token"
            }
          ],
          "preconditions": [
            "Valid undo token",
            "Within 5 second window"
          ],
          "postconditions": [
            "Item restored to cart",
            "Total recalculated"
          ],
          "relatedACs": [
            "AC-CART-005"
          ],
          "relatedBRs": []
        },
        {
          "id": "OP-CART-006",
          "name": "mergeGuestCart",
          "method": "POST",
          "path": "/{cartId}/merge",
          "description": "Merge guest cart with authenticated user's cart on login",
          "inputSchema": {
            "cartId": {
              "type": "UUID",
              "required": true
            },
            "guestCartId": {
              "type": "UUID",
              "required": true
            }
          },
          "outputSchema": {
            "cartId": {
              "type": "UUID"
            },
            "cartTotal": {
              "type": "Money"
            },
            "mergedItems": {
              "type": "integer"
            },
            "quantityLimitedItems": {
              "type": "List\u003cQuantityLimitedItem\u003e"
            }
          },
          "errors": [
            {
              "code": "CART_NOT_FOUND",
              "httpStatus": 404,
              "message": "Cart does not exist"
            },
            {
              "code": "GUEST_CART_NOT_FOUND",
              "httpStatus": 404,
              "message": "Guest cart does not exist"
            }
          ],
          "preconditions": [
            "Both carts exist"
          ],
          "postconditions": [
            "Guest cart items merged into user cart",
            "Quantities limited by stock if needed",
            "Guest cart cleared"
          ],
          "relatedACs": [
            "AC-CART-003"
          ],
          "relatedBRs": [
            "BR-CART-002"
          ]
        },
        {
          "id": "OP-CART-007",
          "name": "clearCart",
          "method": "DELETE",
          "path": "/{cartId}",
          "description": "Clear all items from the cart",
          "inputSchema": {
            "cartId": {
              "type": "UUID",
              "required": true
            }
          },
          "outputSchema": {
            "cartId": {
              "type": "UUID"
            },
            "cleared": {
              "type": "boolean"
            }
          },
          "errors": [
            {
              "code": "CART_NOT_FOUND",
              "httpStatus": 404,
              "message": "Cart does not exist"
            }
          ],
          "preconditions": [
            "Cart exists"
          ],
          "postconditions": [
            "All items removed",
            "Total set to zero",
            "CartCleared event emitted"
          ],
          "relatedACs": [],
          "relatedBRs": []
        }
      ],
      "events": [
        {
          "name": "ItemAddedToCart",
          "description": "Emitted when an item is added to the cart",
          "payload": [
            "cartId",
            "cartItemId",
            "productId",
            "quantity",
            "unitPrice"
          ]
        },
        {
          "name": "CartItemQuantityUpdated",
          "description": "Emitted when cart item quantity is changed",
          "payload": [
            "cartId",
            "cartItemId",
            "previousQuantity",
            "newQuantity"
          ]
        },
        {
          "name": "ItemRemovedFromCart",
          "description": "Emitted when an item is removed from the cart",
          "payload": [
            "cartId",
            "cartItemId",
            "productId"
          ]
        },
        {
          "name": "CartCleared",
          "description": "Emitted when cart is cleared (manually or on order placement)",
          "payload": [
            "cartId",
            "customerId",
            "reason"
          ]
        },
        {
          "name": "CartExpired",
          "description": "Emitted when cart expires due to inactivity",
          "payload": [
            "cartId",
            "customerId",
            "expiredAt"
          ]
        }
      ],
      "securityRequirements": {
        "authentication": "Bearer JWT for logged-in users, session token for guest carts",
        "authorization": "User can only access own cart"
      }
    },
    {
      "id": "IC-ORDER-001",
      "serviceName": "Order Service",
      "purpose": "Manages order lifecycle from creation through delivery including status tracking and cancellation",
      "baseUrl": "/api/v1/orders",
      "operations": [
        {
          "id": "OP-ORDER-001",
          "name": "placeOrder",
          "method": "POST",
          "path": "/",
          "description": "Create a new order from cart contents with payment authorization",
          "inputSchema": {
            "cartId": {
              "type": "UUID",
              "required": true
            },
            "customerId": {
              "type": "UUID",
              "required": true
            },
            "paymentMethod": {
              "type": "PaymentMethod"
            },
            "paymentMethodId": {
              "type": "UUID"
            },
            "savePaymentMethod": {
              "type": "boolean"
            },
            "shippingAddress": {
              "type": "Address"
            },
            "shippingAddressId": {
              "type": "UUID"
            }
          },
          "outputSchema": {
            "createdAt": {
              "type": "DateTime"
            },
            "estimatedDelivery": {
              "type": "DateRange"
            },
            "lineItems": {
              "type": "List\u003cOrderLineItem\u003e"
            },
            "orderId": {
              "type": "UUID"
            },
            "orderNumber": {
              "type": "string"
            },
            "shippingAddress": {
              "type": "Address"
            },
            "shippingCost": {
              "type": "Money"
            },
            "status": {
              "type": "OrderStatus"
            },
            "subtotal": {
              "type": "Money"
            },
            "tax": {
              "type": "Money"
            },
            "totalAmount": {
              "type": "Money"
            }
          },
          "errors": [
            {
              "code": "EMAIL_NOT_VERIFIED",
              "httpStatus": 403,
              "message": "Email must be verified to place orders"
            },
            {
              "code": "CART_EMPTY",
              "httpStatus": 400,
              "message": "Cart has no items"
            },
            {
              "code": "STOCK_UNAVAILABLE",
              "httpStatus": 409,
              "message": "One or more items out of stock"
            },
            {
              "code": "PAYMENT_FAILED",
              "httpStatus": 402,
              "message": "Payment authorization failed"
            },
            {
              "code": "PAYMENT_DECLINED",
              "httpStatus": 402,
              "message": "Card was declined"
            },
            {
              "code": "INVALID_CARD",
              "httpStatus": 400,
              "message": "Invalid card number"
            },
            {
              "code": "UNSUPPORTED_CARD_TYPE",
              "httpStatus": 400,
              "message": "Only Visa, Mastercard, and American Express accepted"
            },
            {
              "code": "INVALID_ADDRESS",
              "httpStatus": 400,
              "message": "Invalid shipping address"
            },
            {
              "code": "UNSUPPORTED_SHIPPING_REGION",
              "httpStatus": 400,
              "message": "Shipping only available within domestic country"
            },
            {
              "code": "CUSTOMER_NOT_FOUND",
              "httpStatus": 404,
              "message": "Customer does not exist"
            }
          ],
          "preconditions": [
            "Customer is registered and email verified",
            "Cart has items",
            "All cart items in stock",
            "Valid shipping address",
            "Valid payment method"
          ],
          "postconditions": [
            "Order created with status 'pending'",
            "Payment authorized",
            "Inventory reserved",
            "Cart cleared",
            "Confirmation email queued",
            "OrderPlaced event emitted"
          ],
          "relatedACs": [
            "AC-ORDER-001",
            "AC-ORDER-002",
            "AC-ORDER-003",
            "AC-ORDER-004",
            "AC-ORDER-005",
            "AC-PAY-001",
            "AC-PAY-002"
          ],
          "relatedBRs": [
            "BR-CUST-001",
            "BR-ORDER-001",
            "BR-ORDER-005",
            "BR-ORDER-006",
            "BR-INV-002",
            "BR-PAY-001",
            "BR-PAY-002",
            "BR-SHIP-001",
            "BR-SHIP-002"
          ]
        },
        {
          "id": "OP-ORDER-002",
          "name": "getOrder",
          "method": "GET",
          "path": "/{orderId}",
          "description": "Get order details including tracking information",
          "inputSchema": {
            "orderId": {
              "type": "UUID",
              "required": true
            }
          },
          "outputSchema": {
            "createdAt": {
              "type": "DateTime"
            },
            "lineItems": {
              "type": "List\u003cOrderLineItem\u003e"
            },
            "orderId": {
              "type": "UUID"
            },
            "orderNumber": {
              "type": "string"
            },
            "shippingAddress": {
              "type": "Address"
            },
            "shippingCost": {
              "type": "Money"
            },
            "status": {
              "type": "OrderStatus"
            },
            "subtotal": {
              "type": "Money"
            },
            "tax": {
              "type": "Money"
            },
            "totalAmount": {
              "type": "Money"
            },
            "trackingNumber": {
              "type": "string"
            },
            "trackingUrl": {
              "type": "string"
            },
            "updatedAt": {
              "type": "DateTime"
            }
          },
          "errors": [
            {
              "code": "ORDER_NOT_FOUND",
              "httpStatus": 404,
              "message": "Order does not exist"
            },
            {
              "code": "ACCESS_DENIED",
              "httpStatus": 403,
              "message": "Not authorized to view this order"
            }
          ],
          "preconditions": [
            "Order exists"
          ],
          "postconditions": [],
          "relatedACs": [
            "AC-ORDER-007"
          ],
          "relatedBRs": []
        },
        {
          "id": "OP-ORDER-003",
          "name": "getCustomerOrders",
          "method": "GET",
          "path": "/",
          "description": "Get paginated order history for a customer",
          "inputSchema": {
            "customerId": {
              "type": "UUID",
              "required": true
            },
            "page": {
              "type": "integer"
            },
            "pageSize": {
              "type": "integer"
            },
            "status": {
              "type": "OrderStatus"
            }
          },
          "outputSchema": {
            "orders": {
              "type": "List\u003cOrderSummary\u003e"
            },
            "page": {
              "type": "integer"
            },
            "pageSize": {
              "type": "integer"
            },
            "totalCount": {
              "type": "integer"
            },
            "totalPages": {
              "type": "integer"
            }
          },
          "errors": [
            {
              "code": "CUSTOMER_NOT_FOUND",
              "httpStatus": 404,
              "message": "Customer does not exist"
            }
          ],
          "preconditions": [
            "Customer exists"
          ],
          "postconditions": [],
          "relatedACs": [
            "AC-ORDER-006"
          ],
          "relatedBRs": []
        },
        {
          "id": "OP-ORDER-004",
          "name": "cancelOrder",
          "method": "POST",
          "path": "/{orderId}/cancel",
          "description": "Cancel an order and initiate refund",
          "inputSchema": {
            "orderId": {
              "type": "UUID",
              "required": true
            },
            "reason": {
              "type": "string",
              "required": true
            }
          },
          "outputSchema": {
            "cancelledAt": {
              "type": "DateTime"
            },
            "orderId": {
              "type": "UUID"
            },
            "refundAmount": {
              "type": "Money"
            },
            "refundStatus": {
              "type": "string"
            },
            "status": {
              "type": "OrderStatus"
            }
          },
          "errors": [
            {
              "code": "ORDER_NOT_FOUND",
              "httpStatus": 404,
              "message": "Order does not exist"
            },
            {
              "code": "ORDER_ALREADY_SHIPPED",
              "httpStatus": 409,
              "message": "Cannot cancel order that has been shipped"
            },
            {
              "code": "ORDER_NOT_MODIFIABLE",
              "httpStatus": 409,
              "message": "Order cannot be modified in current status"
            },
            {
              "code": "REFUND_FAILED",
              "httpStatus": 500,
              "message": "Refund initiation failed"
            }
          ],
          "preconditions": [
            "Order exists",
            "Order status is 'pending' or 'confirmed'"
          ],
          "postconditions": [
            "Status changed to 'cancelled'",
            "Inventory restored",
            "Refund initiated to original payment method",
            "Cancellation email sent",
            "OrderCancelled event emitted"
          ],
          "relatedACs": [
            "AC-ORDER-008",
            "AC-ORDER-009",
            "AC-ORDER-010"
          ],
          "relatedBRs": [
            "BR-ORDER-002",
            "BR-ORDER-003",
            "BR-ORDER-004",
            "BR-INV-003",
            "BR-PAY-003"
          ]
        },
        {
          "id": "OP-ORDER-005",
          "name": "confirmOrder",
          "method": "POST",
          "path": "/{orderId}/confirm",
          "description": "Confirm a pending order (admin only)",
          "inputSchema": {
            "orderId": {
              "type": "UUID",
              "required": true
            }
          },
          "outputSchema": {
            "confirmedAt": {
              "type": "DateTime"
            },
            "orderId": {
              "type": "UUID"
            },
            "status": {
              "type": "OrderStatus"
            }
          },
          "errors": [
            {
              "code": "ORDER_NOT_FOUND",
              "httpStatus": 404,
              "message": "Order does not exist"
            },
            {
              "code": "INVALID_STATUS_TRANSITION",
              "httpStatus": 409,
              "message": "Order must be in 'pending' status to confirm"
            }
          ],
          "preconditions": [
            "Admin user authenticated",
            "Order exists",
            "Order status is 'pending'"
          ],
          "postconditions": [
            "Status changed to 'confirmed'",
            "OrderConfirmed event emitted"
          ],
          "relatedACs": [],
          "relatedBRs": [
            "BR-ORDER-003"
          ]
        },
        {
          "id": "OP-ORDER-006",
          "name": "shipOrder",
          "method": "POST",
          "path": "/{orderId}/ship",
          "description": "Mark order as shipped with tracking info (admin only)",
          "inputSchema": {
            "carrier": {
              "type": "string",
              "required": true
            },
            "orderId": {
              "type": "UUID",
              "required": true
            },
            "trackingNumber": {
              "type": "string",
              "required": true
            }
          },
          "outputSchema": {
            "orderId": {
              "type": "UUID"
            },
            "shippedAt": {
              "type": "DateTime"
            },
            "status": {
              "type": "OrderStatus"
            },
            "trackingNumber": {
              "type": "string"
            },
            "trackingUrl": {
              "type": "string"
            }
          },
          "errors": [
            {
              "code": "ORDER_NOT_FOUND",
              "httpStatus": 404,
              "message": "Order does not exist"
            },
            {
              "code": "INVALID_STATUS_TRANSITION",
              "httpStatus": 409,
              "message": "Order must be in 'confirmed' status to ship"
            }
          ],
          "preconditions": [
            "Admin user authenticated",
            "Order exists",
            "Order status is 'confirmed'"
          ],
          "postconditions": [
            "Status changed to 'shipped'",
            "Tracking number stored",
            "Customer notified via email",
            "OrderShipped event emitted"
          ],
          "relatedACs": [
            "AC-ADMIN-008"
          ],
          "relatedBRs": [
            "BR-ORDER-003"
          ]
        },
        {
          "id": "OP-ORDER-007",
          "name": "deliverOrder",
          "method": "POST",
          "path": "/{orderId}/deliver",
          "description": "Mark order as delivered (admin only)",
          "inputSchema": {
            "orderId": {
              "type": "UUID",
              "required": true
            }
          },
          "outputSchema": {
            "deliveredAt": {
              "type": "DateTime"
            },
            "orderId": {
              "type": "UUID"
            },
            "status": {
              "type": "OrderStatus"
            }
          },
          "errors": [
            {
              "code": "ORDER_NOT_FOUND",
              "httpStatus": 404,
              "message": "Order does not exist"
            },
            {
              "code": "INVALID_STATUS_TRANSITION",
              "httpStatus": 409,
              "message": "Order must be in 'shipped' status to mark as delivered"
            }
          ],
          "preconditions": [
            "Admin user authenticated",
            "Order exists",
            "Order status is 'shipped'"
          ],
          "postconditions": [
            "Status changed to 'delivered'",
            "OrderDelivered event emitted"
          ],
          "relatedACs": [],
          "relatedBRs": [
            "BR-ORDER-003"
          ]
        },
        {
          "id": "OP-ORDER-008",
          "name": "getAllOrders",
          "method": "GET",
          "path": "/admin/all",
          "description": "Get all orders with filters (admin only)",
          "inputSchema": {
            "endDate": {
              "type": "Date"
            },
            "orderNumberSearch": {
              "type": "string"
            },
            "page": {
              "type": "integer"
            },
            "pageSize": {
              "type": "integer"
            },
            "startDate": {
              "type": "Date"
            },
            "status": {
              "type": "OrderStatus"
            }
          },
          "outputSchema": {
            "orders": {
              "type": "List\u003cAdminOrderSummary\u003e"
            },
            "page": {
              "type": "integer"
            },
            "pageSize": {
              "type": "integer"
            },
            "totalCount": {
              "type": "integer"
            },
            "totalPages": {
              "type": "integer"
            }
          },
          "errors": [
            {
              "code": "INVALID_DATE_RANGE",
              "httpStatus": 400,
              "message": "Start date must be before end date"
            }
          ],
          "preconditions": [
            "Admin user authenticated"
          ],
          "postconditions": [],
          "relatedACs": [
            "AC-ADMIN-006"
          ],
          "relatedBRs": []
        },
        {
          "id": "OP-ORDER-009",
          "name": "exportOrdersCsv",
          "method": "GET",
          "path": "/admin/export",
          "description": "Export filtered orders to CSV (admin only)",
          "inputSchema": {
            "endDate": {
              "type": "Date"
            },
            "orderNumberSearch": {
              "type": "string"
            },
            "startDate": {
              "type": "Date"
            },
            "status": {
              "type": "OrderStatus"
            }
          },
          "outputSchema": {
            "file": {
              "type": "binary"
            },
            "filename": {
              "type": "string"
            }
          },
          "errors": [
            {
              "code": "EXPORT_TOO_LARGE",
              "httpStatus": 400,
              "message": "Too many orders to export, narrow filter criteria"
            }
          ],
          "preconditions": [
            "Admin user authenticated"
          ],
          "postconditions": [
            "CSV file generated with all filtered orders"
          ],
          "relatedACs": [
            "AC-ADMIN-007"
          ],
          "relatedBRs": []
        }
      ],
      "events": [
        {
          "name": "OrderPlaced",
          "description": "Emitted when a new order is created",
          "payload": [
            "orderId",
            "orderNumber",
            "customerId",
            "totalAmount",
            "lineItems",
            "shippingAddress"
          ]
        },
        {
          "name": "OrderConfirmed",
          "description": "Emitted when an order is confirmed",
          "payload": [
            "orderId",
            "customerId",
            "confirmedAt"
          ]
        },
        {
          "name": "OrderShipped",
          "description": "Emitted when an order is shipped",
          "payload": [
            "orderId",
            "customerId",
            "trackingNumber",
            "carrier",
            "shippedAt"
          ]
        },
        {
          "name": "OrderDelivered",
          "description": "Emitted when an order is delivered",
          "payload": [
            "orderId",
            "customerId",
            "deliveredAt"
          ]
        },
        {
          "name": "OrderCancelled",
          "description": "Emitted when an order is cancelled",
          "payload": [
            "orderId",
            "customerId",
            "reason",
            "refundAmount",
            "cancelledAt"
          ]
        }
      ],
      "securityRequirements": {
        "authentication": "Bearer JWT required for all operations",
        "authorization": "Customer can only access own orders, admin operations require admin role"
      }
    },
    {
      "id": "IC-INVENTORY-001",
      "serviceName": "Inventory Service",
      "purpose": "Manages product stock levels, reservations, and inventory adjustments with audit logging",
      "baseUrl": "/api/v1/inventory",
      "operations": [
        {
          "id": "OP-INV-001",
          "name": "getInventory",
          "method": "GET",
          "path": "/{productId}",
          "description": "Get current inventory levels for a product",
          "inputSchema": {
            "productId": {
              "type": "UUID",
              "required": true
            }
          },
          "outputSchema": {
            "availableQuantity": {
              "type": "integer"
            },
            "inventoryId": {
              "type": "UUID"
            },
            "isLowStock": {
              "type": "boolean"
            },
            "lowStockThreshold": {
              "type": "integer"
            },
            "productId": {
              "type": "UUID"
            },
            "reservedQuantity": {
              "type": "integer"
            },
            "stockLevel": {
              "type": "integer"
            }
          },
          "errors": [
            {
              "code": "PRODUCT_NOT_FOUND",
              "httpStatus": 404,
              "message": "Product does not exist"
            }
          ],
          "preconditions": [
            "Product exists"
          ],
          "postconditions": [],
          "relatedACs": [],
          "relatedBRs": []
        },
        {
          "id": "OP-INV-002",
          "name": "setInventoryLevel",
          "method": "PUT",
          "path": "/{productId}",
          "description": "Set absolute inventory level (admin only)",
          "inputSchema": {
            "productId": {
              "type": "UUID",
              "required": true
            },
            "quantity": {
              "type": "integer",
              "required": true
            },
            "reason": {
              "type": "string",
              "required": true
            }
          },
          "outputSchema": {
            "adjustedAt": {
              "type": "DateTime"
            },
            "adjustedBy": {
              "type": "UUID"
            },
            "inventoryId": {
              "type": "UUID"
            },
            "newLevel": {
              "type": "integer"
            },
            "previousLevel": {
              "type": "integer"
            },
            "productId": {
              "type": "UUID"
            }
          },
          "errors": [
            {
              "code": "PRODUCT_NOT_FOUND",
              "httpStatus": 404,
              "message": "Product does not exist"
            },
            {
              "code": "INVALID_QUANTITY",
              "httpStatus": 400,
              "message": "Quantity cannot be negative"
            }
          ],
          "preconditions": [
            "Admin user authenticated",
            "Product exists"
          ],
          "postconditions": [
            "Stock level updated",
            "Audit log created with before/after values, reason, user, timestamp",
            "Low stock alert triggered if applicable"
          ],
          "relatedACs": [
            "AC-ADMIN-009"
          ],
          "relatedBRs": [
            "BR-INV-001",
            "BR-INV-004"
          ]
        },
        {
          "id": "OP-INV-003",
          "name": "adjustInventory",
          "method": "POST",
          "path": "/{productId}/adjust",
          "description": "Adjust inventory by delta amount (admin only)",
          "inputSchema": {
            "delta": {
              "type": "integer",
              "required": true
            },
            "productId": {
              "type": "UUID",
              "required": true
            },
            "reason": {
              "type": "string",
              "required": true
            }
          },
          "outputSchema": {
            "adjustedAt": {
              "type": "DateTime"
            },
            "adjustedBy": {
              "type": "UUID"
            },
            "delta": {
              "type": "integer"
            },
            "inventoryId": {
              "type": "UUID"
            },
            "newLevel": {
              "type": "integer"
            },
            "previousLevel": {
              "type": "integer"
            },
            "productId": {
              "type": "UUID"
            }
          },
          "errors": [
            {
              "code": "PRODUCT_NOT_FOUND",
              "httpStatus": 404,
              "message": "Product does not exist"
            },
            {
              "code": "INSUFFICIENT_STOCK",
              "httpStatus": 409,
              "message": "Adjustment would result in negative stock"
            }
          ],
          "preconditions": [
            "Admin user authenticated",
            "Product exists",
            "Resulting quantity \u003e= 0"
          ],
          "postconditions": [
            "Stock level adjusted by delta",
            "Audit log created",
            "Low stock alert triggered if applicable"
          ],
          "relatedACs": [
            "AC-ADMIN-010"
          ],
          "relatedBRs": [
            "BR-INV-001",
            "BR-INV-004"
          ]
        },
        {
          "id": "OP-INV-004",
          "name": "bulkUpdateInventory",
          "method": "POST",
          "path": "/bulk",
          "description": "Bulk update inventory from CSV file (admin only)",
          "inputSchema": {
            "file": {
              "type": "MultipartFile",
              "required": true
            }
          },
          "outputSchema": {
            "errors": {
              "type": "List\u003cBulkUpdateError\u003e"
            },
            "failedUpdates": {
              "type": "integer"
            },
            "successfulUpdates": {
              "type": "integer"
            },
            "totalRows": {
              "type": "integer"
            }
          },
          "errors": [
            {
              "code": "INVALID_CSV_FORMAT",
              "httpStatus": 400,
              "message": "CSV file format is invalid"
            },
            {
              "code": "EMPTY_FILE",
              "httpStatus": 400,
              "message": "CSV file is empty"
            }
          ],
          "preconditions": [
            "Admin user authenticated",
            "Valid CSV file"
          ],
          "postconditions": [
            "Valid rows updated",
            "Audit logs created for each update",
            "Error report generated for invalid rows"
          ],
          "relatedACs": [
            "AC-ADMIN-011"
          ],
          "relatedBRs": [
            "BR-INV-004"
          ]
        },
        {
          "id": "OP-INV-005",
          "name": "reserveInventory",
          "method": "POST",
          "path": "/{productId}/reserve",
          "description": "Reserve inventory for a pending order (internal use)",
          "inputSchema": {
            "orderId": {
              "type": "UUID",
              "required": true
            },
            "productId": {
              "type": "UUID",
              "required": true
            },
            "quantity": {
              "type": "integer",
              "required": true
            }
          },
          "outputSchema": {
            "availableQuantity": {
              "type": "integer"
            },
            "productId": {
              "type": "UUID"
            },
            "quantity": {
              "type": "integer"
            },
            "reservationId": {
              "type": "UUID"
            }
          },
          "errors": [
            {
              "code": "PRODUCT_NOT_FOUND",
              "httpStatus": 404,
              "message": "Product does not exist"
            },
            {
              "code": "INSUFFICIENT_STOCK",
              "httpStatus": 409,
              "message": "Insufficient stock to reserve"
            }
          ],
          "preconditions": [
            "Product exists",
            "Requested quantity \u003c= available quantity"
          ],
          "postconditions": [
            "Reserved quantity increased",
            "InventoryReserved event emitted"
          ],
          "relatedACs": [
            "AC-ORDER-001"
          ],
          "relatedBRs": [
            "BR-INV-001",
            "BR-INV-002"
          ]
        },
        {
          "id": "OP-INV-006",
          "name": "releaseInventory",
          "method": "POST",
          "path": "/{productId}/release",
          "description": "Release reserved inventory (e.g., on order cancellation)",
          "inputSchema": {
            "orderId": {
              "type": "UUID",
              "required": true
            },
            "productId": {
              "type": "UUID",
              "required": true
            },
            "quantity": {
              "type": "integer",
              "required": true
            }
          },
          "outputSchema": {
            "availableQuantity": {
              "type": "integer"
            },
            "productId": {
              "type": "UUID"
            },
            "releasedQuantity": {
              "type": "integer"
            }
          },
          "errors": [
            {
              "code": "PRODUCT_NOT_FOUND",
              "httpStatus": 404,
              "message": "Product does not exist"
            },
            {
              "code": "INVALID_RELEASE_QUANTITY",
              "httpStatus": 400,
              "message": "Release quantity exceeds reserved amount"
            }
          ],
          "preconditions": [
            "Product exists",
            "Quantity \u003c= reserved quantity"
          ],
          "postconditions": [
            "Reserved quantity decreased",
            "InventoryReleased event emitted"
          ],
          "relatedACs": [
            "AC-ORDER-008"
          ],
          "relatedBRs": [
            "BR-INV-003"
          ]
        },
        {
          "id": "OP-INV-007",
          "name": "deductInventory",
          "method": "POST",
          "path": "/{productId}/deduct",
          "description": "Deduct reserved inventory on order fulfillment (internal use)",
          "inputSchema": {
            "orderId": {
              "type": "UUID",
              "required": true
            },
            "productId": {
              "type": "UUID",
              "required": true
            },
            "quantity": {
              "type": "integer",
              "required": true
            }
          },
          "outputSchema": {
            "deductedQuantity": {
              "type": "integer"
            },
            "newStockLevel": {
              "type": "integer"
            },
            "productId": {
              "type": "UUID"
            }
          },
          "errors": [
            {
              "code": "PRODUCT_NOT_FOUND",
              "httpStatus": 404,
              "message": "Product does not exist"
            },
            {
              "code": "INVALID_DEDUCT_QUANTITY",
              "httpStatus": 400,
              "message": "Deduct quantity exceeds reserved amount"
            }
          ],
          "preconditions": [
            "Product exists",
            "Quantity \u003c= reserved quantity"
          ],
          "postconditions": [
            "Stock level and reserved quantity decreased",
            "InventoryDeducted event emitted",
            "OutOfStock event if stock reaches 0"
          ],
          "relatedACs": [],
          "relatedBRs": [
            "BR-INV-001"
          ]
        },
        {
          "id": "OP-INV-008",
          "name": "getAuditLog",
          "method": "GET",
          "path": "/{productId}/audit",
          "description": "Get inventory audit log for a product (admin only)",
          "inputSchema": {
            "endDate": {
              "type": "Date"
            },
            "page": {
              "type": "integer"
            },
            "pageSize": {
              "type": "integer"
            },
            "productId": {
              "type": "UUID",
              "required": true
            },
            "startDate": {
              "type": "Date"
            }
          },
          "outputSchema": {
            "auditEntries": {
              "type": "List\u003cInventoryAuditEntry\u003e"
            },
            "page": {
              "type": "integer"
            },
            "pageSize": {
              "type": "integer"
            },
            "totalCount": {
              "type": "integer"
            }
          },
          "errors": [
            {
              "code": "PRODUCT_NOT_FOUND",
              "httpStatus": 404,
              "message": "Product does not exist"
            }
          ],
          "preconditions": [
            "Admin user authenticated",
            "Product exists"
          ],
          "postconditions": [],
          "relatedACs": [
            "AC-ADMIN-009"
          ],
          "relatedBRs": [
            "BR-INV-004"
          ]
        }
      ],
      "events": [
        {
          "name": "InventoryReserved",
          "description": "Emitted when inventory is reserved for an order",
          "payload": [
            "productId",
            "orderId",
            "quantity",
            "availableQuantity"
          ]
        },
        {
          "name": "InventoryReleased",
          "description": "Emitted when reserved inventory is released",
          "payload": [
            "productId",
            "orderId",
            "quantity",
            "availableQuantity"
          ]
        },
        {
          "name": "InventoryDeducted",
          "description": "Emitted when inventory is permanently deducted",
          "payload": [
            "productId",
            "orderId",
            "quantity",
            "newStockLevel"
          ]
        },
        {
          "name": "InventoryRestocked",
          "description": "Emitted when inventory is restocked",
          "payload": [
            "productId",
            "quantity",
            "newStockLevel",
            "adjustedBy"
          ]
        },
        {
          "name": "OutOfStock",
          "description": "Emitted when product available quantity reaches zero",
          "payload": [
            "productId",
            "productName"
          ]
        },
        {
          "name": "LowStockAlert",
          "description": "Emitted when stock drops below threshold",
          "payload": [
            "productId",
            "productName",
            "currentStock",
            "threshold"
          ]
        }
      ],
      "securityRequirements": {
        "authentication": "Bearer JWT for admin operations, internal auth for reserve/release/deduct",
        "authorization": "Admin role required for manual adjustments and audit access"
      }
    },
    {
      "id": "IC-CATEGORY-001",
      "serviceName": "Category Service",
      "purpose": "Manages product category hierarchy for catalog organization",
      "baseUrl": "/api/v1/categories",
      "operations": [
        {
          "id": "OP-CAT-001",
          "name": "getCategories",
          "method": "GET",
          "path": "/",
          "description": "Get all categories in hierarchical structure",
          "inputSchema": {
            "includeChildren": {
              "type": "boolean"
            },
            "parentId": {
              "type": "UUID"
            }
          },
          "outputSchema": {
            "categories": {
              "type": "List\u003cCategoryTree\u003e"
            }
          },
          "errors": [],
          "preconditions": [],
          "postconditions": [],
          "relatedACs": [
            "AC-PROD-001"
          ],
          "relatedBRs": []
        },
        {
          "id": "OP-CAT-002",
          "name": "createCategory",
          "method": "POST",
          "path": "/",
          "description": "Create a new category (admin only)",
          "inputSchema": {
            "description": {
              "type": "string"
            },
            "displayOrder": {
              "type": "integer"
            },
            "name": {
              "type": "string",
              "required": true
            },
            "parentCategoryId": {
              "type": "UUID"
            }
          },
          "outputSchema": {
            "categoryId": {
              "type": "UUID"
            },
            "createdAt": {
              "type": "DateTime"
            },
            "depth": {
              "type": "integer"
            },
            "name": {
              "type": "string"
            },
            "parentCategoryId": {
              "type": "UUID"
            }
          },
          "errors": [
            {
              "code": "DUPLICATE_CATEGORY_NAME",
              "httpStatus": 409,
              "message": "Category name already exists"
            },
            {
              "code": "PARENT_NOT_FOUND",
              "httpStatus": 404,
              "message": "Parent category does not exist"
            },
            {
              "code": "MAX_NESTING_EXCEEDED",
              "httpStatus": 400,
              "message": "Category hierarchy cannot exceed 3 levels"
            }
          ],
          "preconditions": [
            "Admin user authenticated",
            "Name is unique",
            "Nesting depth \u003c= 3"
          ],
          "postconditions": [
            "Category created with parent reference",
            "CategoryCreated event emitted"
          ],
          "relatedACs": [
            "AC-ADMIN-013"
          ],
          "relatedBRs": [
            "BR-CAT-001"
          ]
        },
        {
          "id": "OP-CAT-003",
          "name": "updateCategory",
          "method": "PUT",
          "path": "/{categoryId}",
          "description": "Update category details (admin only)",
          "inputSchema": {
            "categoryId": {
              "type": "UUID",
              "required": true
            },
            "description": {
              "type": "string"
            },
            "displayOrder": {
              "type": "integer"
            },
            "name": {
              "type": "string"
            }
          },
          "outputSchema": {
            "categoryId": {
              "type": "UUID"
            },
            "name": {
              "type": "string"
            },
            "updatedAt": {
              "type": "DateTime"
            }
          },
          "errors": [
            {
              "code": "CATEGORY_NOT_FOUND",
              "httpStatus": 404,
              "message": "Category does not exist"
            },
            {
              "code": "DUPLICATE_CATEGORY_NAME",
              "httpStatus": 409,
              "message": "Category name already exists"
            }
          ],
          "preconditions": [
            "Admin user authenticated",
            "Category exists"
          ],
          "postconditions": [
            "Category attributes updated"
          ],
          "relatedACs": [],
          "relatedBRs": []
        },
        {
          "id": "OP-CAT-004",
          "name": "deleteCategory",
          "method": "DELETE",
          "path": "/{categoryId}",
          "description": "Delete a category (admin only)",
          "inputSchema": {
            "categoryId": {
              "type": "UUID",
              "required": true
            }
          },
          "outputSchema": {
            "deleted": {
              "type": "boolean"
            }
          },
          "errors": [
            {
              "code": "CATEGORY_NOT_FOUND",
              "httpStatus": 404,
              "message": "Category does not exist"
            },
            {
              "code": "CATEGORY_HAS_PRODUCTS",
              "httpStatus": 409,
              "message": "Cannot delete category with products"
            },
            {
              "code": "CATEGORY_HAS_CHILDREN",
              "httpStatus": 409,
              "message": "Cannot delete category with subcategories"
            }
          ],
          "preconditions": [
            "Admin user authenticated",
            "Category exists",
            "No products in category",
            "No child categories"
          ],
          "postconditions": [
            "Category deleted"
          ],
          "relatedACs": [],
          "relatedBRs": []
        }
      ],
      "events": [
        {
          "name": "CategoryCreated",
          "description": "Emitted when a new category is created",
          "payload": [
            "categoryId",
            "name",
            "parentCategoryId"
          ]
        }
      ],
      "securityRequirements": {
        "authentication": "None for reading, Bearer JWT for admin operations",
        "authorization": "Admin role required for create/update/delete"
      }
    },
    {
      "id": "IC-NOTIFICATION-001",
      "serviceName": "Notification Service",
      "purpose": "Handles email notifications for order confirmations, status updates, and alerts",
      "baseUrl": "/api/v1/notifications",
      "operations": [
        {
          "id": "OP-NOTIF-001",
          "name": "sendOrderConfirmation",
          "method": "POST",
          "path": "/order-confirmation",
          "description": "Queue order confirmation email (internal use)",
          "inputSchema": {
            "customerId": {
              "type": "UUID",
              "required": true
            },
            "email": {
              "type": "Email",
              "required": true
            },
            "orderId": {
              "type": "UUID",
              "required": true
            }
          },
          "outputSchema": {
            "notificationId": {
              "type": "UUID"
            },
            "queuedAt": {
              "type": "DateTime"
            },
            "status": {
              "type": "string"
            }
          },
          "errors": [
            {
              "code": "ORDER_NOT_FOUND",
              "httpStatus": 404,
              "message": "Order does not exist"
            },
            {
              "code": "DUPLICATE_NOTIFICATION",
              "httpStatus": 409,
              "message": "Confirmation email already sent for this order"
            }
          ],
          "preconditions": [
            "Order exists",
            "Email not already sent for this order"
          ],
          "postconditions": [
            "Email queued with order details",
            "Retry mechanism enabled if delivery fails"
          ],
          "relatedACs": [
            "AC-ORDER-011"
          ],
          "relatedBRs": [
            "BR-EMAIL-001",
            "BR-EMAIL-002"
          ]
        },
        {
          "id": "OP-NOTIF-002",
          "name": "sendShippingNotification",
          "method": "POST",
          "path": "/shipping-update",
          "description": "Queue shipping status email (internal use)",
          "inputSchema": {
            "carrier": {
              "type": "string",
              "required": true
            },
            "customerId": {
              "type": "UUID",
              "required": true
            },
            "email": {
              "type": "Email",
              "required": true
            },
            "orderId": {
              "type": "UUID",
              "required": true
            },
            "trackingNumber": {
              "type": "string",
              "required": true
            }
          },
          "outputSchema": {
            "notificationId": {
              "type": "UUID"
            },
            "queuedAt": {
              "type": "DateTime"
            },
            "status": {
              "type": "string"
            }
          },
          "errors": [
            {
              "code": "ORDER_NOT_FOUND",
              "httpStatus": 404,
              "message": "Order does not exist"
            }
          ],
          "preconditions": [
            "Order exists"
          ],
          "postconditions": [
            "Email queued with tracking information"
          ],
          "relatedACs": [
            "AC-ADMIN-008"
          ],
          "relatedBRs": [
            "BR-EMAIL-001"
          ]
        },
        {
          "id": "OP-NOTIF-003",
          "name": "sendCancellationNotification",
          "method": "POST",
          "path": "/cancellation",
          "description": "Queue order cancellation email (internal use)",
          "inputSchema": {
            "customerId": {
              "type": "UUID",
              "required": true
            },
            "email": {
              "type": "Email",
              "required": true
            },
            "orderId": {
              "type": "UUID",
              "required": true
            },
            "refundAmount": {
              "type": "Money",
              "required": true
            }
          },
          "outputSchema": {
            "notificationId": {
              "type": "UUID"
            },
            "queuedAt": {
              "type": "DateTime"
            },
            "status": {
              "type": "string"
            }
          },
          "errors": [
            {
              "code": "ORDER_NOT_FOUND",
              "httpStatus": 404,
              "message": "Order does not exist"
            }
          ],
          "preconditions": [
            "Order exists"
          ],
          "postconditions": [
            "Email queued with cancellation and refund details"
          ],
          "relatedACs": [
            "AC-ORDER-008"
          ],
          "relatedBRs": [
            "BR-EMAIL-001"
          ]
        },
        {
          "id": "OP-NOTIF-004",
          "name": "sendLowStockAlert",
          "method": "POST",
          "path": "/low-stock-alert",
          "description": "Send low stock alert to admin (internal use)",
          "inputSchema": {
            "currentStock": {
              "type": "integer",
              "required": true
            },
            "productId": {
              "type": "UUID",
              "required": true
            },
            "productName": {
              "type": "string",
              "required": true
            },
            "threshold": {
              "type": "integer",
              "required": true
            }
          },
          "outputSchema": {
            "notificationId": {
              "type": "UUID"
            },
            "status": {
              "type": "string"
            }
          },
          "errors": [],
          "preconditions": [],
          "postconditions": [
            "Alert sent to admin notification channel"
          ],
          "relatedACs": [
            "AC-ADMIN-012"
          ],
          "relatedBRs": []
        }
      ],
      "events": [
        {
          "name": "NotificationSent",
          "description": "Emitted when a notification is successfully sent",
          "payload": [
            "notificationId",
            "type",
            "recipientEmail",
            "sentAt"
          ]
        },
        {
          "name": "NotificationFailed",
          "description": "Emitted when a notification fails to send",
          "payload": [
            "notificationId",
            "type",
            "recipientEmail",
            "error",
            "retryCount"
          ]
        }
      ],
      "securityRequirements": {
        "authentication": "Internal service authentication",
        "authorization": "Only internal services can trigger notifications"
      }
    }
  ],
  "sequences": [
    {
      "id": "SEQ-REG-001",
      "name": "Customer Registration Flow",
      "description": "Complete flow for new customer registration with email verification",
      "trigger": {
        "type": "user_action",
        "description": "Customer submits registration form with email and password"
      },
      "participants": [
        {
          "name": "Customer",
          "type": "actor"
        },
        {
          "name": "Customer Service",
          "type": "service"
        },
        {
          "name": "Customer Aggregate",
          "type": "aggregate"
        },
        {
          "name": "Email Service",
          "type": "service"
        }
      ],
      "steps": [
        {
          "step": 1,
          "actor": "Customer",
          "action": "Submit registration request",
          "target": "Customer Service",
          "data": [
            "email",
            "password"
          ]
        },
        {
          "step": 2,
          "actor": "Customer Service",
          "action": "Validate email uniqueness",
          "target": "Customer Aggregate",
          "returns": "Email availability status"
        },
        {
          "step": 3,
          "actor": "Customer Service",
          "action": "Validate password requirements",
          "target": "Customer Service",
          "returns": "Password validation result"
        },
        {
          "step": 4,
          "actor": "Customer Service",
          "action": "Create customer with 'registered' status",
          "target": "Customer Aggregate",
          "event": "CustomerRegistered"
        },
        {
          "step": 5,
          "actor": "Customer Service",
          "action": "Create empty cart for customer",
          "target": "Cart Aggregate",
          "returns": "Cart created"
        },
        {
          "step": 6,
          "actor": "Customer Service",
          "action": "Send verification email (async)",
          "target": "Email Service",
          "returns": "Email queued"
        },
        {
          "step": 7,
          "actor": "Customer Service",
          "action": "Return registration confirmation",
          "target": "Customer",
          "returns": "Customer ID and confirmation message"
        }
      ],
      "outcome": {
        "success": "Customer registered with 'registered' status, empty cart created, verification email sent",
        "state_changes": [
          "Customer.status = registered",
          "Cart created with empty items"
        ]
      },
      "exceptions": [
        {
          "condition": "Email already registered",
          "step": 2,
          "handling": "Return error DUPLICATE_EMAIL, abort flow"
        },
        {
          "condition": "Invalid password format",
          "step": 3,
          "handling": "Return error INVALID_PASSWORD with requirements, abort flow"
        },
        {
          "condition": "Email delivery fails",
          "step": 6,
          "handling": "Log error, continue flow (BR-EMAIL-001: non-blocking)"
        }
      ],
      "relatedACs": [],
      "relatedBRs": [
        "BR-CUST-001",
        "BR-CUST-002",
        "BR-CUST-003",
        "BR-EMAIL-001"
      ]
    },
    {
      "id": "SEQ-CART-001",
      "name": "Add Item to Cart Flow",
      "description": "Complete flow for adding a product to shopping cart with stock validation",
      "trigger": {
        "type": "user_action",
        "description": "Customer clicks 'Add to Cart' button on product page"
      },
      "participants": [
        {
          "name": "Customer",
          "type": "actor"
        },
        {
          "name": "Cart Service",
          "type": "service"
        },
        {
          "name": "Product Service",
          "type": "service"
        },
        {
          "name": "Inventory Service",
          "type": "service"
        },
        {
          "name": "Cart Aggregate",
          "type": "aggregate"
        }
      ],
      "steps": [
        {
          "step": 1,
          "actor": "Customer",
          "action": "Submit add to cart request",
          "target": "Cart Service",
          "data": [
            "productId",
            "variantId (optional)",
            "quantity"
          ]
        },
        {
          "step": 2,
          "actor": "Cart Service",
          "action": "Fetch product details",
          "target": "Product Service",
          "returns": "Product with name, price, variants, isActive"
        },
        {
          "step": 3,
          "actor": "Cart Service",
          "action": "Validate product is active",
          "target": "Cart Service",
          "returns": "Validation result"
        },
        {
          "step": 4,
          "actor": "Cart Service",
          "action": "Validate variant selection if product has variants",
          "target": "Cart Service",
          "returns": "Variant validation result"
        },
        {
          "step": 5,
          "actor": "Cart Service",
          "action": "Check available inventory",
          "target": "Inventory Service",
          "returns": "Available quantity"
        },
        {
          "step": 6,
          "actor": "Cart Service",
          "action": "Add item to cart or update quantity if exists",
          "target": "Cart Aggregate",
          "event": "ItemAddedToCart"
        },
        {
          "step": 7,
          "actor": "Cart Service",
          "action": "Recalculate cart total",
          "target": "Cart Aggregate",
          "returns": "Updated total price"
        },
        {
          "step": 8,
          "actor": "Cart Service",
          "action": "Return updated cart",
          "target": "Customer",
          "returns": "Cart with items and total"
        }
      ],
      "outcome": {
        "success": "Product added to cart with validated quantity, cart total updated",
        "state_changes": [
          "Cart.items += new item or quantity updated",
          "Cart.totalPrice recalculated"
        ]
      },
      "exceptions": [
        {
          "condition": "Product inactive",
          "step": 3,
          "handling": "Return error PRODUCT_UNAVAILABLE, abort flow"
        },
        {
          "condition": "Variant required but not selected",
          "step": 4,
          "handling": "Return error VARIANT_REQUIRED, abort flow"
        },
        {
          "condition": "Product out of stock",
          "step": 5,
          "handling": "Return error OUT_OF_STOCK, abort flow"
        },
        {
          "condition": "Requested quantity exceeds stock",
          "step": 5,
          "handling": "Cap quantity to available stock, return QUANTITY_LIMITED warning"
        }
      ],
      "relatedACs": [],
      "relatedBRs": [
        "BR-CART-001",
        "BR-CART-002",
        "BR-CART-003",
        "BR-CART-005"
      ]
    },
    {
      "id": "SEQ-CART-002",
      "name": "Update Cart Item Quantity Flow",
      "description": "Complete flow for updating quantity of an item in the cart",
      "trigger": {
        "type": "user_action",
        "description": "Customer changes quantity in cart view"
      },
      "participants": [
        {
          "name": "Customer",
          "type": "actor"
        },
        {
          "name": "Cart Service",
          "type": "service"
        },
        {
          "name": "Inventory Service",
          "type": "service"
        },
        {
          "name": "Cart Aggregate",
          "type": "aggregate"
        }
      ],
      "steps": [
        {
          "step": 1,
          "actor": "Customer",
          "action": "Submit quantity update request",
          "target": "Cart Service",
          "data": [
            "cartId",
            "productId",
            "newQuantity"
          ]
        },
        {
          "step": 2,
          "actor": "Cart Service",
          "action": "Validate item exists in cart",
          "target": "Cart Aggregate",
          "returns": "Cart item details"
        },
        {
          "step": 3,
          "actor": "Cart Service",
          "action": "Check if quantity is zero",
          "target": "Cart Service",
          "returns": "Boolean: should remove item"
        },
        {
          "step": 4,
          "actor": "Cart Service",
          "action": "Check available inventory for new quantity",
          "target": "Inventory Service",
          "returns": "Available quantity"
        },
        {
          "step": 5,
          "actor": "Cart Service",
          "action": "Update item quantity or remove if zero",
          "target": "Cart Aggregate",
          "event": "CartItemQuantityUpdated or ItemRemovedFromCart"
        },
        {
          "step": 6,
          "actor": "Cart Service",
          "action": "Recalculate cart total",
          "target": "Cart Aggregate",
          "returns": "Updated total price"
        },
        {
          "step": 7,
          "actor": "Cart Service",
          "action": "Return updated cart",
          "target": "Customer",
          "returns": "Cart with updated items and total"
        }
      ],
      "outcome": {
        "success": "Cart item quantity updated or item removed, cart total recalculated",
        "state_changes": [
          "CartItem.quantity = newQuantity or item removed",
          "Cart.totalPrice recalculated"
        ]
      },
      "exceptions": [
        {
          "condition": "Item not in cart",
          "step": 2,
          "handling": "Return error ITEM_NOT_FOUND, abort flow"
        },
        {
          "condition": "Requested quantity exceeds stock",
          "step": 4,
          "handling": "Cap quantity to available stock, return QUANTITY_LIMITED warning"
        }
      ],
      "relatedACs": [],
      "relatedBRs": [
        "BR-CART-002",
        "BR-CART-003"
      ]
    },
    {
      "id": "SEQ-CART-003",
      "name": "Remove Item from Cart Flow",
      "description": "Complete flow for removing a product from shopping cart",
      "trigger": {
        "type": "user_action",
        "description": "Customer clicks 'Remove' button on cart item"
      },
      "participants": [
        {
          "name": "Customer",
          "type": "actor"
        },
        {
          "name": "Cart Service",
          "type": "service"
        },
        {
          "name": "Cart Aggregate",
          "type": "aggregate"
        }
      ],
      "steps": [
        {
          "step": 1,
          "actor": "Customer",
          "action": "Submit remove item request",
          "target": "Cart Service",
          "data": [
            "cartId",
            "productId"
          ]
        },
        {
          "step": 2,
          "actor": "Cart Service",
          "action": "Validate item exists in cart",
          "target": "Cart Aggregate",
          "returns": "Cart item details"
        },
        {
          "step": 3,
          "actor": "Cart Service",
          "action": "Remove item from cart",
          "target": "Cart Aggregate",
          "event": "ItemRemovedFromCart"
        },
        {
          "step": 4,
          "actor": "Cart Service",
          "action": "Recalculate cart total",
          "target": "Cart Aggregate",
          "returns": "Updated total price"
        },
        {
          "step": 5,
          "actor": "Cart Service",
          "action": "Return updated cart",
          "target": "Customer",
          "returns": "Cart with remaining items and total"
        }
      ],
      "outcome": {
        "success": "Item removed from cart, cart total recalculated",
        "state_changes": [
          "Cart.items -= removed item",
          "Cart.totalPrice recalculated"
        ]
      },
      "exceptions": [
        {
          "condition": "Item not in cart",
          "step": 2,
          "handling": "Return error ITEM_NOT_FOUND, abort flow"
        }
      ],
      "relatedACs": [],
      "relatedBRs": []
    },
    {
      "id": "SEQ-ORDER-001",
      "name": "Place Order Flow",
      "description": "Complete flow from cart checkout to order confirmation with payment and inventory reservation",
      "trigger": {
        "type": "user_action",
        "description": "Customer clicks 'Place Order' button at checkout"
      },
      "participants": [
        {
          "name": "Customer",
          "type": "actor"
        },
        {
          "name": "Order Service",
          "type": "service"
        },
        {
          "name": "Cart Service",
          "type": "service"
        },
        {
          "name": "Inventory Service",
          "type": "service"
        },
        {
          "name": "Payment Service",
          "type": "service"
        },
        {
          "name": "Email Service",
          "type": "service"
        },
        {
          "name": "Order Aggregate",
          "type": "aggregate"
        },
        {
          "name": "Cart Aggregate",
          "type": "aggregate"
        },
        {
          "name": "Inventory Aggregate",
          "type": "aggregate"
        }
      ],
      "steps": [
        {
          "step": 1,
          "actor": "Customer",
          "action": "Submit order request",
          "target": "Order Service",
          "data": [
            "cartId",
            "shippingAddress",
            "paymentMethod"
          ]
        },
        {
          "step": 2,
          "actor": "Order Service",
          "action": "Validate customer registration status",
          "target": "Order Service",
          "returns": "Customer is registered"
        },
        {
          "step": 3,
          "actor": "Order Service",
          "action": "Fetch cart contents",
          "target": "Cart Service",
          "returns": "Cart with items and total"
        },
        {
          "step": 4,
          "actor": "Order Service",
          "action": "Validate cart is not empty",
          "target": "Order Service",
          "returns": "Validation result"
        },
        {
          "step": 5,
          "actor": "Order Service",
          "action": "Validate shipping address",
          "target": "Order Service",
          "returns": "Address validation result"
        },
        {
          "step": 6,
          "actor": "Order Service",
          "action": "Reserve inventory for each item",
          "target": "Inventory Service",
          "event": "InventoryReserved"
        },
        {
          "step": 7,
          "actor": "Order Service",
          "action": "Authorize payment",
          "target": "Payment Service",
          "returns": "Payment authorization token"
        },
        {
          "step": 8,
          "actor": "Order Service",
          "action": "Calculate shipping cost (free if subtotal \u003e $50)",
          "target": "Order Service",
          "returns": "Shipping cost"
        },
        {
          "step": 9,
          "actor": "Order Service",
          "action": "Create order with 'pending' status, snapshot prices",
          "target": "Order Aggregate",
          "event": "OrderPlaced"
        },
        {
          "step": 10,
          "actor": "Order Service",
          "action": "Clear customer cart",
          "target": "Cart Service",
          "event": "CartCleared"
        },
        {
          "step": 11,
          "actor": "Order Service",
          "action": "Send order confirmation email (async)",
          "target": "Email Service",
          "returns": "Email queued"
        },
        {
          "step": 12,
          "actor": "Order Service",
          "action": "Return order confirmation",
          "target": "Customer",
          "returns": "Order details with orderId"
        }
      ],
      "outcome": {
        "success": "Order created with 'pending' status, inventory reserved, payment authorized, cart cleared, confirmation email sent",
        "state_changes": [
          "Order.status = pending",
          "Inventory.reservedQuantity += quantities",
          "Cart.items = empty",
          "Payment authorized"
        ]
      },
      "exceptions": [
        {
          "condition": "Customer not registered",
          "step": 2,
          "handling": "Return error UNAUTHORIZED_ORDER, abort flow"
        },
        {
          "condition": "Cart is empty",
          "step": 4,
          "handling": "Return error EMPTY_ORDER, abort flow"
        },
        {
          "condition": "Invalid shipping address",
          "step": 5,
          "handling": "Return error INVALID_ADDRESS, abort flow"
        },
        {
          "condition": "Shipping outside domestic country",
          "step": 5,
          "handling": "Return error UNSUPPORTED_SHIPPING_REGION, abort flow"
        },
        {
          "condition": "Insufficient stock for item",
          "step": 6,
          "handling": "Return error STOCK_UNAVAILABLE with affected items, abort flow"
        },
        {
          "condition": "Payment authorization fails",
          "step": 7,
          "handling": "Release reserved inventory, return error PAYMENT_FAILED, abort flow"
        },
        {
          "condition": "Unsupported card type",
          "step": 7,
          "handling": "Return error UNSUPPORTED_CARD_TYPE, abort flow"
        },
        {
          "condition": "Email delivery fails",
          "step": 11,
          "handling": "Log error, continue flow (BR-EMAIL-001: non-blocking)"
        }
      ],
      "relatedACs": [],
      "relatedBRs": [
        "BR-CUST-001",
        "BR-ORDER-001",
        "BR-ORDER-005",
        "BR-ORDER-006",
        "BR-INV-002",
        "BR-PAY-001",
        "BR-PAY-002",
        "BR-SHIP-001",
        "BR-SHIP-002",
        "BR-EMAIL-001",
        "BR-EMAIL-002"
      ]
    },
    {
      "id": "SEQ-ORDER-002",
      "name": "Confirm Order Flow",
      "description": "Flow for confirming a pending order after payment capture",
      "trigger": {
        "type": "system_event",
        "description": "Payment capture completed or manual confirmation by admin"
      },
      "participants": [
        {
          "name": "Payment Service",
          "type": "service"
        },
        {
          "name": "Order Service",
          "type": "service"
        },
        {
          "name": "Inventory Service",
          "type": "service"
        },
        {
          "name": "Order Aggregate",
          "type": "aggregate"
        },
        {
          "name": "Inventory Aggregate",
          "type": "aggregate"
        }
      ],
      "steps": [
        {
          "step": 1,
          "actor": "Payment Service",
          "action": "Notify payment captured",
          "target": "Order Service",
          "data": [
            "orderId",
            "paymentConfirmation"
          ]
        },
        {
          "step": 2,
          "actor": "Order Service",
          "action": "Validate order status is 'pending'",
          "target": "Order Aggregate",
          "returns": "Order details and status"
        },
        {
          "step": 3,
          "actor": "Order Service",
          "action": "Deduct reserved inventory",
          "target": "Inventory Service",
          "event": "InventoryDeducted"
        },
        {
          "step": 4,
          "actor": "Order Service",
          "action": "Update order status to 'confirmed'",
          "target": "Order Aggregate",
          "event": "OrderConfirmed"
        },
        {
          "step": 5,
          "actor": "Order Service",
          "action": "Return confirmation result",
          "target": "Payment Service",
          "returns": "Order confirmed status"
        }
      ],
      "outcome": {
        "success": "Order confirmed, reserved inventory deducted from stock",
        "state_changes": [
          "Order.status = confirmed",
          "Inventory.stockLevel -= quantities",
          "Inventory.reservedQuantity -= quantities"
        ]
      },
      "exceptions": [
        {
          "condition": "Order not in 'pending' status",
          "step": 2,
          "handling": "Return error INVALID_STATUS_TRANSITION, abort flow"
        }
      ],
      "relatedACs": [],
      "relatedBRs": [
        "BR-ORDER-003"
      ]
    },
    {
      "id": "SEQ-ORDER-003",
      "name": "Ship Order Flow",
      "description": "Flow for marking an order as shipped",
      "trigger": {
        "type": "system_event",
        "description": "Warehouse confirms shipment dispatch"
      },
      "participants": [
        {
          "name": "Warehouse System",
          "type": "actor"
        },
        {
          "name": "Order Service",
          "type": "service"
        },
        {
          "name": "Email Service",
          "type": "service"
        },
        {
          "name": "Order Aggregate",
          "type": "aggregate"
        }
      ],
      "steps": [
        {
          "step": 1,
          "actor": "Warehouse System",
          "action": "Submit shipment notification",
          "target": "Order Service",
          "data": [
            "orderId",
            "trackingNumber",
            "carrier"
          ]
        },
        {
          "step": 2,
          "actor": "Order Service",
          "action": "Validate order status is 'confirmed'",
          "target": "Order Aggregate",
          "returns": "Order details and status"
        },
        {
          "step": 3,
          "actor": "Order Service",
          "action": "Update order status to 'shipped'",
          "target": "Order Aggregate",
          "event": "OrderShipped"
        },
        {
          "step": 4,
          "actor": "Order Service",
          "action": "Send shipment notification email (async)",
          "target": "Email Service",
          "returns": "Email queued"
        },
        {
          "step": 5,
          "actor": "Order Service",
          "action": "Return shipment confirmation",
          "target": "Warehouse System",
          "returns": "Order shipped status"
        }
      ],
      "outcome": {
        "success": "Order marked as shipped, customer notified",
        "state_changes": [
          "Order.status = shipped",
          "Order.trackingNumber set"
        ]
      },
      "exceptions": [
        {
          "condition": "Order not in 'confirmed' status",
          "step": 2,
          "handling": "Return error INVALID_STATUS_TRANSITION, abort flow"
        },
        {
          "condition": "Email delivery fails",
          "step": 4,
          "handling": "Log error, continue flow (BR-EMAIL-001: non-blocking)"
        }
      ],
      "relatedACs": [],
      "relatedBRs": [
        "BR-ORDER-003",
        "BR-ORDER-004",
        "BR-EMAIL-001"
      ]
    },
    {
      "id": "SEQ-ORDER-004",
      "name": "Deliver Order Flow",
      "description": "Flow for marking an order as delivered",
      "trigger": {
        "type": "system_event",
        "description": "Carrier confirms delivery or customer confirms receipt"
      },
      "participants": [
        {
          "name": "Carrier System",
          "type": "actor"
        },
        {
          "name": "Order Service",
          "type": "service"
        },
        {
          "name": "Order Aggregate",
          "type": "aggregate"
        }
      ],
      "steps": [
        {
          "step": 1,
          "actor": "Carrier System",
          "action": "Submit delivery confirmation",
          "target": "Order Service",
          "data": [
            "orderId",
            "deliveryTimestamp",
            "signatureRequired"
          ]
        },
        {
          "step": 2,
          "actor": "Order Service",
          "action": "Validate order status is 'shipped'",
          "target": "Order Aggregate",
          "returns": "Order details and status"
        },
        {
          "step": 3,
          "actor": "Order Service",
          "action": "Update order status to 'delivered'",
          "target": "Order Aggregate",
          "event": "OrderDelivered"
        },
        {
          "step": 4,
          "actor": "Order Service",
          "action": "Return delivery confirmation",
          "target": "Carrier System",
          "returns": "Order delivered status"
        }
      ],
      "outcome": {
        "success": "Order marked as delivered, order lifecycle complete",
        "state_changes": [
          "Order.status = delivered"
        ]
      },
      "exceptions": [
        {
          "condition": "Order not in 'shipped' status",
          "step": 2,
          "handling": "Return error INVALID_STATUS_TRANSITION, abort flow"
        }
      ],
      "relatedACs": [],
      "relatedBRs": [
        "BR-ORDER-003",
        "BR-ORDER-004"
      ]
    },
    {
      "id": "SEQ-ORDER-005",
      "name": "Cancel Order Flow",
      "description": "Complete flow for cancelling an order with inventory restoration and refund",
      "trigger": {
        "type": "user_action",
        "description": "Customer clicks 'Cancel Order' button or admin initiates cancellation"
      },
      "participants": [
        {
          "name": "Customer",
          "type": "actor"
        },
        {
          "name": "Order Service",
          "type": "service"
        },
        {
          "name": "Inventory Service",
          "type": "service"
        },
        {
          "name": "Payment Service",
          "type": "service"
        },
        {
          "name": "Email Service",
          "type": "service"
        },
        {
          "name": "Order Aggregate",
          "type": "aggregate"
        },
        {
          "name": "Inventory Aggregate",
          "type": "aggregate"
        }
      ],
      "steps": [
        {
          "step": 1,
          "actor": "Customer",
          "action": "Submit cancellation request",
          "target": "Order Service",
          "data": [
            "orderId",
            "cancellationReason (optional)"
          ]
        },
        {
          "step": 2,
          "actor": "Order Service",
          "action": "Validate order status allows cancellation",
          "target": "Order Aggregate",
          "returns": "Order details and status"
        },
        {
          "step": 3,
          "actor": "Order Service",
          "action": "Release or restore inventory for each line item",
          "target": "Inventory Service",
          "event": "InventoryReleased"
        },
        {
          "step": 4,
          "actor": "Order Service",
          "action": "Initiate refund to original payment method",
          "target": "Payment Service",
          "returns": "Refund confirmation"
        },
        {
          "step": 5,
          "actor": "Order Service",
          "action": "Update order status to 'cancelled'",
          "target": "Order Aggregate",
          "event": "OrderCancelled"
        },
        {
          "step": 6,
          "actor": "Order Service",
          "action": "Send cancellation confirmation email (async)",
          "target": "Email Service",
          "returns": "Email queued"
        },
        {
          "step": 7,
          "actor": "Order Service",
          "action": "Return cancellation confirmation",
          "target": "Customer",
          "returns": "Cancellation details with refund info"
        }
      ],
      "outcome": {
        "success": "Order cancelled, inventory restored, refund initiated, customer notified",
        "state_changes": [
          "Order.status = cancelled",
          "Inventory.stockLevel += quantities (if deducted)",
          "Inventory.reservedQuantity -= quantities (if reserved)",
          "Payment refunded"
        ]
      },
      "exceptions": [
        {
          "condition": "Order already shipped or delivered",
          "step": 2,
          "handling": "Return error ORDER_ALREADY_SHIPPED, abort flow"
        },
        {
          "condition": "Order already cancelled",
          "step": 2,
          "handling": "Return error INVALID_STATUS_TRANSITION, abort flow"
        },
        {
          "condition": "Refund fails",
          "step": 4,
          "handling": "Log error REFUND_FAILED, mark for manual review, continue with cancellation"
        },
        {
          "condition": "Email delivery fails",
          "step": 6,
          "handling": "Log error, continue flow (BR-EMAIL-001: non-blocking)"
        }
      ],
      "relatedACs": [],
      "relatedBRs": [
        "BR-ORDER-002",
        "BR-ORDER-003",
        "BR-INV-003",
        "BR-PAY-003",
        "BR-EMAIL-001"
      ]
    },
    {
      "id": "SEQ-INV-001",
      "name": "Restock Inventory Flow",
      "description": "Flow for restocking product inventory with audit trail",
      "trigger": {
        "type": "system_event",
        "description": "Warehouse receives new stock or admin manually adjusts inventory"
      },
      "participants": [
        {
          "name": "Warehouse Admin",
          "type": "actor"
        },
        {
          "name": "Inventory Service",
          "type": "service"
        },
        {
          "name": "Inventory Aggregate",
          "type": "aggregate"
        },
        {
          "name": "Audit Service",
          "type": "service"
        }
      ],
      "steps": [
        {
          "step": 1,
          "actor": "Warehouse Admin",
          "action": "Submit restock request",
          "target": "Inventory Service",
          "data": [
            "productId",
            "quantity",
            "reason"
          ]
        },
        {
          "step": 2,
          "actor": "Inventory Service",
          "action": "Validate quantity is positive",
          "target": "Inventory Service",
          "returns": "Validation result"
        },
        {
          "step": 3,
          "actor": "Inventory Service",
          "action": "Get current inventory state",
          "target": "Inventory Aggregate",
          "returns": "Current stockLevel and reservedQuantity"
        },
        {
          "step": 4,
          "actor": "Inventory Service",
          "action": "Increase stock level",
          "target": "Inventory Aggregate",
          "event": "InventoryRestocked"
        },
        {
          "step": 5,
          "actor": "Inventory Service",
          "action": "Create audit log entry",
          "target": "Audit Service",
          "data": [
            "previousValue",
            "newValue",
            "reason",
            "userId",
            "timestamp"
          ]
        },
        {
          "step": 6,
          "actor": "Inventory Service",
          "action": "Return updated inventory",
          "target": "Warehouse Admin",
          "returns": "Updated inventory with new stockLevel"
        }
      ],
      "outcome": {
        "success": "Inventory restocked, audit trail created",
        "state_changes": [
          "Inventory.stockLevel += quantity",
          "Audit log entry created"
        ]
      },
      "exceptions": [
        {
          "condition": "Invalid quantity (zero or negative)",
          "step": 2,
          "handling": "Return error INVALID_QUANTITY, abort flow"
        },
        {
          "condition": "Product not found",
          "step": 3,
          "handling": "Return error PRODUCT_NOT_FOUND, abort flow"
        }
      ],
      "relatedACs": [],
      "relatedBRs": [
        "BR-INV-001",
        "BR-INV-004"
      ]
    },
    {
      "id": "SEQ-PROD-001",
      "name": "Create Product Flow",
      "description": "Flow for creating a new product in the catalog with inventory initialization",
      "trigger": {
        "type": "user_action",
        "description": "Admin submits new product creation form"
      },
      "participants": [
        {
          "name": "Admin",
          "type": "actor"
        },
        {
          "name": "Product Service",
          "type": "service"
        },
        {
          "name": "Category Service",
          "type": "service"
        },
        {
          "name": "Inventory Service",
          "type": "service"
        },
        {
          "name": "Product Aggregate",
          "type": "aggregate"
        },
        {
          "name": "Inventory Aggregate",
          "type": "aggregate"
        }
      ],
      "steps": [
        {
          "step": 1,
          "actor": "Admin",
          "action": "Submit product creation request",
          "target": "Product Service",
          "data": [
            "name",
            "description",
            "price",
            "categoryId",
            "initialStock"
          ]
        },
        {
          "step": 2,
          "actor": "Product Service",
          "action": "Validate product name length",
          "target": "Product Service",
          "returns": "Validation result"
        },
        {
          "step": 3,
          "actor": "Product Service",
          "action": "Validate price is positive",
          "target": "Product Service",
          "returns": "Validation result"
        },
        {
          "step": 4,
          "actor": "Product Service",
          "action": "Verify category exists",
          "target": "Category Service",
          "returns": "Category details"
        },
        {
          "step": 5,
          "actor": "Product Service",
          "action": "Create product with active status",
          "target": "Product Aggregate",
          "event": "ProductCreated"
        },
        {
          "step": 6,
          "actor": "Product Service",
          "action": "Initialize inventory record",
          "target": "Inventory Service",
          "returns": "Inventory created with initial stock"
        },
        {
          "step": 7,
          "actor": "Product Service",
          "action": "Return created product",
          "target": "Admin",
          "returns": "Product details with productId"
        }
      ],
      "outcome": {
        "success": "Product created with active status, inventory initialized",
        "state_changes": [
          "Product created with isActive=true",
          "Inventory.stockLevel = initialStock"
        ]
      },
      "exceptions": [
        {
          "condition": "Invalid product name",
          "step": 2,
          "handling": "Return error INVALID_NAME, abort flow"
        },
        {
          "condition": "Invalid price",
          "step": 3,
          "handling": "Return error INVALID_PRICE, abort flow"
        },
        {
          "condition": "Category not found",
          "step": 4,
          "handling": "Return error CATEGORY_NOT_FOUND, abort flow"
        }
      ],
      "relatedACs": [],
      "relatedBRs": [
        "BR-PROD-001",
        "BR-PROD-002"
      ]
    },
    {
      "id": "SEQ-PROD-002",
      "name": "Deactivate Product Flow",
      "description": "Flow for soft-deleting a product while preserving order history",
      "trigger": {
        "type": "user_action",
        "description": "Admin clicks 'Deactivate Product' button"
      },
      "participants": [
        {
          "name": "Admin",
          "type": "actor"
        },
        {
          "name": "Product Service",
          "type": "service"
        },
        {
          "name": "Order Service",
          "type": "service"
        },
        {
          "name": "Product Aggregate",
          "type": "aggregate"
        }
      ],
      "steps": [
        {
          "step": 1,
          "actor": "Admin",
          "action": "Submit deactivation request",
          "target": "Product Service",
          "data": [
            "productId"
          ]
        },
        {
          "step": 2,
          "actor": "Product Service",
          "action": "Validate product exists and is active",
          "target": "Product Aggregate",
          "returns": "Product details and status"
        },
        {
          "step": 3,
          "actor": "Product Service",
          "action": "Check for order history references",
          "target": "Order Service",
          "returns": "Boolean: has order references"
        },
        {
          "step": 4,
          "actor": "Product Service",
          "action": "Set product to inactive (soft delete)",
          "target": "Product Aggregate",
          "event": "ProductDeactivated"
        },
        {
          "step": 5,
          "actor": "Product Service",
          "action": "Return deactivation confirmation",
          "target": "Admin",
          "returns": "Product deactivated status"
        }
      ],
      "outcome": {
        "success": "Product deactivated, order history preserved, product no longer appears in catalog",
        "state_changes": [
          "Product.isActive = false"
        ]
      },
      "exceptions": [
        {
          "condition": "Product not found",
          "step": 2,
          "handling": "Return error PRODUCT_NOT_FOUND, abort flow"
        },
        {
          "condition": "Product already inactive",
          "step": 2,
          "handling": "Return success (idempotent operation)"
        }
      ],
      "relatedACs": [],
      "relatedBRs": [
        "BR-PROD-003"
      ]
    }
  ],
  "shared_types": [
    {
      "name": "Money",
      "fields": [
        {
          "name": "amount",
          "type": "decimal",
          "constraints": "\u003e= 0, precision 2"
        },
        {
          "name": "currency",
          "type": "string",
          "constraints": "ISO 4217, default USD"
        }
      ]
    },
    {
      "name": "Address",
      "fields": [
        {
          "name": "addressId",
          "type": "UUID",
          "constraints": "optional, for saved addresses"
        },
        {
          "name": "street",
          "type": "string",
          "constraints": "1-200 chars"
        },
        {
          "name": "city",
          "type": "string",
          "constraints": "1-100 chars"
        },
        {
          "name": "state",
          "type": "string",
          "constraints": "required"
        },
        {
          "name": "postalCode",
          "type": "string",
          "constraints": "valid format"
        },
        {
          "name": "country",
          "type": "string",
          "constraints": "ISO 3166-1"
        },
        {
          "name": "recipientName",
          "type": "string",
          "constraints": "required for shipping"
        }
      ]
    },
    {
      "name": "PaymentMethod",
      "fields": [
        {
          "name": "paymentMethodId",
          "type": "UUID",
          "constraints": "optional, for saved methods"
        },
        {
          "name": "type",
          "type": "PaymentType",
          "constraints": "required"
        },
        {
          "name": "lastFourDigits",
          "type": "string",
          "constraints": "4 digits, for credit card display"
        },
        {
          "name": "cardBrand",
          "type": "string",
          "constraints": "visa, mastercard, amex"
        },
        {
          "name": "paypalEmail",
          "type": "string",
          "constraints": "for PayPal identification"
        }
      ]
    },
    {
      "name": "Quantity",
      "fields": [
        {
          "name": "value",
          "type": "integer",
          "constraints": "\u003e 0"
        }
      ]
    },
    {
      "name": "Email",
      "fields": [
        {
          "name": "value",
          "type": "string",
          "constraints": "RFC 5322 valid email format"
        }
      ]
    },
    {
      "name": "SKU",
      "fields": [
        {
          "name": "value",
          "type": "string",
          "constraints": "alphanumeric, unique across all variants"
        }
      ]
    },
    {
      "name": "OrderStatus",
      "fields": [
        {
          "name": "value",
          "type": "enum",
          "constraints": "pending, confirmed, shipped, delivered, cancelled"
        }
      ]
    },
    {
      "name": "RegistrationStatus",
      "fields": [
        {
          "name": "value",
          "type": "enum",
          "constraints": "unverified, registered"
        }
      ]
    },
    {
      "name": "PaymentType",
      "fields": [
        {
          "name": "value",
          "type": "enum",
          "constraints": "credit_card, paypal"
        }
      ]
    },
    {
      "name": "ProductSummary",
      "fields": [
        {
          "name": "productId",
          "type": "UUID",
          "constraints": "required"
        },
        {
          "name": "name",
          "type": "string",
          "constraints": "required"
        },
        {
          "name": "price",
          "type": "Money",
          "constraints": "required"
        },
        {
          "name": "primaryImageUrl",
          "type": "string",
          "constraints": "optional"
        },
        {
          "name": "categoryName",
          "type": "string",
          "constraints": "required"
        },
        {
          "name": "isInStock",
          "type": "boolean",
          "constraints": "required"
        },
        {
          "name": "hasVariants",
          "type": "boolean",
          "constraints": "required"
        }
      ]
    },
    {
      "name": "ProductVariant",
      "fields": [
        {
          "name": "variantId",
          "type": "UUID",
          "constraints": "required"
        },
        {
          "name": "sku",
          "type": "SKU",
          "constraints": "required, unique"
        },
        {
          "name": "size",
          "type": "string",
          "constraints": "optional"
        },
        {
          "name": "color",
          "type": "string",
          "constraints": "optional"
        },
        {
          "name": "priceAdjustment",
          "type": "Money",
          "constraints": "optional, can be negative"
        },
        {
          "name": "availableQuantity",
          "type": "integer",
          "constraints": "\u003e= 0"
        }
      ]
    },
    {
      "name": "ProductImage",
      "fields": [
        {
          "name": "imageId",
          "type": "UUID",
          "constraints": "required"
        },
        {
          "name": "url",
          "type": "string",
          "constraints": "required, valid URL"
        },
        {
          "name": "isPrimary",
          "type": "boolean",
          "constraints": "required"
        },
        {
          "name": "displayOrder",
          "type": "integer",
          "constraints": "\u003e= 0"
        }
      ]
    },
    {
      "name": "CartItem",
      "fields": [
        {
          "name": "cartItemId",
          "type": "UUID",
          "constraints": "required"
        },
        {
          "name": "productId",
          "type": "UUID",
          "constraints": "required"
        },
        {
          "name": "variantId",
          "type": "UUID",
          "constraints": "optional"
        },
        {
          "name": "productName",
          "type": "string",
          "constraints": "required"
        },
        {
          "name": "unitPrice",
          "type": "Money",
          "constraints": "required"
        },
        {
          "name": "quantity",
          "type": "Quantity",
          "constraints": "required"
        },
        {
          "name": "subtotal",
          "type": "Money",
          "constraints": "calculated"
        },
        {
          "name": "isInStock",
          "type": "boolean",
          "constraints": "required"
        },
        {
          "name": "availableQuantity",
          "type": "integer",
          "constraints": "\u003e= 0"
        }
      ]
    },
    {
      "name": "OrderLineItem",
      "fields": [
        {
          "name": "lineItemId",
          "type": "UUID",
          "constraints": "required"
        },
        {
          "name": "productId",
          "type": "UUID",
          "constraints": "required"
        },
        {
          "name": "productName",
          "type": "string",
          "constraints": "required, snapshot"
        },
        {
          "name": "unitPrice",
          "type": "Money",
          "constraints": "required, snapshot"
        },
        {
          "name": "quantity",
          "type": "Quantity",
          "constraints": "required"
        },
        {
          "name": "subtotal",
          "type": "Money",
          "constraints": "calculated"
        }
      ]
    },
    {
      "name": "OrderSummary",
      "fields": [
        {
          "name": "orderId",
          "type": "UUID",
          "constraints": "required"
        },
        {
          "name": "orderNumber",
          "type": "string",
          "constraints": "required"
        },
        {
          "name": "status",
          "type": "OrderStatus",
          "constraints": "required"
        },
        {
          "name": "totalAmount",
          "type": "Money",
          "constraints": "required"
        },
        {
          "name": "itemCount",
          "type": "integer",
          "constraints": "required"
        },
        {
          "name": "createdAt",
          "type": "DateTime",
          "constraints": "required"
        }
      ]
    },
    {
      "name": "AdminOrderSummary",
      "fields": [
        {
          "name": "orderId",
          "type": "UUID",
          "constraints": "required"
        },
        {
          "name": "orderNumber",
          "type": "string",
          "constraints": "required"
        },
        {
          "name": "customerName",
          "type": "string",
          "constraints": "required"
        },
        {
          "name": "customerEmail",
          "type": "Email",
          "constraints": "required"
        },
        {
          "name": "status",
          "type": "OrderStatus",
          "constraints": "required"
        },
        {
          "name": "totalAmount",
          "type": "Money",
          "constraints": "required"
        },
        {
          "name": "createdAt",
          "type": "DateTime",
          "constraints": "required"
        }
      ]
    },
    {
      "name": "CategoryTree",
      "fields": [
        {
          "name": "categoryId",
          "type": "UUID",
          "constraints": "required"
        },
        {
          "name": "name",
          "type": "string",
          "constraints": "required"
        },
        {
          "name": "description",
          "type": "string",
          "constraints": "optional"
        },
        {
          "name": "depth",
          "type": "integer",
          "constraints": "0-2"
        },
        {
          "name": "children",
          "type": "List\u003cCategoryTree\u003e",
          "constraints": "optional"
        }
      ]
    },
    {
      "name": "PriceChange",
      "fields": [
        {
          "name": "cartItemId",
          "type": "UUID",
          "constraints": "required"
        },
        {
          "name": "productName",
          "type": "string",
          "constraints": "required"
        },
        {
          "name": "previousPrice",
          "type": "Money",
          "constraints": "required"
        },
        {
          "name": "currentPrice",
          "type": "Money",
          "constraints": "required"
        }
      ]
    },
    {
      "name": "QuantityLimitedItem",
      "fields": [
        {
          "name": "productId",
          "type": "UUID",
          "constraints": "required"
        },
        {
          "name": "productName",
          "type": "string",
          "constraints": "required"
        },
        {
          "name": "requestedQuantity",
          "type": "integer",
          "constraints": "required"
        },
        {
          "name": "limitedToQuantity",
          "type": "integer",
          "constraints": "required"
        }
      ]
    },
    {
      "name": "BulkUpdateError",
      "fields": [
        {
          "name": "rowNumber",
          "type": "integer",
          "constraints": "required"
        },
        {
          "name": "sku",
          "type": "string",
          "constraints": "required"
        },
        {
          "name": "errorCode",
          "type": "string",
          "constraints": "required"
        },
        {
          "name": "errorMessage",
          "type": "string",
          "constraints": "required"
        }
      ]
    },
    {
      "name": "InventoryAuditEntry",
      "fields": [
        {
          "name": "auditId",
          "type": "UUID",
          "constraints": "required"
        },
        {
          "name": "productId",
          "type": "UUID",
          "constraints": "required"
        },
        {
          "name": "previousValue",
          "type": "integer",
          "constraints": "required"
        },
        {
          "name": "newValue",
          "type": "integer",
          "constraints": "required"
        },
        {
          "name": "reason",
          "type": "string",
          "constraints": "required"
        },
        {
          "name": "userId",
          "type": "UUID",
          "constraints": "required"
        },
        {
          "name": "timestamp",
          "type": "DateTime",
          "constraints": "required"
        }
      ]
    },
    {
      "name": "DateRange",
      "fields": [
        {
          "name": "startDate",
          "type": "Date",
          "constraints": "required"
        },
        {
          "name": "endDate",
          "type": "Date",
          "constraints": "required"
        }
      ]
    }
  ],
  "tables": [
    {
      "id": "TBL-CUSTOMER-001",
      "name": "customers",
      "aggregate": "Customer",
      "purpose": "Stores registered customer information",
      "fields": [
        {
          "name": "id",
          "type": "UUID",
          "constraints": "NOT NULL",
          "default": "gen_random_uuid()"
        },
        {
          "name": "email",
          "type": "VARCHAR(255)",
          "constraints": "NOT NULL UNIQUE"
        },
        {
          "name": "registration_status",
          "type": "VARCHAR(20)",
          "constraints": "NOT NULL",
          "default": "'registered'"
        },
        {
          "name": "version",
          "type": "INTEGER",
          "constraints": "NOT NULL",
          "default": "1"
        },
        {
          "name": "created_at",
          "type": "TIMESTAMP",
          "constraints": "NOT NULL",
          "default": "NOW()"
        },
        {
          "name": "updated_at",
          "type": "TIMESTAMP",
          "constraints": "NOT NULL",
          "default": "NOW()"
        }
      ],
      "primaryKey": {
        "columns": [
          "id"
        ]
      },
      "indexes": [
        {
          "name": "idx_customers_email",
          "columns": [
            "email"
          ]
        }
      ],
      "foreignKeys": [],
      "checkConstraints": [
        {
          "name": "chk_customer_registration_status",
          "expression": "registration_status IN ('registered', 'unregistered')"
        }
      ]
    },
    {
      "id": "TBL-CART-001",
      "name": "carts",
      "aggregate": "Cart",
      "purpose": "Stores shopping cart header information",
      "fields": [
        {
          "name": "id",
          "type": "UUID",
          "constraints": "NOT NULL",
          "default": "gen_random_uuid()"
        },
        {
          "name": "customer_id",
          "type": "UUID",
          "constraints": "NOT NULL UNIQUE"
        },
        {
          "name": "total_price_amount",
          "type": "DECIMAL(10,2)",
          "constraints": "NOT NULL",
          "default": "0"
        },
        {
          "name": "total_price_currency",
          "type": "CHAR(3)",
          "constraints": "NOT NULL",
          "default": "'USD'"
        },
        {
          "name": "version",
          "type": "INTEGER",
          "constraints": "NOT NULL",
          "default": "1"
        },
        {
          "name": "created_at",
          "type": "TIMESTAMP",
          "constraints": "NOT NULL",
          "default": "NOW()"
        },
        {
          "name": "updated_at",
          "type": "TIMESTAMP",
          "constraints": "NOT NULL",
          "default": "NOW()"
        }
      ],
      "primaryKey": {
        "columns": [
          "id"
        ]
      },
      "indexes": [
        {
          "name": "idx_carts_customer",
          "columns": [
            "customer_id"
          ]
        }
      ],
      "foreignKeys": [
        {
          "columns": [
            "customer_id"
          ],
          "references": "customers(id)",
          "onDelete": "CASCADE"
        }
      ],
      "checkConstraints": [
        {
          "name": "chk_cart_total_price",
          "expression": "total_price_amount \u003e= 0"
        }
      ]
    },
    {
      "id": "TBL-CART-002",
      "name": "cart_items",
      "aggregate": "Cart",
      "purpose": "Stores items within shopping carts",
      "fields": [
        {
          "name": "id",
          "type": "UUID",
          "constraints": "NOT NULL",
          "default": "gen_random_uuid()"
        },
        {
          "name": "cart_id",
          "type": "UUID",
          "constraints": "NOT NULL"
        },
        {
          "name": "product_id",
          "type": "UUID",
          "constraints": "NOT NULL"
        },
        {
          "name": "product_name",
          "type": "VARCHAR(200)",
          "constraints": "NOT NULL"
        },
        {
          "name": "unit_price_amount",
          "type": "DECIMAL(10,2)",
          "constraints": "NOT NULL"
        },
        {
          "name": "unit_price_currency",
          "type": "CHAR(3)",
          "constraints": "NOT NULL",
          "default": "'USD'"
        },
        {
          "name": "quantity",
          "type": "INTEGER",
          "constraints": "NOT NULL"
        },
        {
          "name": "subtotal_amount",
          "type": "DECIMAL(10,2)",
          "constraints": "NOT NULL"
        },
        {
          "name": "subtotal_currency",
          "type": "CHAR(3)",
          "constraints": "NOT NULL",
          "default": "'USD'"
        },
        {
          "name": "created_at",
          "type": "TIMESTAMP",
          "constraints": "NOT NULL",
          "default": "NOW()"
        },
        {
          "name": "updated_at",
          "type": "TIMESTAMP",
          "constraints": "NOT NULL",
          "default": "NOW()"
        }
      ],
      "primaryKey": {
        "columns": [
          "id"
        ]
      },
      "indexes": [
        {
          "name": "idx_cart_items_cart",
          "columns": [
            "cart_id"
          ]
        },
        {
          "name": "idx_cart_items_cart_product",
          "columns": [
            "cart_id",
            "product_id"
          ]
        }
      ],
      "foreignKeys": [
        {
          "columns": [
            "cart_id"
          ],
          "references": "carts(id)",
          "onDelete": "CASCADE"
        },
        {
          "columns": [
            "product_id"
          ],
          "references": "products(id)",
          "onDelete": "RESTRICT"
        }
      ],
      "checkConstraints": [
        {
          "name": "chk_cart_item_quantity",
          "expression": "quantity \u003e 0"
        },
        {
          "name": "chk_cart_item_prices",
          "expression": "unit_price_amount \u003e= 0 AND subtotal_amount \u003e= 0"
        }
      ]
    },
    {
      "id": "TBL-ORDER-001",
      "name": "orders",
      "aggregate": "Order",
      "purpose": "Stores order header information with shipping and payment details",
      "fields": [
        {
          "name": "id",
          "type": "UUID",
          "constraints": "NOT NULL",
          "default": "gen_random_uuid()"
        },
        {
          "name": "customer_id",
          "type": "UUID",
          "constraints": "NOT NULL"
        },
        {
          "name": "status",
          "type": "VARCHAR(20)",
          "constraints": "NOT NULL",
          "default": "'pending'"
        },
        {
          "name": "shipping_street",
          "type": "VARCHAR(200)",
          "constraints": "NOT NULL"
        },
        {
          "name": "shipping_city",
          "type": "VARCHAR(100)",
          "constraints": "NOT NULL"
        },
        {
          "name": "shipping_state",
          "type": "VARCHAR(50)",
          "constraints": "NOT NULL"
        },
        {
          "name": "shipping_postal_code",
          "type": "VARCHAR(20)",
          "constraints": "NOT NULL"
        },
        {
          "name": "shipping_country",
          "type": "CHAR(2)",
          "constraints": "NOT NULL"
        },
        {
          "name": "payment_type",
          "type": "VARCHAR(20)",
          "constraints": "NOT NULL"
        },
        {
          "name": "payment_last_four_digits",
          "type": "CHAR(4)",
          "constraints": "NULL"
        },
        {
          "name": "payment_paypal_email",
          "type": "VARCHAR(255)",
          "constraints": "NULL"
        },
        {
          "name": "subtotal_amount",
          "type": "DECIMAL(10,2)",
          "constraints": "NOT NULL"
        },
        {
          "name": "subtotal_currency",
          "type": "CHAR(3)",
          "constraints": "NOT NULL",
          "default": "'USD'"
        },
        {
          "name": "shipping_cost_amount",
          "type": "DECIMAL(10,2)",
          "constraints": "NOT NULL"
        },
        {
          "name": "shipping_cost_currency",
          "type": "CHAR(3)",
          "constraints": "NOT NULL",
          "default": "'USD'"
        },
        {
          "name": "total_amount",
          "type": "DECIMAL(10,2)",
          "constraints": "NOT NULL"
        },
        {
          "name": "total_currency",
          "type": "CHAR(3)",
          "constraints": "NOT NULL",
          "default": "'USD'"
        },
        {
          "name": "version",
          "type": "INTEGER",
          "constraints": "NOT NULL",
          "default": "1"
        },
        {
          "name": "created_at",
          "type": "TIMESTAMP",
          "constraints": "NOT NULL",
          "default": "NOW()"
        },
        {
          "name": "updated_at",
          "type": "TIMESTAMP",
          "constraints": "NOT NULL",
          "default": "NOW()"
        }
      ],
      "primaryKey": {
        "columns": [
          "id"
        ]
      },
      "indexes": [
        {
          "name": "idx_orders_customer",
          "columns": [
            "customer_id"
          ]
        },
        {
          "name": "idx_orders_status",
          "columns": [
            "status"
          ]
        },
        {
          "name": "idx_orders_created",
          "columns": [
            "created_at"
          ]
        }
      ],
      "foreignKeys": [
        {
          "columns": [
            "customer_id"
          ],
          "references": "customers(id)",
          "onDelete": "RESTRICT"
        }
      ],
      "checkConstraints": [
        {
          "name": "chk_order_status",
          "expression": "status IN ('pending', 'confirmed', 'shipped', 'delivered', 'cancelled')"
        },
        {
          "name": "chk_order_amounts",
          "expression": "total_amount \u003e= 0 AND subtotal_amount \u003e= 0 AND shipping_cost_amount \u003e= 0"
        },
        {
          "name": "chk_order_payment_type",
          "expression": "payment_type IN ('credit_card', 'paypal')"
        }
      ]
    },
    {
      "id": "TBL-ORDER-002",
      "name": "order_line_items",
      "aggregate": "Order",
      "purpose": "Stores immutable order line items (snapshot at order time)",
      "fields": [
        {
          "name": "id",
          "type": "UUID",
          "constraints": "NOT NULL",
          "default": "gen_random_uuid()"
        },
        {
          "name": "order_id",
          "type": "UUID",
          "constraints": "NOT NULL"
        },
        {
          "name": "product_id",
          "type": "UUID",
          "constraints": "NOT NULL"
        },
        {
          "name": "product_name",
          "type": "VARCHAR(200)",
          "constraints": "NOT NULL"
        },
        {
          "name": "unit_price_amount",
          "type": "DECIMAL(10,2)",
          "constraints": "NOT NULL"
        },
        {
          "name": "unit_price_currency",
          "type": "CHAR(3)",
          "constraints": "NOT NULL",
          "default": "'USD'"
        },
        {
          "name": "quantity",
          "type": "INTEGER",
          "constraints": "NOT NULL"
        },
        {
          "name": "subtotal_amount",
          "type": "DECIMAL(10,2)",
          "constraints": "NOT NULL"
        },
        {
          "name": "subtotal_currency",
          "type": "CHAR(3)",
          "constraints": "NOT NULL",
          "default": "'USD'"
        },
        {
          "name": "created_at",
          "type": "TIMESTAMP",
          "constraints": "NOT NULL",
          "default": "NOW()"
        }
      ],
      "primaryKey": {
        "columns": [
          "id"
        ]
      },
      "indexes": [
        {
          "name": "idx_order_line_items_order",
          "columns": [
            "order_id"
          ]
        }
      ],
      "foreignKeys": [
        {
          "columns": [
            "order_id"
          ],
          "references": "orders(id)",
          "onDelete": "CASCADE"
        }
      ],
      "checkConstraints": [
        {
          "name": "chk_order_line_item_quantity",
          "expression": "quantity \u003e 0"
        },
        {
          "name": "chk_order_line_item_prices",
          "expression": "unit_price_amount \u003e= 0 AND subtotal_amount \u003e= 0"
        }
      ]
    },
    {
      "id": "TBL-PRODUCT-001",
      "name": "products",
      "aggregate": "Product",
      "purpose": "Stores product catalog information",
      "fields": [
        {
          "name": "id",
          "type": "UUID",
          "constraints": "NOT NULL",
          "default": "gen_random_uuid()"
        },
        {
          "name": "name",
          "type": "VARCHAR(200)",
          "constraints": "NOT NULL"
        },
        {
          "name": "description",
          "type": "VARCHAR(2000)",
          "constraints": "NULL"
        },
        {
          "name": "price_amount",
          "type": "DECIMAL(10,2)",
          "constraints": "NOT NULL"
        },
        {
          "name": "price_currency",
          "type": "CHAR(3)",
          "constraints": "NOT NULL",
          "default": "'USD'"
        },
        {
          "name": "category_id",
          "type": "UUID",
          "constraints": "NOT NULL"
        },
        {
          "name": "is_active",
          "type": "BOOLEAN",
          "constraints": "NOT NULL",
          "default": "true"
        },
        {
          "name": "version",
          "type": "INTEGER",
          "constraints": "NOT NULL",
          "default": "1"
        },
        {
          "name": "created_at",
          "type": "TIMESTAMP",
          "constraints": "NOT NULL",
          "default": "NOW()"
        },
        {
          "name": "updated_at",
          "type": "TIMESTAMP",
          "constraints": "NOT NULL",
          "default": "NOW()"
        }
      ],
      "primaryKey": {
        "columns": [
          "id"
        ]
      },
      "indexes": [
        {
          "name": "idx_products_category",
          "columns": [
            "category_id"
          ]
        },
        {
          "name": "idx_products_active",
          "columns": [
            "is_active"
          ]
        },
        {
          "name": "idx_products_name",
          "columns": [
            "name"
          ]
        }
      ],
      "foreignKeys": [
        {
          "columns": [
            "category_id"
          ],
          "references": "categories(id)",
          "onDelete": "RESTRICT"
        }
      ],
      "checkConstraints": [
        {
          "name": "chk_product_price",
          "expression": "price_amount \u003e 0"
        },
        {
          "name": "chk_product_name_length",
          "expression": "LENGTH(name) \u003e= 1 AND LENGTH(name) \u003c= 200"
        }
      ]
    },
    {
      "id": "TBL-PRODUCT-002",
      "name": "product_variants",
      "aggregate": "Product",
      "purpose": "Stores product variations (size, color combinations)",
      "fields": [
        {
          "name": "id",
          "type": "UUID",
          "constraints": "NOT NULL",
          "default": "gen_random_uuid()"
        },
        {
          "name": "product_id",
          "type": "UUID",
          "constraints": "NOT NULL"
        },
        {
          "name": "size",
          "type": "VARCHAR(50)",
          "constraints": "NULL"
        },
        {
          "name": "color",
          "type": "VARCHAR(50)",
          "constraints": "NULL"
        },
        {
          "name": "sku",
          "type": "VARCHAR(100)",
          "constraints": "NOT NULL UNIQUE"
        },
        {
          "name": "price_adjustment_amount",
          "type": "DECIMAL(10,2)",
          "constraints": "NULL"
        },
        {
          "name": "price_adjustment_currency",
          "type": "CHAR(3)",
          "constraints": "NULL"
        },
        {
          "name": "created_at",
          "type": "TIMESTAMP",
          "constraints": "NOT NULL",
          "default": "NOW()"
        },
        {
          "name": "updated_at",
          "type": "TIMESTAMP",
          "constraints": "NOT NULL",
          "default": "NOW()"
        }
      ],
      "primaryKey": {
        "columns": [
          "id"
        ]
      },
      "indexes": [
        {
          "name": "idx_product_variants_product",
          "columns": [
            "product_id"
          ]
        },
        {
          "name": "idx_product_variants_sku",
          "columns": [
            "sku"
          ]
        },
        {
          "name": "idx_product_variants_unique_combo",
          "columns": [
            "product_id",
            "size",
            "color"
          ]
        }
      ],
      "foreignKeys": [
        {
          "columns": [
            "product_id"
          ],
          "references": "products(id)",
          "onDelete": "CASCADE"
        }
      ],
      "checkConstraints": [
        {
          "name": "chk_variant_has_attribute",
          "expression": "size IS NOT NULL OR color IS NOT NULL"
        }
      ]
    },
    {
      "id": "TBL-CATEGORY-001",
      "name": "categories",
      "aggregate": "Category",
      "purpose": "Stores product category hierarchy",
      "fields": [
        {
          "name": "id",
          "type": "UUID",
          "constraints": "NOT NULL",
          "default": "gen_random_uuid()"
        },
        {
          "name": "name",
          "type": "VARCHAR(100)",
          "constraints": "NOT NULL UNIQUE"
        },
        {
          "name": "description",
          "type": "VARCHAR(500)",
          "constraints": "NULL"
        },
        {
          "name": "parent_category_id",
          "type": "UUID",
          "constraints": "NULL"
        },
        {
          "name": "version",
          "type": "INTEGER",
          "constraints": "NOT NULL",
          "default": "1"
        },
        {
          "name": "created_at",
          "type": "TIMESTAMP",
          "constraints": "NOT NULL",
          "default": "NOW()"
        },
        {
          "name": "updated_at",
          "type": "TIMESTAMP",
          "constraints": "NOT NULL",
          "default": "NOW()"
        }
      ],
      "primaryKey": {
        "columns": [
          "id"
        ]
      },
      "indexes": [
        {
          "name": "idx_categories_name",
          "columns": [
            "name"
          ]
        },
        {
          "name": "idx_categories_parent",
          "columns": [
            "parent_category_id"
          ]
        }
      ],
      "foreignKeys": [
        {
          "columns": [
            "parent_category_id"
          ],
          "references": "categories(id)",
          "onDelete": "SET NULL"
        }
      ],
      "checkConstraints": [
        {
          "name": "chk_category_not_self_parent",
          "expression": "parent_category_id IS NULL OR parent_category_id != id"
        },
        {
          "name": "chk_category_name_length",
          "expression": "LENGTH(name) \u003e= 1 AND LENGTH(name) \u003c= 100"
        }
      ]
    },
    {
      "id": "TBL-INVENTORY-001",
      "name": "inventory",
      "aggregate": "Inventory",
      "purpose": "Tracks stock levels and reservations for products",
      "fields": [
        {
          "name": "id",
          "type": "UUID",
          "constraints": "NOT NULL",
          "default": "gen_random_uuid()"
        },
        {
          "name": "product_id",
          "type": "UUID",
          "constraints": "NOT NULL UNIQUE"
        },
        {
          "name": "stock_level",
          "type": "INTEGER",
          "constraints": "NOT NULL",
          "default": "0"
        },
        {
          "name": "reserved_quantity",
          "type": "INTEGER",
          "constraints": "NOT NULL",
          "default": "0"
        },
        {
          "name": "version",
          "type": "INTEGER",
          "constraints": "NOT NULL",
          "default": "1"
        },
        {
          "name": "created_at",
          "type": "TIMESTAMP",
          "constraints": "NOT NULL",
          "default": "NOW()"
        },
        {
          "name": "updated_at",
          "type": "TIMESTAMP",
          "constraints": "NOT NULL",
          "default": "NOW()"
        }
      ],
      "primaryKey": {
        "columns": [
          "id"
        ]
      },
      "indexes": [
        {
          "name": "idx_inventory_product",
          "columns": [
            "product_id"
          ]
        },
        {
          "name": "idx_inventory_stock_level",
          "columns": [
            "stock_level"
          ]
        }
      ],
      "foreignKeys": [
        {
          "columns": [
            "product_id"
          ],
          "references": "products(id)",
          "onDelete": "CASCADE"
        }
      ],
      "checkConstraints": [
        {
          "name": "chk_inventory_stock_level",
          "expression": "stock_level \u003e= 0"
        },
        {
          "name": "chk_inventory_reserved_quantity",
          "expression": "reserved_quantity \u003e= 0"
        },
        {
          "name": "chk_inventory_reserved_not_exceed_stock",
          "expression": "reserved_quantity \u003c= stock_level"
        }
      ]
    }
  ],
  "tech_specs": [
    {
      "id": "TS-BR-CUST-001",
      "name": "Customer registration validation for orders",
      "br_ref": "BR-CUST-001",
      "rule": "Only registered and email-verified customers can place orders",
      "implementation": "Validate customer registrationStatus and emailVerified fields in order service before order creation",
      "validation_points": [
        "Place Order API",
        "Checkout flow"
      ],
      "data_requirements": [
        {
          "field": "registrationStatus",
          "type": "enum",
          "constraints": "must equal 'registered'",
          "source": "Customer entity"
        },
        {
          "field": "emailVerified",
          "type": "boolean",
          "constraints": "must be true",
          "source": "Customer entity"
        }
      ],
      "error_handling": [
        {
          "condition": "registrationStatus != 'registered' OR emailVerified == false",
          "error_code": "UNAUTHORIZED_ORDER",
          "message": "Only registered and email-verified customers can place orders",
          "http_status": 403
        }
      ],
      "related_acs": []
    },
    {
      "id": "TS-BR-CUST-002",
      "name": "Unique email constraint for customers",
      "br_ref": "BR-CUST-002",
      "rule": "Each customer account must have a unique email address",
      "implementation": "Database unique constraint on email column, application-level check during registration",
      "validation_points": [
        "Registration API",
        "Email update API"
      ],
      "data_requirements": [
        {
          "field": "email",
          "type": "string",
          "constraints": "unique, valid email format",
          "source": "Customer entity"
        }
      ],
      "error_handling": [
        {
          "condition": "email already exists in database",
          "error_code": "DUPLICATE_EMAIL",
          "message": "An account with this email address already exists",
          "http_status": 409
        }
      ],
      "related_acs": []
    },
    {
      "id": "TS-BR-CUST-003",
      "name": "Password strength validation",
      "br_ref": "BR-CUST-003",
      "rule": "Customer passwords must be at least 8 characters with at least one number",
      "implementation": "Regex validation: ^(?=.*[0-9]).{8,}$ applied during registration and password change",
      "validation_points": [
        "Registration API",
        "Password change API",
        "Password reset API"
      ],
      "data_requirements": [
        {
          "field": "password",
          "type": "string",
          "constraints": "length \u003e= 8, contains at least one digit [0-9]",
          "source": "Customer entity"
        }
      ],
      "error_handling": [
        {
          "condition": "password.length \u003c 8 OR !password.matches(/[0-9]/)",
          "error_code": "INVALID_PASSWORD",
          "message": "Password must be at least 8 characters and contain at least one number",
          "http_status": 400
        }
      ],
      "related_acs": []
    },
    {
      "id": "TS-BR-PROD-001",
      "name": "Product price validation",
      "br_ref": "BR-PROD-001",
      "rule": "Product prices must be positive with minimum $0.01",
      "implementation": "Validate price \u003e= 0.01 and has exactly 2 decimal places during product creation and update",
      "validation_points": [
        "Create Product API",
        "Update Product API",
        "Admin UI"
      ],
      "data_requirements": [
        {
          "field": "price",
          "type": "decimal(10,2)",
          "constraints": "\u003e= 0.01, exactly 2 decimal places",
          "source": "Product entity"
        }
      ],
      "error_handling": [
        {
          "condition": "price \u003c 0.01 OR decimal places != 2",
          "error_code": "INVALID_PRICE",
          "message": "Price must be at least $0.01 with exactly 2 decimal places",
          "http_status": 400
        }
      ],
      "related_acs": []
    },
    {
      "id": "TS-BR-PROD-002",
      "name": "Product name length validation",
      "br_ref": "BR-PROD-002",
      "rule": "Product names must be between 2 and 200 characters",
      "implementation": "String length validation on product name field during creation and update",
      "validation_points": [
        "Create Product API",
        "Update Product API",
        "Admin UI"
      ],
      "data_requirements": [
        {
          "field": "name",
          "type": "string",
          "constraints": "2 \u003c= length \u003c= 200",
          "source": "Product entity"
        }
      ],
      "error_handling": [
        {
          "condition": "name.length \u003c 2 OR name.length \u003e 200",
          "error_code": "INVALID_NAME",
          "message": "Product name must be between 2 and 200 characters",
          "http_status": 400
        }
      ],
      "related_acs": []
    },
    {
      "id": "TS-BR-PROD-003",
      "name": "Product soft delete with order references",
      "br_ref": "BR-PROD-003",
      "rule": "Products with order history must be soft-deleted, not permanently deleted",
      "implementation": "Check for OrderLineItem references before delete; if exists, set deletedAt timestamp instead of hard delete",
      "validation_points": [
        "Delete Product API"
      ],
      "data_requirements": [
        {
          "field": "deletedAt",
          "type": "timestamp",
          "constraints": "nullable, set on soft delete",
          "source": "Product entity"
        },
        {
          "field": "orderLineItems",
          "type": "relation",
          "constraints": "check for existence",
          "source": "OrderLineItem entity"
        }
      ],
      "error_handling": [],
      "related_acs": []
    },
    {
      "id": "TS-BR-PROD-004",
      "name": "Unique SKU for product variants",
      "br_ref": "BR-PROD-004",
      "rule": "Each product variant must have a unique SKU",
      "implementation": "Database unique constraint on sku column, application-level check during variant creation",
      "validation_points": [
        "Create Variant API",
        "Update Variant API"
      ],
      "data_requirements": [
        {
          "field": "sku",
          "type": "string",
          "constraints": "unique across all variants",
          "source": "ProductVariant entity"
        }
      ],
      "error_handling": [
        {
          "condition": "sku already exists in database",
          "error_code": "DUPLICATE_SKU",
          "message": "A variant with this SKU already exists",
          "http_status": 409
        }
      ],
      "related_acs": []
    },
    {
      "id": "TS-BR-CART-001",
      "name": "Stock availability check for cart",
      "br_ref": "BR-CART-001",
      "rule": "Products must be in stock to be added to cart",
      "implementation": "Query Inventory.availableQuantity for product before adding to cart",
      "validation_points": [
        "Add to Cart API",
        "Cart UI"
      ],
      "data_requirements": [
        {
          "field": "availableQuantity",
          "type": "integer",
          "constraints": "\u003e 0",
          "source": "Inventory entity"
        },
        {
          "field": "productId",
          "type": "uuid",
          "constraints": "must reference valid product",
          "source": "CartItem entity"
        }
      ],
      "error_handling": [
        {
          "condition": "availableQuantity \u003c= 0",
          "error_code": "OUT_OF_STOCK",
          "message": "This product is currently out of stock",
          "http_status": 400
        }
      ],
      "related_acs": []
    },
    {
      "id": "TS-BR-CART-002",
      "name": "Cart quantity limited by stock",
      "br_ref": "BR-CART-002",
      "rule": "Cart item quantity cannot exceed available stock",
      "implementation": "Compare requested quantity against Inventory.availableQuantity; cap or reject if exceeded",
      "validation_points": [
        "Add to Cart API",
        "Update Cart Quantity API"
      ],
      "data_requirements": [
        {
          "field": "quantity",
          "type": "integer",
          "constraints": "\u003c= availableQuantity",
          "source": "CartItem entity"
        },
        {
          "field": "availableQuantity",
          "type": "integer",
          "constraints": "from Inventory",
          "source": "Inventory entity"
        }
      ],
      "error_handling": [
        {
          "condition": "quantity \u003e availableQuantity",
          "error_code": "QUANTITY_LIMITED",
          "message": "Requested quantity exceeds available stock. Maximum available: {availableQuantity}",
          "http_status": 400
        }
      ],
      "related_acs": []
    },
    {
      "id": "TS-BR-CART-003",
      "name": "Positive cart quantity validation",
      "br_ref": "BR-CART-003",
      "rule": "Cart item quantities must be at least 1",
      "implementation": "Validate quantity \u003e= 1; if quantity set to 0, remove item from cart",
      "validation_points": [
        "Add to Cart API",
        "Update Cart Quantity API"
      ],
      "data_requirements": [
        {
          "field": "quantity",
          "type": "integer",
          "constraints": "\u003e= 1 (0 triggers removal)",
          "source": "CartItem entity"
        }
      ],
      "error_handling": [],
      "related_acs": []
    },
    {
      "id": "TS-BR-CART-004",
      "name": "Cart expiration handling",
      "br_ref": "BR-CART-004",
      "rule": "Inactive carts expire after 30 days (logged-in) or 7 days (guest)",
      "implementation": "Background job or lazy evaluation on cart access checks lastActivityDate against threshold",
      "validation_points": [
        "Cart access API",
        "Background cleanup job"
      ],
      "data_requirements": [
        {
          "field": "lastActivityDate",
          "type": "timestamp",
          "constraints": "updated on cart interaction",
          "source": "Cart entity"
        },
        {
          "field": "isGuest",
          "type": "boolean",
          "constraints": "determines expiration threshold",
          "source": "Cart entity"
        }
      ],
      "error_handling": [
        {
          "condition": "cart expired based on lastActivityDate",
          "error_code": "CART_EXPIRED",
          "message": "Your cart has expired due to inactivity",
          "http_status": 410
        }
      ],
      "related_acs": []
    },
    {
      "id": "TS-BR-CART-005",
      "name": "Variant selection requirement",
      "br_ref": "BR-CART-005",
      "rule": "For products with variants, a specific variant must be selected before adding to cart",
      "implementation": "Check if product has variants; if so, require variantId in add-to-cart request",
      "validation_points": [
        "Add to Cart API",
        "Product UI"
      ],
      "data_requirements": [
        {
          "field": "variantId",
          "type": "uuid",
          "constraints": "required if product has variants",
          "source": "CartItem entity"
        },
        {
          "field": "hasVariants",
          "type": "boolean",
          "constraints": "derived from Product.variants.length \u003e 0",
          "source": "Product entity"
        }
      ],
      "error_handling": [
        {
          "condition": "product has variants AND variantId not provided",
          "error_code": "VARIANT_REQUIRED",
          "message": "Please select a specific variant before adding to cart",
          "http_status": 400
        }
      ],
      "related_acs": []
    },
    {
      "id": "TS-BR-ORDER-001",
      "name": "Free shipping threshold calculation",
      "br_ref": "BR-ORDER-001",
      "rule": "Orders over $50 qualify for free shipping",
      "implementation": "Calculate shipping cost as $0.00 when order subtotal exceeds $50.00",
      "validation_points": [
        "Checkout flow",
        "Order creation"
      ],
      "data_requirements": [
        {
          "field": "subtotal",
          "type": "decimal(10,2)",
          "constraints": "sum of line item totals",
          "source": "Order entity"
        },
        {
          "field": "shippingCost",
          "type": "decimal(10,2)",
          "constraints": "$0.00 if subtotal \u003e $50.00",
          "source": "Order entity"
        }
      ],
      "error_handling": [],
      "related_acs": []
    },
    {
      "id": "TS-BR-ORDER-002",
      "name": "Order cancellation status check",
      "br_ref": "BR-ORDER-002",
      "rule": "Orders can only be cancelled before shipping",
      "implementation": "Check order status is 'pending' or 'confirmed' before allowing cancellation",
      "validation_points": [
        "Cancel Order API"
      ],
      "data_requirements": [
        {
          "field": "status",
          "type": "enum",
          "constraints": "must be 'pending' or 'confirmed' for cancellation",
          "source": "Order entity"
        }
      ],
      "error_handling": [
        {
          "condition": "status NOT IN ('pending', 'confirmed')",
          "error_code": "ORDER_ALREADY_SHIPPED",
          "message": "Cannot cancel order that has already been shipped",
          "http_status": 400
        }
      ],
      "related_acs": []
    },
    {
      "id": "TS-BR-ORDER-003",
      "name": "Order status state machine",
      "br_ref": "BR-ORDER-003",
      "rule": "Order status can only transition through valid states",
      "implementation": "Implement state machine validating transitions: pending→confirmed→shipped→delivered, pending/confirmed→cancelled",
      "validation_points": [
        "Update Order Status API"
      ],
      "data_requirements": [
        {
          "field": "status",
          "type": "enum",
          "constraints": "pending|confirmed|shipped|delivered|cancelled",
          "source": "Order entity"
        },
        {
          "field": "previousStatus",
          "type": "enum",
          "constraints": "current status before transition",
          "source": "Order entity"
        }
      ],
      "error_handling": [
        {
          "condition": "invalid status transition attempted",
          "error_code": "INVALID_STATUS_TRANSITION",
          "message": "Cannot transition order from {currentStatus} to {requestedStatus}",
          "http_status": 400
        }
      ],
      "related_acs": []
    },
    {
      "id": "TS-BR-ORDER-004",
      "name": "Order immutability after shipping",
      "br_ref": "BR-ORDER-004",
      "rule": "Orders cannot be modified after shipping",
      "implementation": "Check order status before any modification; reject if shipped, delivered, or cancelled",
      "validation_points": [
        "Update Order API",
        "All order modification endpoints"
      ],
      "data_requirements": [
        {
          "field": "status",
          "type": "enum",
          "constraints": "must NOT be 'shipped', 'delivered', or 'cancelled'",
          "source": "Order entity"
        }
      ],
      "error_handling": [
        {
          "condition": "status IN ('shipped', 'delivered', 'cancelled')",
          "error_code": "ORDER_NOT_MODIFIABLE",
          "message": "Order cannot be modified in its current status",
          "http_status": 400
        }
      ],
      "related_acs": []
    },
    {
      "id": "TS-BR-ORDER-005",
      "name": "Minimum line item validation",
      "br_ref": "BR-ORDER-005",
      "rule": "Orders must contain at least one line item",
      "implementation": "Validate lineItems array has at least one element during order creation",
      "validation_points": [
        "Place Order API"
      ],
      "data_requirements": [
        {
          "field": "lineItems",
          "type": "array",
          "constraints": "length \u003e= 1",
          "source": "Order entity"
        }
      ],
      "error_handling": [
        {
          "condition": "lineItems.length == 0",
          "error_code": "EMPTY_ORDER",
          "message": "Order must contain at least one item",
          "http_status": 400
        }
      ],
      "related_acs": []
    },
    {
      "id": "TS-BR-ORDER-006",
      "name": "Price snapshot at order time",
      "br_ref": "BR-ORDER-006",
      "rule": "Order line items must capture the price at order placement, not current price",
      "implementation": "Copy Product.price to OrderLineItem.unitPrice during order creation; field is immutable after",
      "validation_points": [
        "Place Order API"
      ],
      "data_requirements": [
        {
          "field": "unitPrice",
          "type": "decimal(10,2)",
          "constraints": "copied from Product.price at order time, immutable",
          "source": "OrderLineItem entity"
        }
      ],
      "error_handling": [],
      "related_acs": []
    },
    {
      "id": "TS-BR-INV-001",
      "name": "Non-negative inventory validation",
      "br_ref": "BR-INV-001",
      "rule": "Inventory stock level cannot go below zero",
      "implementation": "Validate stockLevel \u003e= 0 during all stock adjustments; use database constraint",
      "validation_points": [
        "Manage Inventory API",
        "Order fulfillment",
        "Stock adjustment"
      ],
      "data_requirements": [
        {
          "field": "stockLevel",
          "type": "integer",
          "constraints": "\u003e= 0",
          "source": "Inventory entity"
        }
      ],
      "error_handling": [
        {
          "condition": "adjustment would result in stockLevel \u003c 0",
          "error_code": "INSUFFICIENT_STOCK",
          "message": "Insufficient stock for this operation",
          "http_status": 400
        }
      ],
      "related_acs": []
    },
    {
      "id": "TS-BR-INV-002",
      "name": "No backorder validation at checkout",
      "br_ref": "BR-INV-002",
      "rule": "Products cannot be sold when out of stock (no backorders)",
      "implementation": "Validate availableQuantity \u003e= requested quantity for all line items at checkout",
      "validation_points": [
        "Place Order API",
        "Checkout validation"
      ],
      "data_requirements": [
        {
          "field": "availableQuantity",
          "type": "integer",
          "constraints": "\u003e= requested quantity",
          "source": "Inventory entity"
        },
        {
          "field": "quantity",
          "type": "integer",
          "constraints": "requested order quantity",
          "source": "OrderLineItem entity"
        }
      ],
      "error_handling": [
        {
          "condition": "availableQuantity \u003c requested quantity",
          "error_code": "STOCK_UNAVAILABLE",
          "message": "Insufficient stock for {productName}. Available: {availableQuantity}",
          "http_status": 400
        }
      ],
      "related_acs": []
    },
    {
      "id": "TS-BR-INV-003",
      "name": "Inventory restoration on cancellation",
      "br_ref": "BR-INV-003",
      "rule": "Cancelled orders must restore inventory automatically",
      "implementation": "On order cancellation, iterate line items and restore stockLevel by each item's quantity",
      "validation_points": [
        "Cancel Order API"
      ],
      "data_requirements": [
        {
          "field": "stockLevel",
          "type": "integer",
          "constraints": "incremented by cancelled quantity",
          "source": "Inventory entity"
        },
        {
          "field": "quantity",
          "type": "integer",
          "constraints": "from each OrderLineItem",
          "source": "OrderLineItem entity"
        }
      ],
      "error_handling": [],
      "related_acs": []
    },
    {
      "id": "TS-BR-INV-004",
      "name": "Inventory audit trail logging",
      "br_ref": "BR-INV-004",
      "rule": "All inventory changes must be logged with before/after values and reason",
      "implementation": "Create InventoryAuditLog entry for every inventory modification with previousValue, newValue, reason, userId, timestamp",
      "validation_points": [
        "All inventory modification operations"
      ],
      "data_requirements": [
        {
          "field": "previousValue",
          "type": "integer",
          "constraints": "stock level before change",
          "source": "InventoryAuditLog entity"
        },
        {
          "field": "newValue",
          "type": "integer",
          "constraints": "stock level after change",
          "source": "InventoryAuditLog entity"
        },
        {
          "field": "reason",
          "type": "string",
          "constraints": "description of change reason",
          "source": "InventoryAuditLog entity"
        },
        {
          "field": "userId",
          "type": "uuid",
          "constraints": "user who made change",
          "source": "InventoryAuditLog entity"
        },
        {
          "field": "timestamp",
          "type": "timestamp",
          "constraints": "time of change",
          "source": "InventoryAuditLog entity"
        }
      ],
      "error_handling": [],
      "related_acs": []
    },
    {
      "id": "TS-BR-PAY-001",
      "name": "Payment authorization before order creation",
      "br_ref": "BR-PAY-001",
      "rule": "Payment must be authorized before order is created",
      "implementation": "Call payment gateway authorization API; only create order if authorization succeeds",
      "validation_points": [
        "Place Order API",
        "Checkout flow"
      ],
      "data_requirements": [
        {
          "field": "authorizationId",
          "type": "string",
          "constraints": "returned from payment gateway on success",
          "source": "Payment entity"
        },
        {
          "field": "paymentStatus",
          "type": "enum",
          "constraints": "must be 'authorized'",
          "source": "Payment entity"
        }
      ],
      "error_handling": [
        {
          "condition": "payment authorization fails",
          "error_code": "PAYMENT_FAILED",
          "message": "Payment authorization failed. Please check your payment details and try again",
          "http_status": 402
        }
      ],
      "related_acs": []
    },
    {
      "id": "TS-BR-PAY-002",
      "name": "Supported credit card type validation",
      "br_ref": "BR-PAY-002",
      "rule": "Only Visa, Mastercard, and American Express credit cards are accepted",
      "implementation": "Validate card type from BIN/IIN or explicit type field against allowed list",
      "validation_points": [
        "Payment processing API",
        "Add Payment Method API"
      ],
      "data_requirements": [
        {
          "field": "cardType",
          "type": "enum",
          "constraints": "visa|mastercard|amex",
          "source": "PaymentMethod entity"
        }
      ],
      "error_handling": [
        {
          "condition": "cardType NOT IN ('visa', 'mastercard', 'amex')",
          "error_code": "UNSUPPORTED_CARD_TYPE",
          "message": "Only Visa, Mastercard, and American Express cards are accepted",
          "http_status": 400
        }
      ],
      "related_acs": []
    },
    {
      "id": "TS-BR-PAY-003",
      "name": "Automatic refund on order cancellation",
      "br_ref": "BR-PAY-003",
      "rule": "Cancelled orders must be refunded to the original payment method",
      "implementation": "On order cancellation, initiate refund via payment gateway to original payment method",
      "validation_points": [
        "Cancel Order API"
      ],
      "data_requirements": [
        {
          "field": "paymentMethodId",
          "type": "uuid",
          "constraints": "original payment method used",
          "source": "Order entity"
        },
        {
          "field": "refundAmount",
          "type": "decimal(10,2)",
          "constraints": "order total amount",
          "source": "Order entity"
        }
      ],
      "error_handling": [
        {
          "condition": "refund API call fails",
          "error_code": "REFUND_FAILED",
          "message": "Unable to process refund. Please contact customer support",
          "http_status": 500
        }
      ],
      "related_acs": []
    },
    {
      "id": "TS-BR-SHIP-001",
      "name": "Domestic shipping validation",
      "br_ref": "BR-SHIP-001",
      "rule": "Shipping is only available within the domestic country",
      "implementation": "Validate ShippingAddress.country against configured domestic country code",
      "validation_points": [
        "Checkout flow",
        "Add Shipping Address API"
      ],
      "data_requirements": [
        {
          "field": "country",
          "type": "string",
          "constraints": "must match configured domestic country code",
          "source": "ShippingAddress entity"
        }
      ],
      "error_handling": [
        {
          "condition": "country != domesticCountryCode",
          "error_code": "UNSUPPORTED_SHIPPING_REGION",
          "message": "We currently only ship within {domesticCountry}",
          "http_status": 400
        }
      ],
      "related_acs": []
    },
    {
      "id": "TS-BR-SHIP-002",
      "name": "Required shipping address fields validation",
      "br_ref": "BR-SHIP-002",
      "rule": "Shipping addresses must include all required fields",
      "implementation": "Validate all required fields are present and non-empty",
      "validation_points": [
        "Checkout flow",
        "Add Shipping Address API",
        "Update Address API"
      ],
      "data_requirements": [
        {
          "field": "street",
          "type": "string",
          "constraints": "required, non-empty",
          "source": "ShippingAddress entity"
        },
        {
          "field": "city",
          "type": "string",
          "constraints": "required, non-empty",
          "source": "ShippingAddress entity"
        },
        {
          "field": "state",
          "type": "string",
          "constraints": "required, non-empty",
          "source": "ShippingAddress entity"
        },
        {
          "field": "postalCode",
          "type": "string",
          "constraints": "required, non-empty",
          "source": "ShippingAddress entity"
        },
        {
          "field": "country",
          "type": "string",
          "constraints": "required, non-empty",
          "source": "ShippingAddress entity"
        },
        {
          "field": "recipientName",
          "type": "string",
          "constraints": "required, non-empty",
          "source": "ShippingAddress entity"
        }
      ],
      "error_handling": [
        {
          "condition": "any required field is missing or empty",
          "error_code": "INVALID_ADDRESS",
          "message": "Please provide all required address fields",
          "http_status": 400
        }
      ],
      "related_acs": []
    },
    {
      "id": "TS-BR-CAT-001",
      "name": "Category nesting depth limit",
      "br_ref": "BR-CAT-001",
      "rule": "Category hierarchy is limited to 3 levels deep",
      "implementation": "Calculate depth when creating category with parent; reject if depth \u003e 3",
      "validation_points": [
        "Create Category API",
        "Update Category Parent API"
      ],
      "data_requirements": [
        {
          "field": "parentId",
          "type": "uuid",
          "constraints": "nullable, references parent category",
          "source": "Category entity"
        },
        {
          "field": "depth",
          "type": "integer",
          "constraints": "\u003c= 3",
          "source": "Category entity"
        }
      ],
      "error_handling": [
        {
          "condition": "calculated depth \u003e 3",
          "error_code": "MAX_NESTING_EXCEEDED",
          "message": "Category hierarchy cannot exceed 3 levels",
          "http_status": 400
        }
      ],
      "related_acs": []
    },
    {
      "id": "TS-BR-EMAIL-001",
      "name": "Non-blocking email delivery",
      "br_ref": "BR-EMAIL-001",
      "rule": "Email delivery failures must not block order completion",
      "implementation": "Send confirmation emails asynchronously via message queue with retry mechanism",
      "validation_points": [
        "Place Order API (post-commit)"
      ],
      "data_requirements": [
        {
          "field": "orderId",
          "type": "uuid",
          "constraints": "reference to created order",
          "source": "EmailQueue entity"
        },
        {
          "field": "emailType",
          "type": "enum",
          "constraints": "order_confirmation",
          "source": "EmailQueue entity"
        },
        {
          "field": "retryCount",
          "type": "integer",
          "constraints": "tracks retry attempts",
          "source": "EmailQueue entity"
        }
      ],
      "error_handling": [],
      "related_acs": []
    },
    {
      "id": "TS-BR-EMAIL-002",
      "name": "Email idempotency check",
      "br_ref": "BR-EMAIL-002",
      "rule": "Duplicate email sends must be prevented",
      "implementation": "Check for existing sent email record by orderId before sending; skip if already sent",
      "validation_points": [
        "Email sending service"
      ],
      "data_requirements": [
        {
          "field": "orderId",
          "type": "uuid",
          "constraints": "unique per confirmation email",
          "source": "SentEmailLog entity"
        },
        {
          "field": "sentAt",
          "type": "timestamp",
          "constraints": "records when email was sent",
          "source": "SentEmailLog entity"
        }
      ],
      "error_handling": [],
      "related_acs": []
    }
  ],
  "test_cases": [
    {
      "id": "TC-AC-CUST-001-P01",
      "name": "Valid registration with all required fields",
      "category": "positive",
      "ac_ref": "AC-CUST-001",
      "br_refs": [
        "AMB-ENT-024",
        "AMB-ENT-025"
      ],
      "preconditions": [
        "Email not registered in system"
      ],
      "test_data": [
        {
          "field": "email",
          "value": "john@example.com",
          "notes": "Valid email"
        },
        {
          "field": "password",
          "value": "SecurePass1",
          "notes": "Valid password"
        },
        {
          "field": "firstName",
          "value": "John",
          "notes": "Valid name"
        },
        {
          "field": "lastName",
          "value": "Doe",
          "notes": "Valid name"
        }
      ],
      "steps": [
        "Submit registration form with all fields"
      ],
      "expected_results": [
        "Account created with status 'unverified'",
        "Verification email sent"
      ]
    },
    {
      "id": "TC-AC-CUST-001-P02",
      "name": "Valid registration with complex password",
      "category": "positive",
      "ac_ref": "AC-CUST-001",
      "br_refs": [
        "AMB-ENT-024",
        "AMB-ENT-026"
      ],
      "preconditions": [
        "Email not registered in system"
      ],
      "test_data": [
        {
          "field": "email",
          "value": "jane@example.com",
          "notes": "Valid email"
        },
        {
          "field": "password",
          "value": "C0mpl3x!Pass99",
          "notes": "Strong password"
        },
        {
          "field": "firstName",
          "value": "Jane",
          "notes": "Valid name"
        },
        {
          "field": "lastName",
          "value": "Smith",
          "notes": "Valid name"
        }
      ],
      "steps": [
        "Submit registration form with complex password"
      ],
      "expected_results": [
        "Account created with status 'unverified'",
        "Verification email sent"
      ]
    },
    {
      "id": "TC-AC-CUST-001-N01",
      "name": "Reject duplicate email registration",
      "category": "negative",
      "ac_ref": "AC-CUST-001",
      "br_refs": [
        "AMB-ENT-024"
      ],
      "preconditions": [
        "Email john@example.com already registered"
      ],
      "test_data": [
        {
          "field": "email",
          "value": "john@example.com",
          "notes": "Existing email"
        }
      ],
      "steps": [
        "Submit registration with existing email"
      ],
      "expected_results": [
        "DUPLICATE_EMAIL error",
        "Suggest login or password reset"
      ]
    },
    {
      "id": "TC-AC-CUST-001-N02",
      "name": "Reject password under 8 characters",
      "category": "negative",
      "ac_ref": "AC-CUST-001",
      "br_refs": [
        "AMB-ENT-025"
      ],
      "preconditions": [
        "Email not registered"
      ],
      "test_data": [
        {
          "field": "password",
          "value": "Pass1",
          "notes": "Only 5 characters"
        }
      ],
      "steps": [
        "Submit registration with short password"
      ],
      "expected_results": [
        "INVALID_PASSWORD error",
        "Requirements message shown"
      ]
    },
    {
      "id": "TC-AC-CUST-001-N03",
      "name": "Reject password without number",
      "category": "negative",
      "ac_ref": "AC-CUST-001",
      "br_refs": [
        "AMB-ENT-025"
      ],
      "preconditions": [
        "Email not registered"
      ],
      "test_data": [
        {
          "field": "password",
          "value": "SecurePass",
          "notes": "No numbers"
        }
      ],
      "steps": [
        "Submit registration with password lacking number"
      ],
      "expected_results": [
        "INVALID_PASSWORD error",
        "Requirements message shown"
      ]
    },
    {
      "id": "TC-AC-CUST-001-N04",
      "name": "Reject invalid email format",
      "category": "negative",
      "ac_ref": "AC-CUST-001",
      "br_refs": [
        "AMB-ENT-024"
      ],
      "preconditions": [
        "User on registration page"
      ],
      "test_data": [
        {
          "field": "email",
          "value": "invalid-email",
          "notes": "Missing @ and domain"
        }
      ],
      "steps": [
        "Submit registration with invalid email"
      ],
      "expected_results": [
        "INVALID_EMAIL error"
      ]
    },
    {
      "id": "TC-AC-CUST-001-B01",
      "name": "Password at minimum length (8 chars)",
      "category": "boundary",
      "ac_ref": "AC-CUST-001",
      "br_refs": [
        "AMB-ENT-025"
      ],
      "preconditions": [
        "Email not registered"
      ],
      "test_data": [
        {
          "field": "password",
          "value": "Secure1!",
          "notes": "Exactly 8 characters"
        }
      ],
      "steps": [
        "Submit registration with 8-character password"
      ],
      "expected_results": [
        "Registration succeeds"
      ]
    },
    {
      "id": "TC-AC-CUST-001-B02",
      "name": "Password at 7 chars rejected",
      "category": "boundary",
      "ac_ref": "AC-CUST-001",
      "br_refs": [
        "AMB-ENT-025"
      ],
      "preconditions": [
        "Email not registered"
      ],
      "test_data": [
        {
          "field": "password",
          "value": "Secur1!",
          "notes": "Only 7 characters"
        }
      ],
      "steps": [
        "Submit registration with 7-character password"
      ],
      "expected_results": [
        "INVALID_PASSWORD error"
      ]
    },
    {
      "id": "TC-AC-CUST-001-H01",
      "name": "Phone should NOT be required",
      "category": "hallucination",
      "ac_ref": "AC-CUST-001",
      "br_refs": [],
      "preconditions": [
        "Email not registered"
      ],
      "test_data": [
        {
          "field": "phone",
          "value": "",
          "notes": "Empty - not in AC"
        }
      ],
      "steps": [
        "Submit registration without phone number"
      ],
      "expected_results": [
        "Registration succeeds"
      ],
      "should_not": "Require phone number (not specified in AC)"
    },
    {
      "id": "TC-AC-CUST-001-H02",
      "name": "Account should NOT be auto-verified",
      "category": "hallucination",
      "ac_ref": "AC-CUST-001",
      "br_refs": [
        "AMB-ENT-030"
      ],
      "preconditions": [
        "Valid registration data"
      ],
      "test_data": [],
      "steps": [
        "Complete registration",
        "Check account status"
      ],
      "expected_results": [
        "Account status is 'unverified'"
      ],
      "should_not": "Set account to 'verified' without email verification"
    },
    {
      "id": "TC-AC-CUST-002-P01",
      "name": "Verified customer can place order",
      "category": "positive",
      "ac_ref": "AC-CUST-002",
      "br_refs": [
        "AMB-ENT-030"
      ],
      "preconditions": [
        "Customer email is verified",
        "Cart has items"
      ],
      "test_data": [],
      "steps": [
        "Attempt to place order"
      ],
      "expected_results": [
        "Order placement proceeds"
      ]
    },
    {
      "id": "TC-AC-CUST-002-P02",
      "name": "Prompt to verify shown for unverified customer",
      "category": "positive",
      "ac_ref": "AC-CUST-002",
      "br_refs": [
        "AMB-ENT-030"
      ],
      "preconditions": [
        "Customer email is unverified"
      ],
      "test_data": [],
      "steps": [
        "Attempt to place order"
      ],
      "expected_results": [
        "EMAIL_NOT_VERIFIED error",
        "Prompt to verify email shown"
      ]
    },
    {
      "id": "TC-AC-CUST-002-N01",
      "name": "Unverified customer order rejected",
      "category": "negative",
      "ac_ref": "AC-CUST-002",
      "br_refs": [
        "AMB-ENT-030"
      ],
      "preconditions": [
        "Customer email is unverified",
        "Cart has items"
      ],
      "test_data": [],
      "steps": [
        "Attempt to place order"
      ],
      "expected_results": [
        "Order rejected",
        "EMAIL_NOT_VERIFIED error"
      ]
    },
    {
      "id": "TC-AC-CUST-002-N02",
      "name": "Expired verification link rejected",
      "category": "negative",
      "ac_ref": "AC-CUST-002",
      "br_refs": [],
      "preconditions": [
        "Verification link is expired"
      ],
      "test_data": [],
      "steps": [
        "Click expired verification link"
      ],
      "expected_results": [
        "VERIFICATION_EXPIRED error",
        "Resend option shown"
      ]
    },
    {
      "id": "TC-AC-CUST-002-H01",
      "name": "Unverified order should NOT proceed to payment",
      "category": "hallucination",
      "ac_ref": "AC-CUST-002",
      "br_refs": [],
      "preconditions": [
        "Customer email is unverified"
      ],
      "test_data": [],
      "steps": [
        "Attempt checkout flow"
      ],
      "expected_results": [
        "Blocked before payment"
      ],
      "should_not": "Allow payment processing for unverified customers"
    },
    {
      "id": "TC-AC-CUST-003-P01",
      "name": "Add valid shipping address",
      "category": "positive",
      "ac_ref": "AC-CUST-003",
      "br_refs": [
        "AMB-ENT-027",
        "AMB-ENT-031"
      ],
      "preconditions": [
        "Customer has one existing address"
      ],
      "test_data": [
        {
          "field": "street",
          "value": "456 Oak Ave",
          "notes": "Valid street"
        },
        {
          "field": "city",
          "value": "Boston",
          "notes": "Valid city"
        },
        {
          "field": "state",
          "value": "MA",
          "notes": "Valid state"
        },
        {
          "field": "postalCode",
          "value": "02101",
          "notes": "Valid ZIP"
        },
        {
          "field": "country",
          "value": "US",
          "notes": "Valid country"
        },
        {
          "field": "recipient",
          "value": "John Doe",
          "notes": "Valid name"
        }
      ],
      "steps": [
        "Add new shipping address"
      ],
      "expected_results": [
        "Address saved",
        "Address selectable for orders"
      ]
    },
    {
      "id": "TC-AC-CUST-003-P02",
      "name": "Add second shipping address",
      "category": "positive",
      "ac_ref": "AC-CUST-003",
      "br_refs": [
        "AMB-ENT-027"
      ],
      "preconditions": [
        "Customer has one existing address"
      ],
      "test_data": [
        {
          "field": "street",
          "value": "789 Elm St",
          "notes": "Different address"
        },
        {
          "field": "city",
          "value": "Seattle",
          "notes": "Different city"
        },
        {
          "field": "state",
          "value": "WA",
          "notes": "Valid state"
        },
        {
          "field": "postalCode",
          "value": "98101",
          "notes": "Valid ZIP"
        },
        {
          "field": "country",
          "value": "US",
          "notes": "Valid country"
        }
      ],
      "steps": [
        "Add second shipping address"
      ],
      "expected_results": [
        "Both addresses available",
        "Can select either for orders"
      ]
    },
    {
      "id": "TC-AC-CUST-003-N01",
      "name": "Reject address with missing required field",
      "category": "negative",
      "ac_ref": "AC-CUST-003",
      "br_refs": [
        "AMB-ENT-031"
      ],
      "preconditions": [
        "Customer on address form"
      ],
      "test_data": [
        {
          "field": "street",
          "value": "",
          "notes": "Missing required field"
        }
      ],
      "steps": [
        "Submit address without street"
      ],
      "expected_results": [
        "INVALID_ADDRESS error",
        "Missing field specified"
      ]
    },
    {
      "id": "TC-AC-CUST-003-N02",
      "name": "Reject invalid postal code format",
      "category": "negative",
      "ac_ref": "AC-CUST-003",
      "br_refs": [
        "AMB-ENT-032"
      ],
      "preconditions": [
        "Customer on address form"
      ],
      "test_data": [
        {
          "field": "postalCode",
          "value": "ABCDE",
          "notes": "Invalid format"
        }
      ],
      "steps": [
        "Submit address with invalid postal code"
      ],
      "expected_results": [
        "INVALID_POSTAL_CODE error"
      ]
    },
    {
      "id": "TC-AC-CUST-003-B01",
      "name": "5-digit ZIP code accepted (US minimum)",
      "category": "boundary",
      "ac_ref": "AC-CUST-003",
      "br_refs": [
        "AMB-ENT-032"
      ],
      "preconditions": [
        "Customer on address form"
      ],
      "test_data": [
        {
          "field": "postalCode",
          "value": "02101",
          "notes": "Exactly 5 digits"
        }
      ],
      "steps": [
        "Submit address with 5-digit ZIP"
      ],
      "expected_results": [
        "Address saved successfully"
      ]
    },
    {
      "id": "TC-AC-CUST-003-H01",
      "name": "Billing address should NOT be required",
      "category": "hallucination",
      "ac_ref": "AC-CUST-003",
      "br_refs": [],
      "preconditions": [
        "Customer adding shipping address"
      ],
      "test_data": [],
      "steps": [
        "Add only shipping address"
      ],
      "expected_results": [
        "Address saved without billing info"
      ],
      "should_not": "Require billing address when adding shipping address"
    },
    {
      "id": "TC-AC-CUST-004-P01",
      "name": "Successful data erasure request",
      "category": "positive",
      "ac_ref": "AC-CUST-004",
      "br_refs": [
        "AMB-ENT-029"
      ],
      "preconditions": [
        "Customer registered",
        "No pending orders"
      ],
      "test_data": [],
      "steps": [
        "Request account deletion",
        "Confirm erasure"
      ],
      "expected_results": [
        "Personal data deleted",
        "Order history anonymized",
        "Confirmation sent"
      ]
    },
    {
      "id": "TC-AC-CUST-004-P02",
      "name": "Order history anonymized after erasure",
      "category": "positive",
      "ac_ref": "AC-CUST-004",
      "br_refs": [
        "AMB-ENT-029"
      ],
      "preconditions": [
        "Customer with order history",
        "No pending orders"
      ],
      "test_data": [],
      "steps": [
        "Complete data erasure",
        "Check order records"
      ],
      "expected_results": [
        "Orders exist but anonymized",
        "No personal data in orders"
      ]
    },
    {
      "id": "TC-AC-CUST-004-N01",
      "name": "Reject erasure with pending orders",
      "category": "negative",
      "ac_ref": "AC-CUST-004",
      "br_refs": [],
      "preconditions": [
        "Customer has pending order"
      ],
      "test_data": [],
      "steps": [
        "Request data erasure"
      ],
      "expected_results": [
        "PENDING_ORDERS_EXIST error",
        "Must wait for completion"
      ]
    },
    {
      "id": "TC-AC-CUST-004-N02",
      "name": "Reject erasure with shipped but not delivered order",
      "category": "negative",
      "ac_ref": "AC-CUST-004",
      "br_refs": [],
      "preconditions": [
        "Customer has shipped order (not delivered)"
      ],
      "test_data": [],
      "steps": [
        "Request data erasure"
      ],
      "expected_results": [
        "PENDING_ORDERS_EXIST error"
      ]
    },
    {
      "id": "TC-AC-CUST-004-H01",
      "name": "Deleted data should NOT be recoverable",
      "category": "hallucination",
      "ac_ref": "AC-CUST-004",
      "br_refs": [
        "AMB-ENT-029"
      ],
      "preconditions": [
        "Customer completed data erasure"
      ],
      "test_data": [],
      "steps": [
        "Attempt to access deleted customer data"
      ],
      "expected_results": [
        "Data not found"
      ],
      "should_not": "Allow recovery of erased personal data"
    },
    {
      "id": "TC-AC-PROD-001-P01",
      "name": "Filter by category, price, and availability",
      "category": "positive",
      "ac_ref": "AC-PROD-001",
      "br_refs": [
        "AMB-OP-001",
        "AMB-OP-002"
      ],
      "preconditions": [
        "Products exist in multiple categories"
      ],
      "test_data": [
        {
          "field": "category",
          "value": "Electronics",
          "notes": "Valid category"
        },
        {
          "field": "priceMin",
          "value": "50",
          "notes": "Min price"
        },
        {
          "field": "priceMax",
          "value": "200",
          "notes": "Max price"
        },
        {
          "field": "availability",
          "value": "in stock",
          "notes": "In stock only"
        }
      ],
      "steps": [
        "Apply all filters"
      ],
      "expected_results": [
        "Only matching products shown",
        "Sorted by newest",
        "20 per page"
      ]
    },
    {
      "id": "TC-AC-PROD-001-P02",
      "name": "Pagination works with 20 products per page",
      "category": "positive",
      "ac_ref": "AC-PROD-001",
      "br_refs": [
        "AMB-OP-003"
      ],
      "preconditions": [
        "More than 20 products match filters"
      ],
      "test_data": [],
      "steps": [
        "Apply filters",
        "Navigate to page 2"
      ],
      "expected_results": [
        "Page 2 shows next 20 products",
        "Proper pagination controls"
      ]
    },
    {
      "id": "TC-AC-PROD-001-N01",
      "name": "Empty result with no matching products",
      "category": "negative",
      "ac_ref": "AC-PROD-001",
      "br_refs": [],
      "preconditions": [
        "No products match filter criteria"
      ],
      "test_data": [
        {
          "field": "category",
          "value": "Electronics",
          "notes": "Valid"
        },
        {
          "field": "priceMax",
          "value": "1",
          "notes": "Unrealistic price"
        }
      ],
      "steps": [
        "Apply filters with no matches"
      ],
      "expected_results": [
        "'No products found' message",
        "Clear filters option shown"
      ]
    },
    {
      "id": "TC-AC-PROD-001-N02",
      "name": "Invalid price range handled",
      "category": "negative",
      "ac_ref": "AC-PROD-001",
      "br_refs": [],
      "preconditions": [
        "User on browse page"
      ],
      "test_data": [
        {
          "field": "priceMin",
          "value": "200",
          "notes": "Higher than max"
        },
        {
          "field": "priceMax",
          "value": "50",
          "notes": "Lower than min"
        }
      ],
      "steps": [
        "Apply inverted price range"
      ],
      "expected_results": [
        "Error or auto-correction",
        "No results returned"
      ]
    },
    {
      "id": "TC-AC-PROD-001-B01",
      "name": "Products at exact price boundary included",
      "category": "boundary",
      "ac_ref": "AC-PROD-001",
      "br_refs": [
        "AMB-OP-002"
      ],
      "preconditions": [
        "Product exists at exactly $50.00"
      ],
      "test_data": [
        {
          "field": "priceMin",
          "value": "50",
          "notes": "Exact boundary"
        }
      ],
      "steps": [
        "Filter with min price $50"
      ],
      "expected_results": [
        "$50 product is included"
      ]
    },
    {
      "id": "TC-AC-PROD-001-H01",
      "name": "Deleted products should NOT appear",
      "category": "hallucination",
      "ac_ref": "AC-PROD-001",
      "br_refs": [],
      "preconditions": [
        "Product was soft-deleted"
      ],
      "test_data": [],
      "steps": [
        "Browse all products"
      ],
      "expected_results": [
        "Deleted product not visible"
      ],
      "should_not": "Show soft-deleted products in browse results"
    },
    {
      "id": "TC-AC-PROD-002-P01",
      "name": "Out of stock indicator displayed",
      "category": "positive",
      "ac_ref": "AC-PROD-002",
      "br_refs": [
        "AMB-OP-004"
      ],
      "preconditions": [
        "Product has zero stock"
      ],
      "test_data": [
        {
          "field": "productName",
          "value": "Widget Pro",
          "notes": "Out of stock"
        }
      ],
      "steps": [
        "View product listing"
      ],
      "expected_results": [
        "'Out of Stock' indicator shown",
        "Add to Cart disabled"
      ]
    },
    {
      "id": "TC-AC-PROD-002-P02",
      "name": "Product details still viewable when out of stock",
      "category": "positive",
      "ac_ref": "AC-PROD-002",
      "br_refs": [
        "AMB-OP-004"
      ],
      "preconditions": [
        "Product has zero stock"
      ],
      "test_data": [],
      "steps": [
        "Click on out of stock product"
      ],
      "expected_results": [
        "Product details page loads",
        "Description visible"
      ]
    },
    {
      "id": "TC-AC-PROD-002-N01",
      "name": "Cannot add out of stock product to cart",
      "category": "negative",
      "ac_ref": "AC-PROD-002",
      "br_refs": [
        "AMB-OP-004"
      ],
      "preconditions": [
        "Product has zero stock"
      ],
      "test_data": [],
      "steps": [
        "Attempt to click disabled Add to Cart"
      ],
      "expected_results": [
        "Button is disabled",
        "No cart action occurs"
      ]
    },
    {
      "id": "TC-AC-PROD-002-N02",
      "name": "API rejects adding out of stock via direct call",
      "category": "negative",
      "ac_ref": "AC-PROD-002",
      "br_refs": [
        "AMB-OP-004"
      ],
      "preconditions": [
        "Product has zero stock"
      ],
      "test_data": [],
      "steps": [
        "Call add-to-cart API directly"
      ],
      "expected_results": [
        "OUT_OF_STOCK error returned"
      ]
    },
    {
      "id": "TC-AC-PROD-002-H01",
      "name": "Out of stock product should NOT be hidden",
      "category": "hallucination",
      "ac_ref": "AC-PROD-002",
      "br_refs": [
        "AMB-OP-004"
      ],
      "preconditions": [
        "Product has zero stock"
      ],
      "test_data": [],
      "steps": [
        "Browse product listings"
      ],
      "expected_results": [
        "Product is visible with indicator"
      ],
      "should_not": "Hide out-of-stock products from listings"
    },
    {
      "id": "TC-AC-PROD-003-P01",
      "name": "Variant options displayed correctly",
      "category": "positive",
      "ac_ref": "AC-PROD-003",
      "br_refs": [
        "AMB-ENT-008",
        "AMB-ENT-009"
      ],
      "preconditions": [
        "Product has size and color variants"
      ],
      "test_data": [
        {
          "field": "product",
          "value": "T-Shirt",
          "notes": "Has variants"
        },
        {
          "field": "sizes",
          "value": "S, M, L",
          "notes": "Size options"
        },
        {
          "field": "colors",
          "value": "Red, Blue",
          "notes": "Color options"
        }
      ],
      "steps": [
        "View product detail page"
      ],
      "expected_results": [
        "Size options shown",
        "Color options shown",
        "Add to Cart disabled"
      ]
    },
    {
      "id": "TC-AC-PROD-003-P02",
      "name": "Price and stock update on variant selection",
      "category": "positive",
      "ac_ref": "AC-PROD-003",
      "br_refs": [
        "AMB-ENT-010",
        "AMB-ENT-011"
      ],
      "preconditions": [
        "Product variants have different prices/stock"
      ],
      "test_data": [],
      "steps": [
        "Select size M and color Red"
      ],
      "expected_results": [
        "Price updates for variant",
        "Stock updates for variant",
        "Add to Cart enabled"
      ]
    },
    {
      "id": "TC-AC-PROD-003-N01",
      "name": "Selected variant out of stock",
      "category": "negative",
      "ac_ref": "AC-PROD-003",
      "br_refs": [
        "AMB-OP-010"
      ],
      "preconditions": [
        "Specific variant (M, Red) is out of stock"
      ],
      "test_data": [],
      "steps": [
        "Select out of stock variant"
      ],
      "expected_results": [
        "'Out of Stock' for variant",
        "Can select different variant"
      ]
    },
    {
      "id": "TC-AC-PROD-003-N02",
      "name": "Cannot add to cart without variant selection",
      "category": "negative",
      "ac_ref": "AC-PROD-003",
      "br_refs": [
        "AMB-OP-010"
      ],
      "preconditions": [
        "No variant selected"
      ],
      "test_data": [],
      "steps": [
        "Attempt to add to cart without selection"
      ],
      "expected_results": [
        "Add to Cart is disabled",
        "Prompt to select variant"
      ]
    },
    {
      "id": "TC-AC-PROD-003-B01",
      "name": "Last variant in stock selectable",
      "category": "boundary",
      "ac_ref": "AC-PROD-003",
      "br_refs": [
        "AMB-ENT-011"
      ],
      "preconditions": [
        "Only one variant has stock (1 unit)"
      ],
      "test_data": [],
      "steps": [
        "Select the only available variant"
      ],
      "expected_results": [
        "Variant selectable",
        "Shows stock count 1"
      ]
    },
    {
      "id": "TC-AC-PROD-003-H01",
      "name": "Base product price should NOT be used for variants",
      "category": "hallucination",
      "ac_ref": "AC-PROD-003",
      "br_refs": [
        "AMB-ENT-010"
      ],
      "preconditions": [
        "Variant has different price than base"
      ],
      "test_data": [],
      "steps": [
        "Select variant",
        "Add to cart"
      ],
      "expected_results": [
        "Variant price used in cart"
      ],
      "should_not": "Use base product price instead of variant price"
    },
    {
      "id": "TC-AC-CART-001-P01",
      "name": "Add product to cart successfully",
      "category": "positive",
      "ac_ref": "AC-CART-001",
      "br_refs": [
        "AMB-OP-005",
        "AMB-OP-006"
      ],
      "preconditions": [
        "Product has 10 units in stock"
      ],
      "test_data": [
        {
          "field": "product",
          "value": "Widget",
          "notes": "$25.00 price"
        },
        {
          "field": "quantity",
          "value": "2",
          "notes": "Quantity to add"
        }
      ],
      "steps": [
        "Add 2 units to cart"
      ],
      "expected_results": [
        "Cart shows Widget qty 2",
        "Unit price $25.00",
        "Subtotal $50.00",
        "Toast with View Cart"
      ]
    },
    {
      "id": "TC-AC-CART-001-P02",
      "name": "Toast notification appears with View Cart option",
      "category": "positive",
      "ac_ref": "AC-CART-001",
      "br_refs": [
        "AMB-OP-009"
      ],
      "preconditions": [
        "Product available"
      ],
      "test_data": [],
      "steps": [
        "Add any product to cart"
      ],
      "expected_results": [
        "Toast notification shown",
        "'View Cart' option in toast"
      ]
    },
    {
      "id": "TC-AC-CART-001-N01",
      "name": "Cannot add out of stock product",
      "category": "negative",
      "ac_ref": "AC-CART-001",
      "br_refs": [
        "AMB-OP-006"
      ],
      "preconditions": [
        "Product stock is 0"
      ],
      "test_data": [],
      "steps": [
        "Attempt to add to cart"
      ],
      "expected_results": [
        "OUT_OF_STOCK error",
        "Product not added"
      ]
    },
    {
      "id": "TC-AC-CART-001-N02",
      "name": "Cannot add more than available stock",
      "category": "negative",
      "ac_ref": "AC-CART-001",
      "br_refs": [
        "AMB-OP-006"
      ],
      "preconditions": [
        "Product has 5 units in stock"
      ],
      "test_data": [
        {
          "field": "quantity",
          "value": "10",
          "notes": "Exceeds stock"
        }
      ],
      "steps": [
        "Attempt to add 10 units"
      ],
      "expected_results": [
        "INSUFFICIENT_STOCK error",
        "Available quantity shown"
      ]
    },
    {
      "id": "TC-AC-CART-001-B01",
      "name": "Add exactly available stock quantity",
      "category": "boundary",
      "ac_ref": "AC-CART-001",
      "br_refs": [
        "AMB-OP-006"
      ],
      "preconditions": [
        "Product has exactly 10 units"
      ],
      "test_data": [
        {
          "field": "quantity",
          "value": "10",
          "notes": "Exact stock"
        }
      ],
      "steps": [
        "Add 10 units to cart"
      ],
      "expected_results": [
        "All 10 added successfully"
      ]
    },
    {
      "id": "TC-AC-CART-001-H01",
      "name": "Cart total should NOT include shipping yet",
      "category": "hallucination",
      "ac_ref": "AC-CART-001",
      "br_refs": [],
      "preconditions": [
        "Product added to cart"
      ],
      "test_data": [],
      "steps": [
        "View cart totals"
      ],
      "expected_results": [
        "Only subtotal shown",
        "No shipping in cart view"
      ],
      "should_not": "Include shipping cost in cart subtotal"
    },
    {
      "id": "TC-AC-CART-002-P01",
      "name": "Quantity increases for existing item",
      "category": "positive",
      "ac_ref": "AC-CART-002",
      "br_refs": [
        "AMB-OP-005",
        "AMB-OP-006"
      ],
      "preconditions": [
        "Cart has Widget qty 2",
        "Stock is 10"
      ],
      "test_data": [
        {
          "field": "additionalQty",
          "value": "3",
          "notes": "Add 3 more"
        }
      ],
      "steps": [
        "Add 3 more Widget to cart"
      ],
      "expected_results": [
        "Cart shows Widget qty 5",
        "Single line item"
      ]
    },
    {
      "id": "TC-AC-CART-002-P02",
      "name": "No duplicate line items created",
      "category": "positive",
      "ac_ref": "AC-CART-002",
      "br_refs": [
        "AMB-OP-005"
      ],
      "preconditions": [
        "Cart has Widget qty 2"
      ],
      "test_data": [],
      "steps": [
        "Add more of same product"
      ],
      "expected_results": [
        "Still single line item",
        "Quantity updated"
      ]
    },
    {
      "id": "TC-AC-CART-002-N01",
      "name": "Total quantity limited to available stock",
      "category": "negative",
      "ac_ref": "AC-CART-002",
      "br_refs": [
        "AMB-OP-006"
      ],
      "preconditions": [
        "Cart has Widget qty 8",
        "Stock is 10"
      ],
      "test_data": [
        {
          "field": "additionalQty",
          "value": "5",
          "notes": "Would exceed stock"
        }
      ],
      "steps": [
        "Attempt to add 5 more"
      ],
      "expected_results": [
        "Limited to 10 total",
        "Notification shown"
      ]
    },
    {
      "id": "TC-AC-CART-002-B01",
      "name": "Adding to reach exactly max stock",
      "category": "boundary",
      "ac_ref": "AC-CART-002",
      "br_refs": [
        "AMB-OP-006"
      ],
      "preconditions": [
        "Cart has Widget qty 8",
        "Stock is 10"
      ],
      "test_data": [
        {
          "field": "additionalQty",
          "value": "2",
          "notes": "Reaches exactly 10"
        }
      ],
      "steps": [
        "Add 2 more units"
      ],
      "expected_results": [
        "Quantity becomes 10",
        "Success"
      ]
    },
    {
      "id": "TC-AC-CART-002-H01",
      "name": "Should NOT create separate line items",
      "category": "hallucination",
      "ac_ref": "AC-CART-002",
      "br_refs": [
        "AMB-OP-005"
      ],
      "preconditions": [
        "Same product added twice"
      ],
      "test_data": [],
      "steps": [
        "Add same product multiple times"
      ],
      "expected_results": [
        "Single line item exists"
      ],
      "should_not": "Create multiple line items for same product"
    },
    {
      "id": "TC-AC-CART-003-P01",
      "name": "Guest cart merged on login",
      "category": "positive",
      "ac_ref": "AC-CART-003",
      "br_refs": [
        "AMB-ENT-012",
        "AMB-OP-007"
      ],
      "preconditions": [
        "Guest has items in cart",
        "Account has existing cart"
      ],
      "test_data": [],
      "steps": [
        "Add products as guest",
        "Log in to account"
      ],
      "expected_results": [
        "Guest items merged with account cart"
      ]
    },
    {
      "id": "TC-AC-CART-003-P02",
      "name": "Guest cart items preserved after login",
      "category": "positive",
      "ac_ref": "AC-CART-003",
      "br_refs": [
        "AMB-ENT-013"
      ],
      "preconditions": [
        "Guest has Widget qty 2",
        "Account cart empty"
      ],
      "test_data": [],
      "steps": [
        "Log in to account"
      ],
      "expected_results": [
        "Widget qty 2 now in account cart"
      ]
    },
    {
      "id": "TC-AC-CART-003-N01",
      "name": "Merged quantity limited to stock",
      "category": "negative",
      "ac_ref": "AC-CART-003",
      "br_refs": [
        "AMB-OP-007"
      ],
      "preconditions": [
        "Guest cart has 8 units",
        "Account cart has 5",
        "Stock is 10"
      ],
      "test_data": [],
      "steps": [
        "Log in to account"
      ],
      "expected_results": [
        "Total limited to 10",
        "Notification about limit"
      ]
    },
    {
      "id": "TC-AC-CART-003-H01",
      "name": "Guest cart should NOT be lost on login",
      "category": "hallucination",
      "ac_ref": "AC-CART-003",
      "br_refs": [
        "AMB-ENT-013"
      ],
      "preconditions": [
        "Guest has items in cart"
      ],
      "test_data": [],
      "steps": [
        "Log in to account"
      ],
      "expected_results": [
        "All guest items present in merged cart"
      ],
      "should_not": "Discard guest cart items on login"
    },
    {
      "id": "TC-AC-CART-004-P01",
      "name": "Update quantity successfully",
      "category": "positive",
      "ac_ref": "AC-CART-004",
      "br_refs": [
        "AMB-OP-011"
      ],
      "preconditions": [
        "Cart has Widget qty 3",
        "Stock is 10"
      ],
      "test_data": [
        {
          "field": "newQuantity",
          "value": "5",
          "notes": "Valid update"
        }
      ],
      "steps": [
        "Change quantity to 5"
      ],
      "expected_results": [
        "Quantity updates to 5",
        "Subtotal recalculates",
        "Cart total updates"
      ]
    },
    {
      "id": "TC-AC-CART-004-P02",
      "name": "Subtotal recalculates on quantity change",
      "category": "positive",
      "ac_ref": "AC-CART-004",
      "br_refs": [
        "AMB-OP-011"
      ],
      "preconditions": [
        "Widget at $25 qty 3 = $75"
      ],
      "test_data": [
        {
          "field": "newQuantity",
          "value": "5",
          "notes": "Change to 5"
        }
      ],
      "steps": [
        "Update quantity"
      ],
      "expected_results": [
        "Subtotal becomes $125.00"
      ]
    },
    {
      "id": "TC-AC-CART-004-N01",
      "name": "Setting quantity to 0 removes item",
      "category": "negative",
      "ac_ref": "AC-CART-004",
      "br_refs": [
        "AMB-OP-012"
      ],
      "preconditions": [
        "Cart has Widget qty 3"
      ],
      "test_data": [
        {
          "field": "newQuantity",
          "value": "0",
          "notes": "Zero quantity"
        }
      ],
      "steps": [
        "Set quantity to 0"
      ],
      "expected_results": [
        "Widget removed from cart"
      ]
    },
    {
      "id": "TC-AC-CART-004-N02",
      "name": "Quantity exceeding stock limited",
      "category": "negative",
      "ac_ref": "AC-CART-004",
      "br_refs": [
        "AMB-OP-013"
      ],
      "preconditions": [
        "Cart has Widget qty 3",
        "Stock is 10"
      ],
      "test_data": [
        {
          "field": "newQuantity",
          "value": "15",
          "notes": "Exceeds stock"
        }
      ],
      "steps": [
        "Attempt to set quantity to 15"
      ],
      "expected_results": [
        "Limited to 10",
        "'Only 10 available' notification"
      ]
    },
    {
      "id": "TC-AC-CART-004-B01",
      "name": "Set quantity to exactly max stock",
      "category": "boundary",
      "ac_ref": "AC-CART-004",
      "br_refs": [
        "AMB-OP-013"
      ],
      "preconditions": [
        "Stock is exactly 10"
      ],
      "test_data": [
        {
          "field": "newQuantity",
          "value": "10",
          "notes": "Exact stock"
        }
      ],
      "steps": [
        "Set quantity to 10"
      ],
      "expected_results": [
        "Quantity accepted",
        "No error"
      ]
    },
    {
      "id": "TC-AC-CART-004-H01",
      "name": "Negative quantity should NOT be accepted",
      "category": "hallucination",
      "ac_ref": "AC-CART-004",
      "br_refs": [],
      "preconditions": [
        "Cart has item"
      ],
      "test_data": [
        {
          "field": "newQuantity",
          "value": "-1",
          "notes": "Negative"
        }
      ],
      "steps": [
        "Attempt negative quantity"
      ],
      "expected_results": [
        "Rejected or treated as 0"
      ],
      "should_not": "Accept negative quantity values"
    },
    {
      "id": "TC-AC-CART-005-P01",
      "name": "Remove item with undo option",
      "category": "positive",
      "ac_ref": "AC-CART-005",
      "br_refs": [
        "AMB-OP-014"
      ],
      "preconditions": [
        "Cart has Widget and Gadget"
      ],
      "test_data": [],
      "steps": [
        "Remove Widget from cart"
      ],
      "expected_results": [
        "Widget removed immediately",
        "Undo option for 5 seconds",
        "Cart total recalculates"
      ]
    },
    {
      "id": "TC-AC-CART-005-P02",
      "name": "Undo restores removed item",
      "category": "positive",
      "ac_ref": "AC-CART-005",
      "br_refs": [
        "AMB-OP-014"
      ],
      "preconditions": [
        "Item just removed",
        "Undo visible"
      ],
      "test_data": [],
      "steps": [
        "Click Undo within 5 seconds"
      ],
      "expected_results": [
        "Item restored to cart",
        "Same quantity as before"
      ]
    },
    {
      "id": "TC-AC-CART-005-N01",
      "name": "Undo not available after 5 seconds",
      "category": "negative",
      "ac_ref": "AC-CART-005",
      "br_refs": [
        "AMB-OP-014"
      ],
      "preconditions": [
        "Item removed"
      ],
      "test_data": [],
      "steps": [
        "Wait more than 5 seconds"
      ],
      "expected_results": [
        "Undo option disappears",
        "Removal is permanent"
      ]
    },
    {
      "id": "TC-AC-CART-005-B01",
      "name": "Undo at exactly 5 seconds",
      "category": "boundary",
      "ac_ref": "AC-CART-005",
      "br_refs": [
        "AMB-OP-014"
      ],
      "preconditions": [
        "Item just removed"
      ],
      "test_data": [],
      "steps": [
        "Click Undo at 5 second mark"
      ],
      "expected_results": [
        "Undo succeeds at boundary"
      ]
    },
    {
      "id": "TC-AC-CART-005-H01",
      "name": "Removed item should NOT reappear",
      "category": "hallucination",
      "ac_ref": "AC-CART-005",
      "br_refs": [],
      "preconditions": [
        "Item removed",
        "Undo expired"
      ],
      "test_data": [],
      "steps": [
        "Refresh cart page"
      ],
      "expected_results": [
        "Removed item stays removed"
      ],
      "should_not": "Show removed items after undo expires"
    },
    {
      "id": "TC-AC-CART-006-P01",
      "name": "Empty cart state shown",
      "category": "positive",
      "ac_ref": "AC-CART-006",
      "br_refs": [
        "AMB-OP-015"
      ],
      "preconditions": [
        "Cart has only Widget"
      ],
      "test_data": [],
      "steps": [
        "Remove Widget"
      ],
      "expected_results": [
        "Empty cart state displayed",
        "'Continue Shopping' link shown"
      ]
    },
    {
      "id": "TC-AC-CART-006-P02",
      "name": "Continue Shopping link works",
      "category": "positive",
      "ac_ref": "AC-CART-006",
      "br_refs": [
        "AMB-OP-015"
      ],
      "preconditions": [
        "Cart is empty"
      ],
      "test_data": [],
      "steps": [
        "Click Continue Shopping"
      ],
      "expected_results": [
        "Navigates to product catalog"
      ]
    },
    {
      "id": "TC-AC-CART-006-N01",
      "name": "Cannot proceed to checkout with empty cart",
      "category": "negative",
      "ac_ref": "AC-CART-006",
      "br_refs": [],
      "preconditions": [
        "Cart is empty"
      ],
      "test_data": [],
      "steps": [
        "Attempt to proceed to checkout"
      ],
      "expected_results": [
        "Checkout blocked",
        "Message to add items"
      ]
    },
    {
      "id": "TC-AC-CART-006-H01",
      "name": "Empty cart should NOT show checkout button",
      "category": "hallucination",
      "ac_ref": "AC-CART-006",
      "br_refs": [],
      "preconditions": [
        "Cart is empty"
      ],
      "test_data": [],
      "steps": [
        "View empty cart"
      ],
      "expected_results": [
        "Checkout button hidden or disabled"
      ],
      "should_not": "Show enabled checkout button for empty cart"
    },
    {
      "id": "TC-AC-CART-007-P01",
      "name": "Out of stock warning on cart item",
      "category": "positive",
      "ac_ref": "AC-CART-007",
      "br_refs": [
        "AMB-ENT-014"
      ],
      "preconditions": [
        "Cart has Widget qty 2",
        "Widget goes out of stock"
      ],
      "test_data": [],
      "steps": [
        "View cart after stock depleted"
      ],
      "expected_results": [
        "Item remains in cart",
        "'Out of Stock' warning shown"
      ]
    },
    {
      "id": "TC-AC-CART-007-P02",
      "name": "Checkout blocked with out of stock item",
      "category": "positive",
      "ac_ref": "AC-CART-007",
      "br_refs": [
        "AMB-ENT-014"
      ],
      "preconditions": [
        "Cart has out of stock item"
      ],
      "test_data": [],
      "steps": [
        "Attempt checkout"
      ],
      "expected_results": [
        "Checkout blocked",
        "Prompt to remove or wait"
      ]
    },
    {
      "id": "TC-AC-CART-007-N01",
      "name": "Cannot increase quantity of out of stock item",
      "category": "negative",
      "ac_ref": "AC-CART-007",
      "br_refs": [
        "AMB-ENT-014"
      ],
      "preconditions": [
        "Cart item is out of stock"
      ],
      "test_data": [],
      "steps": [
        "Attempt to increase quantity"
      ],
      "expected_results": [
        "Increase blocked",
        "Still at 0 available"
      ]
    },
    {
      "id": "TC-AC-CART-007-H01",
      "name": "Out of stock item should NOT be auto-removed",
      "category": "hallucination",
      "ac_ref": "AC-CART-007",
      "br_refs": [
        "AMB-ENT-014"
      ],
      "preconditions": [
        "Cart item goes out of stock"
      ],
      "test_data": [],
      "steps": [
        "View cart"
      ],
      "expected_results": [
        "Item still in cart with warning"
      ],
      "should_not": "Automatically remove items when stock depletes"
    },
    {
      "id": "TC-AC-CART-008-P01",
      "name": "Price change notification shown",
      "category": "positive",
      "ac_ref": "AC-CART-008",
      "br_refs": [
        "AMB-ENT-016"
      ],
      "preconditions": [
        "Cart has Widget at $25.00",
        "Admin changes to $30.00"
      ],
      "test_data": [],
      "steps": [
        "View cart after price change"
      ],
      "expected_results": [
        "New price $30.00 shown",
        "'Price updated from $25 to $30' notification"
      ]
    },
    {
      "id": "TC-AC-CART-008-P02",
      "name": "Cart total reflects new price",
      "category": "positive",
      "ac_ref": "AC-CART-008",
      "br_refs": [
        "AMB-ENT-016"
      ],
      "preconditions": [
        "Price changed from $25 to $30",
        "Qty is 2"
      ],
      "test_data": [],
      "steps": [
        "View cart totals"
      ],
      "expected_results": [
        "Subtotal shows $60.00 (not $50.00)"
      ]
    },
    {
      "id": "TC-AC-CART-008-N01",
      "name": "Price decrease also notified",
      "category": "negative",
      "ac_ref": "AC-CART-008",
      "br_refs": [
        "AMB-ENT-016"
      ],
      "preconditions": [
        "Cart has Widget at $25.00",
        "Price drops to $20.00"
      ],
      "test_data": [],
      "steps": [
        "View cart"
      ],
      "expected_results": [
        "New price $20.00",
        "Notification of price change"
      ]
    },
    {
      "id": "TC-AC-CART-008-H01",
      "name": "Old price should NOT be charged",
      "category": "hallucination",
      "ac_ref": "AC-CART-008",
      "br_refs": [
        "AMB-ENT-016"
      ],
      "preconditions": [
        "Price changed since added to cart"
      ],
      "test_data": [],
      "steps": [
        "Proceed to checkout"
      ],
      "expected_results": [
        "Current price used for checkout"
      ],
      "should_not": "Use original cart price at checkout"
    },
    {
      "id": "TC-AC-CART-009-P01",
      "name": "Cart cleared after 30 days inactivity",
      "category": "positive",
      "ac_ref": "AC-CART-009",
      "br_refs": [
        "AMB-ENT-012"
      ],
      "preconditions": [
        "Logged-in customer cart inactive 30 days"
      ],
      "test_data": [],
      "steps": [
        "Wait 30 days",
        "Log in"
      ],
      "expected_results": [
        "Cart items cleared",
        "Notification on login"
      ]
    },
    {
      "id": "TC-AC-CART-009-P02",
      "name": "Customer notified of cart expiration",
      "category": "positive",
      "ac_ref": "AC-CART-009",
      "br_refs": [
        "AMB-ENT-012"
      ],
      "preconditions": [
        "Cart expired"
      ],
      "test_data": [],
      "steps": [
        "Log in after expiration"
      ],
      "expected_results": [
        "Clear notification about expired cart"
      ]
    },
    {
      "id": "TC-AC-CART-009-N01",
      "name": "Cart activity resets expiration timer",
      "category": "negative",
      "ac_ref": "AC-CART-009",
      "br_refs": [
        "AMB-ENT-012"
      ],
      "preconditions": [
        "Cart has items",
        "29 days of inactivity"
      ],
      "test_data": [],
      "steps": [
        "Update cart quantity",
        "Wait another 29 days"
      ],
      "expected_results": [
        "Cart still active",
        "Timer reset by activity"
      ]
    },
    {
      "id": "TC-AC-CART-009-B01",
      "name": "Cart at exactly 30 days expires",
      "category": "boundary",
      "ac_ref": "AC-CART-009",
      "br_refs": [
        "AMB-ENT-012"
      ],
      "preconditions": [
        "Cart inactive for exactly 30 days"
      ],
      "test_data": [],
      "steps": [
        "Check cart status"
      ],
      "expected_results": [
        "Cart expired at 30-day mark"
      ]
    },
    {
      "id": "TC-AC-CART-009-H01",
      "name": "Cart at 29 days should NOT expire",
      "category": "hallucination",
      "ac_ref": "AC-CART-009",
      "br_refs": [
        "AMB-ENT-012"
      ],
      "preconditions": [
        "Cart inactive for 29 days"
      ],
      "test_data": [],
      "steps": [
        "Log in"
      ],
      "expected_results": [
        "Cart items still present"
      ],
      "should_not": "Expire cart before 30 days"
    },
    {
      "id": "TC-AC-ORDER-001-P01",
      "name": "Order placed with free shipping over $75",
      "category": "positive",
      "ac_ref": "AC-ORDER-001",
      "br_refs": [
        "AMB-OP-016",
        "AMB-OP-020"
      ],
      "preconditions": [
        "Verified customer",
        "Cart subtotal $75+"
      ],
      "test_data": [
        {
          "field": "subtotal",
          "value": "$75.00",
          "notes": "Free shipping threshold"
        }
      ],
      "steps": [
        "Place order with valid address and credit card"
      ],
      "expected_results": [
        "Order status 'pending'",
        "Shipping $0.00",
        "Payment authorized",
        "Inventory decremented"
      ]
    },
    {
      "id": "TC-AC-ORDER-001-P02",
      "name": "Cart cleared after successful order",
      "category": "positive",
      "ac_ref": "AC-ORDER-001",
      "br_refs": [
        "AMB-OP-017"
      ],
      "preconditions": [
        "Order placed successfully"
      ],
      "test_data": [],
      "steps": [
        "View cart after order"
      ],
      "expected_results": [
        "Cart is empty",
        "Confirmation email queued"
      ]
    },
    {
      "id": "TC-AC-ORDER-001-N01",
      "name": "Order rejected on payment failure",
      "category": "negative",
      "ac_ref": "AC-ORDER-001",
      "br_refs": [
        "AMB-OP-018"
      ],
      "preconditions": [
        "Invalid credit card"
      ],
      "test_data": [],
      "steps": [
        "Attempt to place order"
      ],
      "expected_results": [
        "PAYMENT_FAILED error",
        "Cart preserved",
        "Retry allowed"
      ]
    },
    {
      "id": "TC-AC-ORDER-001-N02",
      "name": "Order rejected when item out of stock",
      "category": "negative",
      "ac_ref": "AC-ORDER-001",
      "br_refs": [
        "AMB-OP-019"
      ],
      "preconditions": [
        "Item goes out of stock at checkout"
      ],
      "test_data": [],
      "steps": [
        "Attempt to place order"
      ],
      "expected_results": [
        "STOCK_UNAVAILABLE error",
        "Modification allowed"
      ]
    },
    {
      "id": "TC-AC-ORDER-001-N03",
      "name": "Order rejected for unverified customer",
      "category": "negative",
      "ac_ref": "AC-ORDER-001",
      "br_refs": [
        "AMB-OP-016"
      ],
      "preconditions": [
        "Customer email not verified"
      ],
      "test_data": [],
      "steps": [
        "Attempt to place order"
      ],
      "expected_results": [
        "EMAIL_NOT_VERIFIED error"
      ]
    },
    {
      "id": "TC-AC-ORDER-001-B01",
      "name": "Free shipping at exactly $75 subtotal",
      "category": "boundary",
      "ac_ref": "AC-ORDER-001",
      "br_refs": [
        "AMB-OP-020"
      ],
      "preconditions": [
        "Cart subtotal exactly $75.00"
      ],
      "test_data": [],
      "steps": [
        "Place order"
      ],
      "expected_results": [
        "Shipping cost $0.00"
      ]
    },
    {
      "id": "TC-AC-ORDER-001-H01",
      "name": "Inventory should NOT decrement on failure",
      "category": "hallucination",
      "ac_ref": "AC-ORDER-001",
      "br_refs": [
        "AMB-OP-017"
      ],
      "preconditions": [
        "Payment fails"
      ],
      "test_data": [],
      "steps": [
        "Check inventory after failed order"
      ],
      "expected_results": [
        "Inventory unchanged"
      ],
      "should_not": "Decrement inventory when order fails"
    },
    {
      "id": "TC-AC-ORDER-002-P01",
      "name": "Order includes $5.99 shipping under $75",
      "category": "positive",
      "ac_ref": "AC-ORDER-002",
      "br_refs": [
        "AMB-OP-020",
        "AMB-OP-021"
      ],
      "preconditions": [
        "Verified customer",
        "Cart subtotal $35.00"
      ],
      "test_data": [],
      "steps": [
        "Place order"
      ],
      "expected_results": [
        "Shipping $5.99",
        "Total $40.99 plus tax"
      ]
    },
    {
      "id": "TC-AC-ORDER-002-P02",
      "name": "Tax calculated on order total",
      "category": "positive",
      "ac_ref": "AC-ORDER-002",
      "br_refs": [
        "AMB-OP-021"
      ],
      "preconditions": [
        "Subtotal + shipping calculated"
      ],
      "test_data": [],
      "steps": [
        "View order total"
      ],
      "expected_results": [
        "Tax added to subtotal",
        "Final total displayed"
      ]
    },
    {
      "id": "TC-AC-ORDER-002-N01",
      "name": "Shipping cannot be waived below threshold",
      "category": "negative",
      "ac_ref": "AC-ORDER-002",
      "br_refs": [
        "AMB-OP-020"
      ],
      "preconditions": [
        "Subtotal $74.99"
      ],
      "test_data": [],
      "steps": [
        "View shipping cost"
      ],
      "expected_results": [
        "Shipping is $5.99",
        "Not free"
      ]
    },
    {
      "id": "TC-AC-ORDER-002-B01",
      "name": "Shipping charged at $74.99 subtotal",
      "category": "boundary",
      "ac_ref": "AC-ORDER-002",
      "br_refs": [
        "AMB-OP-020"
      ],
      "preconditions": [
        "Cart subtotal exactly $74.99"
      ],
      "test_data": [],
      "steps": [
        "View order summary"
      ],
      "expected_results": [
        "Shipping $5.99 (not free)"
      ]
    },
    {
      "id": "TC-AC-ORDER-002-H01",
      "name": "Shipping should NOT be included in tax calc",
      "category": "hallucination",
      "ac_ref": "AC-ORDER-002",
      "br_refs": [
        "AMB-OP-022"
      ],
      "preconditions": [
        "Order with shipping"
      ],
      "test_data": [],
      "steps": [
        "Check tax calculation"
      ],
      "expected_results": [
        "Tax on subtotal only"
      ],
      "should_not": "Calculate tax on shipping cost"
    },
    {
      "id": "TC-AC-ORDER-003-P01",
      "name": "Sequential order number assigned",
      "category": "positive",
      "ac_ref": "AC-ORDER-003",
      "br_refs": [
        "AMB-ENT-017"
      ],
      "preconditions": [
        "Last order was ORD-2024-00042"
      ],
      "test_data": [],
      "steps": [
        "Place new order"
      ],
      "expected_results": [
        "Order number ORD-2024-00043 assigned"
      ]
    },
    {
      "id": "TC-AC-ORDER-003-P02",
      "name": "Order number follows year format",
      "category": "positive",
      "ac_ref": "AC-ORDER-003",
      "br_refs": [
        "AMB-ENT-017"
      ],
      "preconditions": [
        "Current year is 2024"
      ],
      "test_data": [],
      "steps": [
        "Place order"
      ],
      "expected_results": [
        "Format is ORD-2024-XXXXX"
      ]
    },
    {
      "id": "TC-AC-ORDER-003-N01",
      "name": "Concurrent orders get unique numbers",
      "category": "negative",
      "ac_ref": "AC-ORDER-003",
      "br_refs": [
        "AMB-ENT-017"
      ],
      "preconditions": [
        "Multiple orders placed simultaneously"
      ],
      "test_data": [],
      "steps": [
        "Place 3 orders at same time"
      ],
      "expected_results": [
        "Each gets unique sequential number"
      ]
    },
    {
      "id": "TC-AC-ORDER-003-B01",
      "name": "Year rollover resets sequence",
      "category": "boundary",
      "ac_ref": "AC-ORDER-003",
      "br_refs": [
        "AMB-ENT-017"
      ],
      "preconditions": [
        "Last 2024 order was ORD-2024-99999",
        "Now 2025"
      ],
      "test_data": [],
      "steps": [
        "Place first order in 2025"
      ],
      "expected_results": [
        "Order number ORD-2025-00001"
      ]
    },
    {
      "id": "TC-AC-ORDER-003-H01",
      "name": "Order numbers should NOT have gaps",
      "category": "hallucination",
      "ac_ref": "AC-ORDER-003",
      "br_refs": [
        "AMB-ENT-017"
      ],
      "preconditions": [
        "Failed order attempt"
      ],
      "test_data": [],
      "steps": [
        "Place successful order after failure"
      ],
      "expected_results": [
        "Next sequential number used"
      ],
      "should_not": "Skip order numbers for failed attempts"
    },
    {
      "id": "TC-AC-ORDER-004-P01",
      "name": "Order captures price at order time",
      "category": "positive",
      "ac_ref": "AC-ORDER-004",
      "br_refs": [
        "AMB-ENT-019"
      ],
      "preconditions": [
        "Widget price is $25.00"
      ],
      "test_data": [],
      "steps": [
        "Place order",
        "Admin changes price to $30"
      ],
      "expected_results": [
        "Order line item shows $25.00"
      ]
    },
    {
      "id": "TC-AC-ORDER-004-P02",
      "name": "Order total unaffected by later price changes",
      "category": "positive",
      "ac_ref": "AC-ORDER-004",
      "br_refs": [
        "AMB-ENT-019"
      ],
      "preconditions": [
        "Order placed at $25 per unit"
      ],
      "test_data": [],
      "steps": [
        "View order after product price change"
      ],
      "expected_results": [
        "Original price preserved in order"
      ]
    },
    {
      "id": "TC-AC-ORDER-004-N01",
      "name": "Price change does not affect existing orders",
      "category": "negative",
      "ac_ref": "AC-ORDER-004",
      "br_refs": [
        "AMB-ENT-019"
      ],
      "preconditions": [
        "Order exists with price $25"
      ],
      "test_data": [],
      "steps": [
        "Admin changes price",
        "View existing order"
      ],
      "expected_results": [
        "Order still shows $25"
      ]
    },
    {
      "id": "TC-AC-ORDER-004-H01",
      "name": "Order price should NOT update retroactively",
      "category": "hallucination",
      "ac_ref": "AC-ORDER-004",
      "br_refs": [
        "AMB-ENT-019"
      ],
      "preconditions": [
        "Order placed",
        "Price later changes"
      ],
      "test_data": [],
      "steps": [
        "View order details"
      ],
      "expected_results": [
        "Original price shown"
      ],
      "should_not": "Update historical order prices when catalog changes"
    },
    {
      "id": "TC-AC-ORDER-005-P01",
      "name": "Tax calculated correctly for California",
      "category": "positive",
      "ac_ref": "AC-ORDER-005",
      "br_refs": [
        "AMB-OP-022"
      ],
      "preconditions": [
        "Subtotal $100.00",
        "Shipping to CA (7.25%)"
      ],
      "test_data": [
        {
          "field": "subtotal",
          "value": "$100.00",
          "notes": "Before tax"
        },
        {
          "field": "state",
          "value": "CA",
          "notes": "7.25% rate"
        }
      ],
      "steps": [
        "Calculate order totals"
      ],
      "expected_results": [
        "Tax is $7.25"
      ]
    },
    {
      "id": "TC-AC-ORDER-005-P02",
      "name": "Tax calculated on subtotal before shipping",
      "category": "positive",
      "ac_ref": "AC-ORDER-005",
      "br_refs": [
        "AMB-OP-022"
      ],
      "preconditions": [
        "Subtotal $50",
        "Shipping $5.99"
      ],
      "test_data": [],
      "steps": [
        "View tax amount"
      ],
      "expected_results": [
        "Tax based on $50 only"
      ]
    },
    {
      "id": "TC-AC-ORDER-005-N01",
      "name": "Zero tax for tax-exempt states",
      "category": "negative",
      "ac_ref": "AC-ORDER-005",
      "br_refs": [
        "AMB-OP-022"
      ],
      "preconditions": [
        "Shipping to tax-exempt location"
      ],
      "test_data": [],
      "steps": [
        "Calculate order totals"
      ],
      "expected_results": [
        "Tax is $0.00"
      ]
    },
    {
      "id": "TC-AC-ORDER-005-B01",
      "name": "Tax on minimum purchase",
      "category": "boundary",
      "ac_ref": "AC-ORDER-005",
      "br_refs": [
        "AMB-OP-022"
      ],
      "preconditions": [
        "Subtotal $0.01",
        "CA 7.25%"
      ],
      "test_data": [],
      "steps": [
        "Calculate tax"
      ],
      "expected_results": [
        "Tax calculated even on small amount"
      ]
    },
    {
      "id": "TC-AC-ORDER-005-H01",
      "name": "Tax should NOT be calculated on shipping",
      "category": "hallucination",
      "ac_ref": "AC-ORDER-005",
      "br_refs": [
        "AMB-OP-022"
      ],
      "preconditions": [
        "Order with shipping cost"
      ],
      "test_data": [],
      "steps": [
        "Verify tax base"
      ],
      "expected_results": [
        "Tax excludes shipping amount"
      ],
      "should_not": "Include shipping in tax calculation base"
    },
    {
      "id": "TC-AC-ORDER-006-P01",
      "name": "Order history shows all orders",
      "category": "positive",
      "ac_ref": "AC-ORDER-006",
      "br_refs": [
        "AMB-OP-025",
        "AMB-OP-026"
      ],
      "preconditions": [
        "Customer has multiple orders"
      ],
      "test_data": [
        {
          "field": "order1",
          "value": "ORD-2024-00001",
          "notes": "Delivered"
        },
        {
          "field": "order2",
          "value": "ORD-2024-00042",
          "notes": "Shipped"
        }
      ],
      "steps": [
        "View order history"
      ],
      "expected_results": [
        "All orders displayed",
        "Shows number, date, items, total, status"
      ]
    },
    {
      "id": "TC-AC-ORDER-006-P02",
      "name": "Order history has pagination",
      "category": "positive",
      "ac_ref": "AC-ORDER-006",
      "br_refs": [
        "AMB-OP-026"
      ],
      "preconditions": [
        "Customer has 50+ orders"
      ],
      "test_data": [],
      "steps": [
        "View order history"
      ],
      "expected_results": [
        "Pagination controls shown",
        "Can navigate pages"
      ]
    },
    {
      "id": "TC-AC-ORDER-006-N01",
      "name": "Empty order history for new customer",
      "category": "negative",
      "ac_ref": "AC-ORDER-006",
      "br_refs": [
        "AMB-OP-025"
      ],
      "preconditions": [
        "New customer with no orders"
      ],
      "test_data": [],
      "steps": [
        "View order history"
      ],
      "expected_results": [
        "Empty state message",
        "Link to start shopping"
      ]
    },
    {
      "id": "TC-AC-ORDER-006-H01",
      "name": "Other customers' orders should NOT appear",
      "category": "hallucination",
      "ac_ref": "AC-ORDER-006",
      "br_refs": [],
      "preconditions": [
        "Customer viewing order history"
      ],
      "test_data": [],
      "steps": [
        "View order history"
      ],
      "expected_results": [
        "Only own orders shown"
      ],
      "should_not": "Show orders belonging to other customers"
    },
    {
      "id": "TC-AC-ORDER-007-P01",
      "name": "Tracking number displayed for shipped order",
      "category": "positive",
      "ac_ref": "AC-ORDER-007",
      "br_refs": [
        "AMB-OP-027"
      ],
      "preconditions": [
        "Order status 'shipped'",
        "Has tracking number"
      ],
      "test_data": [
        {
          "field": "orderNumber",
          "value": "ORD-2024-00042",
          "notes": "Shipped"
        },
        {
          "field": "tracking",
          "value": "1Z999AA10123456784",
          "notes": "UPS"
        }
      ],
      "steps": [
        "View order details"
      ],
      "expected_results": [
        "Tracking number displayed",
        "Link to carrier tracking page"
      ]
    },
    {
      "id": "TC-AC-ORDER-007-P02",
      "name": "Carrier tracking link is clickable",
      "category": "positive",
      "ac_ref": "AC-ORDER-007",
      "br_refs": [
        "AMB-OP-027"
      ],
      "preconditions": [
        "Shipped order with tracking"
      ],
      "test_data": [],
      "steps": [
        "Click tracking link"
      ],
      "expected_results": [
        "Opens carrier tracking page"
      ]
    },
    {
      "id": "TC-AC-ORDER-007-N01",
      "name": "No tracking shown for pending order",
      "category": "negative",
      "ac_ref": "AC-ORDER-007",
      "br_refs": [
        "AMB-OP-027"
      ],
      "preconditions": [
        "Order status 'pending'"
      ],
      "test_data": [],
      "steps": [
        "View order details"
      ],
      "expected_results": [
        "No tracking number field",
        "Status shows pending"
      ]
    },
    {
      "id": "TC-AC-ORDER-007-H01",
      "name": "Tracking should NOT appear before shipment",
      "category": "hallucination",
      "ac_ref": "AC-ORDER-007",
      "br_refs": [],
      "preconditions": [
        "Order not yet shipped"
      ],
      "test_data": [],
      "steps": [
        "View order details"
      ],
      "expected_results": [
        "No tracking information shown"
      ],
      "should_not": "Display placeholder or fake tracking before shipment"
    },
    {
      "id": "TC-AC-ORDER-008-P01",
      "name": "Successfully cancel pending order",
      "category": "positive",
      "ac_ref": "AC-ORDER-008",
      "br_refs": [
        "AMB-OP-028",
        "AMB-OP-029"
      ],
      "preconditions": [
        "Order status 'pending'"
      ],
      "test_data": [
        {
          "field": "reason",
          "value": "Changed mind",
          "notes": "Cancellation reason"
        }
      ],
      "steps": [
        "Request cancellation with reason"
      ],
      "expected_results": [
        "Status changes to 'cancelled'",
        "Inventory restored",
        "Refund initiated",
        "Email sent"
      ]
    },
    {
      "id": "TC-AC-ORDER-008-P02",
      "name": "Refund to original payment method",
      "category": "positive",
      "ac_ref": "AC-ORDER-008",
      "br_refs": [
        "AMB-OP-030",
        "AMB-OP-031"
      ],
      "preconditions": [
        "Order cancelled"
      ],
      "test_data": [],
      "steps": [
        "Check refund details"
      ],
      "expected_results": [
        "Refund to original card",
        "Full amount refunded"
      ]
    },
    {
      "id": "TC-AC-ORDER-008-N01",
      "name": "Cancellation reason required",
      "category": "negative",
      "ac_ref": "AC-ORDER-008",
      "br_refs": [
        "AMB-OP-032"
      ],
      "preconditions": [
        "Order status 'pending'"
      ],
      "test_data": [
        {
          "field": "reason",
          "value": "",
          "notes": "Empty reason"
        }
      ],
      "steps": [
        "Submit cancellation without reason"
      ],
      "expected_results": [
        "Reason required error or prompt"
      ]
    },
    {
      "id": "TC-AC-ORDER-008-H01",
      "name": "Cancelled order should NOT be shipped",
      "category": "hallucination",
      "ac_ref": "AC-ORDER-008",
      "br_refs": [
        "AMB-OP-028"
      ],
      "preconditions": [
        "Order cancelled"
      ],
      "test_data": [],
      "steps": [
        "Check fulfillment status"
      ],
      "expected_results": [
        "Order not in fulfillment queue"
      ],
      "should_not": "Ship cancelled orders"
    },
    {
      "id": "TC-AC-ORDER-009-P01",
      "name": "Cancel confirmed order successfully",
      "category": "positive",
      "ac_ref": "AC-ORDER-009",
      "br_refs": [
        "AMB-OP-028"
      ],
      "preconditions": [
        "Order status 'confirmed'"
      ],
      "test_data": [],
      "steps": [
        "Request cancellation"
      ],
      "expected_results": [
        "Status changes to 'cancelled'",
        "Inventory restored",
        "Refund initiated"
      ]
    },
    {
      "id": "TC-AC-ORDER-009-P02",
      "name": "Inventory restored on confirmed order cancel",
      "category": "positive",
      "ac_ref": "AC-ORDER-009",
      "br_refs": [
        "AMB-OP-029"
      ],
      "preconditions": [
        "Confirmed order for 5 units",
        "Stock was 10 (now 5)"
      ],
      "test_data": [],
      "steps": [
        "Cancel order",
        "Check inventory"
      ],
      "expected_results": [
        "Stock returns to 10"
      ]
    },
    {
      "id": "TC-AC-ORDER-009-N01",
      "name": "Cannot cancel after status advances beyond confirmed",
      "category": "negative",
      "ac_ref": "AC-ORDER-009",
      "br_refs": [
        "AMB-OP-028"
      ],
      "preconditions": [
        "Order already shipped"
      ],
      "test_data": [],
      "steps": [
        "Attempt cancellation"
      ],
      "expected_results": [
        "Cancellation rejected"
      ]
    },
    {
      "id": "TC-AC-ORDER-009-H01",
      "name": "Confirmed order refund should NOT be partial",
      "category": "hallucination",
      "ac_ref": "AC-ORDER-009",
      "br_refs": [
        "AMB-OP-030"
      ],
      "preconditions": [
        "Confirmed order cancelled"
      ],
      "test_data": [],
      "steps": [
        "Check refund amount"
      ],
      "expected_results": [
        "Full refund issued"
      ],
      "should_not": "Issue partial refund for non-shipped cancellation"
    },
    {
      "id": "TC-AC-ORDER-010-P01",
      "name": "Shipped order shows cancel disabled",
      "category": "positive",
      "ac_ref": "AC-ORDER-010",
      "br_refs": [
        "AMB-OP-028",
        "AMB-ENT-018"
      ],
      "preconditions": [
        "Order status 'shipped'"
      ],
      "test_data": [],
      "steps": [
        "View order details"
      ],
      "expected_results": [
        "Cancel button disabled or hidden"
      ]
    },
    {
      "id": "TC-AC-ORDER-010-P02",
      "name": "Return process suggested for shipped orders",
      "category": "positive",
      "ac_ref": "AC-ORDER-010",
      "br_refs": [],
      "preconditions": [
        "Order status 'shipped'"
      ],
      "test_data": [],
      "steps": [
        "Attempt to cancel"
      ],
      "expected_results": [
        "Return/refund instructions shown instead"
      ]
    },
    {
      "id": "TC-AC-ORDER-010-N01",
      "name": "Cancellation rejected for shipped order",
      "category": "negative",
      "ac_ref": "AC-ORDER-010",
      "br_refs": [
        "AMB-OP-028"
      ],
      "preconditions": [
        "Order status 'shipped'"
      ],
      "test_data": [],
      "steps": [
        "Request cancellation via API"
      ],
      "expected_results": [
        "ORDER_ALREADY_SHIPPED error"
      ]
    },
    {
      "id": "TC-AC-ORDER-010-N02",
      "name": "Cancellation rejected for delivered order",
      "category": "negative",
      "ac_ref": "AC-ORDER-010",
      "br_refs": [
        "AMB-ENT-018"
      ],
      "preconditions": [
        "Order status 'delivered'"
      ],
      "test_data": [],
      "steps": [
        "Request cancellation"
      ],
      "expected_results": [
        "Cancellation not allowed"
      ]
    },
    {
      "id": "TC-AC-ORDER-010-H01",
      "name": "Shipped order status should NOT revert",
      "category": "hallucination",
      "ac_ref": "AC-ORDER-010",
      "br_refs": [
        "AMB-ENT-018"
      ],
      "preconditions": [
        "Order shipped"
      ],
      "test_data": [],
      "steps": [
        "Check order status transitions"
      ],
      "expected_results": [
        "Cannot go back to pending/confirmed"
      ],
      "should_not": "Allow status regression from shipped"
    },
    {
      "id": "TC-AC-ORDER-011-P01",
      "name": "Confirmation email with order details",
      "category": "positive",
      "ac_ref": "AC-ORDER-011",
      "br_refs": [
        "AMB-OP-056",
        "AMB-OP-057"
      ],
      "preconditions": [
        "Order just placed successfully"
      ],
      "test_data": [],
      "steps": [
        "Check email queue"
      ],
      "expected_results": [
        "Email queued with order number, items, quantities, prices, total"
      ]
    },
    {
      "id": "TC-AC-ORDER-011-P02",
      "name": "Email includes shipping and delivery info",
      "category": "positive",
      "ac_ref": "AC-ORDER-011",
      "br_refs": [
        "AMB-OP-058",
        "AMB-OP-059"
      ],
      "preconditions": [
        "Order placed"
      ],
      "test_data": [],
      "steps": [
        "View email content"
      ],
      "expected_results": [
        "Shipping address shown",
        "Estimated delivery date included"
      ]
    },
    {
      "id": "TC-AC-ORDER-011-N01",
      "name": "Email failure does not block order",
      "category": "negative",
      "ac_ref": "AC-ORDER-011",
      "br_refs": [
        "AMB-OP-060"
      ],
      "preconditions": [
        "Email service temporarily down"
      ],
      "test_data": [],
      "steps": [
        "Place order"
      ],
      "expected_results": [
        "Order succeeds",
        "Email queued for retry"
      ]
    },
    {
      "id": "TC-AC-ORDER-011-H01",
      "name": "Email should NOT contain payment details",
      "category": "hallucination",
      "ac_ref": "AC-ORDER-011",
      "br_refs": [],
      "preconditions": [
        "Order confirmation email"
      ],
      "test_data": [],
      "steps": [
        "Check email content"
      ],
      "expected_results": [
        "No full card number",
        "Only last 4 digits if any"
      ],
      "should_not": "Include full credit card number in email"
    },
    {
      "id": "TC-AC-ADMIN-001-P01",
      "name": "Create product with required fields",
      "category": "positive",
      "ac_ref": "AC-ADMIN-001",
      "br_refs": [
        "AMB-ENT-001",
        "AMB-OP-033"
      ],
      "preconditions": [
        "Admin on product management page"
      ],
      "test_data": [
        {
          "field": "name",
          "value": "Super Widget",
          "notes": "Valid name"
        },
        {
          "field": "description",
          "value": "A great widget",
          "notes": "Valid desc"
        },
        {
          "field": "price",
          "value": "29.99",
          "notes": "Valid price"
        },
        {
          "field": "category",
          "value": "Electronics",
          "notes": "Valid category"
        }
      ],
      "steps": [
        "Create product with all required fields"
      ],
      "expected_results": [
        "Product created with status 'draft'",
        "UUID assigned",
        "Audit logged"
      ]
    },
    {
      "id": "TC-AC-ADMIN-001-P02",
      "name": "Audit log includes creator and timestamp",
      "category": "positive",
      "ac_ref": "AC-ADMIN-001",
      "br_refs": [
        "AMB-OP-037"
      ],
      "preconditions": [
        "Product creation"
      ],
      "test_data": [],
      "steps": [
        "Check audit log"
      ],
      "expected_results": [
        "Creator username logged",
        "Timestamp logged"
      ]
    },
    {
      "id": "TC-AC-ADMIN-001-N01",
      "name": "Reject product with empty name",
      "category": "negative",
      "ac_ref": "AC-ADMIN-001",
      "br_refs": [
        "AMB-OP-034"
      ],
      "preconditions": [
        "Admin creating product"
      ],
      "test_data": [
        {
          "field": "name",
          "value": "",
          "notes": "Empty"
        }
      ],
      "steps": [
        "Submit with empty name"
      ],
      "expected_results": [
        "NAME_REQUIRED error"
      ]
    },
    {
      "id": "TC-AC-ADMIN-001-N02",
      "name": "Reject name over 200 characters",
      "category": "negative",
      "ac_ref": "AC-ADMIN-001",
      "br_refs": [
        "AMB-OP-034"
      ],
      "preconditions": [
        "Admin creating product"
      ],
      "test_data": [
        {
          "field": "name",
          "value": "[201 chars]",
          "notes": "Too long"
        }
      ],
      "steps": [
        "Submit with long name"
      ],
      "expected_results": [
        "NAME_TOO_LONG error"
      ]
    },
    {
      "id": "TC-AC-ADMIN-001-N03",
      "name": "Reject zero or negative price",
      "category": "negative",
      "ac_ref": "AC-ADMIN-001",
      "br_refs": [
        "AMB-OP-035"
      ],
      "preconditions": [
        "Admin creating product"
      ],
      "test_data": [
        {
          "field": "price",
          "value": "0",
          "notes": "Zero price"
        }
      ],
      "steps": [
        "Submit with zero price"
      ],
      "expected_results": [
        "INVALID_PRICE error"
      ]
    },
    {
      "id": "TC-AC-ADMIN-001-N04",
      "name": "Reject without category",
      "category": "negative",
      "ac_ref": "AC-ADMIN-001",
      "br_refs": [
        "AMB-OP-035"
      ],
      "preconditions": [
        "Admin creating product"
      ],
      "test_data": [
        {
          "field": "category",
          "value": "",
          "notes": "No category"
        }
      ],
      "steps": [
        "Submit without category"
      ],
      "expected_results": [
        "CATEGORY_REQUIRED error"
      ]
    },
    {
      "id": "TC-AC-ADMIN-001-N05",
      "name": "Duplicate name shows warning (not blocking)",
      "category": "negative",
      "ac_ref": "AC-ADMIN-001",
      "br_refs": [
        "AMB-ENT-002"
      ],
      "preconditions": [
        "Product named 'Super Widget' exists"
      ],
      "test_data": [
        {
          "field": "name",
          "value": "Super Widget",
          "notes": "Duplicate"
        }
      ],
      "steps": [
        "Create product with same name"
      ],
      "expected_results": [
        "Warning shown",
        "Creation allowed"
      ]
    },
    {
      "id": "TC-AC-ADMIN-001-B01",
      "name": "Name at exactly 200 characters accepted",
      "category": "boundary",
      "ac_ref": "AC-ADMIN-001",
      "br_refs": [
        "AMB-OP-034"
      ],
      "preconditions": [
        "Admin creating product"
      ],
      "test_data": [
        {
          "field": "name",
          "value": "[200 chars]",
          "notes": "Max length"
        }
      ],
      "steps": [
        "Submit with 200-char name"
      ],
      "expected_results": [
        "Product created successfully"
      ]
    },
    {
      "id": "TC-AC-ADMIN-001-H01",
      "name": "New product should NOT be visible to customers",
      "category": "hallucination",
      "ac_ref": "AC-ADMIN-001",
      "br_refs": [
        "AMB-ENT-003"
      ],
      "preconditions": [
        "Product just created"
      ],
      "test_data": [],
      "steps": [
        "Browse products as customer"
      ],
      "expected_results": [
        "Draft product not visible"
      ],
      "should_not": "Show draft products in customer catalog"
    },
    {
      "id": "TC-AC-ADMIN-002-P01",
      "name": "Upload images and set primary",
      "category": "positive",
      "ac_ref": "AC-ADMIN-002",
      "br_refs": [
        "AMB-ENT-004",
        "AMB-OP-036"
      ],
      "preconditions": [
        "Product in draft status"
      ],
      "test_data": [],
      "steps": [
        "Upload 3 images",
        "Set one as primary"
      ],
      "expected_results": [
        "Images uploaded to cloud",
        "URLs stored",
        "Primary image marked"
      ]
    },
    {
      "id": "TC-AC-ADMIN-002-P02",
      "name": "Multiple images displayed in order",
      "category": "positive",
      "ac_ref": "AC-ADMIN-002",
      "br_refs": [
        "AMB-ENT-004"
      ],
      "preconditions": [
        "Product has 3 images"
      ],
      "test_data": [],
      "steps": [
        "View product images"
      ],
      "expected_results": [
        "Primary shown first",
        "All images accessible"
      ]
    },
    {
      "id": "TC-AC-ADMIN-002-N01",
      "name": "Reject more than 10 images",
      "category": "negative",
      "ac_ref": "AC-ADMIN-002",
      "br_refs": [
        "AMB-OP-036"
      ],
      "preconditions": [
        "Product already has 10 images"
      ],
      "test_data": [],
      "steps": [
        "Attempt to upload 11th image"
      ],
      "expected_results": [
        "MAX_IMAGES_EXCEEDED error"
      ]
    },
    {
      "id": "TC-AC-ADMIN-002-N02",
      "name": "Reject invalid image format",
      "category": "negative",
      "ac_ref": "AC-ADMIN-002",
      "br_refs": [
        "AMB-OP-036"
      ],
      "preconditions": [
        "Admin uploading image"
      ],
      "test_data": [
        {
          "field": "file",
          "value": "document.pdf",
          "notes": "Not an image"
        }
      ],
      "steps": [
        "Upload PDF file"
      ],
      "expected_results": [
        "INVALID_IMAGE_FORMAT error"
      ]
    },
    {
      "id": "TC-AC-ADMIN-002-B01",
      "name": "Upload exactly 10 images",
      "category": "boundary",
      "ac_ref": "AC-ADMIN-002",
      "br_refs": [
        "AMB-OP-036"
      ],
      "preconditions": [
        "Product has 0 images"
      ],
      "test_data": [],
      "steps": [
        "Upload 10 images"
      ],
      "expected_results": [
        "All 10 images accepted"
      ]
    },
    {
      "id": "TC-AC-ADMIN-002-H01",
      "name": "Product should NOT require images",
      "category": "hallucination",
      "ac_ref": "AC-ADMIN-002",
      "br_refs": [],
      "preconditions": [
        "Draft product"
      ],
      "test_data": [],
      "steps": [
        "Publish product without images"
      ],
      "expected_results": [
        "Should not require images"
      ],
      "should_not": "Block product creation without images"
    },
    {
      "id": "TC-AC-ADMIN-003-P01",
      "name": "Update price with audit log",
      "category": "positive",
      "ac_ref": "AC-ADMIN-003",
      "br_refs": [
        "AMB-ENT-007",
        "AMB-OP-038"
      ],
      "preconditions": [
        "Product price is $25.00"
      ],
      "test_data": [
        {
          "field": "newPrice",
          "value": "30.00",
          "notes": "New price"
        }
      ],
      "steps": [
        "Change price to $30.00"
      ],
      "expected_results": [
        "Price updated",
        "Change logged with admin and timestamp"
      ]
    },
    {
      "id": "TC-AC-ADMIN-003-P02",
      "name": "Cart prices update after product price change",
      "category": "positive",
      "ac_ref": "AC-ADMIN-003",
      "br_refs": [
        "AMB-OP-040"
      ],
      "preconditions": [
        "Product in customer carts at $25"
      ],
      "test_data": [],
      "steps": [
        "Admin changes price to $30",
        "Customer views cart"
      ],
      "expected_results": [
        "Cart shows $30 on next view"
      ]
    },
    {
      "id": "TC-AC-ADMIN-003-N01",
      "name": "Reject negative price update",
      "category": "negative",
      "ac_ref": "AC-ADMIN-003",
      "br_refs": [
        "AMB-OP-038"
      ],
      "preconditions": [
        "Product exists"
      ],
      "test_data": [
        {
          "field": "newPrice",
          "value": "-5.00",
          "notes": "Negative"
        }
      ],
      "steps": [
        "Attempt negative price"
      ],
      "expected_results": [
        "INVALID_PRICE error"
      ]
    },
    {
      "id": "TC-AC-ADMIN-003-H01",
      "name": "Existing orders should NOT reflect new price",
      "category": "hallucination",
      "ac_ref": "AC-ADMIN-003",
      "br_refs": [
        "AMB-ENT-019"
      ],
      "preconditions": [
        "Order placed at $25",
        "Price changed to $30"
      ],
      "test_data": [],
      "steps": [
        "View existing order"
      ],
      "expected_results": [
        "Order still shows $25"
      ],
      "should_not": "Update prices in existing orders"
    },
    {
      "id": "TC-AC-ADMIN-004-P01",
      "name": "Last save wins with conflict warning",
      "category": "positive",
      "ac_ref": "AC-ADMIN-004",
      "br_refs": [
        "AMB-OP-039"
      ],
      "preconditions": [
        "Admin A and B editing same product"
      ],
      "test_data": [],
      "steps": [
        "Admin A saves",
        "Admin B saves different changes"
      ],
      "expected_results": [
        "Admin B's changes saved",
        "Conflict warning shown to B"
      ]
    },
    {
      "id": "TC-AC-ADMIN-004-P02",
      "name": "Warning shows overwritten fields",
      "category": "positive",
      "ac_ref": "AC-ADMIN-004",
      "br_refs": [
        "AMB-OP-039"
      ],
      "preconditions": [
        "Concurrent edit conflict"
      ],
      "test_data": [],
      "steps": [
        "Second admin saves"
      ],
      "expected_results": [
        "Warning indicates which fields were overwritten"
      ]
    },
    {
      "id": "TC-AC-ADMIN-004-N01",
      "name": "First admin's changes lost",
      "category": "negative",
      "ac_ref": "AC-ADMIN-004",
      "br_refs": [
        "AMB-OP-039"
      ],
      "preconditions": [
        "Both admins edit"
      ],
      "test_data": [],
      "steps": [
        "A saves",
        "B saves"
      ],
      "expected_results": [
        "A's specific changes overwritten"
      ]
    },
    {
      "id": "TC-AC-ADMIN-004-H01",
      "name": "Concurrent edit should NOT cause data corruption",
      "category": "hallucination",
      "ac_ref": "AC-ADMIN-004",
      "br_refs": [],
      "preconditions": [
        "Concurrent edits"
      ],
      "test_data": [],
      "steps": [
        "Both admins save simultaneously"
      ],
      "expected_results": [
        "Product data remains valid"
      ],
      "should_not": "Corrupt product data on concurrent saves"
    },
    {
      "id": "TC-AC-ADMIN-005-P01",
      "name": "Soft delete hides from customers",
      "category": "positive",
      "ac_ref": "AC-ADMIN-005",
      "br_refs": [
        "AMB-ENT-005",
        "AMB-OP-041"
      ],
      "preconditions": [
        "Product has order history"
      ],
      "test_data": [],
      "steps": [
        "Admin confirms removal"
      ],
      "expected_results": [
        "Product soft-deleted",
        "Not visible to customers"
      ]
    },
    {
      "id": "TC-AC-ADMIN-005-P02",
      "name": "Order history preserved after removal",
      "category": "positive",
      "ac_ref": "AC-ADMIN-005",
      "br_refs": [
        "AMB-OP-042"
      ],
      "preconditions": [
        "Product in past orders"
      ],
      "test_data": [],
      "steps": [
        "Remove product",
        "View order history"
      ],
      "expected_results": [
        "Order history still shows product details"
      ]
    },
    {
      "id": "TC-AC-ADMIN-005-P03",
      "name": "Cart items removed with notification",
      "category": "positive",
      "ac_ref": "AC-ADMIN-005",
      "br_refs": [
        "AMB-OP-043"
      ],
      "preconditions": [
        "Product in customer carts"
      ],
      "test_data": [],
      "steps": [
        "Admin removes product"
      ],
      "expected_results": [
        "Cart items removed",
        "Customer notification on next view"
      ]
    },
    {
      "id": "TC-AC-ADMIN-005-N01",
      "name": "Cannot permanently delete product with orders",
      "category": "negative",
      "ac_ref": "AC-ADMIN-005",
      "br_refs": [
        "AMB-OP-042"
      ],
      "preconditions": [
        "Product has order history"
      ],
      "test_data": [],
      "steps": [
        "Attempt hard delete"
      ],
      "expected_results": [
        "Only soft delete allowed"
      ]
    },
    {
      "id": "TC-AC-ADMIN-005-H01",
      "name": "Deleted product should NOT appear in search",
      "category": "hallucination",
      "ac_ref": "AC-ADMIN-005",
      "br_refs": [
        "AMB-OP-041"
      ],
      "preconditions": [
        "Product soft-deleted"
      ],
      "test_data": [],
      "steps": [
        "Customer searches for product"
      ],
      "expected_results": [
        "Product not in search results"
      ],
      "should_not": "Show soft-deleted products in search"
    },
    {
      "id": "TC-AC-ADMIN-006-P01",
      "name": "Filter orders by status and date",
      "category": "positive",
      "ac_ref": "AC-ADMIN-006",
      "br_refs": [
        "AMB-OP-044",
        "AMB-OP-045"
      ],
      "preconditions": [
        "100 orders in system"
      ],
      "test_data": [
        {
          "field": "status",
          "value": "shipped",
          "notes": "Filter value"
        },
        {
          "field": "dateRange",
          "value": "last 7 days",
          "notes": "Date filter"
        }
      ],
      "steps": [
        "Apply status and date filters"
      ],
      "expected_results": [
        "Only matching orders shown",
        "Displays order number, date, customer, total, status"
      ]
    },
    {
      "id": "TC-AC-ADMIN-006-P02",
      "name": "Search by order number",
      "category": "positive",
      "ac_ref": "AC-ADMIN-006",
      "br_refs": [
        "AMB-OP-044"
      ],
      "preconditions": [
        "Orders exist"
      ],
      "test_data": [
        {
          "field": "search",
          "value": "ORD-2024",
          "notes": "Partial number"
        }
      ],
      "steps": [
        "Search for ORD-2024"
      ],
      "expected_results": [
        "All 2024 orders shown"
      ]
    },
    {
      "id": "TC-AC-ADMIN-006-N01",
      "name": "No results for invalid search",
      "category": "negative",
      "ac_ref": "AC-ADMIN-006",
      "br_refs": [
        "AMB-OP-044"
      ],
      "preconditions": [
        "Orders exist"
      ],
      "test_data": [
        {
          "field": "search",
          "value": "INVALID-99999",
          "notes": "No match"
        }
      ],
      "steps": [
        "Search for non-existent order"
      ],
      "expected_results": [
        "No results message"
      ]
    },
    {
      "id": "TC-AC-ADMIN-006-H01",
      "name": "Admin should NOT see customer payment details",
      "category": "hallucination",
      "ac_ref": "AC-ADMIN-006",
      "br_refs": [],
      "preconditions": [
        "Admin viewing orders"
      ],
      "test_data": [],
      "steps": [
        "View order list"
      ],
      "expected_results": [
        "No full card numbers shown"
      ],
      "should_not": "Display full payment credentials in order list"
    },
    {
      "id": "TC-AC-ADMIN-007-P01",
      "name": "Export filtered orders to CSV",
      "category": "positive",
      "ac_ref": "AC-ADMIN-007",
      "br_refs": [
        "AMB-OP-046"
      ],
      "preconditions": [
        "Filtered list shows 25 orders"
      ],
      "test_data": [],
      "steps": [
        "Click Export CSV"
      ],
      "expected_results": [
        "CSV file downloads",
        "Contains all 25 filtered orders"
      ]
    },
    {
      "id": "TC-AC-ADMIN-007-P02",
      "name": "CSV includes order details",
      "category": "positive",
      "ac_ref": "AC-ADMIN-007",
      "br_refs": [
        "AMB-OP-046"
      ],
      "preconditions": [
        "Export completed"
      ],
      "test_data": [],
      "steps": [
        "Open CSV file"
      ],
      "expected_results": [
        "Order number, date, customer, items, totals included"
      ]
    },
    {
      "id": "TC-AC-ADMIN-007-N01",
      "name": "Empty export for no results",
      "category": "negative",
      "ac_ref": "AC-ADMIN-007",
      "br_refs": [
        "AMB-OP-046"
      ],
      "preconditions": [
        "Filter returns 0 orders"
      ],
      "test_data": [],
      "steps": [
        "Attempt export"
      ],
      "expected_results": [
        "Empty CSV or appropriate message"
      ]
    },
    {
      "id": "TC-AC-ADMIN-007-H01",
      "name": "CSV should NOT contain sensitive data",
      "category": "hallucination",
      "ac_ref": "AC-ADMIN-007",
      "br_refs": [],
      "preconditions": [
        "Export generated"
      ],
      "test_data": [],
      "steps": [
        "Review CSV contents"
      ],
      "expected_results": [
        "No full card numbers or passwords"
      ],
      "should_not": "Export sensitive payment or password data"
    },
    {
      "id": "TC-AC-ADMIN-008-P01",
      "name": "Update to shipped with tracking",
      "category": "positive",
      "ac_ref": "AC-ADMIN-008",
      "br_refs": [
        "AMB-OP-047",
        "AMB-OP-048"
      ],
      "preconditions": [
        "Order status 'confirmed'"
      ],
      "test_data": [
        {
          "field": "status",
          "value": "shipped",
          "notes": "New status"
        },
        {
          "field": "tracking",
          "value": "1Z999AA10123456784",
          "notes": "Tracking number"
        }
      ],
      "steps": [
        "Update status with tracking number"
      ],
      "expected_results": [
        "Status changes to 'shipped'",
        "Tracking stored",
        "Change logged"
      ]
    },
    {
      "id": "TC-AC-ADMIN-008-P02",
      "name": "Customer email sent on shipment",
      "category": "positive",
      "ac_ref": "AC-ADMIN-008",
      "br_refs": [
        "AMB-OP-050"
      ],
      "preconditions": [
        "Order marked shipped"
      ],
      "test_data": [],
      "steps": [
        "Check email queue"
      ],
      "expected_results": [
        "Shipment notification email queued"
      ]
    },
    {
      "id": "TC-AC-ADMIN-008-N01",
      "name": "Invalid status transition rejected",
      "category": "negative",
      "ac_ref": "AC-ADMIN-008",
      "br_refs": [
        "AMB-OP-049"
      ],
      "preconditions": [
        "Order status 'pending'"
      ],
      "test_data": [
        {
          "field": "status",
          "value": "shipped",
          "notes": "Skip confirmed"
        }
      ],
      "steps": [
        "Attempt pending→shipped transition"
      ],
      "expected_results": [
        "INVALID_STATUS_TRANSITION error"
      ]
    },
    {
      "id": "TC-AC-ADMIN-008-N02",
      "name": "Shipped without tracking number",
      "category": "negative",
      "ac_ref": "AC-ADMIN-008",
      "br_refs": [
        "AMB-OP-048"
      ],
      "preconditions": [
        "Order confirmed"
      ],
      "test_data": [
        {
          "field": "tracking",
          "value": "",
          "notes": "Empty"
        }
      ],
      "steps": [
        "Mark shipped without tracking"
      ],
      "expected_results": [
        "Warning or requirement for tracking"
      ]
    },
    {
      "id": "TC-AC-ADMIN-008-H01",
      "name": "Cancelled order should NOT become shipped",
      "category": "hallucination",
      "ac_ref": "AC-ADMIN-008",
      "br_refs": [
        "AMB-OP-049"
      ],
      "preconditions": [
        "Order is cancelled"
      ],
      "test_data": [],
      "steps": [
        "Attempt to mark shipped"
      ],
      "expected_results": [
        "Transition blocked"
      ],
      "should_not": "Allow cancelled orders to be shipped"
    },
    {
      "id": "TC-AC-ADMIN-009-P01",
      "name": "Set stock with audit log",
      "category": "positive",
      "ac_ref": "AC-ADMIN-009",
      "br_refs": [
        "AMB-OP-051",
        "AMB-OP-052"
      ],
      "preconditions": [
        "Product stock is 50"
      ],
      "test_data": [
        {
          "field": "newStock",
          "value": "100",
          "notes": "New quantity"
        },
        {
          "field": "reason",
          "value": "Shipment received",
          "notes": "Reason"
        }
      ],
      "steps": [
        "Set stock to 100 with reason"
      ],
      "expected_results": [
        "Stock updated to 100",
        "Audit log: before 50, after 100, reason, admin, timestamp"
      ]
    },
    {
      "id": "TC-AC-ADMIN-009-P02",
      "name": "Audit log includes all details",
      "category": "positive",
      "ac_ref": "AC-ADMIN-009",
      "br_refs": [
        "AMB-OP-055"
      ],
      "preconditions": [
        "Stock updated"
      ],
      "test_data": [],
      "steps": [
        "View audit log"
      ],
      "expected_results": [
        "Before value, after value, reason, admin, timestamp all logged"
      ]
    },
    {
      "id": "TC-AC-ADMIN-009-N01",
      "name": "Reject negative stock quantity",
      "category": "negative",
      "ac_ref": "AC-ADMIN-009",
      "br_refs": [
        "AMB-OP-053"
      ],
      "preconditions": [
        "Admin setting stock"
      ],
      "test_data": [
        {
          "field": "newStock",
          "value": "-10",
          "notes": "Negative"
        }
      ],
      "steps": [
        "Attempt to set negative stock"
      ],
      "expected_results": [
        "INVALID_QUANTITY error"
      ]
    },
    {
      "id": "TC-AC-ADMIN-009-B01",
      "name": "Set stock to zero",
      "category": "boundary",
      "ac_ref": "AC-ADMIN-009",
      "br_refs": [
        "AMB-OP-051"
      ],
      "preconditions": [
        "Product has stock"
      ],
      "test_data": [
        {
          "field": "newStock",
          "value": "0",
          "notes": "Zero"
        }
      ],
      "steps": [
        "Set stock to 0"
      ],
      "expected_results": [
        "Stock set to 0",
        "Product shows out of stock"
      ]
    },
    {
      "id": "TC-AC-ADMIN-009-H01",
      "name": "Stock change should NOT affect in-flight orders",
      "category": "hallucination",
      "ac_ref": "AC-ADMIN-009",
      "br_refs": [],
      "preconditions": [
        "Pending order exists for product"
      ],
      "test_data": [],
      "steps": [
        "Reduce stock below order quantity"
      ],
      "expected_results": [
        "Pending order unaffected"
      ],
      "should_not": "Cancel or modify pending orders on stock reduction"
    },
    {
      "id": "TC-AC-ADMIN-010-P01",
      "name": "Adjust stock by negative delta",
      "category": "positive",
      "ac_ref": "AC-ADMIN-010",
      "br_refs": [
        "AMB-OP-051",
        "AMB-OP-053"
      ],
      "preconditions": [
        "Stock is 50"
      ],
      "test_data": [
        {
          "field": "delta",
          "value": "-5",
          "notes": "Reduce by 5"
        },
        {
          "field": "reason",
          "value": "Damaged goods",
          "notes": "Reason"
        }
      ],
      "steps": [
        "Adjust stock by -5"
      ],
      "expected_results": [
        "Stock updated to 45",
        "Audit log created"
      ]
    },
    {
      "id": "TC-AC-ADMIN-010-P02",
      "name": "Adjust stock by positive delta",
      "category": "positive",
      "ac_ref": "AC-ADMIN-010",
      "br_refs": [
        "AMB-OP-051"
      ],
      "preconditions": [
        "Stock is 50"
      ],
      "test_data": [
        {
          "field": "delta",
          "value": "+10",
          "notes": "Add 10"
        }
      ],
      "steps": [
        "Adjust stock by +10"
      ],
      "expected_results": [
        "Stock updated to 60"
      ]
    },
    {
      "id": "TC-AC-ADMIN-010-N01",
      "name": "Reject adjustment resulting in negative stock",
      "category": "negative",
      "ac_ref": "AC-ADMIN-010",
      "br_refs": [
        "AMB-OP-053"
      ],
      "preconditions": [
        "Stock is 10"
      ],
      "test_data": [
        {
          "field": "delta",
          "value": "-15",
          "notes": "Would be -5"
        }
      ],
      "steps": [
        "Attempt to adjust by -15"
      ],
      "expected_results": [
        "INSUFFICIENT_STOCK error"
      ]
    },
    {
      "id": "TC-AC-ADMIN-010-B01",
      "name": "Adjust to exactly zero",
      "category": "boundary",
      "ac_ref": "AC-ADMIN-010",
      "br_refs": [
        "AMB-OP-053"
      ],
      "preconditions": [
        "Stock is 10"
      ],
      "test_data": [
        {
          "field": "delta",
          "value": "-10",
          "notes": "Exactly to 0"
        }
      ],
      "steps": [
        "Adjust by -10"
      ],
      "expected_results": [
        "Stock becomes 0",
        "Product out of stock"
      ]
    },
    {
      "id": "TC-AC-ADMIN-010-H01",
      "name": "Delta adjustment should NOT skip audit",
      "category": "hallucination",
      "ac_ref": "AC-ADMIN-010",
      "br_refs": [
        "AMB-OP-052"
      ],
      "preconditions": [
        "Stock adjusted"
      ],
      "test_data": [],
      "steps": [
        "Check audit log"
      ],
      "expected_results": [
        "Adjustment logged"
      ],
      "should_not": "Skip audit logging for delta adjustments"
    },
    {
      "id": "TC-AC-ADMIN-011-P01",
      "name": "Bulk update from valid CSV",
      "category": "positive",
      "ac_ref": "AC-ADMIN-011",
      "br_refs": [
        "AMB-OP-054"
      ],
      "preconditions": [
        "CSV with 50 valid SKUs and quantities"
      ],
      "test_data": [],
      "steps": [
        "Import CSV file"
      ],
      "expected_results": [
        "All 50 rows updated",
        "Summary shown"
      ]
    },
    {
      "id": "TC-AC-ADMIN-011-P02",
      "name": "Summary shows success count",
      "category": "positive",
      "ac_ref": "AC-ADMIN-011",
      "br_refs": [
        "AMB-OP-054"
      ],
      "preconditions": [
        "CSV imported"
      ],
      "test_data": [],
      "steps": [
        "View import results"
      ],
      "expected_results": [
        "Success count displayed",
        "Error count if any"
      ]
    },
    {
      "id": "TC-AC-ADMIN-011-N01",
      "name": "Invalid SKU rows skipped with error",
      "category": "negative",
      "ac_ref": "AC-ADMIN-011",
      "br_refs": [
        "AMB-OP-054"
      ],
      "preconditions": [
        "CSV has non-existent SKU"
      ],
      "test_data": [],
      "steps": [
        "Import CSV"
      ],
      "expected_results": [
        "Row skipped",
        "SKU not found error reported"
      ]
    },
    {
      "id": "TC-AC-ADMIN-011-N02",
      "name": "Invalid quantity rows skipped",
      "category": "negative",
      "ac_ref": "AC-ADMIN-011",
      "br_refs": [
        "AMB-OP-054"
      ],
      "preconditions": [
        "CSV has negative quantity"
      ],
      "test_data": [],
      "steps": [
        "Import CSV"
      ],
      "expected_results": [
        "Row skipped",
        "Invalid quantity error reported"
      ]
    },
    {
      "id": "TC-AC-ADMIN-011-B01",
      "name": "Single row CSV imports successfully",
      "category": "boundary",
      "ac_ref": "AC-ADMIN-011",
      "br_refs": [
        "AMB-OP-054"
      ],
      "preconditions": [
        "CSV has 1 valid row"
      ],
      "test_data": [],
      "steps": [
        "Import single-row CSV"
      ],
      "expected_results": [
        "Row processed successfully"
      ]
    },
    {
      "id": "TC-AC-ADMIN-011-H01",
      "name": "Partial failures should NOT rollback successes",
      "category": "hallucination",
      "ac_ref": "AC-ADMIN-011",
      "br_refs": [],
      "preconditions": [
        "CSV has mix of valid and invalid rows"
      ],
      "test_data": [],
      "steps": [
        "Import CSV",
        "Check updates"
      ],
      "expected_results": [
        "Valid rows are updated"
      ],
      "should_not": "Rollback successful updates when some rows fail"
    },
    {
      "id": "TC-AC-ADMIN-012-P01",
      "name": "Alert triggered when stock drops below threshold",
      "category": "positive",
      "ac_ref": "AC-ADMIN-012",
      "br_refs": [
        "AMB-ENT-041"
      ],
      "preconditions": [
        "Threshold is 10",
        "Stock is 15"
      ],
      "test_data": [],
      "steps": [
        "Stock drops to 8 (via order or adjustment)"
      ],
      "expected_results": [
        "Low stock alert triggered"
      ]
    },
    {
      "id": "TC-AC-ADMIN-012-P02",
      "name": "Admin notified of low stock",
      "category": "positive",
      "ac_ref": "AC-ADMIN-012",
      "br_refs": [
        "AMB-ENT-041"
      ],
      "preconditions": [
        "Low stock alert triggered"
      ],
      "test_data": [],
      "steps": [
        "Check admin notifications"
      ],
      "expected_results": [
        "Low stock notification visible"
      ]
    },
    {
      "id": "TC-AC-ADMIN-012-N01",
      "name": "No alert when stock above threshold",
      "category": "negative",
      "ac_ref": "AC-ADMIN-012",
      "br_refs": [
        "AMB-ENT-041"
      ],
      "preconditions": [
        "Threshold is 10",
        "Stock is 15"
      ],
      "test_data": [],
      "steps": [
        "Stock drops to 11"
      ],
      "expected_results": [
        "No alert triggered"
      ]
    },
    {
      "id": "TC-AC-ADMIN-012-B01",
      "name": "Alert at exactly threshold",
      "category": "boundary",
      "ac_ref": "AC-ADMIN-012",
      "br_refs": [
        "AMB-ENT-041"
      ],
      "preconditions": [
        "Threshold is 10",
        "Stock is 11"
      ],
      "test_data": [],
      "steps": [
        "Stock drops to exactly 10"
      ],
      "expected_results": [
        "Alert triggered at threshold"
      ]
    },
    {
      "id": "TC-AC-ADMIN-012-H01",
      "name": "Alert should NOT trigger repeatedly",
      "category": "hallucination",
      "ac_ref": "AC-ADMIN-012",
      "br_refs": [],
      "preconditions": [
        "Already below threshold"
      ],
      "test_data": [],
      "steps": [
        "Stock drops further"
      ],
      "expected_results": [
        "No duplicate alert"
      ],
      "should_not": "Send multiple alerts for same low-stock condition"
    },
    {
      "id": "TC-AC-ADMIN-013-P01",
      "name": "Create subcategory under parent",
      "category": "positive",
      "ac_ref": "AC-ADMIN-013",
      "br_refs": [
        "AMB-ENT-037"
      ],
      "preconditions": [
        "Category 'Electronics' exists"
      ],
      "test_data": [
        {
          "field": "name",
          "value": "Smartphones",
          "notes": "Subcategory"
        },
        {
          "field": "parent",
          "value": "Electronics",
          "notes": "Parent category"
        }
      ],
      "steps": [
        "Create subcategory Smartphones under Electronics"
      ],
      "expected_results": [
        "Subcategory created",
        "Parent reference set"
      ]
    },
    {
      "id": "TC-AC-ADMIN-013-P02",
      "name": "Display order configurable",
      "category": "positive",
      "ac_ref": "AC-ADMIN-013",
      "br_refs": [
        "AMB-ENT-038"
      ],
      "preconditions": [
        "Subcategory created"
      ],
      "test_data": [],
      "steps": [
        "Set display order"
      ],
      "expected_results": [
        "Order saved",
        "Categories display in configured order"
      ]
    },
    {
      "id": "TC-AC-ADMIN-013-N01",
      "name": "Reject more than 3 levels of nesting",
      "category": "negative",
      "ac_ref": "AC-ADMIN-013",
      "br_refs": [
        "AMB-ENT-037"
      ],
      "preconditions": [
        "3 levels already exist"
      ],
      "test_data": [],
      "steps": [
        "Attempt to create 4th level"
      ],
      "expected_results": [
        "MAX_NESTING_EXCEEDED error"
      ]
    },
    {
      "id": "TC-AC-ADMIN-013-B01",
      "name": "Create exactly 3 levels deep",
      "category": "boundary",
      "ac_ref": "AC-ADMIN-013",
      "br_refs": [
        "AMB-ENT-037"
      ],
      "preconditions": [
        "2 levels exist"
      ],
      "test_data": [],
      "steps": [
        "Create 3rd level category"
      ],
      "expected_results": [
        "3rd level created successfully"
      ]
    },
    {
      "id": "TC-AC-ADMIN-013-H01",
      "name": "Circular parent reference should NOT be allowed",
      "category": "hallucination",
      "ac_ref": "AC-ADMIN-013",
      "br_refs": [],
      "preconditions": [
        "Category A exists under Category B"
      ],
      "test_data": [],
      "steps": [
        "Try to set B as child of A"
      ],
      "expected_results": [
        "Circular reference blocked"
      ],
      "should_not": "Allow circular parent-child relationships"
    },
    {
      "id": "TC-AC-PAY-001-P01",
      "name": "Successful Visa payment via Stripe",
      "category": "positive",
      "ac_ref": "AC-PAY-001",
      "br_refs": [
        "AMB-ENT-034",
        "AMB-ENT-036"
      ],
      "preconditions": [
        "Customer at checkout",
        "Valid Visa card"
      ],
      "test_data": [
        {
          "field": "cardLast4",
          "value": "4242",
          "notes": "Visa test card"
        }
      ],
      "steps": [
        "Submit payment"
      ],
      "expected_results": [
        "Payment authorized via Stripe",
        "Tokenized reference stored",
        "Order created"
      ]
    },
    {
      "id": "TC-AC-PAY-001-P02",
      "name": "Mastercard payment successful",
      "category": "positive",
      "ac_ref": "AC-PAY-001",
      "br_refs": [
        "AMB-ENT-034"
      ],
      "preconditions": [
        "Valid Mastercard"
      ],
      "test_data": [
        {
          "field": "cardLast4",
          "value": "5555",
          "notes": "Mastercard"
        }
      ],
      "steps": [
        "Submit payment"
      ],
      "expected_results": [
        "Payment authorized",
        "Order created"
      ]
    },
    {
      "id": "TC-AC-PAY-001-N01",
      "name": "Declined card rejected",
      "category": "negative",
      "ac_ref": "AC-PAY-001",
      "br_refs": [
        "AMB-ENT-035"
      ],
      "preconditions": [
        "Card will be declined"
      ],
      "test_data": [],
      "steps": [
        "Submit payment"
      ],
      "expected_results": [
        "PAYMENT_DECLINED error",
        "Reason shown"
      ]
    },
    {
      "id": "TC-AC-PAY-001-N02",
      "name": "Invalid card number rejected",
      "category": "negative",
      "ac_ref": "AC-PAY-001",
      "br_refs": [
        "AMB-ENT-035"
      ],
      "preconditions": [
        "Invalid card number format"
      ],
      "test_data": [
        {
          "field": "cardNumber",
          "value": "1234",
          "notes": "Invalid"
        }
      ],
      "steps": [
        "Submit payment"
      ],
      "expected_results": [
        "INVALID_CARD error"
      ]
    },
    {
      "id": "TC-AC-PAY-001-N03",
      "name": "Unsupported card type rejected",
      "category": "negative",
      "ac_ref": "AC-PAY-001",
      "br_refs": [
        "AMB-ENT-034"
      ],
      "preconditions": [
        "Discover card (not supported)"
      ],
      "test_data": [],
      "steps": [
        "Attempt payment with Discover"
      ],
      "expected_results": [
        "UNSUPPORTED_CARD_TYPE error"
      ]
    },
    {
      "id": "TC-AC-PAY-001-B01",
      "name": "Card expiring this month accepted",
      "category": "boundary",
      "ac_ref": "AC-PAY-001",
      "br_refs": [],
      "preconditions": [
        "Card expires end of current month"
      ],
      "test_data": [],
      "steps": [
        "Submit payment"
      ],
      "expected_results": [
        "Payment accepted (still valid)"
      ]
    },
    {
      "id": "TC-AC-PAY-001-H01",
      "name": "Full card number should NOT be stored",
      "category": "hallucination",
      "ac_ref": "AC-PAY-001",
      "br_refs": [
        "AMB-ENT-036"
      ],
      "preconditions": [
        "Payment completed"
      ],
      "test_data": [],
      "steps": [
        "Check stored payment data"
      ],
      "expected_results": [
        "Only token and last 4 digits stored"
      ],
      "should_not": "Store full card number in database"
    },
    {
      "id": "TC-AC-PAY-002-P01",
      "name": "Successful PayPal authorization",
      "category": "positive",
      "ac_ref": "AC-PAY-002",
      "br_refs": [
        "AMB-ENT-035"
      ],
      "preconditions": [
        "Customer selects PayPal at checkout"
      ],
      "test_data": [],
      "steps": [
        "Complete PayPal authorization"
      ],
      "expected_results": [
        "Payment authorized",
        "PayPal reference stored",
        "Order created"
      ]
    },
    {
      "id": "TC-AC-PAY-002-P02",
      "name": "PayPal reference stored for order",
      "category": "positive",
      "ac_ref": "AC-PAY-002",
      "br_refs": [
        "AMB-ENT-035"
      ],
      "preconditions": [
        "PayPal payment completed"
      ],
      "test_data": [],
      "steps": [
        "View order details"
      ],
      "expected_results": [
        "PayPal transaction reference visible"
      ]
    },
    {
      "id": "TC-AC-PAY-002-N01",
      "name": "Cancelled PayPal authorization",
      "category": "negative",
      "ac_ref": "AC-PAY-002",
      "br_refs": [],
      "preconditions": [
        "Customer cancels PayPal"
      ],
      "test_data": [],
      "steps": [
        "Cancel PayPal authorization"
      ],
      "expected_results": [
        "PAYMENT_CANCELLED",
        "Return to checkout"
      ]
    },
    {
      "id": "TC-AC-PAY-002-N02",
      "name": "PayPal timeout handled",
      "category": "negative",
      "ac_ref": "AC-PAY-002",
      "br_refs": [],
      "preconditions": [
        "PayPal session expires"
      ],
      "test_data": [],
      "steps": [
        "Wait for timeout"
      ],
      "expected_results": [
        "Timeout error",
        "Return to checkout"
      ]
    },
    {
      "id": "TC-AC-PAY-002-H01",
      "name": "PayPal credentials should NOT be stored locally",
      "category": "hallucination",
      "ac_ref": "AC-PAY-002",
      "br_refs": [],
      "preconditions": [
        "PayPal payment completed"
      ],
      "test_data": [],
      "steps": [
        "Check stored data"
      ],
      "expected_results": [
        "Only transaction reference stored"
      ],
      "should_not": "Store PayPal email or password"
    },
    {
      "id": "TC-AC-PAY-003-P01",
      "name": "Save card for future purchases",
      "category": "positive",
      "ac_ref": "AC-PAY-003",
      "br_refs": [
        "AMB-ENT-028",
        "AMB-ENT-036"
      ],
      "preconditions": [
        "Customer completing order"
      ],
      "test_data": [],
      "steps": [
        "Select 'Save for future purchases'",
        "Complete order"
      ],
      "expected_results": [
        "Tokenized payment method stored",
        "Available for future checkouts"
      ]
    },
    {
      "id": "TC-AC-PAY-003-P02",
      "name": "Saved card available at next checkout",
      "category": "positive",
      "ac_ref": "AC-PAY-003",
      "br_refs": [
        "AMB-ENT-028"
      ],
      "preconditions": [
        "Customer has saved card"
      ],
      "test_data": [],
      "steps": [
        "Start new checkout"
      ],
      "expected_results": [
        "Saved card shown as option",
        "Can select for payment"
      ]
    },
    {
      "id": "TC-AC-PAY-003-N01",
      "name": "Opt-out does not save card",
      "category": "negative",
      "ac_ref": "AC-PAY-003",
      "br_refs": [
        "AMB-ENT-028"
      ],
      "preconditions": [
        "Customer completing order"
      ],
      "test_data": [],
      "steps": [
        "Do NOT select save option",
        "Complete order"
      ],
      "expected_results": [
        "Card not saved",
        "Not available at future checkout"
      ]
    },
    {
      "id": "TC-AC-PAY-003-H01",
      "name": "Saved card should NOT store full number",
      "category": "hallucination",
      "ac_ref": "AC-PAY-003",
      "br_refs": [
        "AMB-ENT-036"
      ],
      "preconditions": [
        "Card saved for future"
      ],
      "test_data": [],
      "steps": [
        "View saved payment methods"
      ],
      "expected_results": [
        "Only last 4 digits shown"
      ],
      "should_not": "Display or store full card number"
    }
  ]
}