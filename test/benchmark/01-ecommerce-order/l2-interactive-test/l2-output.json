{
  "aggregates": [
    {
      "id": "AGG-CUSTOMER-001",
      "name": "Customer",
      "purpose": "Manages customer account lifecycle including registration, verification, and account status",
      "invariants": [
        {
          "id": "INV-CUST-001",
          "rule": "Password must be at least 8 characters and contain at least one number",
          "enforcement": "Validated on password creation and change via Password value object"
        },
        {
          "id": "INV-CUST-002",
          "rule": "Email address must be unique across all customer accounts",
          "enforcement": "Enforced at repository level with unique constraint, checked before save"
        },
        {
          "id": "INV-CUST-003",
          "rule": "Email must be valid format",
          "enforcement": "Validated via Email value object on creation and update"
        },
        {
          "id": "INV-CUST-004",
          "rule": "Status transitions must follow valid state machine (unverified→verified→suspended, unverified→suspended)",
          "enforcement": "Guard clauses in status transition methods"
        },
        {
          "id": "INV-CUST-005",
          "rule": "Customer must have first name and last name",
          "enforcement": "Validated on creation, non-empty string check"
        }
      ],
      "root": {
        "entity": "Customer",
        "identity": "CustomerId (UUID)",
        "attributes": [
          {
            "name": "email",
            "type": "Email",
            "mutable": true
          },
          {
            "name": "password",
            "type": "Password",
            "mutable": true
          },
          {
            "name": "firstName",
            "type": "string",
            "mutable": true
          },
          {
            "name": "lastName",
            "type": "string",
            "mutable": true
          },
          {
            "name": "status",
            "type": "CustomerStatus",
            "mutable": true
          },
          {
            "name": "createdAt",
            "type": "DateTime",
            "mutable": false
          },
          {
            "name": "verifiedAt",
            "type": "DateTime?",
            "mutable": true
          }
        ]
      },
      "entities": [],
      "valueObjects": [
        "Email",
        "Password",
        "CustomerStatus"
      ],
      "behaviors": [
        {
          "name": "register",
          "command": "RegisterCustomer",
          "preconditions": [
            "email is unique (checked via repository)"
          ],
          "postconditions": [
            "status == 'unverified'",
            "customer persisted"
          ],
          "emits": "CustomerRegistered"
        },
        {
          "name": "verify",
          "command": "VerifyCustomer",
          "preconditions": [
            "status == 'unverified'"
          ],
          "postconditions": [
            "status == 'verified'",
            "verifiedAt is set"
          ],
          "emits": "CustomerVerified"
        },
        {
          "name": "suspend",
          "command": "SuspendCustomer",
          "preconditions": [
            "status in ['unverified', 'verified']"
          ],
          "postconditions": [
            "status == 'suspended'"
          ],
          "emits": "CustomerSuspended"
        },
        {
          "name": "changeEmail",
          "command": "ChangeCustomerEmail",
          "preconditions": [
            "status != 'suspended'",
            "new email is unique"
          ],
          "postconditions": [
            "email updated",
            "status == 'unverified'"
          ],
          "emits": "CustomerEmailChanged"
        },
        {
          "name": "changePassword",
          "command": "ChangeCustomerPassword",
          "preconditions": [
            "status != 'suspended'"
          ],
          "postconditions": [
            "password updated"
          ],
          "emits": "CustomerPasswordChanged"
        },
        {
          "name": "updateProfile",
          "command": "UpdateCustomerProfile",
          "preconditions": [
            "status != 'suspended'"
          ],
          "postconditions": [
            "firstName and/or lastName updated"
          ],
          "emits": "CustomerProfileUpdated"
        }
      ],
      "events": [
        {
          "name": "CustomerRegistered",
          "payload": [
            "customerId",
            "email",
            "firstName",
            "lastName",
            "registeredAt"
          ]
        },
        {
          "name": "CustomerVerified",
          "payload": [
            "customerId",
            "verifiedAt"
          ]
        },
        {
          "name": "CustomerSuspended",
          "payload": [
            "customerId",
            "suspendedAt",
            "reason"
          ]
        },
        {
          "name": "CustomerEmailChanged",
          "payload": [
            "customerId",
            "oldEmail",
            "newEmail",
            "changedAt"
          ]
        },
        {
          "name": "CustomerPasswordChanged",
          "payload": [
            "customerId",
            "changedAt"
          ]
        },
        {
          "name": "CustomerProfileUpdated",
          "payload": [
            "customerId",
            "firstName",
            "lastName",
            "updatedAt"
          ]
        }
      ],
      "repository": {
        "name": "CustomerRepository",
        "methods": [
          {
            "name": "findById",
            "params": "CustomerId",
            "returns": "Customer?"
          },
          {
            "name": "findByEmail",
            "params": "Email",
            "returns": "Customer?"
          },
          {
            "name": "existsByEmail",
            "params": "Email",
            "returns": "boolean"
          },
          {
            "name": "save",
            "params": "Customer",
            "returns": "void"
          }
        ],
        "loadStrategy": "Load complete aggregate (single entity, no children)",
        "concurrency": "Optimistic locking via version field"
      },
      "externalReferences": []
    }
  ],
  "enums": [
    {
      "name": "registration_status",
      "values": [
        "unverified",
        "verified",
        "suspended"
      ]
    },
    {
      "name": "order_status",
      "values": [
        "pending",
        "confirmed",
        "shipped",
        "delivered",
        "cancelled"
      ]
    },
    {
      "name": "payment_type",
      "values": [
        "credit_card",
        "paypal"
      ]
    },
    {
      "name": "product_status",
      "values": [
        "draft",
        "active",
        "inactive",
        "archived"
      ]
    },
    {
      "name": "inventory_change_type",
      "values": [
        "set",
        "adjust",
        "reserve",
        "release",
        "deduct",
        "restock"
      ]
    }
  ],
  "interface_contracts": [
    {
      "id": "IC-CUSTOMER-001",
      "serviceName": "Customer Service",
      "purpose": "Manages customer registration and account lifecycle",
      "baseUrl": "/api/v1/customers",
      "operations": [
        {
          "id": "OP-CUSTOMER-001",
          "name": "registerCustomer",
          "method": "POST",
          "path": "/register",
          "description": "Register a new customer account",
          "inputSchema": {
            "email": {
              "type": "Email",
              "required": true
            },
            "firstName": {
              "type": "string",
              "required": true
            },
            "lastName": {
              "type": "string",
              "required": true
            },
            "password": {
              "type": "string",
              "required": true
            }
          },
          "outputSchema": {
            "createdAt": {
              "type": "DateTime"
            },
            "customerId": {
              "type": "UUID"
            },
            "email": {
              "type": "Email"
            },
            "firstName": {
              "type": "string"
            },
            "lastName": {
              "type": "string"
            },
            "status": {
              "type": "CustomerStatus"
            }
          },
          "errors": [
            {
              "code": "DUPLICATE_EMAIL",
              "httpStatus": 409,
              "message": "Email already registered. Please login or reset your password."
            },
            {
              "code": "INVALID_PASSWORD",
              "httpStatus": 400,
              "message": "Password must be at least 8 characters and contain at least one number."
            },
            {
              "code": "INVALID_EMAIL",
              "httpStatus": 400,
              "message": "Invalid email format."
            }
          ],
          "preconditions": [
            "Email must not be registered to existing account"
          ],
          "postconditions": [
            "Customer account created with status 'unverified'",
            "Verification email sent to customer"
          ],
          "relatedACs": [
            "AC-CUST-001"
          ],
          "relatedBRs": [
            "BR-CUST-001",
            "BR-CUST-002"
          ]
        }
      ],
      "events": [
        {
          "name": "CustomerRegistered",
          "description": "Emitted when a new customer account is created",
          "payload": [
            "customerId",
            "email",
            "firstName",
            "lastName",
            "status"
          ]
        },
        {
          "name": "VerificationEmailSent",
          "description": "Emitted when a verification email is dispatched",
          "payload": [
            "customerId",
            "email",
            "sentAt"
          ]
        }
      ],
      "securityRequirements": {
        "authentication": "None (public endpoint)",
        "authorization": "None"
      }
    }
  ],
  "sequences": [
    {
      "id": "SEQ-CUST-001",
      "name": "Customer Registration Flow",
      "description": "Complete flow from registration form submission to account creation",
      "trigger": {
        "type": "user_action",
        "description": "Visitor submits registration form with email and password"
      },
      "participants": [
        {
          "name": "Visitor",
          "type": "actor"
        },
        {
          "name": "Customer Service",
          "type": "service"
        },
        {
          "name": "Customer Aggregate",
          "type": "aggregate"
        },
        {
          "name": "Email Service",
          "type": "service"
        }
      ],
      "steps": [
        {
          "step": 1,
          "actor": "Visitor",
          "action": "Submit registration request",
          "target": "Customer Service",
          "data": [
            "email",
            "password",
            "firstName",
            "lastName"
          ]
        },
        {
          "step": 2,
          "actor": "Customer Service",
          "action": "Validate password requirements",
          "target": "Customer Service"
        },
        {
          "step": 3,
          "actor": "Customer Service",
          "action": "Check email uniqueness",
          "target": "Customer Aggregate"
        },
        {
          "step": 4,
          "actor": "Customer Service",
          "action": "Create customer with status 'unverified'",
          "target": "Customer Aggregate",
          "event": "CustomerRegistered"
        },
        {
          "step": 5,
          "actor": "Customer Service",
          "action": "Send verification email",
          "target": "Email Service",
          "event": "VerificationEmailSent"
        },
        {
          "step": 6,
          "actor": "Customer Service",
          "action": "Return registration confirmation",
          "target": "Visitor",
          "returns": "Customer id, verification pending message"
        }
      ],
      "outcome": {
        "success": "Customer account created with 'unverified' status, verification email sent",
        "state_changes": [
          "Customer.status = unverified",
          "Customer.email = provided email"
        ]
      },
      "exceptions": [
        {
          "condition": "Password does not meet requirements",
          "step": 2,
          "handling": "Return error PASSWORD_INVALID with requirements, abort flow"
        },
        {
          "condition": "Email already registered",
          "step": 3,
          "handling": "Return error EMAIL_EXISTS, abort flow"
        }
      ],
      "relatedACs": [],
      "relatedBRs": [
        "BR-CUST-001",
        "BR-CUST-002"
      ]
    },
    {
      "id": "SEQ-CUST-002",
      "name": "Email Verification Flow",
      "description": "Flow for customer to verify their email address",
      "trigger": {
        "type": "user_action",
        "description": "Customer clicks verification link in email"
      },
      "participants": [
        {
          "name": "Customer",
          "type": "actor"
        },
        {
          "name": "Customer Service",
          "type": "service"
        },
        {
          "name": "Customer Aggregate",
          "type": "aggregate"
        }
      ],
      "steps": [
        {
          "step": 1,
          "actor": "Customer",
          "action": "Submit verification token",
          "target": "Customer Service",
          "data": [
            "verificationToken"
          ]
        },
        {
          "step": 2,
          "actor": "Customer Service",
          "action": "Validate verification token",
          "target": "Customer Service"
        },
        {
          "step": 3,
          "actor": "Customer Service",
          "action": "Update customer status to 'verified'",
          "target": "Customer Aggregate",
          "event": "CustomerVerified"
        },
        {
          "step": 4,
          "actor": "Customer Service",
          "action": "Return verification success",
          "target": "Customer",
          "returns": "Verification confirmed message"
        }
      ],
      "outcome": {
        "success": "Customer email verified, account status changed to 'verified'",
        "state_changes": [
          "Customer.status = verified"
        ]
      },
      "exceptions": [
        {
          "condition": "Token invalid or expired",
          "step": 2,
          "handling": "Return error INVALID_TOKEN, abort flow"
        },
        {
          "condition": "Customer already verified",
          "step": 2,
          "handling": "Return success (idempotent), no state change"
        }
      ],
      "relatedACs": [],
      "relatedBRs": []
    },
    {
      "id": "SEQ-CUST-003",
      "name": "Customer Login Flow",
      "description": "Authentication flow for existing customers",
      "trigger": {
        "type": "user_action",
        "description": "Customer submits login credentials"
      },
      "participants": [
        {
          "name": "Customer",
          "type": "actor"
        },
        {
          "name": "Auth Service",
          "type": "service"
        },
        {
          "name": "Customer Aggregate",
          "type": "aggregate"
        }
      ],
      "steps": [
        {
          "step": 1,
          "actor": "Customer",
          "action": "Submit login credentials",
          "target": "Auth Service",
          "data": [
            "email",
            "password"
          ]
        },
        {
          "step": 2,
          "actor": "Auth Service",
          "action": "Look up customer by email",
          "target": "Customer Aggregate",
          "returns": "Customer record or null"
        },
        {
          "step": 3,
          "actor": "Auth Service",
          "action": "Verify password",
          "target": "Auth Service"
        },
        {
          "step": 4,
          "actor": "Auth Service",
          "action": "Check customer status",
          "target": "Auth Service"
        },
        {
          "step": 5,
          "actor": "Auth Service",
          "action": "Generate session token",
          "target": "Auth Service",
          "event": "CustomerLoggedIn"
        },
        {
          "step": 6,
          "actor": "Auth Service",
          "action": "Return authentication result",
          "target": "Customer",
          "returns": "Session token, customer profile"
        }
      ],
      "outcome": {
        "success": "Customer authenticated, session established",
        "state_changes": [
          "Session created for customer"
        ]
      },
      "exceptions": [
        {
          "condition": "Customer not found",
          "step": 2,
          "handling": "Return error INVALID_CREDENTIALS, abort flow"
        },
        {
          "condition": "Password incorrect",
          "step": 3,
          "handling": "Return error INVALID_CREDENTIALS, abort flow"
        },
        {
          "condition": "Customer suspended",
          "step": 4,
          "handling": "Return error ACCOUNT_SUSPENDED, abort flow"
        }
      ],
      "relatedACs": [],
      "relatedBRs": []
    },
    {
      "id": "SEQ-CUST-004",
      "name": "Suspend Customer Flow",
      "description": "Administrative flow to suspend a customer account",
      "trigger": {
        "type": "admin_action",
        "description": "Administrator initiates customer suspension"
      },
      "participants": [
        {
          "name": "Administrator",
          "type": "actor"
        },
        {
          "name": "Customer Service",
          "type": "service"
        },
        {
          "name": "Customer Aggregate",
          "type": "aggregate"
        },
        {
          "name": "Notification Service",
          "type": "service"
        }
      ],
      "steps": [
        {
          "step": 1,
          "actor": "Administrator",
          "action": "Submit suspension request",
          "target": "Customer Service",
          "data": [
            "customerId",
            "reason"
          ]
        },
        {
          "step": 2,
          "actor": "Customer Service",
          "action": "Fetch customer record",
          "target": "Customer Aggregate",
          "returns": "Customer record"
        },
        {
          "step": 3,
          "actor": "Customer Service",
          "action": "Update customer status to 'suspended'",
          "target": "Customer Aggregate",
          "event": "CustomerSuspended"
        },
        {
          "step": 4,
          "actor": "Customer Service",
          "action": "Invalidate active sessions",
          "target": "Customer Service",
          "event": "SessionsInvalidated"
        },
        {
          "step": 5,
          "actor": "Customer Service",
          "action": "Send suspension notification",
          "target": "Notification Service",
          "event": "SuspensionNotificationSent"
        },
        {
          "step": 6,
          "actor": "Customer Service",
          "action": "Return suspension confirmation",
          "target": "Administrator",
          "returns": "Suspension confirmed with timestamp"
        }
      ],
      "outcome": {
        "success": "Customer account suspended, sessions invalidated, notification sent",
        "state_changes": [
          "Customer.status = suspended",
          "All customer sessions invalidated"
        ]
      },
      "exceptions": [
        {
          "condition": "Customer not found",
          "step": 2,
          "handling": "Return error CUSTOMER_NOT_FOUND, abort flow"
        },
        {
          "condition": "Customer already suspended",
          "step": 2,
          "handling": "Return success (idempotent), no state change"
        }
      ],
      "relatedACs": [],
      "relatedBRs": []
    },
    {
      "id": "SEQ-CUST-005",
      "name": "Update Customer Profile Flow",
      "description": "Flow for customer to update their profile information",
      "trigger": {
        "type": "user_action",
        "description": "Customer submits profile update form"
      },
      "participants": [
        {
          "name": "Customer",
          "type": "actor"
        },
        {
          "name": "Customer Service",
          "type": "service"
        },
        {
          "name": "Customer Aggregate",
          "type": "aggregate"
        }
      ],
      "steps": [
        {
          "step": 1,
          "actor": "Customer",
          "action": "Submit profile update request",
          "target": "Customer Service",
          "data": [
            "customerId",
            "firstName",
            "lastName"
          ]
        },
        {
          "step": 2,
          "actor": "Customer Service",
          "action": "Validate customer authorization",
          "target": "Customer Service"
        },
        {
          "step": 3,
          "actor": "Customer Service",
          "action": "Fetch customer record",
          "target": "Customer Aggregate",
          "returns": "Customer record"
        },
        {
          "step": 4,
          "actor": "Customer Service",
          "action": "Check customer status allows updates",
          "target": "Customer Service"
        },
        {
          "step": 5,
          "actor": "Customer Service",
          "action": "Update customer profile",
          "target": "Customer Aggregate",
          "event": "CustomerProfileUpdated"
        },
        {
          "step": 6,
          "actor": "Customer Service",
          "action": "Return updated profile",
          "target": "Customer",
          "returns": "Updated customer profile"
        }
      ],
      "outcome": {
        "success": "Customer profile updated with new information",
        "state_changes": [
          "Customer.firstName = new value",
          "Customer.lastName = new value"
        ]
      },
      "exceptions": [
        {
          "condition": "Authorization failed",
          "step": 2,
          "handling": "Return error UNAUTHORIZED, abort flow"
        },
        {
          "condition": "Customer not found",
          "step": 3,
          "handling": "Return error CUSTOMER_NOT_FOUND, abort flow"
        },
        {
          "condition": "Customer suspended",
          "step": 4,
          "handling": "Return error ACCOUNT_SUSPENDED, abort flow"
        }
      ],
      "relatedACs": [],
      "relatedBRs": []
    }
  ],
  "shared_types": [
    {
      "name": "Email",
      "fields": [
        {
          "name": "value",
          "type": "string",
          "constraints": "valid email format per RFC 5322"
        }
      ]
    },
    {
      "name": "CustomerStatus",
      "fields": [
        {
          "name": "value",
          "type": "enum",
          "constraints": "unverified | verified | suspended"
        }
      ]
    }
  ],
  "tables": [
    {
      "id": "TBL-CUSTOMER-001",
      "name": "customers",
      "aggregate": "Customer",
      "purpose": "Stores customer identity and authentication information",
      "fields": [
        {
          "name": "id",
          "type": "UUID",
          "constraints": "NOT NULL",
          "default": "gen_random_uuid()"
        },
        {
          "name": "email",
          "type": "VARCHAR(255)",
          "constraints": "NOT NULL UNIQUE"
        },
        {
          "name": "password_hash",
          "type": "VARCHAR(255)",
          "constraints": "NOT NULL"
        },
        {
          "name": "registration_status",
          "type": "VARCHAR(20)",
          "constraints": "NOT NULL",
          "default": "'unverified'"
        },
        {
          "name": "email_verified",
          "type": "BOOLEAN",
          "constraints": "NOT NULL",
          "default": "false"
        },
        {
          "name": "first_name",
          "type": "VARCHAR(100)",
          "constraints": "NULL"
        },
        {
          "name": "last_name",
          "type": "VARCHAR(100)",
          "constraints": "NULL"
        },
        {
          "name": "version",
          "type": "INTEGER",
          "constraints": "NOT NULL",
          "default": "1"
        },
        {
          "name": "created_at",
          "type": "TIMESTAMP",
          "constraints": "NOT NULL",
          "default": "NOW()"
        },
        {
          "name": "updated_at",
          "type": "TIMESTAMP",
          "constraints": "NOT NULL",
          "default": "NOW()"
        }
      ],
      "primaryKey": {
        "columns": [
          "id"
        ]
      },
      "indexes": [
        {
          "name": "idx_customers_email",
          "columns": [
            "email"
          ]
        },
        {
          "name": "idx_customers_registration_status",
          "columns": [
            "registration_status"
          ]
        }
      ],
      "foreignKeys": [],
      "checkConstraints": [
        {
          "name": "chk_customer_registration_status",
          "expression": "registration_status IN ('unverified', 'verified', 'suspended')"
        }
      ]
    },
    {
      "id": "TBL-CUSTOMER-002",
      "name": "customer_shipping_addresses",
      "aggregate": "Customer",
      "purpose": "Stores customer saved shipping addresses",
      "fields": [
        {
          "name": "id",
          "type": "UUID",
          "constraints": "NOT NULL",
          "default": "gen_random_uuid()"
        },
        {
          "name": "customer_id",
          "type": "UUID",
          "constraints": "NOT NULL"
        },
        {
          "name": "street",
          "type": "VARCHAR(200)",
          "constraints": "NOT NULL"
        },
        {
          "name": "city",
          "type": "VARCHAR(100)",
          "constraints": "NOT NULL"
        },
        {
          "name": "state",
          "type": "VARCHAR(50)",
          "constraints": "NOT NULL"
        },
        {
          "name": "postal_code",
          "type": "VARCHAR(20)",
          "constraints": "NOT NULL"
        },
        {
          "name": "country",
          "type": "CHAR(2)",
          "constraints": "NOT NULL"
        },
        {
          "name": "is_default",
          "type": "BOOLEAN",
          "constraints": "NOT NULL",
          "default": "false"
        },
        {
          "name": "created_at",
          "type": "TIMESTAMP",
          "constraints": "NOT NULL",
          "default": "NOW()"
        },
        {
          "name": "updated_at",
          "type": "TIMESTAMP",
          "constraints": "NOT NULL",
          "default": "NOW()"
        }
      ],
      "primaryKey": {
        "columns": [
          "id"
        ]
      },
      "indexes": [
        {
          "name": "idx_shipping_addresses_customer",
          "columns": [
            "customer_id"
          ]
        }
      ],
      "foreignKeys": [
        {
          "columns": [
            "customer_id"
          ],
          "references": "customers(id)",
          "onDelete": "CASCADE"
        }
      ],
      "checkConstraints": []
    },
    {
      "id": "TBL-CART-001",
      "name": "carts",
      "aggregate": "Cart",
      "purpose": "Stores shopping cart header information",
      "fields": [
        {
          "name": "id",
          "type": "UUID",
          "constraints": "NOT NULL",
          "default": "gen_random_uuid()"
        },
        {
          "name": "customer_id",
          "type": "UUID",
          "constraints": "NULL"
        },
        {
          "name": "is_guest",
          "type": "BOOLEAN",
          "constraints": "NOT NULL",
          "default": "false"
        },
        {
          "name": "total_price_amount",
          "type": "DECIMAL(12,2)",
          "constraints": "NOT NULL",
          "default": "0.00"
        },
        {
          "name": "total_price_currency",
          "type": "CHAR(3)",
          "constraints": "NOT NULL",
          "default": "'USD'"
        },
        {
          "name": "last_activity_date",
          "type": "TIMESTAMP",
          "constraints": "NOT NULL",
          "default": "NOW()"
        },
        {
          "name": "version",
          "type": "INTEGER",
          "constraints": "NOT NULL",
          "default": "1"
        },
        {
          "name": "created_at",
          "type": "TIMESTAMP",
          "constraints": "NOT NULL",
          "default": "NOW()"
        },
        {
          "name": "updated_at",
          "type": "TIMESTAMP",
          "constraints": "NOT NULL",
          "default": "NOW()"
        }
      ],
      "primaryKey": {
        "columns": [
          "id"
        ]
      },
      "indexes": [
        {
          "name": "idx_carts_customer",
          "columns": [
            "customer_id"
          ]
        },
        {
          "name": "idx_carts_last_activity",
          "columns": [
            "last_activity_date"
          ]
        }
      ],
      "foreignKeys": [
        {
          "columns": [
            "customer_id"
          ],
          "references": "customers(id)",
          "onDelete": "SET NULL"
        }
      ],
      "checkConstraints": [
        {
          "name": "chk_cart_total",
          "expression": "total_price_amount \u003e= 0"
        }
      ]
    },
    {
      "id": "TBL-CART-002",
      "name": "cart_items",
      "aggregate": "Cart",
      "purpose": "Stores cart line items with product snapshots",
      "fields": [
        {
          "name": "id",
          "type": "UUID",
          "constraints": "NOT NULL",
          "default": "gen_random_uuid()"
        },
        {
          "name": "cart_id",
          "type": "UUID",
          "constraints": "NOT NULL"
        },
        {
          "name": "product_id",
          "type": "UUID",
          "constraints": "NOT NULL"
        },
        {
          "name": "variant_id",
          "type": "UUID",
          "constraints": "NULL"
        },
        {
          "name": "product_name",
          "type": "VARCHAR(200)",
          "constraints": "NOT NULL"
        },
        {
          "name": "unit_price_amount",
          "type": "DECIMAL(10,2)",
          "constraints": "NOT NULL"
        },
        {
          "name": "unit_price_currency",
          "type": "CHAR(3)",
          "constraints": "NOT NULL",
          "default": "'USD'"
        },
        {
          "name": "quantity",
          "type": "INTEGER",
          "constraints": "NOT NULL"
        },
        {
          "name": "subtotal_amount",
          "type": "DECIMAL(12,2)",
          "constraints": "NOT NULL"
        },
        {
          "name": "subtotal_currency",
          "type": "CHAR(3)",
          "constraints": "NOT NULL",
          "default": "'USD'"
        },
        {
          "name": "created_at",
          "type": "TIMESTAMP",
          "constraints": "NOT NULL",
          "default": "NOW()"
        },
        {
          "name": "updated_at",
          "type": "TIMESTAMP",
          "constraints": "NOT NULL",
          "default": "NOW()"
        }
      ],
      "primaryKey": {
        "columns": [
          "id"
        ]
      },
      "indexes": [
        {
          "name": "idx_cart_items_cart",
          "columns": [
            "cart_id"
          ]
        },
        {
          "name": "idx_cart_items_product",
          "columns": [
            "product_id"
          ]
        },
        {
          "name": "idx_cart_items_cart_product",
          "columns": [
            "cart_id",
            "product_id",
            "variant_id"
          ]
        }
      ],
      "foreignKeys": [
        {
          "columns": [
            "cart_id"
          ],
          "references": "carts(id)",
          "onDelete": "CASCADE"
        },
        {
          "columns": [
            "product_id"
          ],
          "references": "products(id)",
          "onDelete": "RESTRICT"
        },
        {
          "columns": [
            "variant_id"
          ],
          "references": "product_variants(id)",
          "onDelete": "RESTRICT"
        }
      ],
      "checkConstraints": [
        {
          "name": "chk_cart_item_quantity",
          "expression": "quantity \u003e 0"
        },
        {
          "name": "chk_cart_item_price",
          "expression": "unit_price_amount \u003e= 0 AND subtotal_amount \u003e= 0"
        }
      ]
    },
    {
      "id": "TBL-ORDER-001",
      "name": "orders",
      "aggregate": "Order",
      "purpose": "Stores order header information with shipping and payment details",
      "fields": [
        {
          "name": "id",
          "type": "UUID",
          "constraints": "NOT NULL",
          "default": "gen_random_uuid()"
        },
        {
          "name": "order_number",
          "type": "VARCHAR(20)",
          "constraints": "NOT NULL UNIQUE"
        },
        {
          "name": "customer_id",
          "type": "UUID",
          "constraints": "NOT NULL"
        },
        {
          "name": "status",
          "type": "VARCHAR(20)",
          "constraints": "NOT NULL",
          "default": "'pending'"
        },
        {
          "name": "shipping_street",
          "type": "VARCHAR(200)",
          "constraints": "NOT NULL"
        },
        {
          "name": "shipping_city",
          "type": "VARCHAR(100)",
          "constraints": "NOT NULL"
        },
        {
          "name": "shipping_state",
          "type": "VARCHAR(50)",
          "constraints": "NOT NULL"
        },
        {
          "name": "shipping_postal_code",
          "type": "VARCHAR(20)",
          "constraints": "NOT NULL"
        },
        {
          "name": "shipping_country",
          "type": "CHAR(2)",
          "constraints": "NOT NULL"
        },
        {
          "name": "payment_type",
          "type": "VARCHAR(20)",
          "constraints": "NOT NULL"
        },
        {
          "name": "payment_last_four_digits",
          "type": "CHAR(4)",
          "constraints": "NULL"
        },
        {
          "name": "payment_paypal_email",
          "type": "VARCHAR(255)",
          "constraints": "NULL"
        },
        {
          "name": "payment_transaction_id",
          "type": "VARCHAR(100)",
          "constraints": "NULL"
        },
        {
          "name": "subtotal_amount",
          "type": "DECIMAL(12,2)",
          "constraints": "NOT NULL"
        },
        {
          "name": "subtotal_currency",
          "type": "CHAR(3)",
          "constraints": "NOT NULL",
          "default": "'USD'"
        },
        {
          "name": "shipping_cost_amount",
          "type": "DECIMAL(10,2)",
          "constraints": "NOT NULL"
        },
        {
          "name": "shipping_cost_currency",
          "type": "CHAR(3)",
          "constraints": "NOT NULL",
          "default": "'USD'"
        },
        {
          "name": "tax_amount",
          "type": "DECIMAL(10,2)",
          "constraints": "NOT NULL",
          "default": "0.00"
        },
        {
          "name": "tax_currency",
          "type": "CHAR(3)",
          "constraints": "NOT NULL",
          "default": "'USD'"
        },
        {
          "name": "total_amount",
          "type": "DECIMAL(12,2)",
          "constraints": "NOT NULL"
        },
        {
          "name": "total_currency",
          "type": "CHAR(3)",
          "constraints": "NOT NULL",
          "default": "'USD'"
        },
        {
          "name": "tracking_number",
          "type": "VARCHAR(100)",
          "constraints": "NULL"
        },
        {
          "name": "cancellation_reason",
          "type": "VARCHAR(500)",
          "constraints": "NULL"
        },
        {
          "name": "version",
          "type": "INTEGER",
          "constraints": "NOT NULL",
          "default": "1"
        },
        {
          "name": "created_at",
          "type": "TIMESTAMP",
          "constraints": "NOT NULL",
          "default": "NOW()"
        },
        {
          "name": "updated_at",
          "type": "TIMESTAMP",
          "constraints": "NOT NULL",
          "default": "NOW()"
        }
      ],
      "primaryKey": {
        "columns": [
          "id"
        ]
      },
      "indexes": [
        {
          "name": "idx_orders_order_number",
          "columns": [
            "order_number"
          ]
        },
        {
          "name": "idx_orders_customer",
          "columns": [
            "customer_id"
          ]
        },
        {
          "name": "idx_orders_status",
          "columns": [
            "status"
          ]
        },
        {
          "name": "idx_orders_created",
          "columns": [
            "created_at"
          ]
        }
      ],
      "foreignKeys": [
        {
          "columns": [
            "customer_id"
          ],
          "references": "customers(id)",
          "onDelete": "RESTRICT"
        }
      ],
      "checkConstraints": [
        {
          "name": "chk_order_status",
          "expression": "status IN ('pending', 'confirmed', 'shipped', 'delivered', 'cancelled')"
        },
        {
          "name": "chk_order_amounts",
          "expression": "total_amount \u003e= 0 AND subtotal_amount \u003e= 0 AND shipping_cost_amount \u003e= 0 AND tax_amount \u003e= 0"
        },
        {
          "name": "chk_order_payment_type",
          "expression": "payment_type IN ('credit_card', 'paypal')"
        }
      ]
    },
    {
      "id": "TBL-ORDER-002",
      "name": "order_line_items",
      "aggregate": "Order",
      "purpose": "Stores immutable order line item snapshots",
      "fields": [
        {
          "name": "id",
          "type": "UUID",
          "constraints": "NOT NULL",
          "default": "gen_random_uuid()"
        },
        {
          "name": "order_id",
          "type": "UUID",
          "constraints": "NOT NULL"
        },
        {
          "name": "product_id",
          "type": "UUID",
          "constraints": "NOT NULL"
        },
        {
          "name": "variant_id",
          "type": "UUID",
          "constraints": "NULL"
        },
        {
          "name": "product_name",
          "type": "VARCHAR(200)",
          "constraints": "NOT NULL"
        },
        {
          "name": "sku",
          "type": "VARCHAR(50)",
          "constraints": "NULL"
        },
        {
          "name": "unit_price_amount",
          "type": "DECIMAL(10,2)",
          "constraints": "NOT NULL"
        },
        {
          "name": "unit_price_currency",
          "type": "CHAR(3)",
          "constraints": "NOT NULL",
          "default": "'USD'"
        },
        {
          "name": "quantity",
          "type": "INTEGER",
          "constraints": "NOT NULL"
        },
        {
          "name": "subtotal_amount",
          "type": "DECIMAL(12,2)",
          "constraints": "NOT NULL"
        },
        {
          "name": "subtotal_currency",
          "type": "CHAR(3)",
          "constraints": "NOT NULL",
          "default": "'USD'"
        },
        {
          "name": "created_at",
          "type": "TIMESTAMP",
          "constraints": "NOT NULL",
          "default": "NOW()"
        }
      ],
      "primaryKey": {
        "columns": [
          "id"
        ]
      },
      "indexes": [
        {
          "name": "idx_order_line_items_order",
          "columns": [
            "order_id"
          ]
        },
        {
          "name": "idx_order_line_items_product",
          "columns": [
            "product_id"
          ]
        }
      ],
      "foreignKeys": [
        {
          "columns": [
            "order_id"
          ],
          "references": "orders(id)",
          "onDelete": "CASCADE"
        },
        {
          "columns": [
            "product_id"
          ],
          "references": "products(id)",
          "onDelete": "RESTRICT"
        }
      ],
      "checkConstraints": [
        {
          "name": "chk_order_line_item_quantity",
          "expression": "quantity \u003e 0"
        },
        {
          "name": "chk_order_line_item_price",
          "expression": "unit_price_amount \u003e= 0 AND subtotal_amount \u003e= 0"
        }
      ]
    },
    {
      "id": "TBL-PRODUCT-001",
      "name": "products",
      "aggregate": "Product",
      "purpose": "Stores product catalog information",
      "fields": [
        {
          "name": "id",
          "type": "UUID",
          "constraints": "NOT NULL",
          "default": "gen_random_uuid()"
        },
        {
          "name": "name",
          "type": "VARCHAR(200)",
          "constraints": "NOT NULL"
        },
        {
          "name": "description",
          "type": "TEXT",
          "constraints": "NULL"
        },
        {
          "name": "price_amount",
          "type": "DECIMAL(10,2)",
          "constraints": "NOT NULL"
        },
        {
          "name": "price_currency",
          "type": "CHAR(3)",
          "constraints": "NOT NULL",
          "default": "'USD'"
        },
        {
          "name": "category_id",
          "type": "UUID",
          "constraints": "NOT NULL"
        },
        {
          "name": "is_active",
          "type": "BOOLEAN",
          "constraints": "NOT NULL",
          "default": "true"
        },
        {
          "name": "is_deleted",
          "type": "BOOLEAN",
          "constraints": "NOT NULL",
          "default": "false"
        },
        {
          "name": "status",
          "type": "VARCHAR(20)",
          "constraints": "NOT NULL",
          "default": "'draft'"
        },
        {
          "name": "created_by",
          "type": "UUID",
          "constraints": "NULL"
        },
        {
          "name": "updated_by",
          "type": "UUID",
          "constraints": "NULL"
        },
        {
          "name": "version",
          "type": "INTEGER",
          "constraints": "NOT NULL",
          "default": "1"
        },
        {
          "name": "created_at",
          "type": "TIMESTAMP",
          "constraints": "NOT NULL",
          "default": "NOW()"
        },
        {
          "name": "updated_at",
          "type": "TIMESTAMP",
          "constraints": "NOT NULL",
          "default": "NOW()"
        }
      ],
      "primaryKey": {
        "columns": [
          "id"
        ]
      },
      "indexes": [
        {
          "name": "idx_products_category",
          "columns": [
            "category_id"
          ]
        },
        {
          "name": "idx_products_status",
          "columns": [
            "status"
          ]
        },
        {
          "name": "idx_products_is_active",
          "columns": [
            "is_active"
          ]
        },
        {
          "name": "idx_products_name",
          "columns": [
            "name"
          ]
        }
      ],
      "foreignKeys": [
        {
          "columns": [
            "category_id"
          ],
          "references": "categories(id)",
          "onDelete": "RESTRICT"
        }
      ],
      "checkConstraints": [
        {
          "name": "chk_product_price",
          "expression": "price_amount \u003e= 0.01"
        },
        {
          "name": "chk_product_name_length",
          "expression": "LENGTH(name) \u003e= 2 AND LENGTH(name) \u003c= 200"
        },
        {
          "name": "chk_product_status",
          "expression": "status IN ('draft', 'active', 'inactive', 'archived')"
        }
      ]
    },
    {
      "id": "TBL-PRODUCT-002",
      "name": "product_variants",
      "aggregate": "Product",
      "purpose": "Stores product variant combinations (size, color)",
      "fields": [
        {
          "name": "id",
          "type": "UUID",
          "constraints": "NOT NULL",
          "default": "gen_random_uuid()"
        },
        {
          "name": "product_id",
          "type": "UUID",
          "constraints": "NOT NULL"
        },
        {
          "name": "sku",
          "type": "VARCHAR(50)",
          "constraints": "NOT NULL UNIQUE"
        },
        {
          "name": "size",
          "type": "VARCHAR(20)",
          "constraints": "NULL"
        },
        {
          "name": "color",
          "type": "VARCHAR(50)",
          "constraints": "NULL"
        },
        {
          "name": "price_adjustment_amount",
          "type": "DECIMAL(10,2)",
          "constraints": "NOT NULL",
          "default": "0.00"
        },
        {
          "name": "price_adjustment_currency",
          "type": "CHAR(3)",
          "constraints": "NOT NULL",
          "default": "'USD'"
        },
        {
          "name": "created_at",
          "type": "TIMESTAMP",
          "constraints": "NOT NULL",
          "default": "NOW()"
        },
        {
          "name": "updated_at",
          "type": "TIMESTAMP",
          "constraints": "NOT NULL",
          "default": "NOW()"
        }
      ],
      "primaryKey": {
        "columns": [
          "id"
        ]
      },
      "indexes": [
        {
          "name": "idx_product_variants_product",
          "columns": [
            "product_id"
          ]
        },
        {
          "name": "idx_product_variants_sku",
          "columns": [
            "sku"
          ]
        },
        {
          "name": "idx_product_variants_combination",
          "columns": [
            "product_id",
            "size",
            "color"
          ]
        }
      ],
      "foreignKeys": [
        {
          "columns": [
            "product_id"
          ],
          "references": "products(id)",
          "onDelete": "CASCADE"
        }
      ],
      "checkConstraints": [
        {
          "name": "chk_variant_has_attribute",
          "expression": "size IS NOT NULL OR color IS NOT NULL"
        }
      ]
    },
    {
      "id": "TBL-PRODUCT-003",
      "name": "product_images",
      "aggregate": "Product",
      "purpose": "Stores product image URLs and display order",
      "fields": [
        {
          "name": "id",
          "type": "UUID",
          "constraints": "NOT NULL",
          "default": "gen_random_uuid()"
        },
        {
          "name": "product_id",
          "type": "UUID",
          "constraints": "NOT NULL"
        },
        {
          "name": "image_url",
          "type": "VARCHAR(500)",
          "constraints": "NOT NULL"
        },
        {
          "name": "display_order",
          "type": "INTEGER",
          "constraints": "NOT NULL",
          "default": "0"
        },
        {
          "name": "is_primary",
          "type": "BOOLEAN",
          "constraints": "NOT NULL",
          "default": "false"
        },
        {
          "name": "created_at",
          "type": "TIMESTAMP",
          "constraints": "NOT NULL",
          "default": "NOW()"
        }
      ],
      "primaryKey": {
        "columns": [
          "id"
        ]
      },
      "indexes": [
        {
          "name": "idx_product_images_product",
          "columns": [
            "product_id"
          ]
        },
        {
          "name": "idx_product_images_primary",
          "columns": [
            "product_id",
            "is_primary"
          ]
        }
      ],
      "foreignKeys": [
        {
          "columns": [
            "product_id"
          ],
          "references": "products(id)",
          "onDelete": "CASCADE"
        }
      ],
      "checkConstraints": [
        {
          "name": "chk_image_display_order",
          "expression": "display_order \u003e= 0"
        }
      ]
    },
    {
      "id": "TBL-INVENTORY-001",
      "name": "inventory",
      "aggregate": "Inventory",
      "purpose": "Tracks product stock levels and reservations",
      "fields": [
        {
          "name": "id",
          "type": "UUID",
          "constraints": "NOT NULL",
          "default": "gen_random_uuid()"
        },
        {
          "name": "product_id",
          "type": "UUID",
          "constraints": "NOT NULL UNIQUE"
        },
        {
          "name": "stock_level",
          "type": "INTEGER",
          "constraints": "NOT NULL",
          "default": "0"
        },
        {
          "name": "reserved_quantity",
          "type": "INTEGER",
          "constraints": "NOT NULL",
          "default": "0"
        },
        {
          "name": "low_stock_threshold",
          "type": "INTEGER",
          "constraints": "NOT NULL",
          "default": "10"
        },
        {
          "name": "version",
          "type": "INTEGER",
          "constraints": "NOT NULL",
          "default": "1"
        },
        {
          "name": "created_at",
          "type": "TIMESTAMP",
          "constraints": "NOT NULL",
          "default": "NOW()"
        },
        {
          "name": "updated_at",
          "type": "TIMESTAMP",
          "constraints": "NOT NULL",
          "default": "NOW()"
        }
      ],
      "primaryKey": {
        "columns": [
          "id"
        ]
      },
      "indexes": [
        {
          "name": "idx_inventory_product",
          "columns": [
            "product_id"
          ]
        },
        {
          "name": "idx_inventory_low_stock",
          "columns": [
            "stock_level",
            "low_stock_threshold"
          ]
        }
      ],
      "foreignKeys": [
        {
          "columns": [
            "product_id"
          ],
          "references": "products(id)",
          "onDelete": "CASCADE"
        }
      ],
      "checkConstraints": [
        {
          "name": "chk_inventory_stock_level",
          "expression": "stock_level \u003e= 0"
        },
        {
          "name": "chk_inventory_reserved",
          "expression": "reserved_quantity \u003e= 0 AND reserved_quantity \u003c= stock_level"
        },
        {
          "name": "chk_inventory_threshold",
          "expression": "low_stock_threshold \u003e= 0"
        }
      ]
    },
    {
      "id": "TBL-INVENTORY-002",
      "name": "inventory_audit_logs",
      "aggregate": "Inventory",
      "purpose": "Immutable audit trail of inventory changes",
      "fields": [
        {
          "name": "id",
          "type": "UUID",
          "constraints": "NOT NULL",
          "default": "gen_random_uuid()"
        },
        {
          "name": "inventory_id",
          "type": "UUID",
          "constraints": "NOT NULL"
        },
        {
          "name": "product_id",
          "type": "UUID",
          "constraints": "NOT NULL"
        },
        {
          "name": "change_type",
          "type": "VARCHAR(30)",
          "constraints": "NOT NULL"
        },
        {
          "name": "previous_stock_level",
          "type": "INTEGER",
          "constraints": "NOT NULL"
        },
        {
          "name": "new_stock_level",
          "type": "INTEGER",
          "constraints": "NOT NULL"
        },
        {
          "name": "previous_reserved",
          "type": "INTEGER",
          "constraints": "NOT NULL"
        },
        {
          "name": "new_reserved",
          "type": "INTEGER",
          "constraints": "NOT NULL"
        },
        {
          "name": "quantity_changed",
          "type": "INTEGER",
          "constraints": "NOT NULL"
        },
        {
          "name": "reason",
          "type": "VARCHAR(500)",
          "constraints": "NULL"
        },
        {
          "name": "order_id",
          "type": "UUID",
          "constraints": "NULL"
        },
        {
          "name": "user_id",
          "type": "UUID",
          "constraints": "NULL"
        },
        {
          "name": "created_at",
          "type": "TIMESTAMP",
          "constraints": "NOT NULL",
          "default": "NOW()"
        }
      ],
      "primaryKey": {
        "columns": [
          "id"
        ]
      },
      "indexes": [
        {
          "name": "idx_inventory_audit_inventory",
          "columns": [
            "inventory_id"
          ]
        },
        {
          "name": "idx_inventory_audit_product",
          "columns": [
            "product_id"
          ]
        },
        {
          "name": "idx_inventory_audit_created",
          "columns": [
            "created_at"
          ]
        },
        {
          "name": "idx_inventory_audit_order",
          "columns": [
            "order_id"
          ]
        }
      ],
      "foreignKeys": [
        {
          "columns": [
            "inventory_id"
          ],
          "references": "inventory(id)",
          "onDelete": "CASCADE"
        },
        {
          "columns": [
            "product_id"
          ],
          "references": "products(id)",
          "onDelete": "RESTRICT"
        },
        {
          "columns": [
            "order_id"
          ],
          "references": "orders(id)",
          "onDelete": "SET NULL"
        }
      ],
      "checkConstraints": [
        {
          "name": "chk_audit_change_type",
          "expression": "change_type IN ('set', 'adjust', 'reserve', 'release', 'deduct', 'restock')"
        }
      ]
    },
    {
      "id": "TBL-CATEGORY-001",
      "name": "categories",
      "aggregate": "Category",
      "purpose": "Organizes products into hierarchical browsing structure",
      "fields": [
        {
          "name": "id",
          "type": "UUID",
          "constraints": "NOT NULL",
          "default": "gen_random_uuid()"
        },
        {
          "name": "name",
          "type": "VARCHAR(100)",
          "constraints": "NOT NULL UNIQUE"
        },
        {
          "name": "description",
          "type": "TEXT",
          "constraints": "NULL"
        },
        {
          "name": "parent_category_id",
          "type": "UUID",
          "constraints": "NULL"
        },
        {
          "name": "depth",
          "type": "INTEGER",
          "constraints": "NOT NULL",
          "default": "0"
        },
        {
          "name": "display_order",
          "type": "INTEGER",
          "constraints": "NOT NULL",
          "default": "0"
        },
        {
          "name": "is_active",
          "type": "BOOLEAN",
          "constraints": "NOT NULL",
          "default": "true"
        },
        {
          "name": "version",
          "type": "INTEGER",
          "constraints": "NOT NULL",
          "default": "1"
        },
        {
          "name": "created_at",
          "type": "TIMESTAMP",
          "constraints": "NOT NULL",
          "default": "NOW()"
        },
        {
          "name": "updated_at",
          "type": "TIMESTAMP",
          "constraints": "NOT NULL",
          "default": "NOW()"
        }
      ],
      "primaryKey": {
        "columns": [
          "id"
        ]
      },
      "indexes": [
        {
          "name": "idx_categories_name",
          "columns": [
            "name"
          ]
        },
        {
          "name": "idx_categories_parent",
          "columns": [
            "parent_category_id"
          ]
        },
        {
          "name": "idx_categories_display_order",
          "columns": [
            "display_order"
          ]
        }
      ],
      "foreignKeys": [
        {
          "columns": [
            "parent_category_id"
          ],
          "references": "categories(id)",
          "onDelete": "RESTRICT"
        }
      ],
      "checkConstraints": [
        {
          "name": "chk_category_name_length",
          "expression": "LENGTH(name) \u003e= 1 AND LENGTH(name) \u003c= 100"
        },
        {
          "name": "chk_category_depth",
          "expression": "depth \u003e= 0 AND depth \u003c= 3"
        },
        {
          "name": "chk_category_not_self_parent",
          "expression": "parent_category_id IS NULL OR parent_category_id != id"
        }
      ]
    }
  ],
  "tech_specs": [
    {
      "id": "TS-BR-CUST-001",
      "name": "Password validation requirements",
      "br_ref": "BR-CUST-001",
      "rule": "Password must be at least 8 characters and contain at least one number",
      "implementation": "Validate password against regex pattern on registration and password change endpoints. Pattern: ^(?=.*[0-9]).{8,}$",
      "validation_points": [
        "Registration API",
        "Password change API",
        "Registration UI",
        "Password change UI"
      ],
      "data_requirements": [
        {
          "field": "password",
          "type": "string",
          "constraints": "min_length: 8, pattern: contains at least one digit [0-9]",
          "source": "BR-CUST-001"
        }
      ],
      "error_handling": [
        {
          "condition": "password.length \u003c 8",
          "error_code": "PASSWORD_TOO_SHORT",
          "message": "Password must be at least 8 characters",
          "http_status": 400
        },
        {
          "condition": "!password.matches(/[0-9]/)",
          "error_code": "PASSWORD_MISSING_NUMBER",
          "message": "Password must contain at least one number",
          "http_status": 400
        }
      ],
      "related_acs": []
    },
    {
      "id": "TS-BR-CUST-002",
      "name": "Email uniqueness constraint",
      "br_ref": "BR-CUST-002",
      "rule": "Each email address can only be associated with one customer account",
      "implementation": "Enforce unique constraint on email column in customers table. Check for existing email before insert on registration endpoint.",
      "validation_points": [
        "Registration API",
        "Email update API",
        "Database constraint"
      ],
      "data_requirements": [
        {
          "field": "email",
          "type": "string",
          "constraints": "unique, valid email format, max_length: 255, case_insensitive comparison",
          "source": "BR-CUST-002"
        }
      ],
      "error_handling": [
        {
          "condition": "email already exists in database",
          "error_code": "EMAIL_ALREADY_REGISTERED",
          "message": "This email address is already associated with an account",
          "http_status": 409
        }
      ],
      "related_acs": []
    }
  ],
  "test_cases": [
    {
      "id": "TC-AC-CUST-001-P01",
      "name": "Valid registration with all required fields",
      "category": "positive",
      "ac_ref": "AC-CUST-001",
      "br_refs": [
        "BR-CUST-001"
      ],
      "preconditions": [
        "Email john@example.com not registered"
      ],
      "test_data": [
        {
          "field": "email",
          "value": "john@example.com",
          "notes": "Valid email"
        },
        {
          "field": "password",
          "value": "SecurePass1",
          "notes": "Valid password"
        },
        {
          "field": "firstName",
          "value": "John",
          "notes": "Required field"
        },
        {
          "field": "lastName",
          "value": "Doe",
          "notes": "Required field"
        }
      ],
      "steps": [
        "Navigate to registration page",
        "Enter email, password, first name, last name",
        "Submit registration form"
      ],
      "expected_results": [
        "Account created with status 'unverified'",
        "Verification email sent to john@example.com"
      ]
    },
    {
      "id": "TC-AC-CUST-001-P02",
      "name": "Valid registration with different valid email",
      "category": "positive",
      "ac_ref": "AC-CUST-001",
      "br_refs": [
        "BR-CUST-001"
      ],
      "preconditions": [
        "Email jane.doe@company.org not registered"
      ],
      "test_data": [
        {
          "field": "email",
          "value": "jane.doe@company.org",
          "notes": "Valid email"
        },
        {
          "field": "password",
          "value": "MyPass123",
          "notes": "Valid password"
        },
        {
          "field": "firstName",
          "value": "Jane",
          "notes": "Required field"
        },
        {
          "field": "lastName",
          "value": "Smith",
          "notes": "Required field"
        }
      ],
      "steps": [
        "Navigate to registration page",
        "Enter all required fields",
        "Submit registration form"
      ],
      "expected_results": [
        "Account created with status 'unverified'",
        "Verification email sent to jane.doe@company.org"
      ]
    },
    {
      "id": "TC-AC-CUST-001-P03",
      "name": "Valid registration with complex password",
      "category": "positive",
      "ac_ref": "AC-CUST-001",
      "br_refs": [
        "BR-CUST-001"
      ],
      "preconditions": [
        "Email test.user@domain.com not registered"
      ],
      "test_data": [
        {
          "field": "email",
          "value": "test.user@domain.com",
          "notes": "Valid email"
        },
        {
          "field": "password",
          "value": "C0mpl3x!Pass#2024",
          "notes": "Strong password"
        },
        {
          "field": "firstName",
          "value": "Test",
          "notes": "Required field"
        },
        {
          "field": "lastName",
          "value": "User",
          "notes": "Required field"
        }
      ],
      "steps": [
        "Navigate to registration page",
        "Enter all required fields with complex password",
        "Submit registration form"
      ],
      "expected_results": [
        "Account created with status 'unverified'",
        "Verification email sent"
      ]
    },
    {
      "id": "TC-AC-CUST-001-N01",
      "name": "Reject duplicate email",
      "category": "negative",
      "ac_ref": "AC-CUST-001",
      "br_refs": [
        "BR-CUST-001"
      ],
      "preconditions": [
        "Email exists@example.com already registered"
      ],
      "test_data": [
        {
          "field": "email",
          "value": "exists@example.com",
          "notes": "Duplicate"
        },
        {
          "field": "password",
          "value": "SecurePass1",
          "notes": "Valid password"
        },
        {
          "field": "firstName",
          "value": "John",
          "notes": "Required field"
        },
        {
          "field": "lastName",
          "value": "Doe",
          "notes": "Required field"
        }
      ],
      "steps": [
        "Navigate to registration page",
        "Enter existing email with valid data",
        "Submit registration form"
      ],
      "expected_results": [
        "DUPLICATE_EMAIL error returned",
        "Suggest login or password reset"
      ]
    },
    {
      "id": "TC-AC-CUST-001-N02",
      "name": "Reject password less than 8 characters",
      "category": "negative",
      "ac_ref": "AC-CUST-001",
      "br_refs": [
        "BR-CUST-001"
      ],
      "preconditions": [
        "Email new@example.com not registered"
      ],
      "test_data": [
        {
          "field": "email",
          "value": "new@example.com",
          "notes": "Valid email"
        },
        {
          "field": "password",
          "value": "Pass1",
          "notes": "Only 5 chars"
        },
        {
          "field": "firstName",
          "value": "John",
          "notes": "Required field"
        },
        {
          "field": "lastName",
          "value": "Doe",
          "notes": "Required field"
        }
      ],
      "steps": [
        "Navigate to registration page",
        "Enter password with less than 8 characters",
        "Submit registration form"
      ],
      "expected_results": [
        "INVALID_PASSWORD error returned",
        "Requirements message displayed"
      ]
    },
    {
      "id": "TC-AC-CUST-001-N03",
      "name": "Reject password without number",
      "category": "negative",
      "ac_ref": "AC-CUST-001",
      "br_refs": [
        "BR-CUST-001"
      ],
      "preconditions": [
        "Email new2@example.com not registered"
      ],
      "test_data": [
        {
          "field": "email",
          "value": "new2@example.com",
          "notes": "Valid email"
        },
        {
          "field": "password",
          "value": "SecurePass",
          "notes": "No number"
        },
        {
          "field": "firstName",
          "value": "John",
          "notes": "Required field"
        },
        {
          "field": "lastName",
          "value": "Doe",
          "notes": "Required field"
        }
      ],
      "steps": [
        "Navigate to registration page",
        "Enter password without any number",
        "Submit registration form"
      ],
      "expected_results": [
        "INVALID_PASSWORD error returned",
        "Requirements message displayed"
      ]
    },
    {
      "id": "TC-AC-CUST-001-N04",
      "name": "Reject invalid email format",
      "category": "negative",
      "ac_ref": "AC-CUST-001",
      "br_refs": [
        "BR-CUST-001"
      ],
      "preconditions": [
        "User on registration page"
      ],
      "test_data": [
        {
          "field": "email",
          "value": "invalid-email",
          "notes": "Missing @ and domain"
        },
        {
          "field": "password",
          "value": "SecurePass1",
          "notes": "Valid password"
        },
        {
          "field": "firstName",
          "value": "John",
          "notes": "Required field"
        },
        {
          "field": "lastName",
          "value": "Doe",
          "notes": "Required field"
        }
      ],
      "steps": [
        "Navigate to registration page",
        "Enter invalid email format",
        "Submit registration form"
      ],
      "expected_results": [
        "INVALID_EMAIL error returned"
      ]
    },
    {
      "id": "TC-AC-CUST-001-N05",
      "name": "Reject email without domain",
      "category": "negative",
      "ac_ref": "AC-CUST-001",
      "br_refs": [
        "BR-CUST-001"
      ],
      "preconditions": [
        "User on registration page"
      ],
      "test_data": [
        {
          "field": "email",
          "value": "john@",
          "notes": "Missing domain"
        },
        {
          "field": "password",
          "value": "SecurePass1",
          "notes": "Valid password"
        },
        {
          "field": "firstName",
          "value": "John",
          "notes": "Required field"
        },
        {
          "field": "lastName",
          "value": "Doe",
          "notes": "Required field"
        }
      ],
      "steps": [
        "Navigate to registration page",
        "Enter email without domain",
        "Submit registration form"
      ],
      "expected_results": [
        "INVALID_EMAIL error returned"
      ]
    },
    {
      "id": "TC-AC-CUST-001-B01",
      "name": "Password at minimum length (8 chars)",
      "category": "boundary",
      "ac_ref": "AC-CUST-001",
      "br_refs": [
        "BR-CUST-001"
      ],
      "preconditions": [
        "Email boundary1@example.com not registered"
      ],
      "test_data": [
        {
          "field": "email",
          "value": "boundary1@example.com",
          "notes": "Valid"
        },
        {
          "field": "password",
          "value": "Secure1!",
          "notes": "Exactly 8 chars"
        },
        {
          "field": "firstName",
          "value": "Test",
          "notes": "Required field"
        },
        {
          "field": "lastName",
          "value": "User",
          "notes": "Required field"
        }
      ],
      "steps": [
        "Navigate to registration page",
        "Enter password with exactly 8 characters",
        "Submit registration form"
      ],
      "expected_results": [
        "Registration succeeds",
        "Account created with status 'unverified'"
      ]
    },
    {
      "id": "TC-AC-CUST-001-B02",
      "name": "Password at 7 chars (below minimum)",
      "category": "boundary",
      "ac_ref": "AC-CUST-001",
      "br_refs": [
        "BR-CUST-001"
      ],
      "preconditions": [
        "Email boundary2@example.com not registered"
      ],
      "test_data": [
        {
          "field": "email",
          "value": "boundary2@example.com",
          "notes": "Valid"
        },
        {
          "field": "password",
          "value": "Secur1!",
          "notes": "Only 7 chars"
        },
        {
          "field": "firstName",
          "value": "Test",
          "notes": "Required field"
        },
        {
          "field": "lastName",
          "value": "User",
          "notes": "Required field"
        }
      ],
      "steps": [
        "Navigate to registration page",
        "Enter password with 7 characters",
        "Submit registration form"
      ],
      "expected_results": [
        "INVALID_PASSWORD error returned",
        "Requirements message displayed"
      ]
    },
    {
      "id": "TC-AC-CUST-001-H01",
      "name": "Phone number should NOT be required",
      "category": "hallucination",
      "ac_ref": "AC-CUST-001",
      "br_refs": [],
      "preconditions": [
        "Email hal1@example.com not registered"
      ],
      "test_data": [
        {
          "field": "email",
          "value": "hal1@example.com",
          "notes": "Valid email"
        },
        {
          "field": "password",
          "value": "SecurePass1",
          "notes": "Valid password"
        },
        {
          "field": "firstName",
          "value": "John",
          "notes": "Required field"
        },
        {
          "field": "lastName",
          "value": "Doe",
          "notes": "Required field"
        },
        {
          "field": "phone",
          "value": "",
          "notes": "Empty - not in AC"
        }
      ],
      "steps": [
        "Navigate to registration page",
        "Fill only email, password, firstName, lastName",
        "Submit without phone number"
      ],
      "expected_results": [
        "Registration succeeds without phone"
      ],
      "should_not": "Require phone number (not specified in AC)"
    },
    {
      "id": "TC-AC-CUST-001-H02",
      "name": "Address should NOT be required",
      "category": "hallucination",
      "ac_ref": "AC-CUST-001",
      "br_refs": [],
      "preconditions": [
        "Email hal2@example.com not registered"
      ],
      "test_data": [
        {
          "field": "email",
          "value": "hal2@example.com",
          "notes": "Valid email"
        },
        {
          "field": "password",
          "value": "SecurePass1",
          "notes": "Valid password"
        },
        {
          "field": "firstName",
          "value": "John",
          "notes": "Required field"
        },
        {
          "field": "lastName",
          "value": "Doe",
          "notes": "Required field"
        },
        {
          "field": "address",
          "value": "",
          "notes": "Empty - not in AC"
        }
      ],
      "steps": [
        "Navigate to registration page",
        "Fill only required fields per AC",
        "Submit without address"
      ],
      "expected_results": [
        "Registration succeeds without address"
      ],
      "should_not": "Require address fields (not specified in AC)"
    },
    {
      "id": "TC-AC-CUST-001-H03",
      "name": "Account should NOT be auto-verified",
      "category": "hallucination",
      "ac_ref": "AC-CUST-001",
      "br_refs": [],
      "preconditions": [
        "Email hal3@example.com not registered"
      ],
      "test_data": [
        {
          "field": "email",
          "value": "hal3@example.com",
          "notes": "Valid email"
        },
        {
          "field": "password",
          "value": "SecurePass1",
          "notes": "Valid password"
        },
        {
          "field": "firstName",
          "value": "John",
          "notes": "Required field"
        },
        {
          "field": "lastName",
          "value": "Doe",
          "notes": "Required field"
        }
      ],
      "steps": [
        "Complete valid registration",
        "Check account status immediately after"
      ],
      "expected_results": [
        "Account status is 'unverified'",
        "Not 'verified' or 'active'"
      ],
      "should_not": "Auto-verify account (AC states 'unverified')"
    }
  ]
}