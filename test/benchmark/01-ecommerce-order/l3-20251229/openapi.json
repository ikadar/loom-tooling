{
  "openapi": "3.0.0",
  "info": {
    "title": "E-Commerce Platform API",
    "version": "1.0.0"
  },
  "paths": {
    "/api/admin/categories": {
      "get": {
        "operationId": "listCategories",
        "responses": {
          "200": {
            "description": "Category tree"
          }
        },
        "summary": "List categories",
        "x-related-specs": [
          "AC-CAT-001"
        ]
      },
      "post": {
        "operationId": "createCategory",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "properties": {
                  "description": {
                    "type": "string"
                  },
                  "display_order": {
                    "type": "integer"
                  },
                  "name": {
                    "type": "string"
                  },
                  "parent_id": {
                    "format": "uuid",
                    "type": "string"
                  },
                  "status": {
                    "enum": [
                      "active",
                      "inactive"
                    ],
                    "type": "string"
                  }
                },
                "required": [
                  "name"
                ],
                "type": "object"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Category created"
          },
          "400": {
            "description": "Validation error (CATEGORY_DEPTH_EXCEEDED)"
          }
        },
        "summary": "Create category",
        "x-related-specs": [
          "TS-BR-CAT-001",
          "AC-CAT-001"
        ]
      }
    },
    "/api/admin/categories/{id}": {
      "put": {
        "operationId": "updateCategory",
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "format": "uuid",
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "properties": {
                  "description": {
                    "type": "string"
                  },
                  "display_order": {
                    "type": "integer"
                  },
                  "name": {
                    "type": "string"
                  },
                  "parent_id": {
                    "format": "uuid",
                    "type": "string"
                  },
                  "status": {
                    "enum": [
                      "active",
                      "inactive"
                    ],
                    "type": "string"
                  }
                },
                "type": "object"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Category updated"
          },
          "400": {
            "description": "Validation error (CATEGORY_DEPTH_EXCEEDED)"
          },
          "404": {
            "description": "Category not found"
          }
        },
        "summary": "Update category",
        "x-related-specs": [
          "TS-BR-CAT-001",
          "AC-CAT-001"
        ]
      }
    },
    "/api/admin/inventory/bulk": {
      "post": {
        "operationId": "bulkUpdateInventory",
        "requestBody": {
          "content": {
            "multipart/form-data": {
              "schema": {
                "properties": {
                  "file": {
                    "format": "binary",
                    "type": "string"
                  }
                },
                "required": [
                  "file"
                ],
                "type": "object"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Bulk update summary with success/error counts"
          },
          "400": {
            "description": "Invalid CSV format"
          }
        },
        "summary": "Bulk inventory update via CSV",
        "x-related-specs": [
          "TS-BR-AUDIT-002",
          "AC-ADMIN-008"
        ]
      }
    },
    "/api/admin/inventory/{id}": {
      "put": {
        "operationId": "updateInventory",
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "format": "uuid",
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "properties": {
                  "delta": {
                    "type": "integer"
                  },
                  "quantity": {
                    "minimum": 0,
                    "type": "integer"
                  },
                  "reason": {
                    "maxLength": 255,
                    "type": "string"
                  }
                },
                "type": "object"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Inventory updated"
          },
          "400": {
            "description": "Invalid stock level (INVALID_STOCK_LEVEL)"
          },
          "404": {
            "description": "Variant not found"
          }
        },
        "summary": "Update inventory",
        "x-related-specs": [
          "TS-BR-STOCK-003",
          "TS-BR-AUDIT-002",
          "AC-ADMIN-007"
        ]
      }
    },
    "/api/admin/orders": {
      "get": {
        "operationId": "adminListOrders",
        "parameters": [
          {
            "in": "query",
            "name": "status",
            "schema": {
              "enum": [
                "pending",
                "confirmed",
                "shipped",
                "delivered",
                "cancelled"
              ],
              "type": "string"
            }
          },
          {
            "in": "query",
            "name": "date_from",
            "schema": {
              "format": "date",
              "type": "string"
            }
          },
          {
            "in": "query",
            "name": "date_to",
            "schema": {
              "format": "date",
              "type": "string"
            }
          },
          {
            "in": "query",
            "name": "search",
            "schema": {
              "type": "string"
            }
          },
          {
            "in": "query",
            "name": "page",
            "schema": {
              "type": "integer"
            }
          },
          {
            "in": "query",
            "name": "page_size",
            "schema": {
              "type": "integer"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Paginated order list"
          }
        },
        "summary": "List orders with filters",
        "x-related-specs": [
          "AC-ADMIN-004"
        ]
      }
    },
    "/api/admin/orders/{id}": {
      "get": {
        "operationId": "adminGetOrder",
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "format": "uuid",
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Order details with status history"
          },
          "404": {
            "description": "Order not found"
          }
        },
        "summary": "Get order details (admin)",
        "x-related-specs": [
          "AC-ADMIN-004"
        ]
      }
    },
    "/api/admin/orders/{id}/status": {
      "put": {
        "operationId": "updateOrderStatus",
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "format": "uuid",
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "properties": {
                  "status": {
                    "enum": [
                      "confirmed",
                      "shipped",
                      "delivered"
                    ],
                    "type": "string"
                  },
                  "tracking_number": {
                    "type": "string"
                  }
                },
                "required": [
                  "status"
                ],
                "type": "object"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Status updated"
          },
          "400": {
            "description": "Invalid transition (INVALID_STATUS_TRANSITION)"
          },
          "404": {
            "description": "Order not found"
          }
        },
        "summary": "Update order status",
        "x-related-specs": [
          "TS-BR-ORDER-001",
          "TS-BR-AUDIT-001",
          "AC-ADMIN-005",
          "AC-ADMIN-006"
        ]
      }
    },
    "/api/admin/products": {
      "get": {
        "operationId": "adminListProducts",
        "parameters": [
          {
            "in": "query",
            "name": "status",
            "schema": {
              "enum": [
                "draft",
                "active",
                "deleted"
              ],
              "type": "string"
            }
          },
          {
            "in": "query",
            "name": "page",
            "schema": {
              "type": "integer"
            }
          },
          {
            "in": "query",
            "name": "page_size",
            "schema": {
              "type": "integer"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Product list"
          }
        },
        "summary": "List all products (admin)",
        "x-related-specs": [
          "AC-ADMIN-001"
        ]
      },
      "post": {
        "operationId": "createProduct",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "properties": {
                  "description": {
                    "maxLength": 5000,
                    "type": "string"
                  },
                  "images": {
                    "items": {
                      "type": "string"
                    },
                    "maxItems": 10,
                    "type": "array"
                  },
                  "name": {
                    "maxLength": 200,
                    "minLength": 2,
                    "type": "string"
                  },
                  "price": {
                    "minimum": 0.01,
                    "type": "number"
                  },
                  "primary_category_id": {
                    "format": "uuid",
                    "type": "string"
                  }
                },
                "required": [
                  "name",
                  "price",
                  "primary_category_id"
                ],
                "type": "object"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Product created with draft status"
          },
          "400": {
            "description": "Validation error (INVALID_NAME, NAME_TOO_LONG, INVALID_PRICE, CATEGORY_REQUIRED)"
          }
        },
        "summary": "Create product",
        "x-related-specs": [
          "TS-BR-PRICE-001",
          "TS-BR-PROD-002",
          "TS-BR-PROD-003",
          "AC-ADMIN-001"
        ]
      }
    },
    "/api/admin/products/{id}": {
      "delete": {
        "operationId": "deleteProduct",
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "format": "uuid",
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Product soft-deleted with impact summary"
          },
          "404": {
            "description": "Product not found"
          }
        },
        "summary": "Soft delete product",
        "x-related-specs": [
          "TS-BR-PROD-001",
          "AC-ADMIN-003"
        ]
      },
      "get": {
        "operationId": "adminGetProduct",
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "format": "uuid",
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Product details"
          },
          "404": {
            "description": "Product not found"
          }
        },
        "summary": "Get product details (admin)",
        "x-related-specs": [
          "AC-ADMIN-002"
        ]
      },
      "put": {
        "operationId": "updateProduct",
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "format": "uuid",
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "properties": {
                  "description": {
                    "maxLength": 5000,
                    "type": "string"
                  },
                  "name": {
                    "maxLength": 200,
                    "minLength": 2,
                    "type": "string"
                  },
                  "price": {
                    "minimum": 0.01,
                    "type": "number"
                  },
                  "primary_category_id": {
                    "format": "uuid",
                    "type": "string"
                  },
                  "status": {
                    "enum": [
                      "draft",
                      "active"
                    ],
                    "type": "string"
                  }
                },
                "type": "object"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Product updated"
          },
          "400": {
            "description": "Validation error"
          },
          "404": {
            "description": "Product not found"
          }
        },
        "summary": "Update product",
        "x-related-specs": [
          "TS-BR-PRICE-001",
          "TS-BR-PROD-002",
          "TS-BR-AUDIT-003",
          "AC-ADMIN-002"
        ]
      }
    },
    "/api/admin/products/{id}/variants": {
      "get": {
        "operationId": "listVariants",
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "format": "uuid",
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Variant list"
          }
        },
        "summary": "List product variants",
        "x-related-specs": [
          "AC-VAR-001"
        ]
      },
      "post": {
        "operationId": "createVariant",
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "format": "uuid",
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "properties": {
                  "attributes": {
                    "additionalProperties": {
                      "type": "string"
                    },
                    "type": "object"
                  },
                  "price_override": {
                    "minimum": 0.01,
                    "type": "number"
                  },
                  "sku": {
                    "maxLength": 50,
                    "type": "string"
                  }
                },
                "required": [
                  "sku",
                  "attributes"
                ],
                "type": "object"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Variant created"
          },
          "400": {
            "description": "Validation error"
          },
          "409": {
            "description": "Duplicate SKU (DUPLICATE_SKU)"
          }
        },
        "summary": "Add product variant",
        "x-related-specs": [
          "TS-BR-VAR-001",
          "AC-VAR-001"
        ]
      }
    },
    "/api/cart": {
      "get": {
        "operationId": "getCart",
        "responses": {
          "200": {
            "description": "Cart with items and price change notifications"
          }
        },
        "summary": "Get cart with current prices",
        "x-related-specs": [
          "TS-BR-PRICE-002",
          "AC-CART-009"
        ]
      }
    },
    "/api/cart/items": {
      "post": {
        "operationId": "addCartItem",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "properties": {
                  "product_id": {
                    "format": "uuid",
                    "type": "string"
                  },
                  "quantity": {
                    "minimum": 1,
                    "type": "integer"
                  },
                  "variant_id": {
                    "format": "uuid",
                    "type": "string"
                  }
                },
                "required": [
                  "product_id",
                  "quantity"
                ],
                "type": "object"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Item added to cart"
          },
          "400": {
            "description": "Validation error (OUT_OF_STOCK, INVALID_QUANTITY, VARIANT_REQUIRED)"
          }
        },
        "summary": "Add item to cart",
        "x-related-specs": [
          "TS-BR-STOCK-001",
          "TS-BR-CART-001",
          "TS-BR-VAR-002",
          "AC-CART-001",
          "AC-CART-002"
        ]
      }
    },
    "/api/cart/items/{id}": {
      "delete": {
        "operationId": "removeCartItem",
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "format": "uuid",
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Item removed with undo token"
          },
          "404": {
            "description": "Cart item not found"
          }
        },
        "summary": "Remove item from cart",
        "x-related-specs": [
          "AC-CART-006",
          "AC-CART-007"
        ]
      },
      "put": {
        "operationId": "updateCartItem",
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "format": "uuid",
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "properties": {
                  "quantity": {
                    "minimum": 0,
                    "type": "integer"
                  }
                },
                "required": [
                  "quantity"
                ],
                "type": "object"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Cart item updated"
          },
          "400": {
            "description": "Validation error (INVALID_QUANTITY, QUANTITY_EXCEEDS_STOCK)"
          },
          "404": {
            "description": "Cart item not found"
          }
        },
        "summary": "Update cart item quantity",
        "x-related-specs": [
          "TS-BR-CART-001",
          "AC-CART-005"
        ]
      }
    },
    "/api/cart/totals": {
      "get": {
        "operationId": "getCartTotals",
        "responses": {
          "200": {
            "description": "Cart totals including subtotal, shipping, tax"
          }
        },
        "summary": "Get cart totals with shipping calculation",
        "x-related-specs": [
          "TS-BR-SHIP-001",
          "AC-ORDER-002",
          "AC-ORDER-003"
        ]
      }
    },
    "/api/checkout/initiate": {
      "post": {
        "operationId": "initiateCheckout",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "properties": {
                  "payment_method_id": {
                    "format": "uuid",
                    "type": "string"
                  },
                  "shipping_address_id": {
                    "format": "uuid",
                    "type": "string"
                  }
                },
                "required": [
                  "shipping_address_id",
                  "payment_method_id"
                ],
                "type": "object"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Checkout session created"
          },
          "400": {
            "description": "Validation error (INSUFFICIENT_STOCK)"
          },
          "403": {
            "description": "Access denied (REGISTRATION_REQUIRED, EMAIL_NOT_VERIFIED)"
          }
        },
        "summary": "Initiate checkout process",
        "x-related-specs": [
          "TS-BR-AUTH-001",
          "TS-BR-STOCK-002",
          "AC-ORDER-001"
        ]
      }
    },
    "/api/customers/addresses": {
      "get": {
        "operationId": "getAddresses",
        "responses": {
          "200": {
            "description": "Address list"
          }
        },
        "summary": "List customer addresses",
        "x-related-specs": [
          "AC-CUST-002"
        ]
      },
      "post": {
        "operationId": "addAddress",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "properties": {
                  "city": {
                    "type": "string"
                  },
                  "country": {
                    "default": "US",
                    "type": "string"
                  },
                  "is_default": {
                    "default": false,
                    "type": "boolean"
                  },
                  "state": {
                    "type": "string"
                  },
                  "street": {
                    "type": "string"
                  },
                  "zip": {
                    "type": "string"
                  }
                },
                "required": [
                  "street",
                  "city",
                  "state",
                  "zip",
                  "country"
                ],
                "type": "object"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Address added"
          },
          "400": {
            "description": "Validation error (INVALID_ADDRESS, UNSUPPORTED_COUNTRY)"
          }
        },
        "summary": "Add shipping address",
        "x-related-specs": [
          "TS-BR-SHIP-002",
          "AC-CUST-002"
        ]
      }
    },
    "/api/customers/addresses/{id}": {
      "delete": {
        "operationId": "deleteAddress",
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "format": "uuid",
              "type": "string"
            }
          }
        ],
        "responses": {
          "204": {
            "description": "Address deleted"
          },
          "404": {
            "description": "Address not found"
          }
        },
        "summary": "Delete shipping address",
        "x-related-specs": [
          "AC-CUST-002"
        ]
      },
      "put": {
        "operationId": "updateAddress",
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "format": "uuid",
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "properties": {
                  "city": {
                    "type": "string"
                  },
                  "country": {
                    "type": "string"
                  },
                  "is_default": {
                    "type": "boolean"
                  },
                  "state": {
                    "type": "string"
                  },
                  "street": {
                    "type": "string"
                  },
                  "zip": {
                    "type": "string"
                  }
                },
                "type": "object"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Address updated"
          },
          "400": {
            "description": "Validation error"
          },
          "404": {
            "description": "Address not found"
          }
        },
        "summary": "Update shipping address",
        "x-related-specs": [
          "TS-BR-SHIP-002",
          "AC-CUST-002"
        ]
      }
    },
    "/api/customers/gdpr/erase": {
      "post": {
        "operationId": "requestDataErasure",
        "responses": {
          "200": {
            "description": "Erasure request submitted"
          },
          "401": {
            "description": "Unauthorized"
          }
        },
        "summary": "Request GDPR data erasure",
        "x-related-specs": [
          "AC-GDPR-001"
        ]
      }
    },
    "/api/customers/payment-methods": {
      "get": {
        "operationId": "getPaymentMethods",
        "responses": {
          "200": {
            "description": "Payment method list (tokenized)"
          }
        },
        "summary": "List customer payment methods",
        "x-related-specs": [
          "AC-CUST-003"
        ]
      },
      "post": {
        "operationId": "addPaymentMethod",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "properties": {
                  "is_default": {
                    "default": false,
                    "type": "boolean"
                  },
                  "payment_type": {
                    "enum": [
                      "card",
                      "paypal"
                    ],
                    "type": "string"
                  },
                  "token": {
                    "type": "string"
                  }
                },
                "required": [
                  "payment_type",
                  "token"
                ],
                "type": "object"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Payment method added"
          },
          "400": {
            "description": "Validation error (INVALID_CARD, UNSUPPORTED_CARD_TYPE)"
          }
        },
        "summary": "Add payment method",
        "x-related-specs": [
          "TS-BR-PAY-001",
          "AC-CUST-003"
        ]
      }
    },
    "/api/customers/register": {
      "post": {
        "operationId": "registerCustomer",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "properties": {
                  "email": {
                    "format": "email",
                    "type": "string"
                  },
                  "first_name": {
                    "type": "string"
                  },
                  "last_name": {
                    "type": "string"
                  },
                  "password": {
                    "minLength": 8,
                    "type": "string"
                  },
                  "phone": {
                    "type": "string"
                  }
                },
                "required": [
                  "email",
                  "password",
                  "first_name",
                  "last_name"
                ],
                "type": "object"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Customer registered, verification email sent"
          },
          "400": {
            "description": "Validation error (INVALID_EMAIL, PASSWORD_TOO_SHORT, PASSWORD_MISSING_NUMBER)"
          },
          "409": {
            "description": "Duplicate email (DUPLICATE_EMAIL)"
          }
        },
        "summary": "Register new customer",
        "x-related-specs": [
          "TS-BR-CUST-001",
          "TS-BR-CUST-002",
          "TS-BR-CUST-003",
          "AC-CUST-001"
        ]
      }
    },
    "/api/customers/verify-email": {
      "get": {
        "operationId": "verifyEmail",
        "parameters": [
          {
            "in": "query",
            "name": "token",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Email verified"
          },
          "400": {
            "description": "Invalid or expired token"
          }
        },
        "summary": "Verify customer email",
        "x-related-specs": [
          "TS-BR-CUST-003",
          "AC-CUST-001"
        ]
      }
    },
    "/api/orders": {
      "get": {
        "operationId": "getOrders",
        "parameters": [
          {
            "in": "query",
            "name": "page",
            "schema": {
              "default": 1,
              "type": "integer"
            }
          },
          {
            "in": "query",
            "name": "page_size",
            "schema": {
              "default": 20,
              "type": "integer"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Paginated order list"
          }
        },
        "summary": "Get customer order history",
        "x-related-specs": [
          "AC-ORDER-005"
        ]
      },
      "post": {
        "operationId": "createOrder",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "properties": {
                  "checkout_session_id": {
                    "type": "string"
                  },
                  "payment_method_id": {
                    "format": "uuid",
                    "type": "string"
                  },
                  "shipping_address_id": {
                    "format": "uuid",
                    "type": "string"
                  }
                },
                "required": [
                  "checkout_session_id",
                  "shipping_address_id",
                  "payment_method_id"
                ],
                "type": "object"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Order created successfully"
          },
          "400": {
            "description": "Validation error (INSUFFICIENT_STOCK, ADDRESS_VALIDATION_ERROR)"
          },
          "402": {
            "description": "Payment failed (PAYMENT_FAILED)"
          },
          "403": {
            "description": "Access denied (REGISTRATION_REQUIRED, EMAIL_NOT_VERIFIED)"
          }
        },
        "summary": "Place order",
        "x-related-specs": [
          "TS-BR-AUTH-001",
          "TS-BR-STOCK-002",
          "TS-BR-PAY-002",
          "TS-BR-ORDER-004",
          "TS-BR-INV-002",
          "AC-ORDER-001"
        ]
      }
    },
    "/api/orders/{id}": {
      "get": {
        "operationId": "getOrder",
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "format": "uuid",
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Order details"
          },
          "404": {
            "description": "Order not found"
          }
        },
        "summary": "Get order details",
        "x-related-specs": [
          "AC-ORDER-005"
        ]
      }
    },
    "/api/orders/{id}/cancel": {
      "post": {
        "operationId": "cancelOrder",
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "format": "uuid",
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "properties": {
                  "reason": {
                    "maxLength": 500,
                    "type": "string"
                  }
                },
                "type": "object"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Order cancelled"
          },
          "400": {
            "description": "Cancellation not allowed (CANCELLATION_NOT_ALLOWED)"
          }
        },
        "summary": "Cancel order",
        "x-related-specs": [
          "TS-BR-CANCEL-001",
          "TS-BR-INV-001",
          "AC-ORDER-006"
        ]
      }
    },
    "/api/products": {
      "get": {
        "operationId": "listProducts",
        "parameters": [
          {
            "in": "query",
            "name": "category",
            "schema": {
              "type": "string"
            }
          },
          {
            "in": "query",
            "name": "price_min",
            "schema": {
              "type": "number"
            }
          },
          {
            "in": "query",
            "name": "price_max",
            "schema": {
              "type": "number"
            }
          },
          {
            "in": "query",
            "name": "availability",
            "schema": {
              "enum": [
                "in_stock",
                "all"
              ],
              "type": "string"
            }
          },
          {
            "in": "query",
            "name": "sort_by",
            "schema": {
              "enum": [
                "name",
                "price_asc",
                "price_desc",
                "newest"
              ],
              "type": "string"
            }
          },
          {
            "in": "query",
            "name": "page",
            "schema": {
              "default": 1,
              "type": "integer"
            }
          },
          {
            "in": "query",
            "name": "page_size",
            "schema": {
              "default": 20,
              "type": "integer"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Product list with pagination"
          },
          "400": {
            "description": "Invalid filter parameters"
          }
        },
        "summary": "List products with filtering and sorting",
        "x-related-specs": [
          "AC-PROD-001"
        ]
      }
    },
    "/api/products/{id}": {
      "get": {
        "operationId": "getProduct",
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "format": "uuid",
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Product details with stock status"
          },
          "404": {
            "description": "Product not found"
          }
        },
        "summary": "Get product details",
        "x-related-specs": [
          "AC-PROD-002",
          "TS-BR-STOCK-001"
        ]
      }
    }
  }
}