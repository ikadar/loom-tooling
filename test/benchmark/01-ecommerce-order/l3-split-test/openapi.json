{
  "openapi": "3.0.0",
  "info": {
    "description": "API for e-commerce platform with customer management, products, cart, orders, and inventory",
    "title": "E-Commerce API",
    "version": "1.0.0"
  },
  "paths": {
    "/api/v1/addresses": {
      "get": {
        "operationId": "listAddresses",
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "items": {
                    "$ref": "#/components/schemas/ShippingAddress"
                  },
                  "type": "array"
                }
              }
            },
            "description": "List of addresses"
          }
        },
        "summary": "List customer addresses",
        "x-related-specs": []
      },
      "post": {
        "operationId": "createAddress",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/ShippingAddressInput"
              }
            }
          },
          "required": true
        },
        "responses": {
          "201": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ShippingAddress"
                }
              }
            },
            "description": "Address created successfully"
          },
          "400": {
            "content": {
              "application/json": {
                "examples": {
                  "incompleteAddress": {
                    "value": {
                      "code": "INCOMPLETE_ADDRESS",
                      "message": "Please provide all required address fields: name, street, city, state, postal code, and country"
                    }
                  },
                  "internationalShipping": {
                    "value": {
                      "code": "INTERNATIONAL_SHIPPING_NOT_AVAILABLE",
                      "message": "We currently only ship within US. International shipping is not available."
                    }
                  }
                },
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            },
            "description": "Validation error"
          }
        },
        "summary": "Create shipping address",
        "x-related-specs": [
          "TS-BR-ADDR-001",
          "TS-BR-SHIP-002"
        ]
      }
    },
    "/api/v1/addresses/{addressId}": {
      "delete": {
        "operationId": "deleteAddress",
        "parameters": [
          {
            "in": "path",
            "name": "addressId",
            "required": true,
            "schema": {
              "format": "uuid",
              "type": "string"
            }
          }
        ],
        "responses": {
          "204": {
            "description": "Address deleted successfully"
          },
          "404": {
            "description": "Address not found"
          }
        },
        "summary": "Delete shipping address",
        "x-related-specs": []
      },
      "put": {
        "operationId": "updateAddress",
        "parameters": [
          {
            "in": "path",
            "name": "addressId",
            "required": true,
            "schema": {
              "format": "uuid",
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/ShippingAddressInput"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ShippingAddress"
                }
              }
            },
            "description": "Address updated successfully"
          },
          "400": {
            "content": {
              "application/json": {
                "examples": {
                  "incompleteAddress": {
                    "value": {
                      "code": "INCOMPLETE_ADDRESS",
                      "message": "Please provide all required address fields: name, street, city, state, postal code, and country"
                    }
                  },
                  "internationalShipping": {
                    "value": {
                      "code": "INTERNATIONAL_SHIPPING_NOT_AVAILABLE",
                      "message": "We currently only ship within US. International shipping is not available."
                    }
                  }
                },
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            },
            "description": "Validation error"
          },
          "404": {
            "description": "Address not found"
          }
        },
        "summary": "Update shipping address",
        "x-related-specs": [
          "TS-BR-ADDR-001",
          "TS-BR-SHIP-002"
        ]
      }
    },
    "/api/v1/cart": {
      "delete": {
        "operationId": "clearCart",
        "responses": {
          "204": {
            "description": "Cart cleared successfully"
          }
        },
        "summary": "Clear cart",
        "x-related-specs": []
      },
      "get": {
        "description": "Returns cart with current product prices and price change flags",
        "operationId": "getCart",
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Cart"
                }
              }
            },
            "description": "Cart details with current prices"
          },
          "410": {
            "content": {
              "application/json": {
                "example": {
                  "code": "CART_EXPIRED",
                  "message": "Your cart has expired due to inactivity"
                },
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            },
            "description": "Cart expired"
          }
        },
        "summary": "Get current cart",
        "x-related-specs": [
          "TS-BR-CART-001",
          "TS-BR-CART-003"
        ]
      }
    },
    "/api/v1/cart/items": {
      "post": {
        "operationId": "addCartItem",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "properties": {
                  "productId": {
                    "format": "uuid",
                    "type": "string"
                  },
                  "quantity": {
                    "minimum": 1,
                    "type": "integer"
                  },
                  "variantId": {
                    "description": "Required if product has variants",
                    "format": "uuid",
                    "type": "string"
                  }
                },
                "required": [
                  "productId",
                  "quantity"
                ],
                "type": "object"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "properties": {
                    "actualQuantity": {
                      "type": "integer"
                    },
                    "cart": {
                      "$ref": "#/components/schemas/Cart"
                    },
                    "quantityAdjusted": {
                      "type": "boolean"
                    },
                    "requestedQuantity": {
                      "type": "integer"
                    }
                  },
                  "type": "object"
                }
              }
            },
            "description": "Item added (quantity may be adjusted to available stock)"
          },
          "400": {
            "content": {
              "application/json": {
                "example": {
                  "code": "VARIANT_REQUIRED",
                  "message": "Please select a variant before adding to cart"
                },
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            },
            "description": "Validation error"
          },
          "409": {
            "content": {
              "application/json": {
                "example": {
                  "code": "OUT_OF_STOCK",
                  "message": "This product is currently out of stock"
                },
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            },
            "description": "Stock conflict"
          }
        },
        "summary": "Add item to cart",
        "x-related-specs": [
          "TS-BR-STOCK-001",
          "TS-BR-VAR-002",
          "TS-BR-CART-002"
        ]
      }
    },
    "/api/v1/cart/items/{itemId}": {
      "delete": {
        "operationId": "removeCartItem",
        "parameters": [
          {
            "in": "path",
            "name": "itemId",
            "required": true,
            "schema": {
              "format": "uuid",
              "type": "string"
            }
          }
        ],
        "responses": {
          "204": {
            "description": "Item removed successfully"
          },
          "404": {
            "description": "Cart item not found"
          }
        },
        "summary": "Remove item from cart",
        "x-related-specs": []
      },
      "put": {
        "operationId": "updateCartItem",
        "parameters": [
          {
            "in": "path",
            "name": "itemId",
            "required": true,
            "schema": {
              "format": "uuid",
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "properties": {
                  "quantity": {
                    "minimum": 1,
                    "type": "integer"
                  }
                },
                "required": [
                  "quantity"
                ],
                "type": "object"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "properties": {
                    "actualQuantity": {
                      "type": "integer"
                    },
                    "cart": {
                      "$ref": "#/components/schemas/Cart"
                    },
                    "quantityAdjusted": {
                      "type": "boolean"
                    },
                    "requestedQuantity": {
                      "type": "integer"
                    }
                  },
                  "type": "object"
                }
              }
            },
            "description": "Item updated (quantity may be adjusted to available stock)"
          },
          "404": {
            "description": "Cart item not found"
          }
        },
        "summary": "Update cart item quantity",
        "x-related-specs": [
          "TS-BR-CART-002"
        ]
      }
    },
    "/api/v1/categories": {
      "get": {
        "operationId": "listCategories",
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "items": {
                    "$ref": "#/components/schemas/Category"
                  },
                  "type": "array"
                }
              }
            },
            "description": "List of categories"
          }
        },
        "summary": "List categories",
        "x-related-specs": []
      },
      "post": {
        "operationId": "createCategory",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "properties": {
                  "name": {
                    "type": "string"
                  },
                  "parentId": {
                    "format": "uuid",
                    "type": "string"
                  }
                },
                "required": [
                  "name"
                ],
                "type": "object"
              }
            }
          },
          "required": true
        },
        "responses": {
          "201": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Category"
                }
              }
            },
            "description": "Category created successfully"
          },
          "400": {
            "content": {
              "application/json": {
                "example": {
                  "code": "CATEGORY_DEPTH_EXCEEDED",
                  "message": "Categories cannot be nested more than 3 levels deep"
                },
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            },
            "description": "Validation error"
          }
        },
        "summary": "Create category",
        "x-related-specs": [
          "TS-BR-CAT-001"
        ]
      }
    },
    "/api/v1/customers": {
      "post": {
        "operationId": "registerCustomer",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "properties": {
                  "email": {
                    "format": "email",
                    "maxLength": 255,
                    "type": "string"
                  },
                  "name": {
                    "type": "string"
                  },
                  "password": {
                    "description": "Must be at least 8 characters and contain at least one number",
                    "minLength": 8,
                    "type": "string"
                  }
                },
                "required": [
                  "email",
                  "password",
                  "name"
                ],
                "type": "object"
              }
            }
          },
          "required": true
        },
        "responses": {
          "201": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Customer"
                }
              }
            },
            "description": "Customer registered successfully"
          },
          "400": {
            "content": {
              "application/json": {
                "examples": {
                  "weakPassword": {
                    "value": {
                      "code": "WEAK_PASSWORD",
                      "message": "Password must be at least 8 characters and contain at least one number"
                    }
                  }
                },
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            },
            "description": "Validation error"
          },
          "409": {
            "content": {
              "application/json": {
                "example": {
                  "code": "EMAIL_ALREADY_REGISTERED",
                  "message": "An account with this email address already exists"
                },
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            },
            "description": "Email already registered"
          }
        },
        "summary": "Register a new customer",
        "x-related-specs": [
          "TS-BR-CUST-001",
          "TS-BR-CUST-002"
        ]
      }
    },
    "/api/v1/customers/{customerId}/password": {
      "put": {
        "operationId": "changeCustomerPassword",
        "parameters": [
          {
            "in": "path",
            "name": "customerId",
            "required": true,
            "schema": {
              "format": "uuid",
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "properties": {
                  "currentPassword": {
                    "type": "string"
                  },
                  "newPassword": {
                    "description": "Must be at least 8 characters and contain at least one number",
                    "minLength": 8,
                    "type": "string"
                  }
                },
                "required": [
                  "currentPassword",
                  "newPassword"
                ],
                "type": "object"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Password changed successfully"
          },
          "400": {
            "content": {
              "application/json": {
                "example": {
                  "code": "WEAK_PASSWORD",
                  "message": "Password must be at least 8 characters and contain at least one number"
                },
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            },
            "description": "Weak password"
          },
          "401": {
            "description": "Current password incorrect"
          }
        },
        "summary": "Change customer password",
        "x-related-specs": [
          "TS-BR-CUST-002"
        ]
      }
    },
    "/api/v1/customers/{customerId}/verify-email": {
      "post": {
        "operationId": "verifyCustomerEmail",
        "parameters": [
          {
            "in": "path",
            "name": "customerId",
            "required": true,
            "schema": {
              "format": "uuid",
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "properties": {
                  "verificationToken": {
                    "type": "string"
                  }
                },
                "required": [
                  "verificationToken"
                ],
                "type": "object"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Email verified successfully"
          },
          "400": {
            "description": "Invalid or expired verification token"
          }
        },
        "summary": "Verify customer email address",
        "x-related-specs": [
          "TS-BR-AUTH-001",
          "TS-BR-CUST-003"
        ]
      }
    },
    "/api/v1/inventory/{productId}": {
      "get": {
        "operationId": "getProductInventory",
        "parameters": [
          {
            "in": "path",
            "name": "productId",
            "required": true,
            "schema": {
              "format": "uuid",
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Inventory"
                }
              }
            },
            "description": "Inventory details"
          },
          "404": {
            "description": "Product not found"
          }
        },
        "summary": "Get inventory for product",
        "x-related-specs": [
          "TS-BR-STOCK-001",
          "TS-BR-INV-001"
        ]
      }
    },
    "/api/v1/inventory/{productId}/adjust": {
      "post": {
        "operationId": "adjustInventory",
        "parameters": [
          {
            "in": "path",
            "name": "productId",
            "required": true,
            "schema": {
              "format": "uuid",
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "properties": {
                  "adjustment": {
                    "description": "Positive to increase, negative to decrease",
                    "type": "integer"
                  },
                  "reason": {
                    "maxLength": 200,
                    "type": "string"
                  }
                },
                "required": [
                  "adjustment",
                  "reason"
                ],
                "type": "object"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Inventory"
                }
              }
            },
            "description": "Inventory adjusted successfully"
          },
          "404": {
            "description": "Product not found"
          },
          "409": {
            "content": {
              "application/json": {
                "example": {
                  "code": "INSUFFICIENT_STOCK",
                  "message": "Insufficient stock available"
                },
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            },
            "description": "Insufficient stock"
          }
        },
        "summary": "Adjust inventory stock level",
        "x-related-specs": [
          "TS-BR-INV-001",
          "TS-BR-AUDIT-002"
        ]
      }
    },
    "/api/v1/orders": {
      "get": {
        "operationId": "listOrders",
        "parameters": [
          {
            "in": "query",
            "name": "status",
            "schema": {
              "enum": [
                "pending",
                "confirmed",
                "shipped",
                "delivered",
                "cancelled"
              ],
              "type": "string"
            }
          },
          {
            "in": "query",
            "name": "page",
            "schema": {
              "default": 1,
              "type": "integer"
            }
          },
          {
            "in": "query",
            "name": "limit",
            "schema": {
              "default": 20,
              "type": "integer"
            }
          }
        ],
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "properties": {
                    "items": {
                      "items": {
                        "$ref": "#/components/schemas/Order"
                      },
                      "type": "array"
                    },
                    "limit": {
                      "type": "integer"
                    },
                    "page": {
                      "type": "integer"
                    },
                    "total": {
                      "type": "integer"
                    }
                  },
                  "type": "object"
                }
              }
            },
            "description": "List of orders"
          }
        },
        "summary": "List customer orders",
        "x-related-specs": []
      },
      "post": {
        "description": "Creates order from cart, validates stock, authorizes payment, captures prices at order time",
        "operationId": "createOrder",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "properties": {
                  "paymentMethodId": {
                    "type": "string"
                  },
                  "shippingAddressId": {
                    "format": "uuid",
                    "type": "string"
                  }
                },
                "required": [
                  "shippingAddressId",
                  "paymentMethodId"
                ],
                "type": "object"
              }
            }
          },
          "required": true
        },
        "responses": {
          "201": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Order"
                }
              }
            },
            "description": "Order created successfully"
          },
          "400": {
            "description": "Validation error"
          },
          "401": {
            "content": {
              "application/json": {
                "example": {
                  "code": "REGISTRATION_REQUIRED",
                  "message": "You must be registered to place an order"
                },
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            },
            "description": "Not authenticated"
          },
          "402": {
            "content": {
              "application/json": {
                "example": {
                  "code": "PAYMENT_REQUIRED",
                  "message": "Payment authorization failed. Please try again or use a different payment method."
                },
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            },
            "description": "Payment required"
          },
          "403": {
            "content": {
              "application/json": {
                "example": {
                  "code": "EMAIL_NOT_VERIFIED",
                  "message": "Please verify your email address before placing an order"
                },
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            },
            "description": "Email not verified"
          },
          "409": {
            "content": {
              "application/json": {
                "examples": {
                  "backorderNotSupported": {
                    "value": {
                      "code": "BACKORDER_NOT_SUPPORTED",
                      "message": "One or more items exceed available stock. Backorders are not supported."
                    }
                  },
                  "insufficientStock": {
                    "value": {
                      "code": "INSUFFICIENT_STOCK",
                      "message": "Not enough stock available for checkout"
                    }
                  }
                },
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            },
            "description": "Stock conflict"
          }
        },
        "summary": "Create order (checkout)",
        "x-related-specs": [
          "TS-BR-AUTH-001",
          "TS-BR-STOCK-001",
          "TS-BR-CUST-003",
          "TS-BR-PRICE-002",
          "TS-BR-INV-002",
          "TS-BR-PAY-001",
          "TS-BR-AUDIT-001"
        ]
      }
    },
    "/api/v1/orders/{orderId}": {
      "get": {
        "operationId": "getOrder",
        "parameters": [
          {
            "in": "path",
            "name": "orderId",
            "required": true,
            "schema": {
              "format": "uuid",
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Order"
                }
              }
            },
            "description": "Order details"
          },
          "404": {
            "description": "Order not found"
          }
        },
        "summary": "Get order by ID",
        "x-related-specs": []
      }
    },
    "/api/v1/orders/{orderId}/cancel": {
      "post": {
        "description": "Cancels order, restores inventory, and initiates refund",
        "operationId": "cancelOrder",
        "parameters": [
          {
            "in": "path",
            "name": "orderId",
            "required": true,
            "schema": {
              "format": "uuid",
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "properties": {
                  "reason": {
                    "type": "string"
                  }
                },
                "type": "object"
              }
            }
          }
        },
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Order"
                }
              }
            },
            "description": "Order cancelled successfully"
          },
          "404": {
            "description": "Order not found"
          },
          "409": {
            "content": {
              "application/json": {
                "example": {
                  "code": "CANCELLATION_NOT_ALLOWED",
                  "message": "This order cannot be cancelled as it has already been shipped"
                },
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            },
            "description": "Cancellation not allowed"
          }
        },
        "summary": "Cancel order",
        "x-related-specs": [
          "TS-BR-CANCEL-001",
          "TS-BR-INV-003",
          "TS-BR-PAY-002",
          "TS-BR-AUDIT-001"
        ]
      }
    },
    "/api/v1/orders/{orderId}/status": {
      "put": {
        "description": "Transitions order to new status following state machine rules",
        "operationId": "updateOrderStatus",
        "parameters": [
          {
            "in": "path",
            "name": "orderId",
            "required": true,
            "schema": {
              "format": "uuid",
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "properties": {
                  "status": {
                    "enum": [
                      "confirmed",
                      "shipped",
                      "delivered"
                    ],
                    "type": "string"
                  },
                  "trackingNumber": {
                    "description": "Required when transitioning to shipped",
                    "type": "string"
                  }
                },
                "required": [
                  "status"
                ],
                "type": "object"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Order"
                }
              }
            },
            "description": "Order status updated"
          },
          "403": {
            "content": {
              "application/json": {
                "example": {
                  "code": "ORDER_MODIFICATION_NOT_ALLOWED",
                  "message": "Orders cannot be modified after placement. Please cancel and create a new order."
                },
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            },
            "description": "Modification not allowed"
          },
          "404": {
            "description": "Order not found"
          },
          "409": {
            "content": {
              "application/json": {
                "example": {
                  "code": "INVALID_STATUS_TRANSITION",
                  "message": "Cannot transition order from pending to delivered"
                },
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            },
            "description": "Invalid status transition"
          }
        },
        "summary": "Update order status",
        "x-related-specs": [
          "TS-BR-ORDER-001",
          "TS-BR-ORDER-002",
          "TS-BR-ORDER-003",
          "TS-BR-AUDIT-001"
        ]
      }
    },
    "/api/v1/products": {
      "get": {
        "operationId": "listProducts",
        "parameters": [
          {
            "in": "query",
            "name": "categoryId",
            "schema": {
              "format": "uuid",
              "type": "string"
            }
          },
          {
            "in": "query",
            "name": "page",
            "schema": {
              "default": 1,
              "type": "integer"
            }
          },
          {
            "in": "query",
            "name": "limit",
            "schema": {
              "default": 20,
              "type": "integer"
            }
          }
        ],
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "properties": {
                    "items": {
                      "items": {
                        "$ref": "#/components/schemas/Product"
                      },
                      "type": "array"
                    },
                    "limit": {
                      "type": "integer"
                    },
                    "page": {
                      "type": "integer"
                    },
                    "total": {
                      "type": "integer"
                    }
                  },
                  "type": "object"
                }
              }
            },
            "description": "List of products"
          }
        },
        "summary": "List products",
        "x-related-specs": []
      },
      "post": {
        "operationId": "createProduct",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "properties": {
                  "categoryId": {
                    "format": "uuid",
                    "type": "string"
                  },
                  "description": {
                    "maxLength": 5000,
                    "type": "string"
                  },
                  "name": {
                    "maxLength": 200,
                    "minLength": 2,
                    "type": "string"
                  },
                  "price": {
                    "format": "decimal",
                    "minimum": 0.01,
                    "type": "number"
                  }
                },
                "required": [
                  "name",
                  "price"
                ],
                "type": "object"
              }
            }
          },
          "required": true
        },
        "responses": {
          "201": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Product"
                }
              }
            },
            "description": "Product created successfully"
          },
          "400": {
            "content": {
              "application/json": {
                "examples": {
                  "descriptionTooLong": {
                    "value": {
                      "code": "DESCRIPTION_TOO_LONG",
                      "message": "Product description cannot exceed 5000 characters"
                    }
                  },
                  "invalidName": {
                    "value": {
                      "code": "INVALID_PRODUCT_NAME",
                      "message": "Product name must be between 2 and 200 characters"
                    }
                  },
                  "invalidPrice": {
                    "value": {
                      "code": "INVALID_PRICE",
                      "message": "Product price must be at least $0.01"
                    }
                  }
                },
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            },
            "description": "Validation error"
          }
        },
        "summary": "Create a new product",
        "x-related-specs": [
          "TS-BR-PRICE-001",
          "TS-BR-PROD-002",
          "TS-BR-PROD-003"
        ]
      }
    },
    "/api/v1/products/{productId}": {
      "delete": {
        "description": "Soft-deletes product if it has order history, otherwise hard-deletes",
        "operationId": "deleteProduct",
        "parameters": [
          {
            "in": "path",
            "name": "productId",
            "required": true,
            "schema": {
              "format": "uuid",
              "type": "string"
            }
          }
        ],
        "responses": {
          "204": {
            "description": "Product deleted successfully"
          },
          "404": {
            "description": "Product not found"
          }
        },
        "summary": "Delete product",
        "x-related-specs": [
          "TS-BR-PROD-001"
        ]
      },
      "get": {
        "operationId": "getProduct",
        "parameters": [
          {
            "in": "path",
            "name": "productId",
            "required": true,
            "schema": {
              "format": "uuid",
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Product"
                }
              }
            },
            "description": "Product details"
          },
          "404": {
            "description": "Product not found"
          }
        },
        "summary": "Get product by ID",
        "x-related-specs": []
      },
      "put": {
        "operationId": "updateProduct",
        "parameters": [
          {
            "in": "path",
            "name": "productId",
            "required": true,
            "schema": {
              "format": "uuid",
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "properties": {
                  "categoryId": {
                    "format": "uuid",
                    "type": "string"
                  },
                  "description": {
                    "maxLength": 5000,
                    "type": "string"
                  },
                  "name": {
                    "maxLength": 200,
                    "minLength": 2,
                    "type": "string"
                  },
                  "price": {
                    "format": "decimal",
                    "minimum": 0.01,
                    "type": "number"
                  }
                },
                "type": "object"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Product"
                }
              }
            },
            "description": "Product updated successfully"
          },
          "400": {
            "content": {
              "application/json": {
                "examples": {
                  "descriptionTooLong": {
                    "value": {
                      "code": "DESCRIPTION_TOO_LONG",
                      "message": "Product description cannot exceed 5000 characters"
                    }
                  },
                  "invalidName": {
                    "value": {
                      "code": "INVALID_PRODUCT_NAME",
                      "message": "Product name must be between 2 and 200 characters"
                    }
                  },
                  "invalidPrice": {
                    "value": {
                      "code": "INVALID_PRICE",
                      "message": "Product price must be at least $0.01"
                    }
                  }
                },
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            },
            "description": "Validation error"
          },
          "404": {
            "description": "Product not found"
          }
        },
        "summary": "Update product",
        "x-related-specs": [
          "TS-BR-PRICE-001",
          "TS-BR-PROD-002",
          "TS-BR-PROD-003",
          "TS-BR-AUDIT-003"
        ]
      }
    },
    "/api/v1/products/{productId}/images": {
      "post": {
        "operationId": "uploadProductImage",
        "parameters": [
          {
            "in": "path",
            "name": "productId",
            "required": true,
            "schema": {
              "format": "uuid",
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "content": {
            "multipart/form-data": {
              "schema": {
                "properties": {
                  "image": {
                    "format": "binary",
                    "type": "string"
                  },
                  "isPrimary": {
                    "default": false,
                    "type": "boolean"
                  }
                },
                "required": [
                  "image"
                ],
                "type": "object"
              }
            }
          },
          "required": true
        },
        "responses": {
          "201": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ProductImage"
                }
              }
            },
            "description": "Image uploaded successfully"
          },
          "400": {
            "content": {
              "application/json": {
                "examples": {
                  "imageLimitExceeded": {
                    "value": {
                      "code": "IMAGE_LIMIT_EXCEEDED",
                      "message": "Products cannot have more than 10 images"
                    }
                  },
                  "primaryImageRequired": {
                    "value": {
                      "code": "PRIMARY_IMAGE_REQUIRED",
                      "message": "Product must have exactly one primary image"
                    }
                  }
                },
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            },
            "description": "Validation error"
          },
          "404": {
            "description": "Product not found"
          }
        },
        "summary": "Upload product image",
        "x-related-specs": [
          "TS-BR-PROD-004"
        ]
      }
    },
    "/api/v1/products/{productId}/images/{imageId}/primary": {
      "put": {
        "operationId": "setPrimaryProductImage",
        "parameters": [
          {
            "in": "path",
            "name": "productId",
            "required": true,
            "schema": {
              "format": "uuid",
              "type": "string"
            }
          },
          {
            "in": "path",
            "name": "imageId",
            "required": true,
            "schema": {
              "format": "uuid",
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Primary image set successfully"
          },
          "404": {
            "description": "Product or image not found"
          }
        },
        "summary": "Set primary product image",
        "x-related-specs": [
          "TS-BR-PROD-004"
        ]
      }
    },
    "/api/v1/products/{productId}/variants": {
      "post": {
        "operationId": "createProductVariant",
        "parameters": [
          {
            "in": "path",
            "name": "productId",
            "required": true,
            "schema": {
              "format": "uuid",
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "properties": {
                  "attributes": {
                    "additionalProperties": {
                      "type": "string"
                    },
                    "type": "object"
                  },
                  "name": {
                    "type": "string"
                  },
                  "price": {
                    "format": "decimal",
                    "minimum": 0.01,
                    "type": "number"
                  },
                  "sku": {
                    "maxLength": 100,
                    "type": "string"
                  }
                },
                "required": [
                  "sku",
                  "name",
                  "price"
                ],
                "type": "object"
              }
            }
          },
          "required": true
        },
        "responses": {
          "201": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ProductVariant"
                }
              }
            },
            "description": "Variant created successfully"
          },
          "400": {
            "description": "Validation error"
          },
          "404": {
            "description": "Product not found"
          },
          "409": {
            "content": {
              "application/json": {
                "example": {
                  "code": "DUPLICATE_SKU",
                  "message": "A variant with this SKU already exists"
                },
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            },
            "description": "Duplicate SKU"
          }
        },
        "summary": "Create product variant",
        "x-related-specs": [
          "TS-BR-VAR-001"
        ]
      }
    },
    "/api/v1/shipping/estimate": {
      "post": {
        "description": "Returns shipping cost based on subtotal (free shipping for orders \u003e= $50)",
        "operationId": "calculateShippingEstimate",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "properties": {
                  "addressId": {
                    "format": "uuid",
                    "type": "string"
                  },
                  "subtotal": {
                    "format": "decimal",
                    "type": "number"
                  }
                },
                "required": [
                  "subtotal"
                ],
                "type": "object"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "properties": {
                    "freeShippingThreshold": {
                      "format": "decimal",
                      "type": "number"
                    },
                    "qualifiesForFreeShipping": {
                      "type": "boolean"
                    },
                    "shippingCost": {
                      "format": "decimal",
                      "type": "number"
                    }
                  },
                  "type": "object"
                }
              }
            },
            "description": "Shipping estimate"
          }
        },
        "summary": "Calculate shipping cost estimate",
        "x-related-specs": [
          "TS-BR-SHIP-001"
        ]
      }
    },
    "/api/v1/variants/{variantId}": {
      "put": {
        "operationId": "updateProductVariant",
        "parameters": [
          {
            "in": "path",
            "name": "variantId",
            "required": true,
            "schema": {
              "format": "uuid",
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "properties": {
                  "attributes": {
                    "additionalProperties": {
                      "type": "string"
                    },
                    "type": "object"
                  },
                  "name": {
                    "type": "string"
                  },
                  "price": {
                    "format": "decimal",
                    "minimum": 0.01,
                    "type": "number"
                  },
                  "sku": {
                    "maxLength": 100,
                    "type": "string"
                  }
                },
                "type": "object"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ProductVariant"
                }
              }
            },
            "description": "Variant updated successfully"
          },
          "400": {
            "description": "Validation error"
          },
          "404": {
            "description": "Variant not found"
          },
          "409": {
            "content": {
              "application/json": {
                "example": {
                  "code": "DUPLICATE_SKU",
                  "message": "A variant with this SKU already exists"
                },
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            },
            "description": "Duplicate SKU"
          }
        },
        "summary": "Update product variant",
        "x-related-specs": [
          "TS-BR-VAR-001"
        ]
      }
    }
  }
}