---
title: "Loom CLI Test Cases"
generated: 2025-01-03T14:30:00Z
status: draft
level: L3
---

# Loom CLI L3 Test Cases Specification

## Overview

This document specifies the test case document structure generated by derive-l3. Test cases follow the TDAI (Test-Driven AI Development) methodology.

**Traceability:** Derived from [acceptance-criteria.md](../l1/acceptance-criteria.md) and [aggregate-design.md](../l2/aggregate-design.md).

---

## Test Case Structure

### TC-001: TestCase Entity

**File:** `internal/generator/testcases.go`

```go
type TestCase struct {
    ID              string     `json:"id"`
    Name            string     `json:"name"`
    Category        string     `json:"category"` // positive, negative, boundary, hallucination
    ACRef           string     `json:"ac_ref"`
    BRRefs          []string   `json:"br_refs"`
    Preconditions   []string   `json:"preconditions"`
    TestData        []TestData `json:"test_data"`
    Steps           []string   `json:"steps"`
    ExpectedResults []string   `json:"expected_results"`
    ShouldNot       string     `json:"should_not,omitempty"` // For hallucination prevention tests
}

type TestData struct {
    Field string      `json:"field"`
    Value interface{} `json:"value"`
    Notes string      `json:"notes"`
}
```

**ID Pattern:** `TC-AC-{DOMAIN}-{AC_NUM}-{TYPE}{SEQ}`

Where:
- `{DOMAIN}` - Domain code from AC (e.g., ORD, USR)
- `{AC_NUM}` - AC number (e.g., 001)
- `{TYPE}` - Test type: P (positive), N (negative), B (boundary), H (hallucination)
- `{SEQ}` - Sequence number (01, 02, ...)

**Example:** `TC-AC-ORD-001-P01` (first positive test for AC-ORD-001)

**Related DEC:** DEC-017 (Test case ID pattern)

---

### TC-002: TestSuite Entity

**Purpose:** Groups test cases for a single Acceptance Criteria.

```go
type TestSuite struct {
    ACRef   string     `json:"ac_ref"`
    ACTitle string     `json:"ac_title"`
    Tests   []TestCase `json:"tests"`
}
```

---

### TC-003: TDAISummary Entity

**Purpose:** Statistics about generated tests for validation compliance.

```go
type TDAISummary struct {
    Total      int `json:"total"`
    ByCategory struct {
        Positive      int `json:"positive"`
        Negative      int `json:"negative"`
        Boundary      int `json:"boundary"`
        Hallucination int `json:"hallucination"`
    } `json:"by_category"`
    Coverage struct {
        ACsCovered            int     `json:"acs_covered"`
        PositiveRatio         float64 `json:"positive_ratio"`
        NegativeRatio         float64 `json:"negative_ratio"`
        HasHallucinationTests bool    `json:"has_hallucination_tests"`
    } `json:"coverage"`
}
```

---

## Test Categories

### CAT-001: Positive Tests (Happy Path)

**Purpose:** Verify expected behavior under normal conditions.

**Naming:** `TC-AC-{DOMAIN}-{NUM}-P{SEQ}`

**Requirements per AC:** At least 1 positive test

**Example:**
```markdown
### TC-AC-ORD-001-P01: Successfully create order with valid data

**Preconditions:**
- Customer is logged in
- Products are in stock

**Test Data:**
| Field | Value | Notes |
|-------|-------|-------|
| customerId | CUST-001 | Valid customer |
| items | [{ productId: "PROD-001", qty: 2 }] | In stock |

**Steps:**
1. Submit order creation request

**Expected Results:**
- Order is created with status "pending"
- Order ID is returned
```

---

### CAT-002: Negative Tests (Error Cases)

**Purpose:** Verify proper error handling for invalid inputs and edge cases.

**Naming:** `TC-AC-{DOMAIN}-{NUM}-N{SEQ}`

**Requirements:** At least 20% of tests must be negative (V008)

**Example:**
```markdown
### TC-AC-ORD-001-N01: Reject order with invalid customer

**Preconditions:**
- Products are in stock

**Test Data:**
| Field | Value | Notes |
|-------|-------|-------|
| customerId | INVALID-999 | Non-existent customer |

**Steps:**
1. Submit order creation request

**Expected Results:**
- Error code: CUSTOMER_NOT_FOUND
- Order is not created
```

---

### CAT-003: Boundary Tests

**Purpose:** Verify behavior at boundary values.

**Naming:** `TC-AC-{DOMAIN}-{NUM}-B{SEQ}`

**Common boundaries:**
- Min/max quantities
- Empty collections
- Zero values
- Maximum string lengths

---

### CAT-004: Hallucination Prevention Tests

**Purpose:** Ensure AI doesn't invent features or data not in requirements.

**Naming:** `TC-AC-{DOMAIN}-{NUM}-H{SEQ}`

**Requirements:** Every AC should have at least 1 hallucination test (V009)

**Special field:** `should_not` - Describes what the system must NOT do

**Example:**
```markdown
### TC-AC-ORD-001-H01: Order creation should not auto-approve

**⚠️ Should NOT:** Automatically approve orders without payment verification

**Preconditions:**
- Order is submitted

**Steps:**
1. Create order
2. Check order status

**Expected Results:**
- Order status is "pending"
- Order status is NOT "approved"
```

---

## Output Format

### OUT-001: test-cases.md

**File:** `{output-dir}/test-cases.md`

**Structure:**
```markdown
---
title: TDAI Test Cases
generated: 2024-01-15T10:30:00Z
status: draft
level: L3
---

# TDAI Test Cases

**Methodology:** Test-Driven AI Development (TDAI)

## Summary

| Category | Count | Ratio |
|----------|-------|-------|
| Positive | 15 | 45% |
| Negative | 12 | 36% |
| Boundary | 4 | - |
| Hallucination Prevention | 6 | - |
| **Total** | **37** | - |

**Coverage:** 12 ACs covered
**Hallucination Prevention:** ✓ Enabled

---

## Positive Tests (Happy Path)

### TC-AC-ORD-001-P01: ...

---

## Negative Tests (Error Cases)

### TC-AC-ORD-001-N01: ...

---

## Boundary Tests

### TC-AC-ORD-001-B01: ...

---

## Hallucination Prevention Tests

### TC-AC-ORD-001-H01: ...
```

---

## Validation Rules

| Rule | Description | Implementation |
|------|-------------|----------------|
| V005 | Every AC has at least 1 test case | Count tests per ACRef |
| V008 | Negative test ratio >= 20% | `summary.coverage.negative_ratio >= 0.2` |
| V009 | Every AC has hallucination prevention test | `summary.coverage.has_hallucination_tests` |

---

## Generation Process

### SEQ-TC-001: Test Case Generation

**Input:** `acceptance-criteria.md` (L1)

**Process:**
1. Parse AC content into chunks (5 ACs per batch)
2. For each chunk, generate test cases via Claude
3. Ensure coverage requirements are met
4. Collect and flatten test suites
5. Calculate summary statistics

**Output:** `test-cases.md`, `l3-output.json` (partial)

---

## Related Documents

| Level | Document | Description |
|-------|----------|-------------|
| L0 | [decisions.md](../l0/decisions.md) | Design Decisions (L0→L1) |
| L1 | [acceptance-criteria.md](../l1/acceptance-criteria.md) | Acceptance Criteria (source) |
| L1 | [business-rules.md](../l1/business-rules.md) | Business Rules |
| L1 | [decisions.md](../l1/decisions.md) | Design Decisions (L1→L2) |
| L2 | [decisions.md](../l2/decisions.md) | Design Decisions (L2→L3) |
| L2 | [aggregate-design.md](../l2/aggregate-design.md) | Aggregate Design |
| L3 | This document | Test Cases Specification |
| L3 | [openapi-spec.md](openapi-spec.md) | API Specification |
