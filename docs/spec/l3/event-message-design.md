---
title: "Loom CLI Event & Message Design"
generated: 2025-01-03T14:30:00Z
status: draft
level: L3
---

# Loom CLI L3 Event & Message Design Specification

## Overview

This document specifies the event and message design document structure generated by derive-l3.

**Traceability:** Derived from [domain-model.md](../l1/domain-model.md) and [sequence-design.md](../l2/sequence-design.md).

---

## Event Structure

### EVT-DOM-001: DomainEvent Entity

**File:** `cmd/derive_l3.go`

```go
type DomainEvent struct {
    ID                  string         `json:"id"`
    Name                string         `json:"name"`
    Purpose             string         `json:"purpose"`
    Trigger             string         `json:"trigger"`
    Aggregate           string         `json:"aggregate"`
    Payload             []EventField   `json:"payload"`
    InvariantsReflected []string       `json:"invariants_reflected"`
    Consumers           []string       `json:"consumers"`
    Version             string         `json:"version"`
}

type EventField struct {
    Field string `json:"field"`
    Type  string `json:"type"`
}
```

**ID Pattern:** `EVT-{DOMAIN}-{NNN}`

Where:
- `{DOMAIN}` - Domain code (e.g., ORD, USR)
- `{NNN}` - Sequence number

**Example:** `EVT-ORD-001` (OrderCreated event)

**Related DEC:** DEC-022 (L3 document ID prefixes)

---

### CMD-ENT-001: Command Entity

**File:** `cmd/derive_l3.go`

```go
type Command struct {
    ID                string       `json:"id"`
    Name              string       `json:"name"`
    Intent            string       `json:"intent"`
    RequiredData      []EventField `json:"required_data"`
    ExpectedOutcome   string       `json:"expected_outcome"`
    FailureConditions []string     `json:"failure_conditions"`
}
```

**ID Pattern:** `CMD-{DOMAIN}-{NNN}`

**Example:** `CMD-ORD-001` (CreateOrder command)

---

### INT-EVT-001: IntegrationEvent Entity

**File:** `cmd/derive_l3.go`

```go
type IntegrationEvent struct {
    ID        string   `json:"id"`
    Name      string   `json:"name"`
    Purpose   string   `json:"purpose"`
    Source    string   `json:"source"`
    Consumers []string `json:"consumers"`
    Payload   []string `json:"payload"`
}
```

**ID Pattern:** `INT-{DOMAIN}-{NNN}`

**Example:** `INT-ORD-001` (OrderPlaced integration event)

---

## Output Format

### OUT-001: event-message-design.md

**File:** `{output-dir}/event-message-design.md`

**Structure:**
```markdown
---
title: Event & Message Design
generated: 2024-01-15T10:30:00Z
status: draft
level: L3
---

# Event & Message Design

---

## Domain Events

### EVT-ORD-001: OrderCreated

**Purpose:** Notifies the system that a new order has been created.

**Trigger:** Order aggregate created

**Aggregate:** Order | **Version:** 1.0

**Payload:**
- `orderId`: string
- `customerId`: string
- `totalAmount`: decimal
- `createdAt`: datetime

**Invariants Reflected:** [Order must have valid customer, Order must have items]

**Consumers:** [NotificationService, AnalyticsService]

---

## Commands

### CMD-ORD-001: CreateOrder

**Intent:** Create a new order for a customer.

**Expected Outcome:** Order is created with status "pending".

**Required Data:**
- `customerId`: string
- `items`: OrderItem[]

**Failure Conditions:** [InvalidCustomer, EmptyItems, OutOfStock]

---

## Integration Events

### INT-ORD-001: OrderPlaced

**Purpose:** Notify external systems of a placed order.

**Source:** OrderService

**Consumers:** [WarehouseSystem, ERPSystem]

**Payload:** [orderId, customerId, items, totalAmount]

---
```

---

## Generation Process

### SEQ-EVT-001: Event Design Generation

**Input:**
- `domain-model.md` (L1)
- `sequence-design.md` (L2)

**Prompt:** Uses `prompts.DeriveEventDesign`

**Process:**
1. Read domain model and sequence design
2. Generate events, commands, integration events via Claude
3. Parse event structure
4. Format as markdown

**Output:** `event-message-design.md`

---

## Related Documents

| Level | Document | Description |
|-------|----------|-------------|
| L0 | [decisions.md](../l0/decisions.md) | Design Decisions (L0→L1) |
| L1 | [domain-model.md](../l1/domain-model.md) | Domain Model (source) |
| L1 | [decisions.md](../l1/decisions.md) | Design Decisions (L1→L2) |
| L2 | [decisions.md](../l2/decisions.md) | Design Decisions (L2→L3) |
| L2 | [sequence-design.md](../l2/sequence-design.md) | Sequence Design (source) |
| L3 | [service-boundaries.md](service-boundaries.md) | Service Boundaries |
| L3 | This document | Event & Message Design |
| L3 | [dependency-graph.md](dependency-graph.md) | Dependency Graph |
