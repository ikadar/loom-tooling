# decisions.md Format Specification

The `decisions.md` file persists interview answers across derivation runs. It lives alongside L0 input files and is version-controlled with the project.

## Purpose

1. **Persistence** - Answers are saved, not asked again on re-run
2. **Traceability** - Decisions are documented with timestamp and source
3. **Version Control** - Changes to decisions are tracked in git
4. **Human Editable** - Can be manually updated if decisions change

## File Location

```
input/
├── project-brief.md      # L0 - original input
├── user-stories.md       # L0 - original input
└── decisions.md          # Decision log (auto-generated, human-editable)
```

## File Format

```markdown
---
# decisions.md - Loom Decision Log
# Generated by: loom-derive v4.1.0
# Last updated: 2025-12-21T12:00:00Z
# Total decisions: 87
---

## Entity Decisions

### {EntityName}

- **{AMB-ID}: {Short Title}**
  - Q: {Original question}
  - A: {Answer given}
  - Decided: {YYYY-MM-DD} by {user|default}

### Station

- **AMB-ENT-001: Deletion behavior**
  - Q: What happens to tasks when station deleted?
  - A: Block deletion if tasks exist
  - Decided: 2025-12-21 by user

- **AMB-ENT-002: Name uniqueness**
  - Q: Must station name be unique?
  - A: Yes, unique within organization
  - Decided: 2025-12-21 by user

### Job

- **AMB-ENT-010: Late threshold**
  - Q: When is a job considered "late"?
  - A: When any task misses its deadline by > 0 minutes
  - Decided: 2025-12-21 by user

## Operation Decisions

### {OperationName}

- **{AMB-ID}: {Short Title}**
  - Q: {Original question}
  - A: {Answer given}
  - Decided: {YYYY-MM-DD} by {user|default}

### Schedule Task

- **AMB-OP-001: Overlap behavior**
  - Q: What happens when task overlaps existing?
  - A: Block with error, show conflict details
  - Decided: 2025-12-21 by user

- **AMB-OP-002: Time granularity**
  - Q: What is the time snap granularity for scheduling?
  - A: 15 minutes
  - Decided: 2025-12-21 by user

## UI Decisions

- **AMB-UI-001: Drag feedback**
  - Q: What visual feedback during task drag?
  - A: Ghost image + valid/invalid drop zone highlighting
  - Decided: 2025-12-21 by user

## Defaults Accepted

The following minor decisions use suggested defaults:

| ID | Question | Default | Accepted |
|----|----------|---------|----------|
| AMB-ENT-050 | Max station name length | 100 chars | 2025-12-21 |
| AMB-ENT-051 | Max job title length | 200 chars | 2025-12-21 |
| AMB-OP-050 | Operation timeout | 30 seconds | 2025-12-21 |
| AMB-OP-051 | Audit log retention | 90 days | 2025-12-21 |
| AMB-UI-050 | Animation duration | 200ms | 2025-12-21 |
```

## Parsing Rules

When loading `decisions.md`:

1. **Skip frontmatter** - YAML between `---` markers
2. **Parse sections** - `## Entity Decisions`, `## Operation Decisions`, etc.
3. **Parse entries** - Each `- **AMB-XXX: Title**` block
4. **Extract Q/A** - Lines starting with `Q:` and `A:`
5. **Match by question** - Use question text, not ID (IDs may change)

## Matching Logic

```yaml
# When checking if an ambiguity is already resolved:

ambiguity:
  id: "AMB-ENT-001"
  question: "What happens to tasks when station deleted?"

# Search decisions.md for similar question
# Use fuzzy matching (normalize whitespace, case-insensitive)
# Match threshold: 90% similarity

existing_decision:
  question: "What happens to tasks when station deleted?"
  answer: "Block deletion if tasks exist"

# Result: MATCH - skip this question in interview
```

## Manual Editing

Users can manually edit `decisions.md` to:

1. **Change a decision** - Update the `A:` line
2. **Remove a decision** - Delete the entire entry (will be asked again)
3. **Add notes** - Add context below the entry
4. **Re-order** - Move entries for better organization

## Conflict Resolution

If the same question appears multiple times:
1. Use the **last occurrence** in the file
2. Log a warning about duplicate decisions

## Version History

Track decision changes via git:

```bash
git log -p decisions.md
```

This shows when decisions were made and any changes over time.
